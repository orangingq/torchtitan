
üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
‚úîÔ∏èCurrent Timestamp: Tue Sep 23 17:06:25 UTC 2025
‚úîÔ∏èSERVER: 30be631344fa (172.18.0.2),  GPUs: 0,1,2,3,4,5,6,7
‚úîÔ∏èSCRIPT: 
‚úîÔ∏èOUTPUT: /workspace/torchtitan/logs/runpod8/0922_main/0922_gpipe_apf.ans
‚úîÔ∏èMain Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs
‚úîÔ∏èRunning with apf x gpipe ... 
‚òëÔ∏è> torchrun --standalone --nnodes=1 --nproc_per_node=8 --local-ranks-filter=0,1,2,3,4,5,6,7 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/workspace/torchtitan/logs/runpod8/0922_main/config.toml --job.description="Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs" --training.global_batch_size=128 --training.local_batch_size=8 --parallelism.pipeline_parallel_microbatch_size=1  --freezing.freeze --freezing.metric_type=apf --freezing.aggressiveness=0.05
üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
W0923 17:06:26.972000 23851 torch/distributed/run.py:815] 
W0923 17:06:26.972000 23851 torch/distributed/run.py:815] *****************************************
W0923 17:06:26.972000 23851 torch/distributed/run.py:815] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0923 17:06:26.972000 23851 torch/distributed/run.py:815] *****************************************
[rank4]:[titan] 2025-09-23 17:06:35,103 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank4]:[titan] 2025-09-23 17:06:35,374 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank4]:[titan] 2025-09-23 17:06:35,378 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank2]:[titan] 2025-09-23 17:06:35,801 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank6]:[titan] 2025-09-23 17:06:35,812 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank1]:[titan] 2025-09-23 17:06:35,826 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank3]:[titan] 2025-09-23 17:06:35,833 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank0]:[titan] 2025-09-23 17:06:35,990 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank5]:[titan] 2025-09-23 17:06:36,273 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank7]:[titan] 2025-09-23 17:06:36,252 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank2]:[titan] 2025-09-23 17:06:36,590 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:[titan] 2025-09-23 17:06:36,593 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank6]:[titan] 2025-09-23 17:06:36,656 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank6]:[titan] 2025-09-23 17:06:36,659 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank1]:[titan] 2025-09-23 17:06:36,755 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:[titan] 2025-09-23 17:06:36,758 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank3]:[titan] 2025-09-23 17:06:36,836 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:[titan] 2025-09-23 17:06:36,840 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:06:37,088 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:[titan] 2025-09-23 17:06:37,092 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:06:37,098 - root - INFO - [GC] Initial GC collection 0.00 seconds
[rank5]:[titan] 2025-09-23 17:06:37,295 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank5]:[titan] 2025-09-23 17:06:37,298 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank7]:[titan] 2025-09-23 17:06:37,296 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank7]:[titan] 2025-09-23 17:06:37,299 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:06:38,416 - root - INFO - Loading tokenizer from tokenizer.json
[rank0]:[titan] 2025-09-23 17:06:38,756 - root - INFO - Preparing slimorca dataset from Open-Orca/SlimOrca
[rank0]:[titan] 2025-09-23 17:06:40,285 - root - INFO - Building llama3 8B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=4096, n_layers=32, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=1024, ffn_dim_multiplier=1.3, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank0]:[titan] 2025-09-23 17:06:40,583 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank1]:[titan] 2025-09-23 17:06:40,558 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank5]:[titan] 2025-09-23 17:06:40,593 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank4]:[titan] 2025-09-23 17:06:40,552 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank7]:[titan] 2025-09-23 17:06:40,583 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank0]:[titan] 2025-09-23 17:06:40,658 - root - INFO - [34mModel llama3 8B [31msize: 8,030,261,248 total parameters[39m
[rank0]:[titan] 2025-09-23 17:06:40,684 - root - INFO - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3', 'layers.4', 'layers.5', 'layers.6', 'layers.7']
[rank2]:[titan] 2025-09-23 17:06:40,627 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank2]:[titan] 2025-09-23 17:06:40,713 - root - INFO - PP rank 1 is building stage_idx 1 with modules ['layers.8', 'layers.9', 'layers.10', 'layers.11', 'layers.12', 'layers.13', 'layers.14', 'layers.15', 'layers.16']
[rank1]:[titan] 2025-09-23 17:06:40,649 - root - INFO - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3', 'layers.4', 'layers.5', 'layers.6', 'layers.7']
[rank1]:[titan] 2025-09-23 17:06:40,683 - root - INFO - Applied FSDP to the model
[rank1]:[titan] 2025-09-23 17:06:40,683 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank5]:[titan] 2025-09-23 17:06:40,692 - root - INFO - PP rank 2 is building stage_idx 2 with modules ['layers.17', 'layers.18', 'layers.19', 'layers.20', 'layers.21', 'layers.22', 'layers.23', 'layers.24']
[rank4]:[titan] 2025-09-23 17:06:40,636 - root - INFO - PP rank 2 is building stage_idx 2 with modules ['layers.17', 'layers.18', 'layers.19', 'layers.20', 'layers.21', 'layers.22', 'layers.23', 'layers.24']
[rank4]:[titan] 2025-09-23 17:06:40,668 - root - INFO - Applied FSDP to the model
[rank4]:[titan] 2025-09-23 17:06:40,668 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank3]:[titan] 2025-09-23 17:06:40,648 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank7]:[titan] 2025-09-23 17:06:40,690 - root - INFO - PP rank 3 is building stage_idx 3 with modules ['layers.25', 'layers.26', 'layers.27', 'layers.28', 'layers.29', 'layers.30', 'layers.31', 'norm', 'output']
[rank7]:[titan] 2025-09-23 17:06:40,723 - root - INFO - Applied FSDP to the model
[rank7]:[titan] 2025-09-23 17:06:40,723 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank0]:[titan] 2025-09-23 17:06:40,719 - root - INFO - Applied FSDP to the model
[rank0]:[titan] 2025-09-23 17:06:40,719 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank2]:[titan] 2025-09-23 17:06:40,747 - root - INFO - Applied FSDP to the model
[rank2]:[titan] 2025-09-23 17:06:40,747 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank5]:[titan] 2025-09-23 17:06:40,727 - root - INFO - Applied FSDP to the model
[rank5]:[titan] 2025-09-23 17:06:40,727 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank3]:[titan] 2025-09-23 17:06:40,721 - root - INFO - PP rank 1 is building stage_idx 1 with modules ['layers.8', 'layers.9', 'layers.10', 'layers.11', 'layers.12', 'layers.13', 'layers.14', 'layers.15', 'layers.16']
[rank3]:[titan] 2025-09-23 17:06:40,757 - root - INFO - Applied FSDP to the model
[rank3]:[titan] 2025-09-23 17:06:40,757 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank4]:[titan] 2025-09-23 17:06:40,917 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank4]:[titan] 2025-09-23 17:06:40,917 - root - INFO - CUDA memory usage for model: 3.26GiB(4.12%)
[rank1]:[titan] 2025-09-23 17:06:41,021 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:[titan] 2025-09-23 17:06:41,021 - root - INFO - CUDA memory usage for model: 4.24GiB(5.35%)
[rank5]:[titan] 2025-09-23 17:06:41,115 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank5]:[titan] 2025-09-23 17:06:41,115 - root - INFO - CUDA memory usage for model: 3.26GiB(4.12%)
[rank0]:[titan] 2025-09-23 17:06:41,156 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:[titan] 2025-09-23 17:06:41,157 - root - INFO - CUDA memory usage for model: 4.24GiB(5.35%)
[rank2]:[titan] 2025-09-23 17:06:41,161 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:[titan] 2025-09-23 17:06:41,162 - root - INFO - CUDA memory usage for model: 3.67GiB(4.64%)
[rank3]:[titan] 2025-09-23 17:06:41,160 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:[titan] 2025-09-23 17:06:41,161 - root - INFO - CUDA memory usage for model: 3.67GiB(4.64%)
[rank7]:[titan] 2025-09-23 17:06:41,139 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank7]:[titan] 2025-09-23 17:06:41,139 - root - INFO - CUDA memory usage for model: 3.83GiB(4.83%)
[rank6]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank6]:wandb: creating run
[rank6]:wandb: Tracking run with wandb version 0.22.0
[rank6]:wandb: Run data is saved locally in /workspace/torchtitan_data/tb/0922_gpipe_apf_runpod/20250923-1706/wandb/run-20250923_170641-tod3gwln
[rank6]:wandb: Run `wandb offline` to turn off syncing.
[rank6]:wandb: Syncing run 0922_gpipe_apf_runpod
[rank6]:wandb: ‚≠êÔ∏è View project at https://wandb.ai/orangingq/torchtitan
[rank6]:wandb: üöÄ View run at https://wandb.ai/orangingq/torchtitan/runs/tod3gwln
[rank6]:[titan] 2025-09-23 17:06:42,862 - root - INFO - WandB logging enabled
[rank6]:[titan] 2025-09-23 17:06:42,863 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank6]:[titan] 2025-09-23 17:06:42,929 - root - INFO - PP rank 3 is building stage_idx 3 with modules ['layers.25', 'layers.26', 'layers.27', 'layers.28', 'layers.29', 'layers.30', 'layers.31', 'norm', 'output']
[rank6]:[titan] 2025-09-23 17:06:42,964 - root - INFO - Applied FSDP to the model
[rank6]:[titan] 2025-09-23 17:06:42,964 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank6]:[titan] 2025-09-23 17:06:43,208 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank6]:[titan] 2025-09-23 17:06:43,209 - root - INFO - CUDA memory usage for model: 3.83GiB(4.83%)
[rank0]:[titan] 2025-09-23 17:06:43,230 - root - INFO - Checkpointing active. Checkpoints will be loaded from and saved to /workspace/torchtitan_data/checkpoint/0922_gpipe_apf_runpod
[rank0]:[titan] 2025-09-23 17:06:43,231 - root - INFO - Mixed precision training is handled by fully_shard
[rank0]:[titan] 2025-09-23 17:06:43,234 - root - INFO - Trainer is initialized with local batch size 8, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 1000 (warmup 20)
[rank0]:[titan] 2025-09-23 17:06:43,235 - root - INFO - Training starts at step 1
[rank0]:/usr/local/lib/python3.11/dist-packages/torch/autograd/graph.py:841: UserWarning: Attempting to run cuBLAS, but there was no current CUDA context! Attempting to set the primary context... (Triggered internally at /pytorch/aten/src/ATen/cuda/CublasHandlePool.cpp:270.)
[rank0]:  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
[rank5]:[titan] 2025-09-23 17:06:58,572 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 28.25GiB(35.65%) [34m tps: 915 [36m tflops: 42.67 [35m mfu: 13.68%[39m
[rank5]:[titan] 2025-09-23 17:06:58,572 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank0]:[titan] 2025-09-23 17:06:58,584 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 35.46GiB(44.74%) [34m tps: 914 [36m tflops: 42.63 [35m mfu: 13.66%[39m
[rank0]:[titan] 2025-09-23 17:06:58,584 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank6]:[titan] 2025-09-23 17:06:58,573 - root - INFO - [31m step:  1 [32m loss: 12.2558 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 38.21GiB(48.22%) [34m tps: 1,045 [36m tflops: 48.76 [35m mfu: 15.63%[39m
[rank6]:[titan] 2025-09-23 17:06:58,574 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank2]:[titan] 2025-09-23 17:06:58,585 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 31.52GiB(39.77%) [34m tps: 915 [36m tflops: 42.69 [35m mfu: 13.68%[39m
[rank2]:[titan] 2025-09-23 17:06:58,586 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank1]:[titan] 2025-09-23 17:06:58,584 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 35.46GiB(44.74%) [34m tps: 912 [36m tflops: 42.54 [35m mfu: 13.64%[39m
[rank1]:[titan] 2025-09-23 17:06:58,584 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank4]:[titan] 2025-09-23 17:06:58,571 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 28.25GiB(35.65%) [34m tps: 912 [36m tflops: 42.54 [35m mfu: 13.63%[39m
[rank4]:[titan] 2025-09-23 17:06:58,572 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank3]:[titan] 2025-09-23 17:06:58,585 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 31.52GiB(39.77%) [34m tps: 916 [36m tflops: 42.71 [35m mfu: 13.69%[39m
[rank3]:[titan] 2025-09-23 17:06:58,586 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank7]:[titan] 2025-09-23 17:06:58,572 - root - INFO - [31m step:  1 [32m loss: 12.2558 [38;2;180;60;0m grad_norm:  0.6801 [38;2;54;234;195m memory: 38.21GiB(48.22%) [34m tps: 915 [36m tflops: 42.67 [35m mfu: 13.68%[39m
[rank7]:[titan] 2025-09-23 17:06:58,572 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank5]:[titan] 2025-09-23 17:10:31,637 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 17:10:31,712 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 17:10:31,974 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:10:32,008 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:10:32,815 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 17:10:32,812 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 17:10:33,445 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 17:10:33,511 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:12:37,282 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank1]:[titan] 2025-09-23 17:12:37,285 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank6]:[titan] 2025-09-23 17:12:37,278 - root - INFO - [31m step: 40 [32m loss:  6.8280 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank5]:[titan] 2025-09-23 17:12:37,279 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank4]:[titan] 2025-09-23 17:12:37,279 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank7]:[titan] 2025-09-23 17:12:37,278 - root - INFO - [31m step: 40 [32m loss:  6.8280 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank3]:[titan] 2025-09-23 17:12:37,282 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank0]:[titan] 2025-09-23 17:12:37,286 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0425 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,887 [36m tflops: 87.99 [35m mfu: 28.20%[39m
[rank6]:[titan] 2025-09-23 17:12:37,499 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1712_real_step40_rank6.svg
[rank6]:> Batch Time: 1052.89 ms, GPU Bubble Ratio: 40.22%, 38.06%, 44.59%, 35.95%
[rank6]:[titan] 2025-09-23 17:12:37,568 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1712_stage3_step40.svg
[rank7]:[titan] 2025-09-23 17:12:37,503 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1712_real_step40_rank7.svg
[rank7]:> Batch Time: 1056.34 ms, GPU Bubble Ratio: 40.31%, 37.85%, 44.94%, 36.04%
[rank7]:[titan] 2025-09-23 17:12:37,569 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1712_stage3_step40.svg
[rank0]:[titan] 2025-09-23 17:13:52,043 - root - INFO - [GC] Peforming periodical GC collection 0.28 seconds
[rank2]:[titan] 2025-09-23 17:14:00,433 - root - INFO - Destroying the purge thread.
[rank2]:[rank2]: Traceback (most recent call last):
[rank2]:[rank2]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank2]:[rank2]:   File "<frozen runpy>", line 88, in _run_code
[rank2]:[rank2]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank2]:[rank2]:     trainer.train()
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank2]:[rank2]:     return f(*args, **kwargs)
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank2]:[rank2]:     self.train_step(data_iterator)
[rank2]:[rank2]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank2]:[rank2]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank2]:[rank2]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank2]:[rank2]:     self._calculate_freezing_metric()
[rank2]:[rank2]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank2]:[rank2]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank2]:[rank2]:                                  ^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank2]:[rank2]:     return disable_fn(*args, **kwargs)
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank2]:[rank2]:     return fn(*args, **kwargs)
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank2]:[rank2]:     return DTensor._op_dispatcher.dispatch(
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank2]:[rank2]:     self.redistribute_local_args(
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank2]:[rank2]:     resharded_local_tensor = redistribute_local_tensor(
[rank2]:[rank2]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank2]:[rank2]:     new_local_tensor = partial_spec._reduce_value(
[rank2]:[rank2]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank2]:[rank2]:     return funcol.all_reduce(
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank2]:[rank2]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank2]:[rank2]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank2]:[rank2]:     return self._op(*args, **kwargs)
[rank2]:[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:[rank2]: RuntimeError: No backend type associated with device type cpu
[rank6]:[titan] 2025-09-23 17:14:00,416 - root - INFO - Destroying the purge thread.
[rank5]:[titan] 2025-09-23 17:14:00,415 - root - INFO - Destroying the purge thread.
[rank5]:[rank5]: Traceback (most recent call last):
[rank5]:[rank5]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank5]:[rank5]:   File "<frozen runpy>", line 88, in _run_code
[rank5]:[rank5]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank5]:[rank5]:     trainer.train()
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank5]:[rank5]:     return f(*args, **kwargs)
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank5]:[rank5]:     self.train_step(data_iterator)
[rank5]:[rank5]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank5]:[rank5]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank5]:[rank5]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank5]:[rank5]:     self._calculate_freezing_metric()
[rank5]:[rank5]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank5]:[rank5]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank5]:[rank5]:                                  ^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank5]:[rank5]:     return disable_fn(*args, **kwargs)
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank5]:[rank5]:     return fn(*args, **kwargs)
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank5]:[rank5]:     return DTensor._op_dispatcher.dispatch(
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank5]:[rank5]:     self.redistribute_local_args(
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank5]:[rank5]:     resharded_local_tensor = redistribute_local_tensor(
[rank5]:[rank5]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank5]:[rank5]:     new_local_tensor = partial_spec._reduce_value(
[rank5]:[rank5]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank5]:[rank5]:     return funcol.all_reduce(
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank5]:[rank5]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank5]:[rank5]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank5]:[rank5]:     return self._op(*args, **kwargs)
[rank5]:[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:[rank5]: RuntimeError: No backend type associated with device type cpu
[rank4]:[titan] 2025-09-23 17:14:00,415 - root - INFO - Destroying the purge thread.
[rank4]:[rank4]: Traceback (most recent call last):
[rank4]:[rank4]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank4]:[rank4]:   File "<frozen runpy>", line 88, in _run_code
[rank4]:[rank4]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank4]:[rank4]:     trainer.train()
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank4]:[rank4]:     return f(*args, **kwargs)
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank4]:[rank4]:     self.train_step(data_iterator)
[rank4]:[rank4]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank4]:[rank4]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank4]:[rank4]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank4]:[rank4]:     self._calculate_freezing_metric()
[rank4]:[rank4]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank4]:[rank4]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank4]:[rank4]:                                  ^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank4]:[rank4]:     return disable_fn(*args, **kwargs)
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank4]:[rank4]:     return fn(*args, **kwargs)
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank4]:[rank4]:     return DTensor._op_dispatcher.dispatch(
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank4]:[rank4]:     self.redistribute_local_args(
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank4]:[rank4]:     resharded_local_tensor = redistribute_local_tensor(
[rank4]:[rank4]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank4]:[rank4]:     new_local_tensor = partial_spec._reduce_value(
[rank7]:[titan] 2025-09-23 17:14:00,418 - root - INFO - Destroying the purge thread.
[rank7]:[rank7]: Traceback (most recent call last):
[rank7]:[rank7]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank4]:[rank4]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "<frozen runpy>", line 88, in _run_code
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank4]:[rank4]:     return funcol.all_reduce(
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:     trainer.train()
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank4]:[rank4]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank4]:[rank4]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank4]:[rank4]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank7]:[rank7]:     return f(*args, **kwargs)
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank7]:[rank7]:     self.train_step(data_iterator)
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank7]:[rank7]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank7]:[rank7]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank7]:[rank7]:     self._calculate_freezing_metric()
[rank4]:[rank4]:     return self._op(*args, **kwargs)
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank7]:[rank7]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank7]:[rank7]:                                  ^^^^^^^^^^^^^^^^^^^
[rank4]:[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank4]:[rank4]: RuntimeError: No backend type associated with device type cpu
[rank7]:[rank7]:     return disable_fn(*args, **kwargs)
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank7]:[rank7]:     return fn(*args, **kwargs)
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank7]:[rank7]:     return DTensor._op_dispatcher.dispatch(
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank7]:[rank7]:     self.redistribute_local_args(
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank7]:[rank7]:     resharded_local_tensor = redistribute_local_tensor(
[rank7]:[rank7]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank7]:[rank7]:     new_local_tensor = partial_spec._reduce_value(
[rank7]:[rank7]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank7]:[rank7]:     return funcol.all_reduce(
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank7]:[rank7]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank7]:[rank7]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank7]:[rank7]:     return self._op(*args, **kwargs)
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]: RuntimeError: No backend type associated with device type cpu
[rank3]:[titan] 2025-09-23 17:14:00,428 - root - INFO - Destroying the purge thread.
[rank3]:[rank3]: Traceback (most recent call last):
[rank3]:[rank3]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank3]:[rank3]:   File "<frozen runpy>", line 88, in _run_code
[rank3]:[rank3]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank3]:[rank3]:     trainer.train()
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank3]:[rank3]:     return f(*args, **kwargs)
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank3]:[rank3]:     self.train_step(data_iterator)
[rank3]:[rank3]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank3]:[rank3]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank3]:[rank3]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank3]:[rank3]:     self._calculate_freezing_metric()
[rank3]:[rank3]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank3]:[rank3]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank3]:[rank3]:                                  ^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank3]:[rank3]:     return disable_fn(*args, **kwargs)
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank3]:[rank3]:     return fn(*args, **kwargs)
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank3]:[rank3]:     return DTensor._op_dispatcher.dispatch(
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank3]:[rank3]:     self.redistribute_local_args(
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank3]:[rank3]:     resharded_local_tensor = redistribute_local_tensor(
[rank3]:[rank3]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank3]:[rank3]:     new_local_tensor = partial_spec._reduce_value(
[rank3]:[rank3]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank3]:[rank3]:     return funcol.all_reduce(
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank3]:[rank3]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank3]:[rank3]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank3]:[rank3]:     return self._op(*args, **kwargs)
[rank3]:[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:[rank3]: RuntimeError: No backend type associated with device type cpu
[rank6]:wandb: updating run metadata
[rank4]:[rank4]:[W923 17:14:00.316661449 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[rank2]:[rank2]:[W923 17:14:00.358938991 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[rank6]:wandb: 
[rank6]:wandb: Run history:
[rank6]:wandb:                    grad_norm ‚ñà‚ñÅ
[rank6]:wandb: loss_metrics/global_avg_loss ‚ñà‚ñÅ
[rank6]:wandb: loss_metrics/global_max_loss ‚ñà‚ñÅ
[rank6]:wandb:                           lr ‚ñÅ‚ñà
[rank6]:wandb:         memory/max_active(%) ‚ñÅ‚ñà
[rank6]:wandb:       memory/max_active(GiB) ‚ñÅ‚ñà
[rank6]:wandb:       memory/max_reserved(%) ‚ñÅ‚ñà
[rank6]:wandb:     memory/max_reserved(GiB) ‚ñÅ‚ñà
[rank6]:wandb:     memory/num_alloc_retries ‚ñÅ‚ñÅ
[rank6]:wandb:              memory/num_ooms ‚ñÅ‚ñÅ
[rank6]:wandb:                           +7 ...
[rank6]:wandb: 
[rank6]:wandb: Run summary:
[rank6]:wandb:                    grad_norm 0.04251
[rank6]:wandb: loss_metrics/global_avg_loss 6.82796
[rank6]:wandb: loss_metrics/global_max_loss 6.84606
[rank6]:wandb:                           lr 0.0003
[rank6]:wandb:         memory/max_active(%) 52.65939
[rank6]:wandb:       memory/max_active(GiB) 41.73347
[rank6]:wandb:       memory/max_reserved(%) 57.85561
[rank6]:wandb:     memory/max_reserved(GiB) 45.85156
[rank6]:wandb:     memory/num_alloc_retries 0
[rank6]:wandb:              memory/num_ooms 0
[rank6]:wandb:                           +7 ...
[rank6]:wandb: 
[rank6]:wandb: üöÄ View run 0922_gpipe_apf_runpod at: https://wandb.ai/orangingq/torchtitan/runs/tod3gwln
[rank6]:wandb: ‚≠êÔ∏è View project at: https://wandb.ai/orangingq/torchtitan
[rank6]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank6]:wandb: Find logs at: ._data/tb/0922_gpipe_apf_runpod/20250923-1706/wandb/run-20250923_170641-tod3gwln/logs
[rank6]:Traceback (most recent call last):
[rank6]:  File "<frozen runpy>", line 198, in _run_module_as_main
[rank6]:  File "<frozen runpy>", line 88, in _run_code
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank6]:    trainer.train()
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank6]:    return f(*args, **kwargs)
[rank6]:           ^^^^^^^^^^^^^^^^^^
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank6]:    self.train_step(data_iterator)
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank6]:    self.freezer.freeze_update() # this should be called after optimizer.step()
[rank6]:    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank6]:    self._calculate_freezing_metric()
[rank6]:  File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank6]:    self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank6]:                                 ^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank6]:    return disable_fn(*args, **kwargs)
[rank6]:           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank6]:    return fn(*args, **kwargs)
[rank6]:           ^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank6]:    return DTensor._op_dispatcher.dispatch(
[rank6]:           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank6]:    self.redistribute_local_args(
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank6]:    resharded_local_tensor = redistribute_local_tensor(
[rank6]:                             ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank6]:    new_local_tensor = partial_spec._reduce_value(
[rank6]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank6]:    return funcol.all_reduce(
[rank6]:           ^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank6]:    tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank6]:             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank6]:    return self._op(*args, **kwargs)
[rank6]:           ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:RuntimeError: No backend type associated with device type cpu
[rank6]:[rank6]: Traceback (most recent call last):
[rank6]:[rank6]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank6]:[rank6]:   File "<frozen runpy>", line 88, in _run_code
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank6]:[rank6]:     trainer.train()
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank6]:[rank6]:     return f(*args, **kwargs)
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank6]:[rank6]:     self.train_step(data_iterator)
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank6]:[rank6]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank6]:[rank6]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank6]:[rank6]:     self._calculate_freezing_metric()
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank6]:[rank6]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank6]:[rank6]:                                  ^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank6]:[rank6]:     return disable_fn(*args, **kwargs)
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank6]:[rank6]:     return fn(*args, **kwargs)
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank6]:[rank6]:     return DTensor._op_dispatcher.dispatch(
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank6]:[rank6]:     self.redistribute_local_args(
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank6]:[rank6]:     resharded_local_tensor = redistribute_local_tensor(
[rank6]:[rank6]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank6]:[rank6]:     new_local_tensor = partial_spec._reduce_value(
[rank6]:[rank6]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank6]:[rank6]:     return funcol.all_reduce(
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank6]:[rank6]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank6]:[rank6]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank6]:[rank6]:     return self._op(*args, **kwargs)
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]: RuntimeError: No backend type associated with device type cpu
[rank6]:[rank6]:[W923 17:14:01.927650400 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[rank4]:[rank4]:[W923 17:14:02.617945596 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
[rank2]:[rank2]:[W923 17:14:02.686223985 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
[rank7]:[rank7]:[W923 17:14:02.712105978 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
[rank0]:[titan] 2025-09-23 17:14:02,448 - root - INFO - Destroying the purge thread.
[rank1]:[titan] 2025-09-23 17:14:02,454 - root - INFO - Destroying the purge thread.
[rank0]:[rank0]: Traceback (most recent call last):
[rank0]:[rank0]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank0]:[rank0]:   File "<frozen runpy>", line 88, in _run_code
[rank0]:[rank0]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank0]:[rank0]:     trainer.train()
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank0]:[rank0]:     return f(*args, **kwargs)
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank0]:[rank0]:     self.train_step(data_iterator)
[rank0]:[rank0]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank0]:[rank0]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank0]:[rank0]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank0]:[rank0]:     self._calculate_freezing_metric()
[rank0]:[rank0]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank0]:[rank0]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank0]:[rank0]:                                  ^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank0]:[rank0]:     return disable_fn(*args, **kwargs)
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank0]:[rank0]:     return fn(*args, **kwargs)
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank0]:[rank0]:     return DTensor._op_dispatcher.dispatch(
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank0]:[rank0]:     self.redistribute_local_args(
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank0]:[rank0]:     resharded_local_tensor = redistribute_local_tensor(
[rank0]:[rank0]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank0]:[rank0]:     new_local_tensor = partial_spec._reduce_value(
[rank0]:[rank0]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank0]:[rank0]:     return funcol.all_reduce(
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank0]:[rank0]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank0]:[rank0]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank0]:[rank0]:     return self._op(*args, **kwargs)
[rank0]:[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:[rank0]: RuntimeError: No backend type associated with device type cpu
[rank1]:[rank1]: Traceback (most recent call last):
[rank1]:[rank1]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank1]:[rank1]:   File "<frozen runpy>", line 88, in _run_code
[rank1]:[rank1]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank1]:[rank1]:     trainer.train()
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank1]:[rank1]:     return f(*args, **kwargs)
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
[rank1]:[rank1]:     self.train_step(data_iterator)
[rank1]:[rank1]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
[rank1]:[rank1]:     self.freezer.freeze_update() # this should be called after optimizer.step()
[rank1]:[rank1]:     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
[rank1]:[rank1]:     self._calculate_freezing_metric()
[rank1]:[rank1]:   File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
[rank1]:[rank1]:     self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
[rank1]:[rank1]:                                  ^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
[rank1]:[rank1]:     return disable_fn(*args, **kwargs)
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
[rank1]:[rank1]:     return fn(*args, **kwargs)
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
[rank1]:[rank1]:     return DTensor._op_dispatcher.dispatch(
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
[rank1]:[rank1]:     self.redistribute_local_args(
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
[rank1]:[rank1]:     resharded_local_tensor = redistribute_local_tensor(
[rank1]:[rank1]:                              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
[rank1]:[rank1]:     new_local_tensor = partial_spec._reduce_value(
[rank1]:[rank1]:                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
[rank1]:[rank1]:     return funcol.all_reduce(
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
[rank1]:[rank1]:     tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
[rank1]:[rank1]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]:   File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
[rank1]:[rank1]:     return self._op(*args, **kwargs)
[rank1]:[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:[rank1]: RuntimeError: No backend type associated with device type cpu
[rank6]:[rank6]:[W923 17:14:02.278572752 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
W0923 17:14:03.036000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23955 closing signal SIGTERM
W0923 17:14:03.038000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23956 closing signal SIGTERM
W0923 17:14:03.039000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23957 closing signal SIGTERM
W0923 17:14:03.039000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23958 closing signal SIGTERM
W0923 17:14:03.040000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23960 closing signal SIGTERM
W0923 17:14:03.041000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23961 closing signal SIGTERM
W0923 17:14:03.042000 23851 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 23962 closing signal SIGTERM
[rank0]:[rank0]:[W923 17:14:02.563822216 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
E0923 17:14:05.860000 23851 torch/distributed/elastic/multiprocessing/api.py:913] failed (exitcode: 1) local_rank: 4 (pid: 23959) of binary: /usr/bin/python
E0923 17:14:05.871000 23851 torch/distributed/elastic/multiprocessing/errors/error_handler.py:141] no error file defined for parent, to copy child error file (/tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/4/error.json)
[rank0]:Stage 0: Modules to keep: {'layers.6', 'layers.2', 'layers.3', 'layers.7', 'layers.5', 'layers.0', 'layers.4', 'layers.1', 'tok_embeddings'}
[rank5]:Stage 2: Modules to keep: {'layers.23', 'layers.21', 'layers.18', 'layers.19', 'layers.22', 'layers.24', 'layers.20', 'layers.17'}
[rank4]:Stage 2: Modules to keep: {'layers.22', 'layers.24', 'layers.20', 'layers.23', 'layers.19', 'layers.18', 'layers.21', 'layers.17'}
[rank1]:Stage 0: Modules to keep: {'tok_embeddings', 'layers.0', 'layers.4', 'layers.1', 'layers.5', 'layers.7', 'layers.2', 'layers.3', 'layers.6'}
[rank2]:Stage 1: Modules to keep: {'layers.15', 'layers.16', 'layers.8', 'layers.10', 'layers.12', 'layers.9', 'layers.14', 'layers.11', 'layers.13'}
[rank7]:Stage 3: Modules to keep: {'layers.26', 'layers.28', 'output', 'layers.29', 'layers.30', 'norm', 'layers.25', 'layers.31', 'layers.27'}
[rank3]:Stage 1: Modules to keep: {'layers.9', 'layers.15', 'layers.8', 'layers.14', 'layers.16', 'layers.13', 'layers.10', 'layers.11', 'layers.12'}
[rank6]:Stage 3: Modules to keep: {'layers.26', 'output', 'layers.29', 'layers.28', 'layers.25', 'layers.30', 'layers.31', 'layers.27', 'norm'}
[rank0]:[Gloo] Rank 0 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank6]:[Gloo] Rank 6 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank4]:[Gloo] Rank 4 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank3]:[Gloo] Rank 3 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank5]:[Gloo] Rank 5 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank2]:[Gloo] Rank 2 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank1]:[Gloo] Rank 1 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank7]:[Gloo] Rank 7 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
Traceback (most recent call last):
  File "/usr/local/bin/torchrun", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/run.py", line 949, in main
    run(args)
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/run.py", line 940, in run
    elastic_launch(
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/launcher/api.py", line 158, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/launcher/api.py", line 299, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
timelyfreeze.train FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2025-09-23_17:14:02
  host      : 30be631344fa
  rank      : 0 (local_rank: 0)
  exitcode  : -15 (pid: 23955)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/0/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[2]:
  time      : 2025-09-23_17:14:02
  host      : 30be631344fa
  rank      : 1 (local_rank: 1)
  exitcode  : -15 (pid: 23956)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/1/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[3]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 23957)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/2/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[4]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 3 (local_rank: 3)
  exitcode  : -15 (pid: 23958)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/3/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[5]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 5 (local_rank: 5)
  exitcode  : -15 (pid: 23960)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/5/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[6]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 6 (local_rank: 6)
  exitcode  : 1 (pid: 23961)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/6/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
[7]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 7 (local_rank: 7)
  exitcode  : 1 (pid: 23962)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/7/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-09-23_17:14:00
  host      : 30be631344fa
  rank      : 4 (local_rank: 4)
  exitcode  : 1 (pid: 23959)
  error_file: /tmp/torchelastic_0gquovlu/33482d80-adfd-482a-8597-530cb25f96d7_fgj64iw_/attempt_0/4/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 574, in train
      self.train_step(data_iterator)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 504, in train_step
      self.freezer.freeze_update() # this should be called after optimizer.step()
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 272, in freeze_update
      self._calculate_freezing_metric()
    File "/workspace/torchtitan/timelyfreeze/core/freezer.py", line 297, in _calculate_freezing_metric
      self.freezing_metric[name] = abs(self.ema[name]) / max(self.ema_abs[name], 1e-10)
                                   ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_compile.py", line 53, in inner
      return disable_fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_dynamo/eval_frame.py", line 1098, in _fn
      return fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_api.py", line 335, in __torch_dispatch__
      return DTensor._op_dispatcher.dispatch(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 187, in dispatch
      self.redistribute_local_args(
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_dispatch.py", line 367, in redistribute_local_args
      resharded_local_tensor = redistribute_local_tensor(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/_redistribute.py", line 206, in redistribute_local_tensor
      new_local_tensor = partial_spec._reduce_value(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/tensor/placement_types.py", line 684, in _reduce_value
      return funcol.all_reduce(
             ^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/_functional_collectives.py", line 174, in all_reduce
      tensor = torch.ops._c10d_functional.all_reduce(self, reduceOp.lower(), group_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/usr/local/lib/python3.11/dist-packages/torch/_ops.py", line 1255, in __call__
      return self._op(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  RuntimeError: No backend type associated with device type cpu
  
============================================================
[W923 17:14:06.704105300 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())

üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
‚úîÔ∏èCurrent Timestamp: Tue Sep 23 17:44:31 UTC 2025
‚úîÔ∏èSERVER: 30be631344fa (172.18.0.2),  GPUs: 0,1,2,3,4,5,6,7
‚úîÔ∏èSCRIPT: 
‚úîÔ∏èOUTPUT: /workspace/torchtitan/logs/runpod8/0922_main/0922_gpipe_apf.ans
‚úîÔ∏èMain Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs
‚úîÔ∏èRunning with apf x gpipe ... 
‚òëÔ∏è> torchrun --standalone --nnodes=1 --nproc_per_node=8 --local-ranks-filter=0,1,2,3,4,5,6,7 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/workspace/torchtitan/logs/runpod8/0922_main/config.toml --job.description="Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs" --training.global_batch_size=128 --training.local_batch_size=8 --parallelism.pipeline_parallel_microbatch_size=1  --freezing.freeze --freezing.metric_type=apf --freezing.aggressiveness=0.05
üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
W0923 17:44:33.213000 36105 torch/distributed/run.py:815] 
W0923 17:44:33.213000 36105 torch/distributed/run.py:815] *****************************************
W0923 17:44:33.213000 36105 torch/distributed/run.py:815] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0923 17:44:33.213000 36105 torch/distributed/run.py:815] *****************************************
[rank1]:[titan] 2025-09-23 17:44:41,867 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank2]:[titan] 2025-09-23 17:44:41,938 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank7]:[titan] 2025-09-23 17:44:41,966 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank0]:[titan] 2025-09-23 17:44:42,165 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank3]:[titan] 2025-09-23 17:44:42,180 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank5]:[titan] 2025-09-23 17:44:42,167 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank6]:[titan] 2025-09-23 17:44:42,103 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank1]:[titan] 2025-09-23 17:44:42,356 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:[titan] 2025-09-23 17:44:42,360 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank4]:[titan] 2025-09-23 17:44:42,639 - root - INFO - Starting job: "Main Table Experiment for Llama 3.1 8B on Runpod with 8 GPUs"
[rank2]:[titan] 2025-09-23 17:44:42,885 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:[titan] 2025-09-23 17:44:42,891 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank7]:[titan] 2025-09-23 17:44:43,037 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank7]:[titan] 2025-09-23 17:44:43,042 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank6]:[titan] 2025-09-23 17:44:43,273 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank6]:[titan] 2025-09-23 17:44:43,276 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:44:43,382 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:[titan] 2025-09-23 17:44:43,385 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:44:43,392 - root - INFO - [GC] Initial GC collection 0.00 seconds
[rank5]:[titan] 2025-09-23 17:44:43,388 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank5]:[titan] 2025-09-23 17:44:43,390 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank3]:[titan] 2025-09-23 17:44:43,482 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:[titan] 2025-09-23 17:44:43,485 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank4]:[titan] 2025-09-23 17:44:43,658 - root - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank4]:[titan] 2025-09-23 17:44:43,661 - root - INFO - Building 2-D device mesh with ['pp', 'dp_shard'], [4, 2]
[rank0]:[titan] 2025-09-23 17:44:44,782 - root - INFO - Loading tokenizer from tokenizer.json
[rank0]:[titan] 2025-09-23 17:44:45,116 - root - INFO - Preparing slimorca dataset from Open-Orca/SlimOrca
[rank0]:[titan] 2025-09-23 17:44:46,434 - root - INFO - Building llama3 8B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=4096, n_layers=32, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=1024, ffn_dim_multiplier=1.3, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank5]:[titan] 2025-09-23 17:44:46,672 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank7]:[titan] 2025-09-23 17:44:46,664 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank1]:[titan] 2025-09-23 17:44:46,791 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank0]:[titan] 2025-09-23 17:44:46,727 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank0]:[titan] 2025-09-23 17:44:46,776 - root - INFO - [34mModel llama3 8B [31msize: 8,030,261,248 total parameters[39m
[rank4]:[titan] 2025-09-23 17:44:46,775 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank3]:[titan] 2025-09-23 17:44:46,731 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank5]:[titan] 2025-09-23 17:44:46,746 - root - INFO - PP rank 2 is building stage_idx 2 with modules ['layers.17', 'layers.18', 'layers.19', 'layers.20', 'layers.21', 'layers.22', 'layers.23', 'layers.24']
[rank5]:[titan] 2025-09-23 17:44:46,780 - root - INFO - Applied FSDP to the model
[rank5]:[titan] 2025-09-23 17:44:46,780 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank7]:[titan] 2025-09-23 17:44:46,741 - root - INFO - PP rank 3 is building stage_idx 3 with modules ['layers.25', 'layers.26', 'layers.27', 'layers.28', 'layers.29', 'layers.30', 'layers.31', 'norm', 'output']
[rank7]:[titan] 2025-09-23 17:44:46,783 - root - INFO - Applied FSDP to the model
[rank7]:[titan] 2025-09-23 17:44:46,783 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank1]:[titan] 2025-09-23 17:44:46,861 - root - INFO - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3', 'layers.4', 'layers.5', 'layers.6', 'layers.7']
[rank1]:[titan] 2025-09-23 17:44:46,893 - root - INFO - Applied FSDP to the model
[rank1]:[titan] 2025-09-23 17:44:46,893 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank0]:[titan] 2025-09-23 17:44:46,804 - root - INFO - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3', 'layers.4', 'layers.5', 'layers.6', 'layers.7']
[rank0]:[titan] 2025-09-23 17:44:46,837 - root - INFO - Applied FSDP to the model
[rank0]:[titan] 2025-09-23 17:44:46,837 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank4]:[titan] 2025-09-23 17:44:46,847 - root - INFO - PP rank 2 is building stage_idx 2 with modules ['layers.17', 'layers.18', 'layers.19', 'layers.20', 'layers.21', 'layers.22', 'layers.23', 'layers.24']
[rank4]:[titan] 2025-09-23 17:44:46,879 - root - INFO - Applied FSDP to the model
[rank4]:[titan] 2025-09-23 17:44:46,879 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank3]:[titan] 2025-09-23 17:44:46,804 - root - INFO - PP rank 1 is building stage_idx 1 with modules ['layers.8', 'layers.9', 'layers.10', 'layers.11', 'layers.12', 'layers.13', 'layers.14', 'layers.15', 'layers.16']
[rank3]:[titan] 2025-09-23 17:44:46,837 - root - INFO - Applied FSDP to the model
[rank3]:[titan] 2025-09-23 17:44:46,837 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank2]:[titan] 2025-09-23 17:44:46,956 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank2]:[titan] 2025-09-23 17:44:47,023 - root - INFO - PP rank 1 is building stage_idx 1 with modules ['layers.8', 'layers.9', 'layers.10', 'layers.11', 'layers.12', 'layers.13', 'layers.14', 'layers.15', 'layers.16']
[rank2]:[titan] 2025-09-23 17:44:47,058 - root - INFO - Applied FSDP to the model
[rank2]:[titan] 2025-09-23 17:44:47,058 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank5]:[titan] 2025-09-23 17:44:47,068 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank5]:[titan] 2025-09-23 17:44:47,068 - root - INFO - CUDA memory usage for model: 3.26GiB(4.12%)
[rank7]:[titan] 2025-09-23 17:44:47,112 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank7]:[titan] 2025-09-23 17:44:47,113 - root - INFO - CUDA memory usage for model: 3.83GiB(4.83%)
[rank1]:[titan] 2025-09-23 17:44:47,224 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:[titan] 2025-09-23 17:44:47,224 - root - INFO - CUDA memory usage for model: 4.24GiB(5.35%)
[rank0]:[titan] 2025-09-23 17:44:47,212 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:[titan] 2025-09-23 17:44:47,212 - root - INFO - CUDA memory usage for model: 4.24GiB(5.35%)
[rank4]:[titan] 2025-09-23 17:44:47,219 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank4]:[titan] 2025-09-23 17:44:47,220 - root - INFO - CUDA memory usage for model: 3.26GiB(4.12%)
[rank2]:[titan] 2025-09-23 17:44:47,293 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:[titan] 2025-09-23 17:44:47,294 - root - INFO - CUDA memory usage for model: 3.67GiB(4.64%)
[rank3]:[titan] 2025-09-23 17:44:47,207 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:[titan] 2025-09-23 17:44:47,207 - root - INFO - CUDA memory usage for model: 3.67GiB(4.64%)
[rank6]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank6]:wandb: Tracking run with wandb version 0.22.0
[rank6]:wandb: Run data is saved locally in /workspace/torchtitan_data/tb/0922_gpipe_apf_runpod/20250923-1744/wandb/run-20250923_174447-at675fb0
[rank6]:wandb: Run `wandb offline` to turn off syncing.
[rank6]:wandb: Syncing run 0922_gpipe_apf_runpod
[rank6]:wandb: ‚≠êÔ∏è View project at https://wandb.ai/orangingq/torchtitan
[rank6]:wandb: üöÄ View run at https://wandb.ai/orangingq/torchtitan/runs/at675fb0
[rank6]:[titan] 2025-09-23 17:44:48,369 - root - INFO - WandB logging enabled
[rank6]:[titan] 2025-09-23 17:44:48,370 - root - INFO - CUDA capacity: NVIDIA A100-SXM4-80GB with 79.25GiB memory
[rank6]:[titan] 2025-09-23 17:44:48,433 - root - INFO - PP rank 3 is building stage_idx 3 with modules ['layers.25', 'layers.26', 'layers.27', 'layers.28', 'layers.29', 'layers.30', 'layers.31', 'norm', 'output']
[rank6]:[titan] 2025-09-23 17:44:48,466 - root - INFO - Applied FSDP to the model
[rank6]:[titan] 2025-09-23 17:44:48,466 - root - INFO - Using pipeline schedule gpipe with 8 microbatches and 4 stages.
[rank6]:[titan] 2025-09-23 17:44:48,690 - root - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank6]:[titan] 2025-09-23 17:44:48,691 - root - INFO - CUDA memory usage for model: 3.83GiB(4.83%)
[rank0]:[titan] 2025-09-23 17:44:48,710 - root - INFO - Checkpointing active. Checkpoints will be loaded from and saved to /workspace/torchtitan_data/checkpoint/0922_gpipe_apf_runpod
[rank0]:[titan] 2025-09-23 17:44:48,711 - root - INFO - Mixed precision training is handled by fully_shard
[rank0]:[titan] 2025-09-23 17:44:48,714 - root - INFO - Trainer is initialized with local batch size 8, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 1000 (warmup 20)
[rank0]:[titan] 2025-09-23 17:44:48,715 - root - INFO - Training starts at step 1
[rank0]:/usr/local/lib/python3.11/dist-packages/torch/autograd/graph.py:841: UserWarning: Attempting to run cuBLAS, but there was no current CUDA context! Attempting to set the primary context... (Triggered internally at /pytorch/aten/src/ATen/cuda/CublasHandlePool.cpp:270.)
[rank0]:  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
[rank4]:[titan] 2025-09-23 17:45:03,312 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 28.25GiB(35.65%) [34m tps: 993 [36m tflops: 46.33 [35m mfu: 14.85%[39m
[rank4]:[titan] 2025-09-23 17:45:03,312 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank6]:[titan] 2025-09-23 17:45:03,310 - root - INFO - [31m step:  1 [32m loss: 12.2158 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 38.21GiB(48.22%) [34m tps: 1,099 [36m tflops: 51.27 [35m mfu: 16.43%[39m
[rank6]:[titan] 2025-09-23 17:45:03,310 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank5]:[titan] 2025-09-23 17:45:03,312 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 28.25GiB(35.65%) [34m tps: 987 [36m tflops: 46.05 [35m mfu: 14.76%[39m
[rank5]:[titan] 2025-09-23 17:45:03,312 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank7]:[titan] 2025-09-23 17:45:03,310 - root - INFO - [31m step:  1 [32m loss: 12.2158 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 38.21GiB(48.22%) [34m tps: 987 [36m tflops: 46.05 [35m mfu: 14.76%[39m
[rank7]:[titan] 2025-09-23 17:45:03,310 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank1]:[titan] 2025-09-23 17:45:03,320 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 35.46GiB(44.74%) [34m tps: 994 [36m tflops: 46.35 [35m mfu: 14.86%[39m
[rank1]:[titan] 2025-09-23 17:45:03,320 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank2]:[titan] 2025-09-23 17:45:03,323 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 31.52GiB(39.77%) [34m tps: 1,003 [36m tflops: 46.80 [35m mfu: 15.00%[39m
[rank2]:[titan] 2025-09-23 17:45:03,324 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank3]:[titan] 2025-09-23 17:45:03,323 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 31.52GiB(39.77%) [34m tps: 990 [36m tflops: 46.18 [35m mfu: 14.80%[39m
[rank3]:[titan] 2025-09-23 17:45:03,324 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank0]:[titan] 2025-09-23 17:45:03,320 - root - INFO - [31m step:  1 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.6781 [38;2;54;234;195m memory: 35.46GiB(44.74%) [34m tps: 990 [36m tflops: 46.19 [35m mfu: 14.80%[39m
[rank0]:[titan] 2025-09-23 17:45:03,320 - root - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:50:00
[rank4]:[titan] 2025-09-23 17:48:36,821 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 17:48:36,884 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 17:48:37,040 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:48:37,210 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:48:37,222 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 17:48:37,262 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 17:48:37,530 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 17:48:37,560 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:50:41,343 - root - INFO - [31m step: 40 [32m loss:  6.6190 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank2]:[titan] 2025-09-23 17:50:41,348 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,890 [36m tflops: 88.17 [35m mfu: 28.26%[39m
[rank4]:[titan] 2025-09-23 17:50:41,345 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank3]:[titan] 2025-09-23 17:50:41,347 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,890 [36m tflops: 88.17 [35m mfu: 28.26%[39m
[rank7]:[titan] 2025-09-23 17:50:41,343 - root - INFO - [31m step: 40 [32m loss:  6.6190 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank0]:[titan] 2025-09-23 17:50:41,351 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank1]:[titan] 2025-09-23 17:50:41,351 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank5]:[titan] 2025-09-23 17:50:41,345 - root - INFO - [31m step: 40 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0411 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,890 [36m tflops: 88.16 [35m mfu: 28.26%[39m
[rank6]:[titan] 2025-09-23 17:50:41,562 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1750_real_step40_rank6.svg
[rank6]:> Batch Time: 1055.58 ms, GPU Bubble Ratio: 40.37%, 38.19%, 44.70%, 35.85%
[rank6]:[titan] 2025-09-23 17:50:41,630 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1750_stage3_step40.svg
[rank7]:[titan] 2025-09-23 17:50:41,574 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1750_real_step40_rank7.svg
[rank7]:> Batch Time: 1057.08 ms, GPU Bubble Ratio: 40.55%, 37.88%, 44.90%, 35.83%
[rank7]:[titan] 2025-09-23 17:50:41,641 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1750_stage3_step40.svg
[rank0]:[titan] 2025-09-23 17:51:56,129 - root - INFO - [GC] Peforming periodical GC collection 0.30 seconds
[rank7]:[titan] 2025-09-23 17:52:09,947 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:52:10,446 - root - INFO - Freezing Ratio: {3: '0.02'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 17:52:10,825 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 17:52:11,047 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:52:11,795 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 17:52:12,088 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 17:52:13,017 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 17:52:13,767 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 17:56:00,646 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 17:56:01,119 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 17:56:01,326 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:56:01,896 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 17:56:01,887 - root - INFO - Freezing Ratio: {3: '0.03'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:56:02,266 - root - INFO - Freezing Ratio: {3: '0.03'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 17:56:02,955 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 17:56:05,464 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:56:46,790 - root - INFO - [31m step: 80 [32m loss:  6.0318 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank4]:[titan] 2025-09-23 17:56:46,789 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank2]:[titan] 2025-09-23 17:56:46,792 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank0]:[titan] 2025-09-23 17:56:46,796 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank7]:[titan] 2025-09-23 17:56:46,788 - root - INFO - [31m step: 80 [32m loss:  6.0318 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank3]:[titan] 2025-09-23 17:56:46,792 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank1]:[titan] 2025-09-23 17:56:46,796 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank5]:[titan] 2025-09-23 17:56:46,789 - root - INFO - [31m step: 80 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0501 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,793 [36m tflops: 83.64 [35m mfu: 26.81%[39m
[rank6]:[titan] 2025-09-23 17:56:46,992 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1756_real_step80_rank6.svg
[rank6]:> Batch Time: 1056.34 ms, GPU Bubble Ratio: 40.42%, 38.22%, 44.68%, 35.84%
[rank7]:[titan] 2025-09-23 17:56:46,996 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1756_real_step80_rank7.svg
[rank7]:> Batch Time: 1058.20 ms, GPU Bubble Ratio: 40.58%, 37.92%, 44.92%, 35.81%
[rank6]:[titan] 2025-09-23 17:56:47,056 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1756_stage3_step80.svg
[rank7]:[titan] 2025-09-23 17:56:47,059 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1756_stage3_step80.svg
[rank0]:[titan] 2025-09-23 17:59:24,335 - root - INFO - [GC] Peforming periodical GC collection 0.37 seconds
[rank7]:[titan] 2025-09-23 17:59:38,114 - root - INFO - Freezing Ratio: {3: '0.03'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 17:59:38,379 - root - INFO - Freezing Ratio: {3: '0.03'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 17:59:39,124 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 17:59:39,264 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 17:59:39,835 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 17:59:39,934 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 17:59:41,074 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 17:59:41,684 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:02:38,259 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank4]:[titan] 2025-09-23 18:02:38,252 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank6]:[titan] 2025-09-23 18:02:38,257 - root - INFO - [31m step: 120 [32m loss:  5.6244 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank2]:[titan] 2025-09-23 18:02:38,255 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank7]:[titan] 2025-09-23 18:02:38,257 - root - INFO - [31m step: 120 [32m loss:  5.6244 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank3]:[titan] 2025-09-23 18:02:38,255 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank1]:[titan] 2025-09-23 18:02:38,259 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank5]:[titan] 2025-09-23 18:02:38,252 - root - INFO - [31m step: 120 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.2081 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank6]:[titan] 2025-09-23 18:02:38,458 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1802_real_step120_rank6.svg
[rank6]:> Batch Time: 1055.45 ms, GPU Bubble Ratio: 40.35%, 38.12%, 44.57%, 35.87%
[rank7]:[titan] 2025-09-23 18:02:38,458 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1802_real_step120_rank7.svg
[rank7]:> Batch Time: 1057.97 ms, GPU Bubble Ratio: 40.56%, 37.89%, 44.85%, 35.82%
[rank6]:[titan] 2025-09-23 18:02:38,521 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1802_stage3_step120.svg
[rank7]:[titan] 2025-09-23 18:02:38,524 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1802_stage3_step120.svg
[rank4]:[titan] 2025-09-23 18:03:29,214 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:03:29,272 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:03:29,969 - root - INFO - Freezing Ratio: {3: '0.05'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:03:30,035 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:03:30,076 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:03:30,221 - root - INFO - Freezing Ratio: {3: '0.05'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:03:30,944 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:03:31,475 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:06:50,109 - root - INFO - [GC] Peforming periodical GC collection 0.39 seconds
[rank7]:[titan] 2025-09-23 18:07:03,968 - root - INFO - Freezing Ratio: {3: '0.05'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:07:04,224 - root - INFO - Freezing Ratio: {3: '0.05'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:07:05,074 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:07:05,181 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:07:05,748 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:07:05,815 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:07:06,982 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:07:07,407 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:08:35,746 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank4]:[titan] 2025-09-23 18:08:35,740 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank3]:[titan] 2025-09-23 18:08:35,743 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank6]:[titan] 2025-09-23 18:08:35,745 - root - INFO - [31m step: 160 [32m loss:  5.2394 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank7]:[titan] 2025-09-23 18:08:35,745 - root - INFO - [31m step: 160 [32m loss:  5.2394 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank2]:[titan] 2025-09-23 18:08:35,743 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank1]:[titan] 2025-09-23 18:08:35,746 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank5]:[titan] 2025-09-23 18:08:35,740 - root - INFO - [31m step: 160 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1674 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,833 [36m tflops: 85.50 [35m mfu: 27.40%[39m
[rank6]:[titan] 2025-09-23 18:08:35,946 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1808_real_step160_rank6.svg
[rank6]:> Batch Time: 1051.28 ms, GPU Bubble Ratio: 40.10%, 37.84%, 44.27%, 36.01%
[rank7]:[titan] 2025-09-23 18:08:35,947 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1808_real_step160_rank7.svg
[rank7]:> Batch Time: 1051.42 ms, GPU Bubble Ratio: 40.19%, 37.46%, 44.42%, 36.05%
[rank6]:[titan] 2025-09-23 18:08:36,008 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1808_stage3_step160.svg
[rank7]:[titan] 2025-09-23 18:08:36,008 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1808_stage3_step160.svg
[rank4]:[titan] 2025-09-23 18:10:54,991 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:10:55,056 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:10:55,659 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:10:55,800 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:10:55,927 - root - INFO - Freezing Ratio: {3: '0.06'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:10:56,053 - root - INFO - Freezing Ratio: {3: '0.06'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:10:56,784 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:10:57,201 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:14:15,926 - root - INFO - [GC] Peforming periodical GC collection 0.42 seconds
[rank7]:[titan] 2025-09-23 18:14:29,195 - root - INFO - Freezing Ratio: {3: '0.06'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:14:29,965 - root - INFO - Freezing Ratio: {3: '0.06'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:14:29,975 - root - INFO - [31m step: 200 [32m loss:  5.1000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,850 [36m tflops: 86.29 [35m mfu: 27.66%[39m
[rank7]:[titan] 2025-09-23 18:14:29,976 - root - INFO - [31m step: 200 [32m loss:  5.1000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,850 [36m tflops: 86.29 [35m mfu: 27.66%[39m
[rank4]:[titan] 2025-09-23 18:14:30,834 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:14:30,871 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:14:30,873 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.07 [35m mfu: 27.59%[39m
[rank4]:[titan] 2025-09-23 18:14:30,873 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.07 [35m mfu: 27.59%[39m
[rank2]:[titan] 2025-09-23 18:14:31,384 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:14:31,492 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:14:31,494 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,842 [36m tflops: 85.92 [35m mfu: 27.54%[39m
[rank2]:[titan] 2025-09-23 18:14:31,494 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,842 [36m tflops: 85.92 [35m mfu: 27.54%[39m
[rank1]:[titan] 2025-09-23 18:14:32,608 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:14:33,132 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.53 [35m mfu: 27.41%[39m
[rank0]:[titan] 2025-09-23 18:14:33,130 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:14:33,133 - root - INFO - [31m step: 200 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0444 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.53 [35m mfu: 27.41%[39m
[rank6]:[titan] 2025-09-23 18:14:33,333 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1814_real_step200_rank6.svg
[rank6]:> Batch Time: 997.86 ms, GPU Bubble Ratio: 36.89%, 34.50%, 41.17%, 37.95%
[rank7]:[titan] 2025-09-23 18:14:33,338 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1814_real_step200_rank7.svg
[rank7]:> Batch Time: 995.17 ms, GPU Bubble Ratio: 36.80%, 33.92%, 41.21%, 38.09%
[rank6]:[titan] 2025-09-23 18:14:33,392 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1814_stage3_step200.svg
[rank7]:[titan] 2025-09-23 18:14:33,400 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1814_stage3_step200.svg
[rank5]:[titan] 2025-09-23 18:18:20,164 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:18:20,761 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:18:21,493 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:18:21,463 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:18:21,734 - root - INFO - Freezing Ratio: {3: '0.08'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:18:21,944 - root - INFO - Freezing Ratio: {3: '0.08'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:18:22,496 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:18:22,860 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:20:26,800 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.88 [35m mfu: 27.52%[39m
[rank6]:[titan] 2025-09-23 18:20:26,799 - root - INFO - [31m step: 240 [32m loss:  4.8881 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,837 [36m tflops: 85.66 [35m mfu: 27.46%[39m
[rank1]:[titan] 2025-09-23 18:20:26,807 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,853 [36m tflops: 86.42 [35m mfu: 27.70%[39m
[rank7]:[titan] 2025-09-23 18:20:26,799 - root - INFO - [31m step: 240 [32m loss:  4.8881 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,837 [36m tflops: 85.66 [35m mfu: 27.46%[39m
[rank2]:[titan] 2025-09-23 18:20:26,803 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,844 [36m tflops: 86.03 [35m mfu: 27.57%[39m
[rank5]:[titan] 2025-09-23 18:20:26,800 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.88 [35m mfu: 27.52%[39m
[rank0]:[titan] 2025-09-23 18:20:26,807 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,853 [36m tflops: 86.42 [35m mfu: 27.70%[39m
[rank3]:[titan] 2025-09-23 18:20:26,803 - root - INFO - [31m step: 240 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0438 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,844 [36m tflops: 86.03 [35m mfu: 27.57%[39m
[rank6]:[titan] 2025-09-23 18:20:27,010 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1820_real_step240_rank6.svg
[rank6]:> Batch Time: 1050.64 ms, GPU Bubble Ratio: 40.06%, 37.80%, 44.20%, 36.03%
[rank7]:[titan] 2025-09-23 18:20:27,011 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1820_real_step240_rank7.svg
[rank7]:> Batch Time: 1051.19 ms, GPU Bubble Ratio: 40.17%, 37.45%, 44.38%, 36.05%
[rank6]:[titan] 2025-09-23 18:20:27,076 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1820_stage3_step240.svg
[rank7]:[titan] 2025-09-23 18:20:27,077 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1820_stage3_step240.svg
[rank0]:[titan] 2025-09-23 18:21:41,765 - root - INFO - [GC] Peforming periodical GC collection 0.43 seconds
[rank7]:[titan] 2025-09-23 18:21:55,688 - root - INFO - Freezing Ratio: {3: '0.08'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:21:55,722 - root - INFO - Freezing Ratio: {3: '0.08'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:21:56,637 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:21:56,677 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:21:57,229 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:21:57,326 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:21:58,471 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:21:58,901 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:25:46,136 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:25:46,204 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:25:46,776 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:25:46,873 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:25:47,078 - root - INFO - Freezing Ratio: {3: '0.09'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:25:47,207 - root - INFO - Freezing Ratio: {3: '0.09'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:25:47,942 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:25:48,350 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:26:29,675 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank6]:[titan] 2025-09-23 18:26:29,673 - root - INFO - [31m step: 280 [32m loss:  5.0416 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank0]:[titan] 2025-09-23 18:26:29,681 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank1]:[titan] 2025-09-23 18:26:29,681 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank7]:[titan] 2025-09-23 18:26:29,674 - root - INFO - [31m step: 280 [32m loss:  5.0416 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank2]:[titan] 2025-09-23 18:26:29,677 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank5]:[titan] 2025-09-23 18:26:29,675 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank3]:[titan] 2025-09-23 18:26:29,677 - root - INFO - [31m step: 280 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0511 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank7]:[titan] 2025-09-23 18:26:29,883 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1826_real_step280_rank7.svg
[rank7]:> Batch Time: 1051.97 ms, GPU Bubble Ratio: 40.23%, 37.50%, 44.44%, 36.02%
[rank6]:[titan] 2025-09-23 18:26:29,881 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1826_real_step280_rank6.svg
[rank6]:> Batch Time: 1051.94 ms, GPU Bubble Ratio: 40.14%, 37.88%, 44.29%, 35.99%
[rank6]:[titan] 2025-09-23 18:26:29,937 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1826_stage3_step280.svg
[rank7]:[titan] 2025-09-23 18:26:29,939 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1826_stage3_step280.svg
[rank0]:[titan] 2025-09-23 18:29:07,222 - root - INFO - [GC] Peforming periodical GC collection 0.45 seconds
[rank7]:[titan] 2025-09-23 18:29:20,979 - root - INFO - Freezing Ratio: {3: '0.09'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:29:21,133 - root - INFO - Freezing Ratio: {3: '0.09'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:29:22,128 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:29:22,119 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:29:22,880 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:29:22,818 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:29:23,849 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:29:24,310 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:32:20,883 - root - INFO - [31m step: 320 [32m loss:  4.6658 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.89%[39m
[rank5]:[titan] 2025-09-23 18:32:20,879 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.89%[39m
[rank2]:[titan] 2025-09-23 18:32:20,881 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.90%[39m
[rank3]:[titan] 2025-09-23 18:32:20,881 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.90%[39m
[rank6]:[titan] 2025-09-23 18:32:20,884 - root - INFO - [31m step: 320 [32m loss:  4.6658 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.89%[39m
[rank4]:[titan] 2025-09-23 18:32:20,879 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.90%[39m
[rank1]:[titan] 2025-09-23 18:32:20,885 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.90%[39m
[rank0]:[titan] 2025-09-23 18:32:20,885 - root - INFO - [31m step: 320 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1312 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,866 [36m tflops: 87.03 [35m mfu: 27.90%[39m
[rank6]:[titan] 2025-09-23 18:32:21,085 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1832_real_step320_rank6.svg
[rank6]:> Batch Time: 1051.86 ms, GPU Bubble Ratio: 40.13%, 37.87%, 44.27%, 35.99%
[rank7]:[titan] 2025-09-23 18:32:21,086 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1832_real_step320_rank7.svg
[rank7]:> Batch Time: 1051.80 ms, GPU Bubble Ratio: 40.22%, 37.49%, 44.42%, 36.02%
[rank7]:[titan] 2025-09-23 18:32:21,142 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1832_stage3_step320.svg
[rank6]:[titan] 2025-09-23 18:32:21,142 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1832_stage3_step320.svg
[rank5]:[titan] 2025-09-23 18:33:11,764 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:33:11,834 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:33:11,974 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:33:12,559 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:33:12,575 - root - INFO - Freezing Ratio: {3: '0.11'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:33:12,790 - root - INFO - Freezing Ratio: {3: '0.11'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:33:13,521 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:33:13,640 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:36:32,359 - root - INFO - [GC] Peforming periodical GC collection 0.47 seconds
[rank7]:[titan] 2025-09-23 18:36:46,167 - root - INFO - Freezing Ratio: {3: '0.11'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:36:46,312 - root - INFO - Freezing Ratio: {3: '0.11'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:36:46,751 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:36:47,220 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:36:48,067 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:36:48,060 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:36:49,059 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:36:49,452 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:38:17,794 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank2]:[titan] 2025-09-23 18:38:17,797 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank1]:[titan] 2025-09-23 18:38:17,800 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank0]:[titan] 2025-09-23 18:38:17,800 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank7]:[titan] 2025-09-23 18:38:17,799 - root - INFO - [31m step: 360 [32m loss:  4.6313 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank5]:[titan] 2025-09-23 18:38:17,794 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank3]:[titan] 2025-09-23 18:38:17,797 - root - INFO - [31m step: 360 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank6]:[titan] 2025-09-23 18:38:17,799 - root - INFO - [31m step: 360 [32m loss:  4.6313 [38;2;180;60;0m grad_norm:  0.1246 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,836 [36m tflops: 85.64 [35m mfu: 27.45%[39m
[rank7]:[titan] 2025-09-23 18:38:18,001 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1838_real_step360_rank7.svg
[rank7]:> Batch Time: 1050.86 ms, GPU Bubble Ratio: 40.17%, 37.42%, 44.34%, 36.05%
[rank7]:[titan] 2025-09-23 18:38:18,061 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1838_stage3_step360.svg
[rank6]:[titan] 2025-09-23 18:38:17,999 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1838_real_step360_rank6.svg
[rank6]:> Batch Time: 1050.22 ms, GPU Bubble Ratio: 40.03%, 37.77%, 44.14%, 36.06%
[rank6]:[titan] 2025-09-23 18:38:18,060 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1838_stage3_step360.svg
[rank5]:[titan] 2025-09-23 18:40:36,568 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:40:37,123 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:40:37,934 - root - INFO - Freezing Ratio: {3: '0.12'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:40:37,978 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:40:38,005 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:40:38,151 - root - INFO - Freezing Ratio: {3: '0.12'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:40:38,905 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:40:39,272 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:43:57,990 - root - INFO - [GC] Peforming periodical GC collection 0.48 seconds
[rank7]:[titan] 2025-09-23 18:44:11,864 - root - INFO - Freezing Ratio: {3: '0.12'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:44:11,970 - root - INFO - Freezing Ratio: {3: '0.12'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:44:11,975 - root - INFO - [31m step: 400 [32m loss:  4.4794 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,850 [36m tflops: 86.30 [35m mfu: 27.66%[39m
[rank7]:[titan] 2025-09-23 18:44:11,976 - root - INFO - [31m step: 400 [32m loss:  4.4794 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,850 [36m tflops: 86.30 [35m mfu: 27.66%[39m
[rank5]:[titan] 2025-09-23 18:44:12,889 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:44:13,001 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.05 [35m mfu: 27.58%[39m
[rank4]:[titan] 2025-09-23 18:44:12,999 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:44:13,001 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.05 [35m mfu: 27.58%[39m
[rank3]:[titan] 2025-09-23 18:44:13,689 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:44:13,744 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,841 [36m tflops: 85.87 [35m mfu: 27.52%[39m
[rank2]:[titan] 2025-09-23 18:44:13,742 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:44:13,744 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,841 [36m tflops: 85.87 [35m mfu: 27.52%[39m
[rank1]:[titan] 2025-09-23 18:44:14,729 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:44:15,124 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank0]:[titan] 2025-09-23 18:44:15,122 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:44:15,124 - root - INFO - [31m step: 400 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0418 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank6]:[titan] 2025-09-23 18:44:15,321 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1844_real_step400_rank6.svg
[rank6]:> Batch Time: 998.88 ms, GPU Bubble Ratio: 36.95%, 34.57%, 41.21%, 37.91%
[rank7]:[titan] 2025-09-23 18:44:15,329 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1844_real_step400_rank7.svg
[rank7]:> Batch Time: 995.28 ms, GPU Bubble Ratio: 36.82%, 33.92%, 41.20%, 38.06%
[rank6]:[titan] 2025-09-23 18:44:15,385 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1844_stage3_step400.svg
[rank7]:[titan] 2025-09-23 18:44:15,393 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1844_stage3_step400.svg
[rank5]:[titan] 2025-09-23 18:48:02,719 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:48:02,794 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:48:03,418 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:48:03,516 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:48:03,696 - root - INFO - Freezing Ratio: {3: '0.14'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:48:03,801 - root - INFO - Freezing Ratio: {3: '0.14'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:48:04,488 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:48:04,872 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:50:08,931 - root - INFO - [31m step: 440 [32m loss:  4.4629 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,836 [36m tflops: 85.63 [35m mfu: 27.45%[39m
[rank1]:[titan] 2025-09-23 18:50:08,939 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,852 [36m tflops: 86.39 [35m mfu: 27.69%[39m
[rank2]:[titan] 2025-09-23 18:50:08,935 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,845 [36m tflops: 86.06 [35m mfu: 27.58%[39m
[rank0]:[titan] 2025-09-23 18:50:08,939 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,852 [36m tflops: 86.39 [35m mfu: 27.69%[39m
[rank3]:[titan] 2025-09-23 18:50:08,935 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,845 [36m tflops: 86.06 [35m mfu: 27.58%[39m
[rank4]:[titan] 2025-09-23 18:50:08,932 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.88 [35m mfu: 27.52%[39m
[rank6]:[titan] 2025-09-23 18:50:08,931 - root - INFO - [31m step: 440 [32m loss:  4.4629 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,836 [36m tflops: 85.63 [35m mfu: 27.45%[39m
[rank5]:[titan] 2025-09-23 18:50:08,933 - root - INFO - [31m step: 440 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0406 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.88 [35m mfu: 27.52%[39m
[rank6]:[titan] 2025-09-23 18:50:09,138 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1850_real_step440_rank6.svg
[rank6]:> Batch Time: 1050.06 ms, GPU Bubble Ratio: 40.02%, 37.76%, 44.13%, 36.06%
[rank6]:[titan] 2025-09-23 18:50:09,202 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1850_stage3_step440.svg
[rank7]:[titan] 2025-09-23 18:50:09,142 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1850_real_step440_rank7.svg
[rank7]:> Batch Time: 1050.86 ms, GPU Bubble Ratio: 40.17%, 37.42%, 44.33%, 36.05%
[rank7]:[titan] 2025-09-23 18:50:09,207 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1850_stage3_step440.svg
[rank0]:[titan] 2025-09-23 18:51:24,005 - root - INFO - [GC] Peforming periodical GC collection 0.49 seconds
[rank7]:[titan] 2025-09-23 18:51:37,818 - root - INFO - Freezing Ratio: {3: '0.14'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:51:38,001 - root - INFO - Freezing Ratio: {3: '0.14'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:51:38,867 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:51:38,959 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:51:39,663 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:51:39,733 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:51:40,824 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:51:41,104 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:55:28,504 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:55:28,669 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:55:29,272 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 18:55:29,592 - root - INFO - Freezing Ratio: {3: '0.15'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:55:29,592 - root - INFO - Freezing Ratio: {3: '0.15'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:55:30,227 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:55:30,660 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:55:31,727 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:56:13,048 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank3]:[titan] 2025-09-23 18:56:13,047 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank6]:[titan] 2025-09-23 18:56:13,043 - root - INFO - [31m step: 480 [32m loss:  4.1758 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank4]:[titan] 2025-09-23 18:56:13,044 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank7]:[titan] 2025-09-23 18:56:13,043 - root - INFO - [31m step: 480 [32m loss:  4.1758 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank5]:[titan] 2025-09-23 18:56:13,044 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank1]:[titan] 2025-09-23 18:56:13,051 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank0]:[titan] 2025-09-23 18:56:13,051 - root - INFO - [31m step: 480 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,800 [36m tflops: 83.95 [35m mfu: 26.91%[39m
[rank6]:[titan] 2025-09-23 18:56:13,282 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1856_real_step480_rank6.svg
[rank6]:> Batch Time: 1051.48 ms, GPU Bubble Ratio: 40.11%, 37.85%, 44.23%, 36.01%
[rank7]:[titan] 2025-09-23 18:56:13,268 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1856_real_step480_rank7.svg
[rank7]:> Batch Time: 1051.42 ms, GPU Bubble Ratio: 40.20%, 37.46%, 44.37%, 36.03%
[rank6]:[titan] 2025-09-23 18:56:13,368 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1856_stage3_step480.svg
[rank7]:[titan] 2025-09-23 18:56:13,368 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1856_stage3_step480.svg
[rank0]:[titan] 2025-09-23 18:58:50,742 - root - INFO - [GC] Peforming periodical GC collection 0.50 seconds
[rank6]:[titan] 2025-09-23 18:59:05,222 - root - INFO - Freezing Ratio: {3: '0.15'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 18:59:05,258 - root - INFO - Freezing Ratio: {3: '0.15'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 18:59:06,209 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 18:59:06,139 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 18:59:06,839 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 18:59:07,233 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 18:59:07,924 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 18:59:08,284 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:02:04,955 - root - INFO - [31m step: 520 [32m loss:  4.2626 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank4]:[titan] 2025-09-23 19:02:04,950 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank5]:[titan] 2025-09-23 19:02:04,950 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank7]:[titan] 2025-09-23 19:02:04,955 - root - INFO - [31m step: 520 [32m loss:  4.2626 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank1]:[titan] 2025-09-23 19:02:04,957 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank0]:[titan] 2025-09-23 19:02:04,956 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank2]:[titan] 2025-09-23 19:02:04,953 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank3]:[titan] 2025-09-23 19:02:04,953 - root - INFO - [31m step: 520 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1102 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,862 [36m tflops: 86.86 [35m mfu: 27.84%[39m
[rank6]:[titan] 2025-09-23 19:02:05,159 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1902_real_step520_rank6.svg
[rank6]:> Batch Time: 1051.31 ms, GPU Bubble Ratio: 40.10%, 37.84%, 44.22%, 36.01%
[rank6]:[titan] 2025-09-23 19:02:05,231 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1902_stage3_step520.svg
[rank7]:[titan] 2025-09-23 19:02:05,167 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1902_real_step520_rank7.svg
[rank7]:> Batch Time: 1051.30 ms, GPU Bubble Ratio: 40.20%, 37.45%, 44.36%, 36.03%
[rank7]:[titan] 2025-09-23 19:02:05,239 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1902_stage3_step520.svg
[rank5]:[titan] 2025-09-23 19:02:55,380 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:02:56,002 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:02:56,629 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:02:56,912 - root - INFO - Freezing Ratio: {3: '0.17'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:02:57,061 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:02:57,120 - root - INFO - Freezing Ratio: {3: '0.17'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:02:57,610 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:02:57,987 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:06:16,928 - root - INFO - [GC] Peforming periodical GC collection 0.50 seconds
[rank6]:[titan] 2025-09-23 19:06:30,873 - root - INFO - Freezing Ratio: {3: '0.17'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:06:30,938 - root - INFO - Freezing Ratio: {3: '0.17'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:06:31,805 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:06:31,831 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:06:32,419 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:06:32,764 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:06:33,556 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:06:33,951 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:08:02,345 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank1]:[titan] 2025-09-23 19:08:02,351 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank3]:[titan] 2025-09-23 19:08:02,348 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank7]:[titan] 2025-09-23 19:08:02,350 - root - INFO - [31m step: 560 [32m loss:  4.2244 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.53 [35m mfu: 27.41%[39m
[rank2]:[titan] 2025-09-23 19:08:02,348 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank6]:[titan] 2025-09-23 19:08:02,350 - root - INFO - [31m step: 560 [32m loss:  4.2244 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.53 [35m mfu: 27.41%[39m
[rank5]:[titan] 2025-09-23 19:08:02,345 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank0]:[titan] 2025-09-23 19:08:02,351 - root - INFO - [31m step: 560 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.1030 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.52 [35m mfu: 27.41%[39m
[rank6]:[titan] 2025-09-23 19:08:02,560 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1908_real_step560_rank6.svg
[rank6]:> Batch Time: 1049.98 ms, GPU Bubble Ratio: 40.02%, 37.75%, 44.11%, 36.06%
[rank6]:[titan] 2025-09-23 19:08:02,632 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1908_stage3_step560.svg
[rank7]:[titan] 2025-09-23 19:08:02,779 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1908_real_step560_rank7.svg
[rank7]:> Batch Time: 1050.78 ms, GPU Bubble Ratio: 40.16%, 37.41%, 44.31%, 36.05%
[rank7]:[titan] 2025-09-23 19:08:02,856 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1908_stage3_step560.svg
[rank5]:[titan] 2025-09-23 19:10:21,863 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:10:22,000 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:10:22,628 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:10:22,919 - root - INFO - Freezing Ratio: {3: '0.18'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:10:22,930 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:10:23,143 - root - INFO - Freezing Ratio: {3: '0.18'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:10:23,544 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:10:23,953 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:13:42,929 - root - INFO - [GC] Peforming periodical GC collection 0.52 seconds
[rank6]:[titan] 2025-09-23 19:13:57,122 - root - INFO - Freezing Ratio: {3: '0.18'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:13:57,448 - root - INFO - Freezing Ratio: {3: '0.18'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:13:57,453 - root - INFO - [31m step: 600 [32m loss:  4.0312 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,846 [36m tflops: 86.08 [35m mfu: 27.59%[39m
[rank6]:[titan] 2025-09-23 19:13:57,454 - root - INFO - [31m step: 600 [32m loss:  4.0312 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,846 [36m tflops: 86.08 [35m mfu: 27.59%[39m
[rank5]:[titan] 2025-09-23 19:13:57,996 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:13:58,194 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,842 [36m tflops: 85.90 [35m mfu: 27.53%[39m
[rank4]:[titan] 2025-09-23 19:13:58,192 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:13:58,195 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,842 [36m tflops: 85.90 [35m mfu: 27.53%[39m
[rank3]:[titan] 2025-09-23 19:13:58,622 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:13:59,086 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:13:59,089 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,837 [36m tflops: 85.68 [35m mfu: 27.46%[39m
[rank3]:[titan] 2025-09-23 19:13:59,089 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,837 [36m tflops: 85.68 [35m mfu: 27.46%[39m
[rank1]:[titan] 2025-09-23 19:13:59,713 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:14:00,256 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:14:00,258 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,831 [36m tflops: 85.40 [35m mfu: 27.37%[39m
[rank1]:[titan] 2025-09-23 19:14:00,258 - root - INFO - [31m step: 600 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0419 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,831 [36m tflops: 85.40 [35m mfu: 27.37%[39m
[rank7]:[titan] 2025-09-23 19:14:00,467 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1913_real_step600_rank7.svg
[rank7]:> Batch Time: 995.67 ms, GPU Bubble Ratio: 36.85%, 33.94%, 41.21%, 38.05%
[rank6]:[titan] 2025-09-23 19:14:00,473 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1913_real_step600_rank6.svg
[rank6]:> Batch Time: 999.81 ms, GPU Bubble Ratio: 37.01%, 34.63%, 41.25%, 37.88%
[rank7]:[titan] 2025-09-23 19:14:00,534 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1913_stage3_step600.svg
[rank6]:[titan] 2025-09-23 19:14:00,539 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1913_stage3_step600.svg
[rank5]:[titan] 2025-09-23 19:17:47,825 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:17:47,901 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:17:48,566 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:17:48,859 - root - INFO - Freezing Ratio: {3: '0.20'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:17:48,878 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:17:49,100 - root - INFO - Freezing Ratio: {3: '0.20'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:17:49,545 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:17:49,970 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:19:53,986 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,853 [36m tflops: 86.41 [35m mfu: 27.70%[39m
[rank1]:[titan] 2025-09-23 19:19:53,986 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,853 [36m tflops: 86.41 [35m mfu: 27.70%[39m
[rank4]:[titan] 2025-09-23 19:19:53,980 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,842 [36m tflops: 85.91 [35m mfu: 27.54%[39m
[rank2]:[titan] 2025-09-23 19:19:53,983 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,847 [36m tflops: 86.13 [35m mfu: 27.60%[39m
[rank3]:[titan] 2025-09-23 19:19:53,983 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,847 [36m tflops: 86.13 [35m mfu: 27.60%[39m
[rank6]:[titan] 2025-09-23 19:19:53,979 - root - INFO - [31m step: 640 [32m loss:  4.0161 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,838 [36m tflops: 85.73 [35m mfu: 27.48%[39m
[rank7]:[titan] 2025-09-23 19:19:53,979 - root - INFO - [31m step: 640 [32m loss:  4.0161 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,838 [36m tflops: 85.73 [35m mfu: 27.48%[39m
[rank5]:[titan] 2025-09-23 19:19:53,980 - root - INFO - [31m step: 640 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0430 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,842 [36m tflops: 85.91 [35m mfu: 27.54%[39m
[rank6]:[titan] 2025-09-23 19:19:54,188 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1919_real_step640_rank6.svg
[rank6]:> Batch Time: 1049.97 ms, GPU Bubble Ratio: 40.02%, 37.75%, 44.10%, 36.07%
[rank6]:[titan] 2025-09-23 19:19:54,259 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1919_stage3_step640.svg
[rank7]:[titan] 2025-09-23 19:19:54,190 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1919_real_step640_rank7.svg
[rank7]:> Batch Time: 1050.80 ms, GPU Bubble Ratio: 40.16%, 37.41%, 44.31%, 36.05%
[rank7]:[titan] 2025-09-23 19:19:54,262 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1919_stage3_step640.svg
[rank0]:[titan] 2025-09-23 19:21:09,041 - root - INFO - [GC] Peforming periodical GC collection 0.52 seconds
[rank6]:[titan] 2025-09-23 19:21:23,012 - root - INFO - Freezing Ratio: {3: '0.20'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:21:23,142 - root - INFO - Freezing Ratio: {3: '0.20'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:21:23,864 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:21:23,975 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:21:24,547 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:21:24,787 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:21:25,520 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:21:25,905 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:25:13,316 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:25:13,470 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:25:14,090 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:25:14,398 - root - INFO - Freezing Ratio: {3: '0.22'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:25:14,434 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:25:14,499 - root - INFO - Freezing Ratio: {3: '0.22'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:25:15,057 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:25:15,439 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:25:56,774 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank3]:[titan] 2025-09-23 19:25:56,774 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank6]:[titan] 2025-09-23 19:25:56,771 - root - INFO - [31m step: 680 [32m loss:  4.0705 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank7]:[titan] 2025-09-23 19:25:56,770 - root - INFO - [31m step: 680 [32m loss:  4.0705 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank5]:[titan] 2025-09-23 19:25:56,771 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank1]:[titan] 2025-09-23 19:25:56,777 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank4]:[titan] 2025-09-23 19:25:56,771 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank0]:[titan] 2025-09-23 19:25:56,777 - root - INFO - [31m step: 680 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0579 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.25 [35m mfu: 27.00%[39m
[rank6]:[titan] 2025-09-23 19:25:56,995 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1925_real_step680_rank6.svg
[rank6]:> Batch Time: 1051.06 ms, GPU Bubble Ratio: 40.08%, 37.82%, 44.17%, 36.03%
[rank7]:[titan] 2025-09-23 19:25:56,992 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1925_real_step680_rank7.svg
[rank7]:> Batch Time: 1051.25 ms, GPU Bubble Ratio: 40.19%, 37.44%, 44.34%, 36.03%
[rank6]:[titan] 2025-09-23 19:25:57,076 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1925_stage3_step680.svg
[rank7]:[titan] 2025-09-23 19:25:57,063 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1925_stage3_step680.svg
[rank0]:[titan] 2025-09-23 19:28:34,565 - root - INFO - [GC] Peforming periodical GC collection 0.53 seconds
[rank6]:[titan] 2025-09-23 19:28:48,493 - root - INFO - Freezing Ratio: {3: '0.22'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:28:48,652 - root - INFO - Freezing Ratio: {3: '0.22'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:28:49,395 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:28:49,545 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:28:49,606 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:28:50,505 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:28:51,087 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:28:51,555 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:31:48,245 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank2]:[titan] 2025-09-23 19:31:48,246 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank7]:[titan] 2025-09-23 19:31:48,247 - root - INFO - [31m step: 720 [32m loss:  3.9554 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.96 [35m mfu: 27.87%[39m
[rank6]:[titan] 2025-09-23 19:31:48,247 - root - INFO - [31m step: 720 [32m loss:  3.9554 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank5]:[titan] 2025-09-23 19:31:48,243 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank1]:[titan] 2025-09-23 19:31:48,249 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank0]:[titan] 2025-09-23 19:31:48,249 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank4]:[titan] 2025-09-23 19:31:48,243 - root - INFO - [31m step: 720 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0944 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.97 [35m mfu: 27.87%[39m
[rank7]:[titan] 2025-09-23 19:31:48,471 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1931_real_step720_rank7.svg
[rank7]:> Batch Time: 1051.19 ms, GPU Bubble Ratio: 40.19%, 37.44%, 44.33%, 36.04%
[rank6]:[titan] 2025-09-23 19:31:48,465 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1931_real_step720_rank6.svg
[rank6]:> Batch Time: 1050.98 ms, GPU Bubble Ratio: 40.08%, 37.81%, 44.16%, 36.03%
[rank7]:[titan] 2025-09-23 19:31:48,538 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1931_stage3_step720.svg
[rank6]:[titan] 2025-09-23 19:31:48,529 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1931_stage3_step720.svg
[rank5]:[titan] 2025-09-23 19:32:39,184 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:32:39,273 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:32:39,941 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:32:40,209 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:32:40,202 - root - INFO - Freezing Ratio: {3: '0.23'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:32:40,319 - root - INFO - Freezing Ratio: {3: '0.23'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:32:40,849 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:32:41,272 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:36:00,203 - root - INFO - [GC] Peforming periodical GC collection 0.54 seconds
[rank6]:[titan] 2025-09-23 19:36:14,107 - root - INFO - Freezing Ratio: {3: '0.23'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:36:14,338 - root - INFO - Freezing Ratio: {3: '0.23'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:36:15,069 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:36:15,156 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:36:15,664 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:36:16,072 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:36:16,757 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:36:17,153 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:37:45,511 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank4]:[titan] 2025-09-23 19:37:45,505 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank7]:[titan] 2025-09-23 19:37:45,509 - root - INFO - [31m step: 760 [32m loss:  3.9020 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank3]:[titan] 2025-09-23 19:37:45,508 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank6]:[titan] 2025-09-23 19:37:45,510 - root - INFO - [31m step: 760 [32m loss:  3.9020 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank2]:[titan] 2025-09-23 19:37:45,508 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank5]:[titan] 2025-09-23 19:37:45,505 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank0]:[titan] 2025-09-23 19:37:45,511 - root - INFO - [31m step: 760 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0836 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.56 [35m mfu: 27.42%[39m
[rank7]:[titan] 2025-09-23 19:37:45,726 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1937_real_step760_rank7.svg
[rank7]:> Batch Time: 1050.66 ms, GPU Bubble Ratio: 40.16%, 37.40%, 44.30%, 36.05%
[rank6]:[titan] 2025-09-23 19:37:45,724 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1937_real_step760_rank6.svg
[rank6]:> Batch Time: 1049.84 ms, GPU Bubble Ratio: 40.01%, 37.74%, 44.08%, 36.08%
[rank7]:[titan] 2025-09-23 19:37:45,795 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1937_stage3_step760.svg
[rank6]:[titan] 2025-09-23 19:37:45,794 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1937_stage3_step760.svg
[rank5]:[titan] 2025-09-23 19:40:04,780 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:40:04,987 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:40:05,592 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:40:05,825 - root - INFO - Freezing Ratio: {3: '0.25'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:40:05,809 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:40:06,142 - root - INFO - Freezing Ratio: {3: '0.25'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:40:06,533 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:40:06,796 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:43:25,834 - root - INFO - [GC] Peforming periodical GC collection 0.54 seconds
[rank6]:[titan] 2025-09-23 19:43:39,746 - root - INFO - Freezing Ratio: {3: '0.25'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:43:40,061 - root - INFO - Freezing Ratio: {3: '0.25'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:43:40,066 - root - INFO - [31m step: 800 [32m loss:  3.8616 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,848 [36m tflops: 86.21 [35m mfu: 27.63%[39m
[rank6]:[titan] 2025-09-23 19:43:40,066 - root - INFO - [31m step: 800 [32m loss:  3.8616 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,848 [36m tflops: 86.21 [35m mfu: 27.63%[39m
[rank5]:[titan] 2025-09-23 19:43:40,652 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:43:40,832 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,844 [36m tflops: 86.02 [35m mfu: 27.57%[39m
[rank4]:[titan] 2025-09-23 19:43:40,830 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:43:40,832 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,844 [36m tflops: 86.02 [35m mfu: 27.57%[39m
[rank3]:[titan] 2025-09-23 19:43:41,333 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:43:41,855 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:43:41,858 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,839 [36m tflops: 85.78 [35m mfu: 27.49%[39m
[rank3]:[titan] 2025-09-23 19:43:41,858 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,839 [36m tflops: 85.78 [35m mfu: 27.49%[39m
[rank1]:[titan] 2025-09-23 19:43:42,461 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:43:42,841 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:43:42,843 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank1]:[titan] 2025-09-23 19:43:42,843 - root - INFO - [31m step: 800 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0459 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank7]:[titan] 2025-09-23 19:43:43,059 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1943_real_step800_rank7.svg
[rank7]:> Batch Time: 995.73 ms, GPU Bubble Ratio: 36.85%, 33.94%, 41.21%, 38.05%
[rank6]:[titan] 2025-09-23 19:43:43,075 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1943_real_step800_rank6.svg
[rank6]:> Batch Time: 1000.41 ms, GPU Bubble Ratio: 37.05%, 34.66%, 41.28%, 37.86%
[rank7]:[titan] 2025-09-23 19:43:43,132 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1943_stage3_step800.svg
[rank6]:[titan] 2025-09-23 19:43:43,159 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1943_stage3_step800.svg
[rank5]:[titan] 2025-09-23 19:47:30,462 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:47:30,652 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:47:31,226 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:47:31,490 - root - INFO - Freezing Ratio: {3: '0.26'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:47:31,546 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:47:32,089 - root - INFO - Freezing Ratio: {3: '0.26'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:47:32,239 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:47:32,690 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:49:36,771 - root - INFO - [31m step: 840 [32m loss:  3.7290 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,837 [36m tflops: 85.69 [35m mfu: 27.46%[39m
[rank3]:[titan] 2025-09-23 19:49:36,775 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,847 [36m tflops: 86.12 [35m mfu: 27.60%[39m
[rank6]:[titan] 2025-09-23 19:49:36,772 - root - INFO - [31m step: 840 [32m loss:  3.7290 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,837 [36m tflops: 85.69 [35m mfu: 27.46%[39m
[rank5]:[titan] 2025-09-23 19:49:36,773 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.87 [35m mfu: 27.52%[39m
[rank4]:[titan] 2025-09-23 19:49:36,773 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,841 [36m tflops: 85.87 [35m mfu: 27.52%[39m
[rank1]:[titan] 2025-09-23 19:49:36,779 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,852 [36m tflops: 86.36 [35m mfu: 27.68%[39m
[rank0]:[titan] 2025-09-23 19:49:36,779 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,852 [36m tflops: 86.36 [35m mfu: 27.68%[39m
[rank2]:[titan] 2025-09-23 19:49:36,775 - root - INFO - [31m step: 840 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0484 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,847 [36m tflops: 86.12 [35m mfu: 27.60%[39m
[rank6]:[titan] 2025-09-23 19:49:36,983 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1949_real_step840_rank6.svg
[rank6]:> Batch Time: 1049.78 ms, GPU Bubble Ratio: 40.01%, 37.73%, 44.07%, 36.08%
[rank7]:[titan] 2025-09-23 19:49:36,991 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1949_real_step840_rank7.svg
[rank7]:> Batch Time: 1050.72 ms, GPU Bubble Ratio: 40.16%, 37.40%, 44.30%, 36.05%
[rank7]:[titan] 2025-09-23 19:49:37,056 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1949_stage3_step840.svg
[rank6]:[titan] 2025-09-23 19:49:37,057 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1949_stage3_step840.svg
[rank0]:[titan] 2025-09-23 19:50:51,834 - root - INFO - [GC] Peforming periodical GC collection 0.55 seconds
[rank6]:[titan] 2025-09-23 19:51:05,804 - root - INFO - Freezing Ratio: {3: '0.26'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:51:06,084 - root - INFO - Freezing Ratio: {3: '0.26'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:51:06,654 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:51:06,837 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:51:07,374 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:51:07,737 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:51:08,367 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:51:08,711 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:54:56,159 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:54:56,378 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:54:56,926 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:54:57,175 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 19:54:57,208 - root - INFO - Freezing Ratio: {3: '0.28'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:54:57,851 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:54:57,904 - root - INFO - Freezing Ratio: {3: '0.28'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:54:58,309 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:55:39,650 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank6]:[titan] 2025-09-23 19:55:39,647 - root - INFO - [31m step: 880 [32m loss:  3.3850 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank5]:[titan] 2025-09-23 19:55:39,648 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank4]:[titan] 2025-09-23 19:55:39,648 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank1]:[titan] 2025-09-23 19:55:39,654 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank0]:[titan] 2025-09-23 19:55:39,654 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank2]:[titan] 2025-09-23 19:55:39,651 - root - INFO - [31m step: 880 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank7]:[titan] 2025-09-23 19:55:39,647 - root - INFO - [31m step: 880 [32m loss:  3.3850 [38;2;180;60;0m grad_norm:  0.0455 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,806 [36m tflops: 84.23 [35m mfu: 27.00%[39m
[rank7]:[titan] 2025-09-23 19:55:39,890 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1955_real_step880_rank7.svg
[rank7]:> Batch Time: 1051.20 ms, GPU Bubble Ratio: 40.18%, 37.44%, 44.33%, 36.04%
[rank6]:[titan] 2025-09-23 19:55:39,888 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_1955_real_step880_rank6.svg
[rank6]:> Batch Time: 1050.80 ms, GPU Bubble Ratio: 40.06%, 37.79%, 44.15%, 36.04%
[rank6]:[titan] 2025-09-23 19:55:39,958 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_1955_stage3_step880.svg
[rank7]:[titan] 2025-09-23 19:55:39,959 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_1955_stage3_step880.svg
[rank0]:[titan] 2025-09-23 19:58:17,414 - root - INFO - [GC] Peforming periodical GC collection 0.55 seconds
[rank6]:[titan] 2025-09-23 19:58:31,333 - root - INFO - Freezing Ratio: {3: '0.28'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 19:58:31,708 - root - INFO - Freezing Ratio: {3: '0.28'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 19:58:32,224 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 19:58:32,389 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 19:58:32,878 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 19:58:33,421 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 19:58:34,006 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 19:58:34,388 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 20:01:31,069 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank4]:[titan] 2025-09-23 20:01:31,069 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank1]:[titan] 2025-09-23 20:01:31,075 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank0]:[titan] 2025-09-23 20:01:31,075 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank7]:[titan] 2025-09-23 20:01:31,074 - root - INFO - [31m step: 920 [32m loss:  3.3302 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank2]:[titan] 2025-09-23 20:01:31,072 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank3]:[titan] 2025-09-23 20:01:31,072 - root - INFO - [31m step: 920 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank6]:[titan] 2025-09-23 20:01:31,074 - root - INFO - [31m step: 920 [32m loss:  3.3302 [38;2;180;60;0m grad_norm:  0.0817 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,865 [36m tflops: 86.98 [35m mfu: 27.88%[39m
[rank7]:[titan] 2025-09-23 20:01:31,289 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2001_real_step920_rank7.svg
[rank7]:> Batch Time: 1051.28 ms, GPU Bubble Ratio: 40.19%, 37.44%, 44.33%, 36.04%
[rank6]:[titan] 2025-09-23 20:01:31,292 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2001_real_step920_rank6.svg
[rank6]:> Batch Time: 1050.78 ms, GPU Bubble Ratio: 40.06%, 37.79%, 44.14%, 36.04%
[rank7]:[titan] 2025-09-23 20:01:31,349 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_2001_stage3_step920.svg
[rank6]:[titan] 2025-09-23 20:01:31,351 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_2001_stage3_step920.svg
[rank5]:[titan] 2025-09-23 20:02:21,928 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:02:22,101 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 20:02:22,692 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 20:02:23,001 - root - INFO - Freezing Ratio: {3: '0.29'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 20:02:23,118 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 20:02:23,256 - root - INFO - Freezing Ratio: {3: '0.29'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 20:02:23,720 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:02:23,908 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:05:42,738 - root - INFO - [GC] Peforming periodical GC collection 0.56 seconds
[rank6]:[titan] 2025-09-23 20:05:57,049 - root - INFO - Freezing Ratio: {3: '0.29'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 20:05:57,148 - root - INFO - Freezing Ratio: {3: '0.29'}, Threshold: 5.0000e-02
[rank5]:[titan] 2025-09-23 20:05:57,863 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:05:58,079 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 20:05:58,588 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 20:05:58,974 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 20:05:59,686 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:06:00,038 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:07:28,393 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank5]:[titan] 2025-09-23 20:07:28,393 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank1]:[titan] 2025-09-23 20:07:28,399 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank0]:[titan] 2025-09-23 20:07:28,399 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank7]:[titan] 2025-09-23 20:07:28,397 - root - INFO - [31m step: 960 [32m loss:  3.2431 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank2]:[titan] 2025-09-23 20:07:28,396 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank3]:[titan] 2025-09-23 20:07:28,396 - root - INFO - [31m step: 960 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank6]:[titan] 2025-09-23 20:07:28,397 - root - INFO - [31m step: 960 [32m loss:  3.2431 [38;2;180;60;0m grad_norm:  0.0738 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank7]:[titan] 2025-09-23 20:07:28,616 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2007_real_step960_rank7.svg
[rank7]:> Batch Time: 1050.81 ms, GPU Bubble Ratio: 40.16%, 37.40%, 44.29%, 36.06%
[rank6]:[titan] 2025-09-23 20:07:28,621 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2007_real_step960_rank6.svg
[rank6]:> Batch Time: 1049.69 ms, GPU Bubble Ratio: 40.00%, 37.73%, 44.07%, 36.08%
[rank6]:[titan] 2025-09-23 20:07:28,686 - root - INFO - Frozen Ratio History of Rank 6 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank6/250923_2007_stage3_step960.svg
[rank7]:[titan] 2025-09-23 20:07:28,682 - root - INFO - Frozen Ratio History of Rank 7 (Stage 3)  is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/freeze_ratio_history/rank7/250923_2007_stage3_step960.svg
[rank5]:[titan] 2025-09-23 20:09:47,607 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:09:47,704 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 20:09:48,356 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank6]:[titan] 2025-09-23 20:09:48,670 - root - INFO - Freezing Ratio: {3: '0.31'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 20:09:48,782 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 20:09:48,950 - root - INFO - Freezing Ratio: {3: '0.31'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 20:09:49,389 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:09:49,842 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:13:08,695 - root - INFO - [GC] Peforming periodical GC collection 0.56 seconds
[rank6]:[titan] 2025-09-23 20:13:22,574 - root - INFO - Freezing Ratio: {3: '0.31'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 20:13:22,763 - root - INFO - Freezing Ratio: {3: '0.31'}, Threshold: 5.0000e-02
[rank7]:[titan] 2025-09-23 20:13:22,769 - root - INFO - [31m step: 1000 [32m loss:  3.2826 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,849 [36m tflops: 86.25 [35m mfu: 27.65%[39m
[rank7]:[titan] 2025-09-23 20:13:22,769 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank7]:[titan] 2025-09-23 20:13:22,787 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank6]:[titan] 2025-09-23 20:13:22,769 - root - INFO - [31m step: 1000 [32m loss:  3.2826 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 45.85GiB(57.86%) [34m tps: 1,849 [36m tflops: 86.25 [35m mfu: 27.65%[39m
[rank6]:[titan] 2025-09-23 20:13:22,770 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank6]:[titan] 2025-09-23 20:13:22,787 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank5]:[titan] 2025-09-23 20:13:23,505 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:13:23,616 - root - INFO - Freezing Ratio: {2: '0.01'}, Threshold: 5.0000e-02
[rank4]:[titan] 2025-09-23 20:13:23,618 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.05 [35m mfu: 27.58%[39m
[rank4]:[titan] 2025-09-23 20:13:23,618 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank4]:[titan] 2025-09-23 20:13:23,633 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank5]:[titan] 2025-09-23 20:13:23,618 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 34.68GiB(43.76%) [34m tps: 1,845 [36m tflops: 86.05 [35m mfu: 27.58%[39m
[rank5]:[titan] 2025-09-23 20:13:23,618 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank5]:[titan] 2025-09-23 20:13:23,634 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank3]:[titan] 2025-09-23 20:13:24,109 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank3]:[titan] 2025-09-23 20:13:24,737 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,839 [36m tflops: 85.78 [35m mfu: 27.49%[39m
[rank3]:[titan] 2025-09-23 20:13:24,738 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank2]:[titan] 2025-09-23 20:13:24,735 - root - INFO - Freezing Ratio: {1: '0.01'}, Threshold: 5.0000e-02
[rank2]:[titan] 2025-09-23 20:13:24,738 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 38.74GiB(48.88%) [34m tps: 1,839 [36m tflops: 85.78 [35m mfu: 27.49%[39m
[rank2]:[titan] 2025-09-23 20:13:24,738 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank2]:[titan] 2025-09-23 20:13:24,758 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank3]:[titan] 2025-09-23 20:13:24,755 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank1]:[titan] 2025-09-23 20:13:25,321 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank1]:[titan] 2025-09-23 20:13:25,748 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank1]:[titan] 2025-09-23 20:13:25,748 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank1]:[titan] 2025-09-23 20:13:25,812 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank0]:[titan] 2025-09-23 20:13:25,746 - root - INFO - Freezing Ratio: {0: '0.01'}, Threshold: 5.0000e-02
[rank0]:[titan] 2025-09-23 20:13:25,748 - root - INFO - [31m step: 1000 [32m loss: -8.0000 [38;2;180;60;0m grad_norm:  0.0451 [38;2;54;234;195m memory: 43.86GiB(55.34%) [34m tps: 1,834 [36m tflops: 85.54 [35m mfu: 27.42%[39m
[rank0]:[titan] 2025-09-23 20:13:25,748 - root - INFO - Saving the checkpoint (or staging if async is enabled).
[rank0]:[titan] 2025-09-23 20:13:25,808 - root - INFO - Saving a model only checkpoint in torch.float16 at last step, step 1000.
[rank0]:[titan] 2025-09-23 20:14:45,776 - root - INFO - [GC] GC collection invoked by checkpointer. 0.01 seconds
[rank1]:[titan] 2025-09-23 20:14:45,790 - root - INFO - Destroying the purge thread.
[rank3]:[titan] 2025-09-23 20:14:45,790 - root - INFO - Destroying the purge thread.
[rank2]:[titan] 2025-09-23 20:14:45,801 - root - INFO - Destroying the purge thread.
[rank4]:[titan] 2025-09-23 20:14:45,800 - root - INFO - Destroying the purge thread.
[rank5]:[titan] 2025-09-23 20:14:45,790 - root - INFO - Destroying the purge thread.
[rank0]:[titan] 2025-09-23 20:14:45,801 - root - INFO - Sleeping 2 seconds for other ranks to complete
[rank7]:[titan] 2025-09-23 20:14:45,994 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2014_real_final1000_rank7.svg
[rank7]:> Batch Time: 996.23 ms, GPU Bubble Ratio: 36.88%, 33.97%, 41.23%, 38.04%
[rank6]:[titan] 2025-09-23 20:14:46,006 - root - INFO - Pipeline schedule is saved as: /workspace/torchtitan_data/images/0922_gpipe_apf_runpod/pipeline_schedule/250923_2014_real_final1000_rank6.svg
[rank6]:> Batch Time: 1000.45 ms, GPU Bubble Ratio: 37.05%, 34.66%, 41.28%, 37.85%
[rank6]:[titan] 2025-09-23 20:14:46,011 - root - INFO - Destroying the purge thread.
[rank7]:[titan] 2025-09-23 20:14:46,000 - root - INFO - Destroying the purge thread.
[rank7]:[rank7]: Traceback (most recent call last):
[rank7]:[rank7]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank7]:[rank7]:   File "<frozen runpy>", line 88, in _run_code
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank7]:[rank7]:     trainer.train()
[rank7]:[rank7]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank7]:[rank7]:     return f(*args, **kwargs)
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 608, in train
[rank7]:[rank7]:     draw_charts(self.freezer, self.step, job_config)
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 653, in draw_charts
[rank7]:[rank7]:     pipeline_schedule = schedule_pipeline(pipeline_schedule, 
[rank7]:[rank7]:                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]:   File "/workspace/torchtitan/timelyfreeze/core/schedule.py", line 182, in schedule_pipeline
[rank7]:[rank7]:     assert fwd_time is None or len(fwd_time) == num_stages, f"fwd_time should have the same length as num_stages. fwd_time: {len(fwd_time)}, num_stages: {num_stages}"
[rank7]:[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:[rank7]: AssertionError: fwd_time should have the same length as num_stages. fwd_time: 1, num_stages: 4
[rank6]:wandb: updating run metadata
[rank6]:wandb: 
[rank6]:wandb: Run history:
[rank6]:wandb:                    grad_norm ‚ñà‚ñÅ‚ñÅ‚ñÉ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb: loss_metrics/global_avg_loss ‚ñà‚ñÑ‚ñÉ‚ñÉ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb: loss_metrics/global_max_loss ‚ñà‚ñÉ‚ñÉ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb:                           lr ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñá‚ñá‚ñá‚ñÜ‚ñÜ‚ñÖ‚ñÖ‚ñÑ‚ñÉ‚ñÉ‚ñÇ‚ñÇ‚ñÇ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb:         memory/max_active(%) ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
[rank6]:wandb:       memory/max_active(GiB) ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
[rank6]:wandb:       memory/max_reserved(%) ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
[rank6]:wandb:     memory/max_reserved(GiB) ‚ñÅ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
[rank6]:wandb:     memory/num_alloc_retries ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb:              memory/num_ooms ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñÅ
[rank6]:wandb:                           +7 ...
[rank6]:wandb: 
[rank6]:wandb: Run summary:
[rank6]:wandb:                    grad_norm 0.0451
[rank6]:wandb: loss_metrics/global_avg_loss 3.28256
[rank6]:wandb: loss_metrics/global_max_loss 3.78049
[rank6]:wandb:                           lr 0.0
[rank6]:wandb:         memory/max_active(%) 52.65939
[rank6]:wandb:       memory/max_active(GiB) 41.73347
[rank6]:wandb:       memory/max_reserved(%) 57.85561
[rank6]:wandb:     memory/max_reserved(GiB) 45.85156
[rank6]:wandb:     memory/num_alloc_retries 0
[rank6]:wandb:              memory/num_ooms 0
[rank6]:wandb:                           +7 ...
[rank6]:wandb: 
[rank6]:wandb: üöÄ View run 0922_gpipe_apf_runpod at: https://wandb.ai/orangingq/torchtitan/runs/at675fb0
[rank6]:wandb: ‚≠êÔ∏è View project at: https://wandb.ai/orangingq/torchtitan
[rank6]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank6]:wandb: Find logs at: ._data/tb/0922_gpipe_apf_runpod/20250923-1744/wandb/run-20250923_174447-at675fb0/logs
[rank6]:Traceback (most recent call last):
[rank6]:  File "<frozen runpy>", line 198, in _run_module_as_main
[rank6]:  File "<frozen runpy>", line 88, in _run_code
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank6]:    trainer.train()
[rank6]:  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank6]:    return f(*args, **kwargs)
[rank6]:           ^^^^^^^^^^^^^^^^^^
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 608, in train
[rank6]:    draw_charts(self.freezer, self.step, job_config)
[rank6]:  File "/workspace/torchtitan/timelyfreeze/train.py", line 653, in draw_charts
[rank6]:    pipeline_schedule = schedule_pipeline(pipeline_schedule,
[rank6]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:  File "/workspace/torchtitan/timelyfreeze/core/schedule.py", line 182, in schedule_pipeline
[rank6]:    assert fwd_time is None or len(fwd_time) == num_stages, f"fwd_time should have the same length as num_stages. fwd_time: {len(fwd_time)}, num_stages: {num_stages}"
[rank6]:           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:AssertionError: fwd_time should have the same length as num_stages. fwd_time: 1, num_stages: 4
[rank6]:[rank6]: Traceback (most recent call last):
[rank6]:[rank6]:   File "<frozen runpy>", line 198, in _run_module_as_main
[rank6]:[rank6]:   File "<frozen runpy>", line 88, in _run_code
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 727, in <module>
[rank6]:[rank6]:     trainer.train()
[rank6]:[rank6]:   File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
[rank6]:[rank6]:     return f(*args, **kwargs)
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 608, in train
[rank6]:[rank6]:     draw_charts(self.freezer, self.step, job_config)
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/train.py", line 653, in draw_charts
[rank6]:[rank6]:     pipeline_schedule = schedule_pipeline(pipeline_schedule, 
[rank6]:[rank6]:                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]:   File "/workspace/torchtitan/timelyfreeze/core/schedule.py", line 182, in schedule_pipeline
[rank6]:[rank6]:     assert fwd_time is None or len(fwd_time) == num_stages, f"fwd_time should have the same length as num_stages. fwd_time: {len(fwd_time)}, num_stages: {num_stages}"
[rank6]:[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:[rank6]: AssertionError: fwd_time should have the same length as num_stages. fwd_time: 1, num_stages: 4
[rank6]:[rank6]:[W923 20:14:47.798886611 ProcessGroupNCCL.cpp:1524] Warning: WARNING: destroy_process_group() was not called before program exit, which can leak resources. For more info, please see https://pytorch.org/docs/stable/distributed.html#shutdown (function operator())
[rank0]:[titan] 2025-09-23 20:14:47,801 - root - INFO - Training completed
[rank0]:[titan] 2025-09-23 20:14:47,801 - root - INFO - Destroying the purge thread.
[rank7]:[rank7]:[W923 20:14:48.532387201 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
[rank6]:[rank6]:[W923 20:14:50.677656945 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
W0923 20:14:50.271000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36213 closing signal SIGTERM
W0923 20:14:50.273000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36214 closing signal SIGTERM
W0923 20:14:50.274000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36215 closing signal SIGTERM
W0923 20:14:50.274000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36216 closing signal SIGTERM
W0923 20:14:50.275000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36217 closing signal SIGTERM
W0923 20:14:50.276000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36218 closing signal SIGTERM
W0923 20:14:50.277000 36105 torch/distributed/elastic/multiprocessing/api.py:939] Sending process 36219 closing signal SIGTERM
E0923 20:14:55.024000 36105 torch/distributed/elastic/multiprocessing/api.py:913] failed (exitcode: 1) local_rank: 7 (pid: 36220) of binary: /usr/bin/python
E0923 20:14:55.035000 36105 torch/distributed/elastic/multiprocessing/errors/error_handler.py:141] no error file defined for parent, to copy child error file (/tmp/torchelastic_9vi3hh4y/0fff0ff2-7601-41fd-a7a4-03bf73c42046_rp__sjkj/attempt_0/7/error.json)
[rank5]:Stage 2: Modules to keep: {'layers.20', 'layers.18', 'layers.19', 'layers.21', 'layers.24', 'layers.23', 'layers.22', 'layers.17'}
[rank7]:Stage 3: Modules to keep: {'layers.30', 'layers.26', 'layers.27', 'output', 'layers.25', 'layers.29', 'layers.28', 'layers.31', 'norm'}
[rank1]:Stage 0: Modules to keep: {'layers.7', 'layers.1', 'layers.2', 'layers.0', 'layers.4', 'layers.5', 'layers.6', 'tok_embeddings', 'layers.3'}
[rank0]:Stage 0: Modules to keep: {'layers.5', 'layers.7', 'layers.6', 'layers.1', 'layers.3', 'layers.2', 'layers.4', 'layers.0', 'tok_embeddings'}
[rank3]:Stage 1: Modules to keep: {'layers.12', 'layers.11', 'layers.15', 'layers.8', 'layers.10', 'layers.13', 'layers.14', 'layers.9', 'layers.16'}
[rank4]:Stage 2: Modules to keep: {'layers.20', 'layers.18', 'layers.17', 'layers.22', 'layers.23', 'layers.21', 'layers.24', 'layers.19'}
[rank2]:Stage 1: Modules to keep: {'layers.10', 'layers.11', 'layers.9', 'layers.15', 'layers.14', 'layers.13', 'layers.16', 'layers.12', 'layers.8'}
[rank6]:Stage 3: Modules to keep: {'norm', 'layers.25', 'layers.30', 'layers.29', 'layers.27', 'layers.31', 'layers.28', 'output', 'layers.26'}
[rank1]:[Gloo] Rank 1 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank0]:[Gloo] Rank 0 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank3]:[Gloo] Rank 3 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank2]:[Gloo] Rank 2 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank7]:[Gloo] Rank 7 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank6]:[Gloo] Rank 6 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank5]:[Gloo] Rank 5 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[rank4]:[Gloo] Rank 4 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
Traceback (most recent call last):
  File "/usr/local/bin/torchrun", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/run.py", line 949, in main
    run(args)
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/run.py", line 940, in run
    elastic_launch(
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/launcher/api.py", line 158, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/torch/distributed/launcher/api.py", line 299, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
timelyfreeze.train FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 0 (local_rank: 0)
  exitcode  : -15 (pid: 36213)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36213
[2]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 1 (local_rank: 1)
  exitcode  : -15 (pid: 36214)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36214
[3]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 2 (local_rank: 2)
  exitcode  : -15 (pid: 36215)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36215
[4]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 3 (local_rank: 3)
  exitcode  : -15 (pid: 36216)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36216
[5]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 4 (local_rank: 4)
  exitcode  : -15 (pid: 36217)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36217
[6]:
  time      : 2025-09-23_20:14:55
  host      : 30be631344fa
  rank      : 5 (local_rank: 5)
  exitcode  : -15 (pid: 36218)
  error_file: <N/A>
  traceback : Signal 15 (SIGTERM) received by PID 36218
[7]:
  time      : 2025-09-23_20:14:46
  host      : 30be631344fa
  rank      : 6 (local_rank: 6)
  exitcode  : 1 (pid: 36219)
  error_file: /tmp/torchelastic_9vi3hh4y/0fff0ff2-7601-41fd-a7a4-03bf73c42046_rp__sjkj/attempt_0/6/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 608, in train
      draw_charts(self.freezer, self.step, job_config)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 653, in draw_charts
      pipeline_schedule = schedule_pipeline(pipeline_schedule,
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/schedule.py", line 182, in schedule_pipeline
      assert fwd_time is None or len(fwd_time) == num_stages, f"fwd_time should have the same length as num_stages. fwd_time: {len(fwd_time)}, num_stages: {num_stages}"
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  AssertionError: fwd_time should have the same length as num_stages. fwd_time: 1, num_stages: 4
  
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2025-09-23_20:14:45
  host      : 30be631344fa
  rank      : 7 (local_rank: 7)
  exitcode  : 1 (pid: 36220)
  error_file: /tmp/torchelastic_9vi3hh4y/0fff0ff2-7601-41fd-a7a4-03bf73c42046_rp__sjkj/attempt_0/7/error.json
  traceback : Traceback (most recent call last):
    File "/usr/local/lib/python3.11/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 357, in wrapper
      return f(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/train.py", line 608, in train
      draw_charts(self.freezer, self.step, job_config)
    File "/workspace/torchtitan/timelyfreeze/train.py", line 653, in draw_charts
      pipeline_schedule = schedule_pipeline(pipeline_schedule,
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "/workspace/torchtitan/timelyfreeze/core/schedule.py", line 182, in schedule_pipeline
      assert fwd_time is None or len(fwd_time) == num_stages, f"fwd_time should have the same length as num_stages. fwd_time: {len(fwd_time)}, num_stages: {num_stages}"
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  AssertionError: fwd_time should have the same length as num_stages. fwd_time: 1, num_stages: 4
  
============================================================
[W923 20:14:55.915292292 AllocatorConfig.cpp:28] Warning: PYTORCH_CUDA_ALLOC_CONF is deprecated, use PYTORCH_ALLOC_CONF instead (function operator())
