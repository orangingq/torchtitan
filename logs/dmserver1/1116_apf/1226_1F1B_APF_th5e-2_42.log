
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 12. 26. (ê¸ˆ) 06:19:37 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 1,2,3,4
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/1226_1F1B_APF_th5e-2_42.log
âœ”ï¸APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged

âœ”ï¸Running with APF (threshold=5e-2) x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml --job.description="APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged
" --parallelism.pipeline_parallel_degree=4  --freezing.freeze --freezing.metric_type=apf --freezing.threshold=5e-2
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank2]:2025-12-26 06:19:43,682 - Starting job: "APF configuration experiment on different threshold values.
[rank2]:1226: everything same as 1116, but debugged
[rank2]:"
[rank3]:2025-12-26 06:19:43,682 - Starting job: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank1]:2025-12-26 06:19:43,839 - Starting job: "APF configuration experiment on different threshold values.
[rank1]:1226: everything same as 1116, but debugged
[rank1]:"
[rank2]:2025-12-26 06:19:43,896 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:2025-12-26 06:19:43,898 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 06:19:43,942 - Starting job: "APF configuration experiment on different threshold values.
[rank0]:1226: everything same as 1116, but debugged
[rank0]:"
[rank3]:2025-12-26 06:19:43,902 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-12-26 06:19:43,904 - Building 1-D device mesh with ['pp'], [4]
[rank1]:2025-12-26 06:19:44,012 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-12-26 06:19:44,015 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 06:19:44,120 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-26 06:19:44,123 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 06:19:44,126 - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-12-26 06:19:44,128 - Loading tokenizer from tokenizer.json
[rank0]:2025-12-26 06:19:44,517 - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank0]:2025-12-26 06:19:47,424 - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank0]:2025-12-26 06:19:47,576 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-26 06:19:47,617 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 06:19:47,618 - Model llama3 1B size: 1,498,482,688 total parameters
[rank0]:2025-12-26 06:19:47,644 - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-12-26 06:19:47,644 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-26 06:19:47,630 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank1]:2025-12-26 06:19:47,667 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 06:19:47,694 - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-12-26 06:19:47,695 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-26 06:19:47,816 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-12-26 06:19:47,859 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-26 06:19:47,886 - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-12-26 06:19:47,886 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-12-26 06:19:47,849 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 06:19:47,850 - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-12-26 06:19:47,851 - CUDA memory usage for model: 1.90GiB(3.99%)
[rank1]:2025-12-26 06:19:47,896 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 06:19:47,897 - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-12-26 06:19:47,898 - CUDA memory usage for model: 1.13GiB(2.39%)
[rank2]:2025-12-26 06:19:48,070 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-26 06:19:48,070 - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-12-26 06:19:48,071 - CUDA memory usage for model: 0.92GiB(1.94%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run gbicamzu
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1226_1F1B_APF_th5e-2_42_dm1/20251226-0619/wandb/run-20251226_061948-gbicamzu
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1226_1F1B_APF_th5e-2_42_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/gbicamzu
[rank3]:2025-12-26 06:19:49,653 - WandB logging enabled
[rank3]:2025-12-26 06:19:49,654 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-12-26 06:19:49,694 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 06:19:49,723 - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-12-26 06:19:49,724 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank3]:2025-12-26 06:19:49,914 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 06:19:49,915 - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-12-26 06:19:49,916 - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-12-26 06:19:49,930 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 06:19:49,931 - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th5e-2_42_dm1
[rank0]:2025-12-26 06:19:49,931 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 06:19:49,932 - Trainer is initialized with local batch size 16, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-12-26 06:19:49,932 - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank2]:2025-12-26 06:19:49,930 - Mixed precision training with TP or PP is handled by autocast
[rank1]:2025-12-26 06:19:49,931 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 06:19:52,487 - [GC] GC collection for checkpoint loading. 0.00 seconds
[rank0]:2025-12-26 06:19:52,487 - Finished loading the checkpoint in 2.55 seconds.
[rank0]:2025-12-26 06:19:52,487 - Training starts at step 1
[rank2]:2025-12-26 06:19:58,138 -  step:  1  loss: -8.0000  grad_norm: 116.5368  memory:  5.20GiB(10.94%)  tps: 3,188  tflops: 24.92  mfu: 7.99%
[rank2]:2025-12-26 06:19:58,138 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-12-26 06:19:58,150 -  step:  1  loss: 10.6088  grad_norm: 116.5368  memory: 12.97GiB(27.31%)  tps: 3,876  tflops: 30.30  mfu: 9.71%
[rank3]:2025-12-26 06:19:58,150 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-26 06:19:58,178 -  step:  1  loss: -8.0000  grad_norm: 116.5368  memory:  9.62GiB(20.24%)  tps: 3,103  tflops: 24.26  mfu: 7.77%
[rank0]:2025-12-26 06:19:58,178 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank1]:2025-12-26 06:19:58,142 -  step:  1  loss: -8.0000  grad_norm: 116.5368  memory:  7.10GiB(14.94%)  tps: 3,128  tflops: 24.46  mfu: 7.84%
[rank1]:2025-12-26 06:19:58,142 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-12-26 06:22:00,720 - Avg. fwd time: 7.3816 / Avg. bwd time: 19.9289 / Avg. batch time: 544.3935 (ms) / GPU bubble ratio: 59.87%
[rank3]:2025-12-26 06:22:00,695 - Avg. fwd time: 13.4951 / Avg. bwd time: 42.4884 / Avg. batch time: 511.5027 (ms) / GPU bubble ratio: 12.44%
[rank1]:2025-12-26 06:22:00,750 - Avg. fwd time: 9.2517 / Avg. bwd time: 24.7586 / Avg. batch time: 584.2643 (ms) / GPU bubble ratio: 53.43%
[rank0]:2025-12-26 06:22:00,780 - Avg. fwd time: 7.6606 / Avg. bwd time: 24.9186 / Avg. batch time: 622.9841 (ms) / GPU bubble ratio: 58.16%
[rank0]:2025-12-26 06:24:03,974 - [GC] Peforming periodical GC collection 0.00 seconds
[rank2]:2025-12-26 06:24:09,007 - Avg. fwd time: 7.3774 / Avg. bwd time: 19.9716 / Avg. batch time: 545.7787 (ms) / GPU bubble ratio: 59.91%
[rank3]:2025-12-26 06:24:08,982 - Avg. fwd time: 13.5815 / Avg. bwd time: 42.6354 / Avg. batch time: 513.2574 (ms) / GPU bubble ratio: 12.38%
[rank0]:2025-12-26 06:24:09,067 - Avg. fwd time: 7.6693 / Avg. bwd time: 24.9684 / Avg. batch time: 623.7237 (ms) / GPU bubble ratio: 58.14%
[rank0]:2025-12-26 06:24:09,103 -  step: 50  loss: -8.0000  grad_norm: 12.7951  memory: 13.42GiB(28.26%)  tps: 6,399  tflops: 50.02  mfu: 16.03%
[rank2]:2025-12-26 06:24:09,088 -  step: 50  loss: -8.0000  grad_norm: 12.7951  memory:  6.98GiB(14.69%)  tps: 6,398  tflops: 50.02  mfu: 16.03%
[rank1]:2025-12-26 06:24:09,037 - Avg. fwd time: 9.2645 / Avg. bwd time: 24.8166 / Avg. batch time: 585.3331 (ms) / GPU bubble ratio: 53.42%
[rank1]:2025-12-26 06:24:09,092 -  step: 50  loss: -8.0000  grad_norm: 12.7951  memory:  9.50GiB(19.99%)  tps: 6,398  tflops: 50.02  mfu: 16.03%
[rank3]:2025-12-26 06:24:09,100 -  step: 50  loss:  9.9168  grad_norm: 12.7951  memory: 16.39GiB(34.50%)  tps: 6,398  tflops: 50.02  mfu: 16.03%
[rank3]:2025-12-26 06:24:55,123 - Freezing Ratio: [Stage3] 0.00, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:24:55,368 - Freezing Ratio: [Stage1] 0.00, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:24:55,341 - Freezing Ratio: [Stage2] 0.00, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:24:55,396 - Freezing Ratio: [Stage0] 0.00, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:25:46,927 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:25:46,907 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:25:46,899 - Freezing Ratio: [Stage2] 0.81, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:25:46,920 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:26:07,373 - Avg. fwd time: 13.6768 / Avg. bwd time: 41.0147 / Avg. batch time: 501.0039 (ms) / GPU bubble ratio: 12.67%
[rank0]:2025-12-26 06:26:07,417 - Avg. fwd time: 7.7904 / Avg. bwd time: 23.6835 / Avg. batch time: 607.8061 (ms) / GPU bubble ratio: 58.57%
[rank1]:2025-12-26 06:26:07,404 - Avg. fwd time: 9.4009 / Avg. bwd time: 23.7184 / Avg. batch time: 570.8358 (ms) / GPU bubble ratio: 53.58%
[rank2]:2025-12-26 06:26:07,388 - Avg. fwd time: 7.4949 / Avg. bwd time: 19.0918 / Avg. batch time: 532.5090 (ms) / GPU bubble ratio: 60.06%
[rank1]:2025-12-26 06:26:21,009 - Freezing Ratio: [Stage1] 0.02, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:26:21,010 - Freezing Ratio: [Stage3] 0.07, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:26:21,010 - Freezing Ratio: [Stage0] 0.03, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:26:21,010 - Freezing Ratio: [Stage2] 0.14, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:27:12,532 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:27:12,548 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:27:12,556 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:27:12,524 - Freezing Ratio: [Stage2] 0.78, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:27:46,444 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:27:46,444 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:27:46,447 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:27:46,449 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:27:46,445 - Freezing Ratio: [Stage2] 0.89, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:27:49,804 - Avg. fwd time: 9.6304 / Avg. bwd time: 21.8957 / Avg. batch time: 545.9702 (ms) / GPU bubble ratio: 53.81%
[rank3]:2025-12-26 06:27:49,774 - Avg. fwd time: 13.7543 / Avg. bwd time: 38.2635 / Avg. batch time: 479.5811 (ms) / GPU bubble ratio: 13.23%
[rank0]:2025-12-26 06:27:49,817 - Avg. fwd time: 7.9815 / Avg. bwd time: 21.5606 / Avg. batch time: 580.7041 (ms) / GPU bubble ratio: 59.30%
[rank0]:2025-12-26 06:27:49,819 -  step: 100  loss: -8.0000  grad_norm:  0.1446  memory: 15.36GiB(32.33%)  tps: 7,423  tflops: 58.03  mfu: 18.60%
[rank2]:2025-12-26 06:27:49,788 - Avg. fwd time: 7.6862 / Avg. bwd time: 17.6292 / Avg. batch time: 509.5448 (ms) / GPU bubble ratio: 60.25%
[rank2]:2025-12-26 06:27:49,819 -  step: 100  loss: -8.0000  grad_norm:  0.1446  memory:  7.91GiB(16.66%)  tps: 7,423  tflops: 58.03  mfu: 18.60%
[rank1]:2025-12-26 06:27:49,819 -  step: 100  loss: -8.0000  grad_norm:  0.1446  memory: 10.69GiB(22.50%)  tps: 7,423  tflops: 58.03  mfu: 18.60%
[rank1]:2025-12-26 06:27:49,887 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0627_stage1_step100.svg
[rank3]:2025-12-26 06:27:49,820 -  step: 100  loss:  9.0596  grad_norm:  0.1446  memory: 19.83GiB(41.74%)  tps: 7,423  tflops: 58.03  mfu: 18.60%
[rank0]:2025-12-26 06:27:49,888 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0627_stage0_step100.svg
[rank2]:2025-12-26 06:27:49,887 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0627_stage2_step100.svg
[rank3]:2025-12-26 06:27:49,984 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0627_step100_rank3.svg
[rank3]:			> Batch Time: 415.49 ms, GPU Bubble Ratio: 65.78%, 58.01%, 66.09%, 31.53%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-19ms       | [S0,MB2,F]  19-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-8-110ms    | [S0,MB4,F]  111-8-119ms    | [S0,MB1,B]  145-8-154ms    | [S0,MB5,F]  154-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  241-8-249ms    | [S0,MB4,B]  276-8-284ms    | [S0,MB5,B]  318-8-327ms    | [S0,MB6,B]  362-8-370ms    | [S0,MB7,B]  407-8-415ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  216-10-226ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  274-11-285ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  259-8-267ms    | [S2,MB5,B]  290-8-299ms    | [S2,MB7,F]  302-8-311ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-242ms   | [S3,MB5,F]  245-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-303ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-376ms  
[rank3]:2025-12-26 06:27:50,027 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0627_stage3_step100.svg
[rank3]:2025-12-26 06:28:20,571 - Freezing Ratio: [Stage3] 0.03, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:28:20,571 - Freezing Ratio: [Stage1] 0.02, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:28:20,572 - Freezing Ratio: [Stage0] 0.03, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:28:20,571 - Freezing Ratio: [Stage2] 0.11, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:29:12,062 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:29:12,078 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:29:12,085 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:29:12,055 - Freezing Ratio: [Stage2] 0.78, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:29:32,374 - Avg. fwd time: 13.7952 / Avg. bwd time: 36.6050 / Avg. batch time: 466.6181 (ms) / GPU bubble ratio: 13.59%
[rank1]:2025-12-26 06:29:32,405 - Avg. fwd time: 9.7696 / Avg. bwd time: 20.8045 / Avg. batch time: 531.0523 (ms) / GPU bubble ratio: 53.94%
[rank0]:2025-12-26 06:29:32,419 - Avg. fwd time: 8.0977 / Avg. bwd time: 20.2852 / Avg. batch time: 564.4556 (ms) / GPU bubble ratio: 59.77%
[rank2]:2025-12-26 06:29:32,389 - Avg. fwd time: 7.8007 / Avg. bwd time: 16.7509 / Avg. batch time: 495.7618 (ms) / GPU bubble ratio: 60.38%
[rank3]:2025-12-26 06:29:46,156 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:29:46,156 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:29:46,157 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:29:46,157 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:30:20,099 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:30:20,099 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:30:20,100 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:30:20,099 - Freezing Ratio: [Stage2] 0.89, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:30:54,040 - Freezing Ratio: [Stage1] 0.04, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:30:54,046 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 06:30:54,047 - Freezing Ratio: [Stage0] 0.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:30:54,040 - Freezing Ratio: [Stage3] 0.07, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:30:54,039 - Freezing Ratio: [Stage2] 0.14, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:30:59,148 - Avg. fwd time: 9.9673 / Avg. bwd time: 19.2320 / Avg. batch time: 509.5299 (ms) / GPU bubble ratio: 54.15%
[rank3]:2025-12-26 06:30:59,091 - Avg. fwd time: 13.8581 / Avg. bwd time: 34.2180 / Avg. batch time: 448.0138 (ms) / GPU bubble ratio: 14.15%
[rank2]:2025-12-26 06:30:59,117 - Avg. fwd time: 7.9688 / Avg. bwd time: 15.4865 / Avg. batch time: 475.8398 (ms) / GPU bubble ratio: 60.57%
[rank1]:2025-12-26 06:30:59,204 -  step: 150  loss: -8.0000  grad_norm: 10.5212  memory: 10.69GiB(22.50%)  tps: 8,651  tflops: 67.63  mfu: 21.68%
[rank3]:2025-12-26 06:30:59,213 -  step: 150  loss:  6.6608  grad_norm: 10.5212  memory: 19.83GiB(41.74%)  tps: 8,651  tflops: 67.63  mfu: 21.68%
[rank0]:2025-12-26 06:30:59,179 - Avg. fwd time: 8.2605 / Avg. bwd time: 18.3764 / Avg. batch time: 540.9729 (ms) / GPU bubble ratio: 60.61%
[rank0]:2025-12-26 06:30:59,216 -  step: 150  loss: -8.0000  grad_norm: 10.5212  memory: 15.49GiB(32.61%)  tps: 8,651  tflops: 67.63  mfu: 21.68%
[rank2]:2025-12-26 06:30:59,201 -  step: 150  loss: -8.0000  grad_norm: 10.5212  memory:  7.91GiB(16.66%)  tps: 8,651  tflops: 67.63  mfu: 21.68%
[rank2]:2025-12-26 06:31:45,625 - Freezing Ratio: [Stage2] 0.81, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:31:45,656 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:31:45,649 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:31:45,633 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:32:19,711 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:32:19,709 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:32:19,710 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:32:19,710 - Freezing Ratio: [Stage2] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:32:39,979 - Avg. fwd time: 13.8865 / Avg. bwd time: 33.5015 / Avg. batch time: 442.5073 (ms) / GPU bubble ratio: 14.33%
[rank2]:2025-12-26 06:32:39,994 - Avg. fwd time: 8.0189 / Avg. bwd time: 15.1002 / Avg. batch time: 469.9110 (ms) / GPU bubble ratio: 60.64%
[rank0]:2025-12-26 06:32:40,025 - Avg. fwd time: 8.3092 / Avg. bwd time: 17.7722 / Avg. batch time: 533.9040 (ms) / GPU bubble ratio: 60.92%
[rank1]:2025-12-26 06:32:40,011 - Avg. fwd time: 10.0272 / Avg. bwd time: 18.7525 / Avg. batch time: 503.1029 (ms) / GPU bubble ratio: 54.24%
[rank1]:2025-12-26 06:32:53,654 - Freezing Ratio: [Stage1] 0.87, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:32:53,655 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:32:53,653 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:32:53,654 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:33:27,548 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:33:27,549 - Freezing Ratio: [Stage1] 0.96, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:33:27,549 - Freezing Ratio: [Stage3] 0.76, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:33:27,550 - Freezing Ratio: [Stage0] 0.78, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:34:01,604 - Freezing Ratio: [Stage2] 0.14, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:34:01,603 - Freezing Ratio: [Stage1] 0.04, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:34:01,604 - Freezing Ratio: [Stage3] 0.07, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:34:01,608 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:34:01,610 - Freezing Ratio: [Stage0] 0.05, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:34:06,728 - Avg. fwd time: 8.1174 / Avg. bwd time: 14.3565 / Avg. batch time: 458.2621 (ms) / GPU bubble ratio: 60.77%
[rank1]:2025-12-26 06:34:06,759 - Avg. fwd time: 10.1440 / Avg. bwd time: 17.8290 / Avg. batch time: 490.5165 (ms) / GPU bubble ratio: 54.38%
[rank3]:2025-12-26 06:34:06,701 - Avg. fwd time: 13.9238 / Avg. bwd time: 32.1054 / Avg. batch time: 431.6323 (ms) / GPU bubble ratio: 14.69%
[rank0]:2025-12-26 06:34:06,791 - Avg. fwd time: 8.4061 / Avg. bwd time: 16.6734 / Avg. batch time: 520.1817 (ms) / GPU bubble ratio: 61.43%
[rank2]:2025-12-26 06:34:06,812 -  step: 200  loss: -8.0000  grad_norm: 12.8259  memory:  7.91GiB(16.66%)  tps: 8,733  tflops: 68.27  mfu: 21.88%
[rank1]:2025-12-26 06:34:06,816 -  step: 200  loss: -8.0000  grad_norm: 12.8259  memory: 10.83GiB(22.79%)  tps: 8,733  tflops: 68.27  mfu: 21.88%
[rank1]:2025-12-26 06:34:06,876 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0634_stage1_step200.svg
[rank3]:2025-12-26 06:34:06,825 -  step: 200  loss:  4.4106  grad_norm: 12.8259  memory: 19.83GiB(41.74%)  tps: 8,733  tflops: 68.27  mfu: 21.88%
[rank0]:2025-12-26 06:34:06,827 -  step: 200  loss: -8.0000  grad_norm: 12.8259  memory: 15.49GiB(32.61%)  tps: 8,733  tflops: 68.27  mfu: 21.88%
[rank0]:2025-12-26 06:34:06,875 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0634_stage0_step200.svg
[rank2]:2025-12-26 06:34:06,876 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0634_stage2_step200.svg
[rank3]:2025-12-26 06:34:06,966 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0634_step200_rank3.svg
[rank3]:			> Batch Time: 416.07 ms, GPU Bubble Ratio: 65.77%, 58.13%, 66.28%, 31.58%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-8-111ms    | [S0,MB4,F]  111-8-120ms    | [S0,MB1,B]  145-8-154ms    | [S0,MB5,F]  154-8-163ms    | [S0,MB2,B]  188-8-197ms    | [S0,MB6,F]  197-8-206ms    | [S0,MB3,B]  233-8-241ms    | [S0,MB7,F]  241-8-250ms    | [S0,MB4,B]  277-8-286ms    | [S0,MB5,B]  320-8-329ms    | [S0,MB6,B]  363-8-371ms    | [S0,MB7,B]  407-8-416ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-11-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  144-10-155ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-10-198ms   | [S1,MB3,B]  217-10-227ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  275-10-286ms   | [S1,MB5,B]  306-10-317ms   | [S1,MB6,B]  348-10-359ms   | [S1,MB7,B]  393-10-404ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-136ms    | [S2,MB2,B]  159-8-167ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  292-8-301ms    | [S2,MB7,F]  304-8-313ms    | [S2,MB6,B]  336-8-345ms    | [S2,MB7,B]  381-8-390ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-21-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-13-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-216ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-288ms   | [S3,MB6,F]  290-14-305ms   | [S3,MB6,B]  311-21-333ms   | [S3,MB7,F]  335-14-350ms   | [S3,MB7,B]  356-21-377ms  
[rank3]:2025-12-26 06:34:07,010 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0634_stage3_step200.svg
[rank1]:2025-12-26 06:34:53,327 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:34:53,344 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:34:53,350 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:34:53,320 - Freezing Ratio: [Stage2] 0.78, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:35:27,243 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:35:27,242 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:35:27,242 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:35:27,244 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:35:47,710 - Avg. fwd time: 10.1714 / Avg. bwd time: 17.6136 / Avg. batch time: 487.6002 (ms) / GPU bubble ratio: 54.41%
[rank3]:2025-12-26 06:35:47,676 - Avg. fwd time: 13.9340 / Avg. bwd time: 31.7760 / Avg. batch time: 429.0769 (ms) / GPU bubble ratio: 14.78%
[rank0]:2025-12-26 06:35:47,724 - Avg. fwd time: 8.4278 / Avg. bwd time: 16.3950 / Avg. batch time: 516.9721 (ms) / GPU bubble ratio: 61.59%
[rank2]:2025-12-26 06:35:47,692 - Avg. fwd time: 8.1403 / Avg. bwd time: 14.1805 / Avg. batch time: 455.5723 (ms) / GPU bubble ratio: 60.80%
[rank3]:2025-12-26 06:36:01,221 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:36:01,220 - Freezing Ratio: [Stage1] 0.87, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:36:01,221 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:36:01,220 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:36:35,247 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:36:35,247 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:36:35,248 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:36:35,248 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:37:09,299 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:37:09,299 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:37:09,305 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 06:37:09,307 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:37:09,299 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:37:12,641 - Avg. fwd time: 13.9600 / Avg. bwd time: 30.7396 / Avg. batch time: 420.9868 (ms) / GPU bubble ratio: 15.06%
[rank2]:2025-12-26 06:37:12,657 - Avg. fwd time: 8.2127 / Avg. bwd time: 13.6283 / Avg. batch time: 446.9092 (ms) / GPU bubble ratio: 60.90%
[rank2]:2025-12-26 06:37:12,690 -  step: 250  loss: -8.0000  grad_norm:  0.1201  memory:  7.91GiB(16.66%)  tps: 8,814  tflops: 68.91  mfu: 22.09%
[rank3]:2025-12-26 06:37:12,692 -  step: 250  loss:  7.3448  grad_norm:  0.1201  memory: 19.83GiB(41.74%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank1]:2025-12-26 06:37:12,674 - Avg. fwd time: 10.2560 / Avg. bwd time: 16.9339 / Avg. batch time: 478.2460 (ms) / GPU bubble ratio: 54.52%
[rank1]:2025-12-26 06:37:12,690 -  step: 250  loss: -8.0000  grad_norm:  0.1201  memory: 10.83GiB(22.79%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank0]:2025-12-26 06:37:12,689 - Avg. fwd time: 8.4981 / Avg. bwd time: 15.5843 / Avg. batch time: 506.7850 (ms) / GPU bubble ratio: 61.98%
[rank0]:2025-12-26 06:37:12,691 -  step: 250  loss: -8.0000  grad_norm:  0.1201  memory: 15.49GiB(32.61%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank3]:2025-12-26 06:37:43,253 - Freezing Ratio: [Stage3] 0.07, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:37:43,253 - Freezing Ratio: [Stage1] 0.11, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:37:43,254 - Freezing Ratio: [Stage0] 0.11, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:37:43,252 - Freezing Ratio: [Stage2] 0.11, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:38:34,694 - Freezing Ratio: [Stage2] 0.83, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:38:34,717 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:38:34,700 - Freezing Ratio: [Stage1] 0.82, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:38:34,723 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:38:55,113 - Avg. fwd time: 8.2162 / Avg. bwd time: 13.5901 / Avg. batch time: 446.3485 (ms) / GPU bubble ratio: 60.92%
[rank3]:2025-12-26 06:38:55,097 - Avg. fwd time: 13.9652 / Avg. bwd time: 30.6712 / Avg. batch time: 420.4824 (ms) / GPU bubble ratio: 15.08%
[rank1]:2025-12-26 06:38:55,131 - Avg. fwd time: 10.2603 / Avg. bwd time: 16.8876 / Avg. batch time: 477.6337 (ms) / GPU bubble ratio: 54.53%
[rank0]:2025-12-26 06:38:55,146 - Avg. fwd time: 8.5012 / Avg. bwd time: 15.5146 / Avg. batch time: 506.0942 (ms) / GPU bubble ratio: 62.04%
[rank2]:2025-12-26 06:39:08,707 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:39:08,707 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:39:08,708 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:39:08,708 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:39:42,771 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:39:42,772 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:39:42,771 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:39:42,773 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:40:16,645 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:40:16,646 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:40:16,646 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:40:16,650 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:40:16,651 - Freezing Ratio: [Stage0] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:40:20,009 - Avg. fwd time: 8.2697 / Avg. bwd time: 13.1805 / Avg. batch time: 439.8698 (ms) / GPU bubble ratio: 60.99%
[rank2]:2025-12-26 06:40:20,045 -  step: 300  loss: -8.0000  grad_norm:  0.2741  memory:  7.91GiB(16.66%)  tps: 8,745  tflops: 68.36  mfu: 21.91%
[rank1]:2025-12-26 06:40:20,027 - Avg. fwd time: 10.3231 / Avg. bwd time: 16.3792 / Avg. batch time: 470.6415 (ms) / GPU bubble ratio: 54.61%
[rank1]:2025-12-26 06:40:20,045 -  step: 300  loss: -8.0000  grad_norm:  0.2741  memory: 10.83GiB(22.79%)  tps: 8,745  tflops: 68.36  mfu: 21.91%
[rank3]:2025-12-26 06:40:19,993 - Avg. fwd time: 13.9816 / Avg. bwd time: 29.8990 / Avg. batch time: 414.4315 (ms) / GPU bubble ratio: 15.29%
[rank3]:2025-12-26 06:40:20,046 -  step: 300  loss:  6.7684  grad_norm:  0.2741  memory: 19.83GiB(41.74%)  tps: 8,745  tflops: 68.36  mfu: 21.91%
[rank0]:2025-12-26 06:40:20,043 - Avg. fwd time: 8.5531 / Avg. bwd time: 14.8941 / Avg. batch time: 498.4665 (ms) / GPU bubble ratio: 62.37%
[rank0]:2025-12-26 06:40:20,045 -  step: 300  loss: -8.0000  grad_norm:  0.2741  memory: 15.49GiB(32.61%)  tps: 8,745  tflops: 68.36  mfu: 21.91%
[rank0]:2025-12-26 06:40:20,093 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0640_stage0_step300.svg
[rank2]:2025-12-26 06:40:20,094 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0640_stage2_step300.svg
[rank1]:2025-12-26 06:40:20,095 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0640_stage1_step300.svg
[rank3]:2025-12-26 06:40:20,185 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0640_step300_rank3.svg
[rank3]:			> Batch Time: 414.79 ms, GPU Bubble Ratio: 66.82%, 57.92%, 66.16%, 31.50%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-8-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  276-8-284ms    | [S0,MB5,B]  318-8-326ms    | [S0,MB6,B]  361-8-369ms    | [S0,MB7,B]  406-8-414ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-11-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-11-198ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-10-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-85ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-242ms   | [S3,MB5,F]  245-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-331ms   | [S3,MB7,F]  334-14-348ms   | [S3,MB7,B]  355-21-376ms  
[rank3]:2025-12-26 06:40:20,225 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0640_stage3_step300.svg
[rank2]:2025-12-26 06:40:50,776 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:40:50,777 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:40:50,777 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:40:50,777 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:41:24,740 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:41:24,740 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:41:24,740 - Freezing Ratio: [Stage1] 0.87, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:41:24,741 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:41:45,076 - Avg. fwd time: 13.9965 / Avg. bwd time: 29.2460 / Avg. batch time: 409.3231 (ms) / GPU bubble ratio: 15.48%
[rank2]:2025-12-26 06:41:45,093 - Avg. fwd time: 8.3151 / Avg. bwd time: 12.8341 / Avg. batch time: 434.4374 (ms) / GPU bubble ratio: 61.05%
[rank1]:2025-12-26 06:41:45,112 - Avg. fwd time: 10.3767 / Avg. bwd time: 15.9500 / Avg. batch time: 464.7755 (ms) / GPU bubble ratio: 54.68%
[rank0]:2025-12-26 06:41:45,128 - Avg. fwd time: 8.5979 / Avg. bwd time: 14.3835 / Avg. batch time: 492.0782 (ms) / GPU bubble ratio: 62.64%
[rank2]:2025-12-26 06:41:58,832 - Freezing Ratio: [Stage2] 0.17, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:41:58,833 - Freezing Ratio: [Stage1] 0.11, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:41:58,833 - Freezing Ratio: [Stage3] 0.07, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:41:58,834 - Freezing Ratio: [Stage0] 0.08, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:42:50,290 - Freezing Ratio: [Stage2] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:42:50,297 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:42:50,314 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:42:50,320 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:43:24,250 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:43:24,251 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:43:24,249 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:43:24,256 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 06:43:24,257 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:43:27,624 - Avg. fwd time: 13.9979 / Avg. bwd time: 29.3011 / Avg. batch time: 409.7764 (ms) / GPU bubble ratio: 15.47%
[rank2]:2025-12-26 06:43:27,642 - Avg. fwd time: 8.3112 / Avg. bwd time: 12.8626 / Avg. batch time: 434.9069 (ms) / GPU bubble ratio: 61.05%
[rank2]:2025-12-26 06:43:27,678 -  step: 350  loss: -8.0000  grad_norm:  0.0839  memory:  7.91GiB(16.66%)  tps: 8,732  tflops: 68.26  mfu: 21.88%
[rank3]:2025-12-26 06:43:27,680 -  step: 350  loss:  4.6783  grad_norm:  0.0839  memory: 19.83GiB(41.74%)  tps: 8,732  tflops: 68.26  mfu: 21.88%
[rank1]:2025-12-26 06:43:27,661 - Avg. fwd time: 10.3723 / Avg. bwd time: 15.9859 / Avg. batch time: 465.2773 (ms) / GPU bubble ratio: 54.68%
[rank1]:2025-12-26 06:43:27,678 -  step: 350  loss: -8.0000  grad_norm:  0.0839  memory: 10.83GiB(22.79%)  tps: 8,732  tflops: 68.26  mfu: 21.88%
[rank0]:2025-12-26 06:43:27,677 - Avg. fwd time: 8.5931 / Avg. bwd time: 14.4151 / Avg. batch time: 492.6071 (ms) / GPU bubble ratio: 62.63%
[rank0]:2025-12-26 06:43:27,679 -  step: 350  loss: -8.0000  grad_norm:  0.0839  memory: 15.49GiB(32.61%)  tps: 8,732  tflops: 68.26  mfu: 21.88%
[rank0]:2025-12-26 06:43:58,278 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:43:58,277 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:43:58,277 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:43:58,277 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:44:32,341 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:44:32,342 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:44:32,342 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:44:32,343 - Freezing Ratio: [Stage0] 0.81, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:44:52,697 - Avg. fwd time: 8.3483 / Avg. bwd time: 12.5834 / Avg. batch time: 430.5203 (ms) / GPU bubble ratio: 61.10%
[rank3]:2025-12-26 06:44:52,680 - Avg. fwd time: 14.0117 / Avg. bwd time: 28.7756 / Avg. batch time: 405.6804 (ms) / GPU bubble ratio: 15.62%
[rank1]:2025-12-26 06:44:52,716 - Avg. fwd time: 10.4158 / Avg. bwd time: 15.6430 / Avg. batch time: 460.5412 (ms) / GPU bubble ratio: 54.73%
[rank0]:2025-12-26 06:44:52,734 - Avg. fwd time: 8.6291 / Avg. bwd time: 14.0002 / Avg. batch time: 487.4498 (ms) / GPU bubble ratio: 62.86%
[rank2]:2025-12-26 06:45:06,390 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:45:06,391 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:45:06,391 - Freezing Ratio: [Stage1] 0.84, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:45:06,392 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:45:40,309 - Freezing Ratio: [Stage0] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:45:40,309 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:45:40,307 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:45:40,308 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:46:14,320 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:46:14,319 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:46:14,319 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:46:14,323 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:46:14,325 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:46:17,731 - Avg. fwd time: 14.0244 / Avg. bwd time: 28.3161 / Avg. batch time: 402.1042 (ms) / GPU bubble ratio: 15.76%
[rank1]:2025-12-26 06:46:17,769 - Avg. fwd time: 10.4542 / Avg. bwd time: 15.3444 / Avg. batch time: 456.4071 (ms) / GPU bubble ratio: 54.78%
[rank1]:2025-12-26 06:46:17,787 -  step: 400  loss: -8.0000  grad_norm:  0.0221  memory: 10.83GiB(22.79%)  tps: 9,631  tflops: 75.29  mfu: 24.13%
[rank3]:2025-12-26 06:46:17,789 -  step: 400  loss:  3.3247  grad_norm:  0.0221  memory: 19.83GiB(41.74%)  tps: 9,632  tflops: 75.30  mfu: 24.13%
[rank2]:2025-12-26 06:46:17,749 - Avg. fwd time: 8.3808 / Avg. bwd time: 12.3391 / Avg. batch time: 426.6896 (ms) / GPU bubble ratio: 61.15%
[rank2]:2025-12-26 06:46:17,787 -  step: 400  loss: -8.0000  grad_norm:  0.0221  memory:  7.91GiB(16.66%)  tps: 9,631  tflops: 75.29  mfu: 24.13%
[rank2]:2025-12-26 06:46:17,842 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0646_stage2_step400.svg
[rank0]:2025-12-26 06:46:17,786 - Avg. fwd time: 8.6607 / Avg. bwd time: 13.6343 / Avg. batch time: 482.9447 (ms) / GPU bubble ratio: 63.07%
[rank0]:2025-12-26 06:46:17,788 -  step: 400  loss: -8.0000  grad_norm:  0.0221  memory: 15.49GiB(32.61%)  tps: 9,631  tflops: 75.29  mfu: 24.13%
[rank0]:2025-12-26 06:46:17,840 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0646_stage0_step400.svg
[rank1]:2025-12-26 06:46:17,843 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0646_stage1_step400.svg
[rank3]:2025-12-26 06:46:17,929 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0646_step400_rank3.svg
[rank3]:			> Batch Time: 413.76 ms, GPU Bubble Ratio: 66.83%, 57.73%, 66.09%, 31.33%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  277-8-285ms    | [S0,MB5,B]  319-8-327ms    | [S0,MB6,B]  362-8-370ms    | [S0,MB7,B]  405-8-413ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-358ms   | [S1,MB7,B]  391-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  247-8-255ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  336-8-345ms    | [S2,MB7,B]  379-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  354-21-376ms  
[rank3]:2025-12-26 06:46:17,974 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0646_stage3_step400.svg
[rank3]:2025-12-26 06:46:37,197 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 06:46:37,386 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-26 06:46:37,375 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-26 06:46:37,394 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 06:46:48,507 - Freezing Ratio: [Stage1] 0.09, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:46:48,508 - Freezing Ratio: [Stage3] 0.10, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:46:48,507 - Freezing Ratio: [Stage2] 0.19, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:46:48,508 - Freezing Ratio: [Stage0] 0.11, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:47:39,970 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:47:39,940 - Freezing Ratio: [Stage2] 0.89, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:47:39,947 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:47:39,963 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:48:00,336 - Avg. fwd time: 8.3735 / Avg. bwd time: 12.3903 / Avg. batch time: 427.5450 (ms) / GPU bubble ratio: 61.15%
[rank1]:2025-12-26 06:48:00,356 - Avg. fwd time: 10.4452 / Avg. bwd time: 15.4094 / Avg. batch time: 457.3250 (ms) / GPU bubble ratio: 54.77%
[rank3]:2025-12-26 06:48:00,319 - Avg. fwd time: 14.0238 / Avg. bwd time: 28.4146 / Avg. batch time: 402.8874 (ms) / GPU bubble ratio: 15.73%
[rank0]:2025-12-26 06:48:00,373 - Avg. fwd time: 8.6531 / Avg. bwd time: 13.7039 / Avg. batch time: 483.9322 (ms) / GPU bubble ratio: 63.04%
[rank0]:2025-12-26 06:48:13,793 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:48:13,793 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:48:13,793 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:48:13,793 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:48:47,697 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:48:47,698 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:48:47,698 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:48:47,699 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:49:21,640 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:49:21,656 - Freezing Ratio: [Stage1] 0.84, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:49:21,656 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:49:21,662 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 06:49:21,664 - Freezing Ratio: [Stage0] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:49:25,015 - Avg. fwd time: 8.4003 / Avg. bwd time: 12.1838 / Avg. batch time: 424.2286 (ms) / GPU bubble ratio: 61.18%
[rank2]:2025-12-26 06:49:25,054 -  step: 450  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,749  tflops: 68.40  mfu: 21.92%
[rank1]:2025-12-26 06:49:25,035 - Avg. fwd time: 10.4765 / Avg. bwd time: 15.1535 / Avg. batch time: 453.7498 (ms) / GPU bubble ratio: 54.81%
[rank1]:2025-12-26 06:49:25,054 -  step: 450  loss: -8.0000  grad_norm:  0.3241  memory: 10.83GiB(22.79%)  tps: 8,749  tflops: 68.40  mfu: 21.92%
[rank3]:2025-12-26 06:49:24,997 - Avg. fwd time: 14.0301 / Avg. bwd time: 28.0212 / Avg. batch time: 399.7893 (ms) / GPU bubble ratio: 15.85%
[rank3]:2025-12-26 06:49:25,056 -  step: 450  loss:  5.1566  grad_norm:  0.3241  memory: 19.83GiB(41.74%)  tps: 8,749  tflops: 68.40  mfu: 21.92%
[rank0]:2025-12-26 06:49:25,053 - Avg. fwd time: 8.6788 / Avg. bwd time: 13.3907 / Avg. batch time: 480.0391 (ms) / GPU bubble ratio: 63.22%
[rank0]:2025-12-26 06:49:25,055 -  step: 450  loss: -8.0000  grad_norm:  0.3241  memory: 15.49GiB(32.61%)  tps: 8,749  tflops: 68.40  mfu: 21.92%
[rank2]:2025-12-26 06:49:55,596 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:49:55,618 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:49:55,619 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:49:55,619 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:50:29,440 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:50:29,461 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:50:29,461 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:50:29,462 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:50:49,834 - Avg. fwd time: 8.4245 / Avg. bwd time: 11.9985 / Avg. batch time: 421.2748 (ms) / GPU bubble ratio: 61.22%
[rank3]:2025-12-26 06:50:49,816 - Avg. fwd time: 14.0365 / Avg. bwd time: 27.6702 / Avg. batch time: 397.0315 (ms) / GPU bubble ratio: 15.96%
[rank1]:2025-12-26 06:50:49,854 - Avg. fwd time: 10.5047 / Avg. bwd time: 14.9252 / Avg. batch time: 450.5650 (ms) / GPU bubble ratio: 54.85%
[rank0]:2025-12-26 06:50:49,871 - Avg. fwd time: 8.7026 / Avg. bwd time: 13.1200 / Avg. batch time: 476.5806 (ms) / GPU bubble ratio: 63.37%
[rank3]:2025-12-26 06:51:03,415 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:51:03,415 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:51:03,415 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:51:03,414 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:51:37,431 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:51:37,431 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:51:37,431 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:51:37,432 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:52:11,263 - Freezing Ratio: [Stage2] 0.22, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:52:11,282 - Freezing Ratio: [Stage1] 0.09, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:52:11,282 - Freezing Ratio: [Stage3] 0.14, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:52:11,286 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:52:11,288 - Freezing Ratio: [Stage0] 0.05, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:52:16,308 - Avg. fwd time: 14.0418 / Avg. bwd time: 27.3971 / Avg. batch time: 394.8880 (ms) / GPU bubble ratio: 16.05%
[rank2]:2025-12-26 06:52:16,338 - Avg. fwd time: 8.4433 / Avg. bwd time: 11.8550 / Avg. batch time: 418.9794 (ms) / GPU bubble ratio: 61.24%
[rank1]:2025-12-26 06:52:16,372 - Avg. fwd time: 10.5266 / Avg. bwd time: 14.7476 / Avg. batch time: 448.0903 (ms) / GPU bubble ratio: 54.88%
[rank0]:2025-12-26 06:52:16,407 - Avg. fwd time: 8.7205 / Avg. bwd time: 12.8993 / Avg. batch time: 473.8826 (ms) / GPU bubble ratio: 63.50%
[rank0]:2025-12-26 06:52:16,443 -  step: 500  loss: -8.0000  grad_norm: 11.6564  memory: 15.49GiB(32.61%)  tps: 9,560  tflops: 74.73  mfu: 23.95%
[rank2]:2025-12-26 06:52:16,429 -  step: 500  loss: -8.0000  grad_norm: 11.6564  memory:  7.91GiB(16.66%)  tps: 9,560  tflops: 74.74  mfu: 23.95%
[rank2]:2025-12-26 06:52:16,491 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0652_stage2_step500.svg
[rank1]:2025-12-26 06:52:16,432 -  step: 500  loss: -8.0000  grad_norm: 11.6564  memory: 10.83GiB(22.79%)  tps: 9,560  tflops: 74.74  mfu: 23.95%
[rank1]:2025-12-26 06:52:16,490 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0652_stage1_step500.svg
[rank3]:2025-12-26 06:52:16,441 -  step: 500  loss:  5.1041  grad_norm: 11.6564  memory: 19.83GiB(41.74%)  tps: 9,560  tflops: 74.73  mfu: 23.95%
[rank0]:2025-12-26 06:52:16,488 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0652_stage0_step500.svg
[rank3]:2025-12-26 06:52:16,580 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0652_step500_rank3.svg
[rank3]:			> Batch Time: 416.05 ms, GPU Bubble Ratio: 66.97%, 57.95%, 66.24%, 31.37%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-19ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  154-8-162ms    | [S0,MB2,B]  189-8-197ms    | [S0,MB6,F]  197-8-206ms    | [S0,MB3,B]  233-8-241ms    | [S0,MB7,F]  241-8-250ms    | [S0,MB4,B]  278-8-286ms    | [S0,MB5,B]  321-8-329ms    | [S0,MB6,B]  364-8-372ms    | [S0,MB7,B]  408-8-416ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-11-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  144-11-155ms   | [S1,MB2,B]  173-10-184ms   | [S1,MB5,F]  187-11-198ms   | [S1,MB3,B]  217-10-228ms   | [S1,MB6,F]  231-11-242ms   | [S1,MB4,B]  262-10-272ms   | [S1,MB7,F]  276-11-287ms   | [S1,MB5,B]  306-10-317ms   | [S1,MB6,B]  349-10-360ms   | [S1,MB7,B]  393-10-404ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  116-8-124ms    | [S2,MB3,F]  128-8-137ms    | [S2,MB2,B]  159-8-168ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  248-8-256ms    | [S2,MB6,F]  260-8-269ms    | [S2,MB5,B]  293-8-301ms    | [S2,MB7,F]  305-8-314ms    | [S2,MB6,B]  337-8-346ms    | [S2,MB7,B]  381-8-390ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-85ms     | [S3,MB1,B]  91-21-112ms    | [S3,MB2,F]  114-13-128ms   | [S3,MB2,B]  134-21-155ms   | [S3,MB3,F]  157-14-172ms   | [S3,MB3,B]  178-21-199ms   | [S3,MB4,F]  201-14-216ms   | [S3,MB4,B]  222-21-244ms   | [S3,MB5,F]  246-14-261ms   | [S3,MB5,B]  267-21-289ms   | [S3,MB6,F]  291-14-306ms   | [S3,MB6,B]  312-21-334ms   | [S3,MB7,F]  336-14-351ms   | [S3,MB7,B]  356-21-378ms  
[rank3]:2025-12-26 06:52:16,622 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0652_stage3_step500.svg
[rank2]:2025-12-26 06:53:02,902 - Freezing Ratio: [Stage2] 0.89, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:53:02,908 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:53:02,924 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:53:02,932 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:53:36,901 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:53:36,901 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:53:36,901 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:53:36,902 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:53:57,241 - Avg. fwd time: 8.4369 / Avg. bwd time: 11.8995 / Avg. batch time: 419.6893 (ms) / GPU bubble ratio: 61.24%
[rank3]:2025-12-26 06:53:57,222 - Avg. fwd time: 14.0406 / Avg. bwd time: 27.4792 / Avg. batch time: 395.5364 (ms) / GPU bubble ratio: 16.02%
[rank0]:2025-12-26 06:53:57,280 - Avg. fwd time: 8.7143 / Avg. bwd time: 12.9597 / Avg. batch time: 474.7085 (ms) / GPU bubble ratio: 63.47%
[rank1]:2025-12-26 06:53:57,262 - Avg. fwd time: 10.5193 / Avg. bwd time: 14.8026 / Avg. batch time: 448.8555 (ms) / GPU bubble ratio: 54.87%
[rank2]:2025-12-26 06:54:10,950 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:54:10,951 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:54:10,950 - Freezing Ratio: [Stage1] 0.84, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:54:10,952 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:54:44,837 - Freezing Ratio: [Stage0] 0.84, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:54:44,816 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:54:44,837 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:54:44,837 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:55:18,850 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:55:18,850 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:55:18,856 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 06:55:18,858 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:55:18,849 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:55:22,237 - Avg. fwd time: 14.0476 / Avg. bwd time: 27.2020 / Avg. batch time: 393.3746 (ms) / GPU bubble ratio: 16.11%
[rank0]:2025-12-26 06:55:22,296 - Avg. fwd time: 8.7333 / Avg. bwd time: 12.7479 / Avg. batch time: 471.9988 (ms) / GPU bubble ratio: 63.59%
[rank0]:2025-12-26 06:55:22,299 -  step: 550  loss: -8.0000  grad_norm:  1.0543  memory: 15.49GiB(32.61%)  tps: 8,815  tflops: 68.92  mfu: 22.09%
[rank2]:2025-12-26 06:55:22,256 - Avg. fwd time: 8.4561 / Avg. bwd time: 11.7540 / Avg. batch time: 417.3729 (ms) / GPU bubble ratio: 61.26%
[rank2]:2025-12-26 06:55:22,298 -  step: 550  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank3]:2025-12-26 06:55:22,300 -  step: 550  loss:  3.7364  grad_norm:  1.0543  memory: 19.83GiB(41.74%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank1]:2025-12-26 06:55:22,277 - Avg. fwd time: 10.5419 / Avg. bwd time: 14.6233 / Avg. batch time: 446.3588 (ms) / GPU bubble ratio: 54.90%
[rank1]:2025-12-26 06:55:22,298 -  step: 550  loss: -8.0000  grad_norm:  1.0543  memory: 10.83GiB(22.79%)  tps: 8,815  tflops: 68.91  mfu: 22.09%
[rank2]:2025-12-26 06:55:52,884 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:55:52,904 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:55:52,905 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:55:52,905 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:56:26,911 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:56:26,911 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:56:26,911 - Freezing Ratio: [Stage1] 0.89, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:56:26,912 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:56:47,167 - Avg. fwd time: 14.0539 / Avg. bwd time: 26.9486 / Avg. batch time: 391.3994 (ms) / GPU bubble ratio: 16.19%
[rank2]:2025-12-26 06:56:47,186 - Avg. fwd time: 8.4735 / Avg. bwd time: 11.6210 / Avg. batch time: 415.2570 (ms) / GPU bubble ratio: 61.29%
[rank1]:2025-12-26 06:56:47,208 - Avg. fwd time: 10.5626 / Avg. bwd time: 14.4593 / Avg. batch time: 444.0788 (ms) / GPU bubble ratio: 54.92%
[rank0]:2025-12-26 06:56:47,227 - Avg. fwd time: 8.7500 / Avg. bwd time: 12.5437 / Avg. batch time: 469.5114 (ms) / GPU bubble ratio: 63.72%
[rank0]:2025-12-26 06:57:00,834 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:57:00,812 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:57:00,833 - Freezing Ratio: [Stage3] 0.79, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:57:00,833 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:57:34,587 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:57:34,588 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:57:34,588 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:57:34,589 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:58:08,507 - Freezing Ratio: [Stage2] 0.22, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:58:08,526 - Freezing Ratio: [Stage3] 0.10, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:58:08,526 - Freezing Ratio: [Stage1] 0.11, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:58:08,530 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 06:58:08,532 - Freezing Ratio: [Stage0] 0.16, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:58:13,659 - Avg. fwd time: 8.4870 / Avg. bwd time: 11.5179 / Avg. batch time: 413.6202 (ms) / GPU bubble ratio: 61.31%
[rank3]:2025-12-26 06:58:13,627 - Avg. fwd time: 14.0585 / Avg. bwd time: 26.7529 / Avg. batch time: 389.8726 (ms) / GPU bubble ratio: 16.26%
[rank1]:2025-12-26 06:58:13,695 - Avg. fwd time: 10.5788 / Avg. bwd time: 14.3323 / Avg. batch time: 442.3147 (ms) / GPU bubble ratio: 54.94%
[rank2]:2025-12-26 06:58:13,753 -  step: 600  loss: -8.0000  grad_norm: 48.1825  memory:  7.91GiB(16.66%)  tps: 9,556  tflops: 74.70  mfu: 23.94%
[rank3]:2025-12-26 06:58:13,765 -  step: 600  loss:  3.0716  grad_norm: 48.1825  memory: 19.83GiB(41.74%)  tps: 9,555  tflops: 74.70  mfu: 23.94%
[rank1]:2025-12-26 06:58:13,756 -  step: 600  loss: -8.0000  grad_norm: 48.1825  memory: 10.83GiB(22.79%)  tps: 9,556  tflops: 74.70  mfu: 23.94%
[rank0]:2025-12-26 06:58:13,731 - Avg. fwd time: 8.7617 / Avg. bwd time: 12.3585 / Avg. batch time: 467.5574 (ms) / GPU bubble ratio: 63.86%
[rank0]:2025-12-26 06:58:13,767 -  step: 600  loss: -8.0000  grad_norm: 48.1825  memory: 15.49GiB(32.61%)  tps: 9,555  tflops: 74.70  mfu: 23.94%
[rank0]:2025-12-26 06:58:13,814 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0658_stage0_step600.svg
[rank2]:2025-12-26 06:58:13,816 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0658_stage2_step600.svg
[rank1]:2025-12-26 06:58:13,816 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0658_stage1_step600.svg
[rank3]:2025-12-26 06:58:13,905 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0658_step600_rank3.svg
[rank3]:			> Batch Time: 413.30 ms, GPU Bubble Ratio: 66.81%, 57.81%, 66.12%, 31.57%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-161ms    | [S0,MB2,B]  187-8-195ms    | [S0,MB6,F]  196-8-204ms    | [S0,MB3,B]  231-8-239ms    | [S0,MB7,F]  239-8-248ms    | [S0,MB4,B]  276-8-284ms    | [S0,MB5,B]  318-8-326ms    | [S0,MB6,B]  361-8-369ms    | [S0,MB7,B]  405-8-413ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-10-111ms   | [S1,MB1,B]  128-10-139ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  171-10-182ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  215-10-226ms   | [S1,MB6,F]  230-10-241ms   | [S1,MB4,B]  259-10-270ms   | [S1,MB7,F]  274-10-285ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-357ms   | [S1,MB7,B]  391-10-401ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-123ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-166ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  201-8-210ms    | [S2,MB5,F]  214-8-222ms    | [S2,MB4,B]  245-8-254ms    | [S2,MB6,F]  258-8-267ms    | [S2,MB5,B]  290-8-298ms    | [S2,MB7,F]  302-8-311ms    | [S2,MB6,B]  335-8-343ms    | [S2,MB7,B]  379-8-387ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-13-170ms   | [S3,MB3,B]  176-21-198ms   | [S3,MB4,F]  200-14-214ms   | [S3,MB4,B]  220-21-242ms   | [S3,MB5,F]  244-14-258ms   | [S3,MB5,B]  264-21-286ms   | [S3,MB6,F]  288-14-303ms   | [S3,MB6,B]  309-21-331ms   | [S3,MB7,F]  333-14-348ms   | [S3,MB7,B]  353-21-375ms  
[rank3]:2025-12-26 06:58:13,947 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0658_stage3_step600.svg
[rank3]:2025-12-26 06:59:00,251 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:59:00,235 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:59:00,257 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:59:00,227 - Freezing Ratio: [Stage2] 0.86, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:59:33,967 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 06:59:33,967 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 06:59:33,966 - Freezing Ratio: [Stage1] 0.84, Threshold: 5.0000e-02
[rank0]:2025-12-26 06:59:33,967 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 06:59:54,385 - Avg. fwd time: 8.4800 / Avg. bwd time: 11.5685 / Avg. batch time: 414.4237 (ms) / GPU bubble ratio: 61.30%
[rank3]:2025-12-26 06:59:54,365 - Avg. fwd time: 14.0560 / Avg. bwd time: 26.8472 / Avg. batch time: 390.6096 (ms) / GPU bubble ratio: 16.23%
[rank1]:2025-12-26 06:59:54,408 - Avg. fwd time: 10.5708 / Avg. bwd time: 14.3959 / Avg. batch time: 443.1804 (ms) / GPU bubble ratio: 54.93%
[rank0]:2025-12-26 06:59:54,427 - Avg. fwd time: 8.7533 / Avg. bwd time: 12.4045 / Avg. batch time: 468.4681 (ms) / GPU bubble ratio: 63.87%
[rank2]:2025-12-26 07:00:07,917 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:00:07,938 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:00:07,939 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:00:07,939 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:00:41,805 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:00:41,825 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:00:41,824 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:00:41,825 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:01:15,936 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:01:15,935 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:01:15,942 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:01:15,943 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:01:15,919 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:01:19,294 - Avg. fwd time: 8.4945 / Avg. bwd time: 11.4577 / Avg. batch time: 412.6680 (ms) / GPU bubble ratio: 61.32%
[rank3]:2025-12-26 07:01:19,273 - Avg. fwd time: 14.0609 / Avg. bwd time: 26.6375 / Avg. batch time: 388.9715 (ms) / GPU bubble ratio: 16.30%
[rank3]:2025-12-26 07:01:19,338 -  step: 650  loss:  3.9709  grad_norm:  0.2824  memory: 19.83GiB(41.74%)  tps: 8,829  tflops: 69.02  mfu: 22.12%
[rank1]:2025-12-26 07:01:19,316 - Avg. fwd time: 10.5877 / Avg. bwd time: 14.2600 / Avg. batch time: 441.2861 (ms) / GPU bubble ratio: 54.95%
[rank1]:2025-12-26 07:01:19,336 -  step: 650  loss: -8.0000  grad_norm:  0.2824  memory: 10.83GiB(22.79%)  tps: 8,829  tflops: 69.02  mfu: 22.12%
[rank0]:2025-12-26 07:01:19,334 - Avg. fwd time: 8.7665 / Avg. bwd time: 12.2188 / Avg. batch time: 466.3863 (ms) / GPU bubble ratio: 64.00%
[rank0]:2025-12-26 07:01:19,336 -  step: 650  loss: -8.0000  grad_norm:  0.2824  memory: 15.49GiB(32.61%)  tps: 8,829  tflops: 69.02  mfu: 22.12%
[rank2]:2025-12-26 07:01:19,336 -  step: 650  loss: -8.0000  grad_norm:  0.2824  memory:  7.91GiB(16.66%)  tps: 8,828  tflops: 69.02  mfu: 22.12%
[rank2]:2025-12-26 07:01:49,742 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:01:49,743 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:01:49,742 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:01:49,743 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:02:23,631 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:02:23,630 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:02:23,631 - Freezing Ratio: [Stage0] 0.89, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:02:23,630 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:02:43,946 - Avg. fwd time: 14.0649 / Avg. bwd time: 26.4432 / Avg. batch time: 387.4504 (ms) / GPU bubble ratio: 16.36%
[rank2]:2025-12-26 07:02:43,967 - Avg. fwd time: 8.5079 / Avg. bwd time: 11.3557 / Avg. batch time: 411.0389 (ms) / GPU bubble ratio: 61.34%
[rank0]:2025-12-26 07:02:44,008 - Avg. fwd time: 8.7775 / Avg. bwd time: 12.0289 / Avg. batch time: 464.4343 (ms) / GPU bubble ratio: 64.16%
[rank1]:2025-12-26 07:02:43,989 - Avg. fwd time: 10.6032 / Avg. bwd time: 14.1340 / Avg. batch time: 439.5286 (ms) / GPU bubble ratio: 54.98%
[rank2]:2025-12-26 07:02:57,508 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:02:57,510 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:02:57,509 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:02:57,509 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:03:31,427 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:03:31,446 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:03:31,446 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:03:31,446 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:04:05,212 - Freezing Ratio: [Stage2] 1.00, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:04:05,216 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:04:05,217 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:04:05,213 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:04:05,212 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:04:08,537 - Avg. fwd time: 14.0687 / Avg. bwd time: 26.2630 / Avg. batch time: 386.0403 (ms) / GPU bubble ratio: 16.42%
[rank1]:2025-12-26 07:04:08,581 - Avg. fwd time: 10.6176 / Avg. bwd time: 14.0169 / Avg. batch time: 437.8989 (ms) / GPU bubble ratio: 55.00%
[rank2]:2025-12-26 07:04:08,558 - Avg. fwd time: 8.5203 / Avg. bwd time: 11.2606 / Avg. batch time: 409.5285 (ms) / GPU bubble ratio: 61.36%
[rank2]:2025-12-26 07:04:08,600 -  step: 700  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,680  tflops: 75.67  mfu: 24.25%
[rank0]:2025-12-26 07:04:08,599 - Avg. fwd time: 8.7865 / Avg. bwd time: 11.8291 / Avg. batch time: 462.6003 (ms) / GPU bubble ratio: 64.35%
[rank0]:2025-12-26 07:04:08,601 -  step: 700  loss: -8.0000  grad_norm:  0.2202  memory: 15.49GiB(32.61%)  tps: 9,680  tflops: 75.67  mfu: 24.25%
[rank0]:2025-12-26 07:04:08,653 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0704_stage0_step700.svg
[rank3]:2025-12-26 07:04:08,603 -  step: 700  loss:  4.1055  grad_norm:  0.2202  memory: 19.83GiB(41.74%)  tps: 9,680  tflops: 75.67  mfu: 24.25%
[rank1]:2025-12-26 07:04:08,600 -  step: 700  loss: -8.0000  grad_norm:  0.2202  memory: 10.83GiB(22.79%)  tps: 9,680  tflops: 75.67  mfu: 24.25%
[rank1]:2025-12-26 07:04:08,654 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0704_stage1_step700.svg
[rank2]:2025-12-26 07:04:08,655 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0704_stage2_step700.svg
[rank3]:2025-12-26 07:04:08,744 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0704_step700_rank3.svg
[rank3]:			> Batch Time: 413.42 ms, GPU Bubble Ratio: 70.05%, 57.67%, 66.00%, 31.20%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-6-108ms    | [S0,MB4,F]  108-8-117ms    | [S0,MB1,B]  145-6-151ms    | [S0,MB5,F]  151-8-160ms    | [S0,MB2,B]  188-6-194ms    | [S0,MB6,F]  194-8-203ms    | [S0,MB3,B]  232-6-238ms    | [S0,MB7,F]  238-8-247ms    | [S0,MB4,B]  276-6-283ms    | [S0,MB5,B]  319-6-325ms    | [S0,MB6,B]  362-6-368ms    | [S0,MB7,B]  407-6-413ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-358ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  259-8-267ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  336-8-344ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-242ms   | [S3,MB5,F]  245-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  309-21-331ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 07:04:08,789 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0704_stage3_step700.svg
[rank2]:2025-12-26 07:04:39,168 - Freezing Ratio: [Stage2] 0.19, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:04:39,187 - Freezing Ratio: [Stage1] 0.11, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:04:39,187 - Freezing Ratio: [Stage3] 0.14, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:04:39,188 - Freezing Ratio: [Stage0] 0.14, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:05:30,654 - Freezing Ratio: [Stage2] 0.92, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:05:30,661 - Freezing Ratio: [Stage1] 0.87, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:05:30,678 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:05:30,686 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:05:50,955 - Avg. fwd time: 8.5110 / Avg. bwd time: 11.3289 / Avg. batch time: 410.6127 (ms) / GPU bubble ratio: 61.35%
[rank1]:2025-12-26 07:05:50,978 - Avg. fwd time: 10.6069 / Avg. bwd time: 14.1023 / Avg. batch time: 439.0675 (ms) / GPU bubble ratio: 54.98%
[rank3]:2025-12-26 07:05:50,933 - Avg. fwd time: 14.0659 / Avg. bwd time: 26.3905 / Avg. batch time: 387.0420 (ms) / GPU bubble ratio: 16.38%
[rank0]:2025-12-26 07:05:50,997 - Avg. fwd time: 8.7759 / Avg. bwd time: 11.8992 / Avg. batch time: 463.8396 (ms) / GPU bubble ratio: 64.34%
[rank2]:2025-12-26 07:06:04,646 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:06:04,647 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:06:04,646 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:06:04,647 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:06:38,473 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:06:38,473 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:06:38,472 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:06:38,472 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:07:12,334 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:07:12,334 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:07:12,335 - Freezing Ratio: [Stage3] 0.86, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:07:12,341 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:07:12,342 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:07:15,753 - Avg. fwd time: 8.5229 / Avg. bwd time: 11.2416 / Avg. batch time: 409.2338 (ms) / GPU bubble ratio: 61.36%
[rank1]:2025-12-26 07:07:15,778 - Avg. fwd time: 10.6204 / Avg. bwd time: 13.9943 / Avg. batch time: 437.5792 (ms) / GPU bubble ratio: 55.00%
[rank1]:2025-12-26 07:07:15,801 -  step: 750  loss: -8.0000  grad_norm:  0.0333  memory: 10.83GiB(22.79%)  tps: 8,752  tflops: 68.42  mfu: 21.93%
[rank3]:2025-12-26 07:07:15,731 - Avg. fwd time: 14.0704 / Avg. bwd time: 26.2247 / Avg. batch time: 385.7553 (ms) / GPU bubble ratio: 16.43%
[rank3]:2025-12-26 07:07:15,804 -  step: 750  loss:  3.3614  grad_norm:  0.0333  memory: 19.89GiB(41.86%)  tps: 8,752  tflops: 68.42  mfu: 21.93%
[rank0]:2025-12-26 07:07:15,800 - Avg. fwd time: 8.7851 / Avg. bwd time: 11.7202 / Avg. batch time: 462.1704 (ms) / GPU bubble ratio: 64.51%
[rank0]:2025-12-26 07:07:15,802 -  step: 750  loss: -8.0000  grad_norm:  0.0333  memory: 15.49GiB(32.61%)  tps: 8,752  tflops: 68.42  mfu: 21.93%
[rank2]:2025-12-26 07:07:15,802 -  step: 750  loss: -8.0000  grad_norm:  0.0333  memory:  7.91GiB(16.66%)  tps: 8,752  tflops: 68.42  mfu: 21.93%
[rank1]:2025-12-26 07:07:46,441 - Freezing Ratio: [Stage1] 0.91, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:07:46,441 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:07:46,441 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:07:46,441 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:08:20,381 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:08:20,381 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:08:20,381 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:08:20,382 - Freezing Ratio: [Stage0] 0.86, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:08:40,692 - Avg. fwd time: 14.0745 / Avg. bwd time: 26.0694 / Avg. batch time: 384.5466 (ms) / GPU bubble ratio: 16.49%
[rank2]:2025-12-26 07:08:40,714 - Avg. fwd time: 8.5339 / Avg. bwd time: 11.1599 / Avg. batch time: 407.9389 (ms) / GPU bubble ratio: 61.38%
[rank1]:2025-12-26 07:08:40,738 - Avg. fwd time: 10.6330 / Avg. bwd time: 13.8935 / Avg. batch time: 436.1825 (ms) / GPU bubble ratio: 55.02%
[rank0]:2025-12-26 07:08:40,759 - Avg. fwd time: 8.7950 / Avg. bwd time: 11.5879 / Avg. batch time: 460.6398 (ms) / GPU bubble ratio: 64.60%
[rank0]:2025-12-26 07:08:54,361 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:08:54,359 - Freezing Ratio: [Stage2] 0.94, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:08:54,359 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:08:54,359 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:09:28,164 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:09:28,164 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:09:28,164 - Freezing Ratio: [Stage3] 0.83, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:09:28,165 - Freezing Ratio: [Stage0] 0.95, Threshold: 5.0000e-02
[rank1]:2025-12-26 07:10:02,053 - Freezing Ratio: [Stage1] 0.93, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:10:02,053 - Freezing Ratio: [Stage2] 0.97, Threshold: 5.0000e-02
[rank3]:2025-12-26 07:10:02,054 - Freezing Ratio: [Stage3] 0.90, Threshold: 5.0000e-02
[rank0]:2025-12-26 07:10:02,057 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:10:02,059 - Freezing Ratio: [Stage0] 0.92, Threshold: 5.0000e-02
[rank2]:2025-12-26 07:10:05,504 - Avg. fwd time: 8.5445 / Avg. bwd time: 11.0834 / Avg. batch time: 406.7350 (ms) / GPU bubble ratio: 61.39%
[rank1]:2025-12-26 07:10:05,528 - Avg. fwd time: 10.6450 / Avg. bwd time: 13.7988 / Avg. batch time: 434.8830 (ms) / GPU bubble ratio: 55.03%
[rank3]:2025-12-26 07:10:05,482 - Avg. fwd time: 14.0787 / Avg. bwd time: 25.9245 / Avg. batch time: 383.4234 (ms) / GPU bubble ratio: 16.53%
[rank0]:2025-12-26 07:10:05,548 - Avg. fwd time: 8.8030 / Avg. bwd time: 11.4350 / Avg. batch time: 459.1837 (ms) / GPU bubble ratio: 64.74%
[rank0]:2025-12-26 07:10:05,550 -  step: 800  loss: -8.0000  grad_norm:  0.1418  memory: 15.49GiB(32.61%)  tps: 9,652  tflops: 75.45  mfu: 24.18%
[rank0]:2025-12-26 07:10:05,550 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.1418  tps: 9,229  tflops: 72.15  mfu: 21.20%
[rank0]:2025-12-26 07:10:05,550 - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-12-26 07:10:05,550 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank2]:2025-12-26 07:10:05,549 -  step: 800  loss: -8.0000  grad_norm:  0.1418  memory:  7.91GiB(16.66%)  tps: 9,652  tflops: 75.45  mfu: 24.18%
[rank2]:2025-12-26 07:10:05,549 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.1418  tps: 9,230  tflops: 72.15  mfu: 21.21%
[rank2]:2025-12-26 07:10:05,549 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-26 07:10:05,550 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-12-26 07:10:05,549 -  step: 800  loss: -8.0000  grad_norm:  0.1418  memory: 10.83GiB(22.79%)  tps: 9,652  tflops: 75.45  mfu: 24.18%
[rank1]:2025-12-26 07:10:05,549 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.1418  tps: 9,229  tflops: 72.15  mfu: 21.20%
[rank1]:2025-12-26 07:10:05,549 - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-12-26 07:10:05,550 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-12-26 07:10:05,550 -  step: 800  loss:  2.8178  grad_norm:  0.1418  memory: 19.89GiB(41.86%)  tps: 9,652  tflops: 75.46  mfu: 24.18%
[rank3]:2025-12-26 07:10:05,551 - â„¹ï¸ final step: 800  loss:  2.8178  grad_norm:  0.1418  tps: 9,236  tflops: 72.20  mfu: 21.31%
[rank3]:2025-12-26 07:10:05,551 - Saving the checkpoint (or staging if async is enabled).
[rank3]:2025-12-26 07:10:05,552 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-26 07:10:07,697 - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank2]:2025-12-26 07:10:07,767 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank2/251226_0710_stage2_final800.svg
[rank1]:2025-12-26 07:10:07,767 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank1/251226_0710_stage1_final800.svg
[rank0]:2025-12-26 07:10:07,766 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank0/251226_0710_stage0_final800.svg
[rank2]:2025-12-26 07:10:07,922 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_params_histogram/251226_0710_rank2_stage2.svg
[rank2]:	> Counts Sum: 2219, Total Sum: 2700 (82.19%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 73.33, 84.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 78.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 50.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 68.0, 46.66]
[rank2]:2025-12-26 07:10:07,923 - Destroying the purge thread.
[rank1]:2025-12-26 07:10:07,916 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_params_histogram/251226_0710_rank1_stage1.svg
[rank1]:	> Counts Sum: 2655, Total Sum: 3375 (78.67%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 76.0, 1.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 70.66, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 76.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 12.0, 64.0]
[rank1]:2025-12-26 07:10:07,916 - Destroying the purge thread.
[rank3]:2025-12-26 07:10:07,852 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0710_final800_rank3.svg
[rank3]:			> Batch Time: 416.55 ms, GPU Bubble Ratio: 67.04%, 58.03%, 66.28%, 31.54%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-8-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  189-8-197ms    | [S0,MB6,F]  197-8-205ms    | [S0,MB3,B]  233-8-241ms    | [S0,MB7,F]  241-8-250ms    | [S0,MB4,B]  278-8-286ms    | [S0,MB5,B]  321-8-329ms    | [S0,MB6,B]  364-8-372ms    | [S0,MB7,B]  408-8-416ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-10-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  144-10-155ms   | [S1,MB2,B]  173-10-184ms   | [S1,MB5,F]  187-10-198ms   | [S1,MB3,B]  217-10-228ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  262-10-272ms   | [S1,MB7,F]  276-10-287ms   | [S1,MB5,B]  306-10-317ms   | [S1,MB6,B]  349-10-360ms   | [S1,MB7,B]  394-10-404ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-137ms    | [S2,MB2,B]  159-8-168ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  248-8-256ms    | [S2,MB6,F]  260-8-269ms    | [S2,MB5,B]  292-8-301ms    | [S2,MB7,F]  305-8-313ms    | [S2,MB6,B]  337-8-346ms    | [S2,MB7,B]  381-8-390ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  91-20-112ms    | [S3,MB2,F]  114-13-128ms   | [S3,MB2,B]  134-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-216ms   | [S3,MB4,B]  222-21-244ms   | [S3,MB5,F]  246-14-261ms   | [S3,MB5,B]  267-21-289ms   | [S3,MB6,F]  291-14-305ms   | [S3,MB6,B]  312-21-333ms   | [S3,MB7,F]  336-14-350ms   | [S3,MB7,B]  356-21-378ms  
[rank0]:2025-12-26 07:10:07,922 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_params_histogram/251226_0710_rank0_stage0.svg
[rank0]:	> Counts Sum: 2124, Total Sum: 2775 (76.54%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 80.0, 25.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 1.33, 65.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 40.0, 64.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 1.33, 80.0]
[rank0]:2025-12-26 07:10:07,922 - Sleeping 2 seconds for other ranks to complete
[rank2]:2025-12-26 07:10:07,986 - Process group destroyed
[rank1]:2025-12-26 07:10:08,003 - Process group destroyed
[rank3]:2025-12-26 07:10:07,985 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/pipeline_schedule/251226_0710_thry_final800_rank3.svg
[rank3]:			> Batch Time: 354.94 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-10-10ms      | [S0,MB1,F]  10-10-21ms     | [S0,MB2,F]  21-10-32ms     | [S0,MB3,F]  32-10-43ms     | [S0,MB0,B]  107-21-129ms   | [S0,MB4,F]  129-10-139ms   | [S0,MB1,B]  139-21-161ms   | [S0,MB5,F]  161-10-172ms   | [S0,MB2,B]  172-21-193ms   | [S0,MB6,F]  193-10-204ms   | [S0,MB3,B]  204-21-225ms   | [S0,MB7,F]  225-10-236ms   | [S0,MB4,B]  236-21-258ms   | [S0,MB5,B]  268-21-290ms   | [S0,MB6,B]  301-21-322ms   | [S0,MB7,B]  333-21-354ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  10-10-21ms     | [S1,MB1,F]  21-10-32ms     | [S1,MB2,F]  32-10-43ms     | [S1,MB0,B]  86-21-107ms    | [S1,MB3,F]  107-10-118ms   | [S1,MB1,B]  118-21-139ms   | [S1,MB4,F]  139-10-150ms   | [S1,MB2,B]  150-21-172ms   | [S1,MB5,F]  172-10-182ms   | [S1,MB3,B]  182-21-204ms   | [S1,MB6,F]  204-10-215ms   | [S1,MB4,B]  215-21-236ms   | [S1,MB7,F]  236-10-247ms   | [S1,MB5,B]  247-21-268ms   | [S1,MB6,B]  279-21-301ms   | [S1,MB7,B]  311-21-333ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  21-10-32ms     | [S2,MB1,F]  32-10-43ms     | [S2,MB0,B]  64-21-86ms     | [S2,MB2,F]  86-10-96ms     | [S2,MB1,B]  96-21-118ms    | [S2,MB3,F]  118-10-129ms   | [S2,MB2,B]  129-21-150ms   | [S2,MB4,F]  150-10-161ms   | [S2,MB3,B]  161-21-182ms   | [S2,MB5,F]  182-10-193ms   | [S2,MB4,B]  193-21-215ms   | [S2,MB6,F]  215-10-225ms   | [S2,MB5,B]  225-21-247ms   | [S2,MB7,F]  247-10-258ms   | [S2,MB6,B]  258-21-279ms   | [S2,MB7,B]  290-21-311ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  32-10-43ms     | [S3,MB0,B]  43-21-64ms     | [S3,MB1,F]  64-10-75ms     | [S3,MB1,B]  75-21-96ms     | [S3,MB2,F]  96-10-107ms    | [S3,MB2,B]  107-21-129ms   | [S3,MB3,F]  129-10-139ms   | [S3,MB3,B]  139-21-161ms   | [S3,MB4,F]  161-10-172ms   | [S3,MB4,B]  172-21-193ms   | [S3,MB5,F]  193-10-204ms   | [S3,MB5,B]  204-21-225ms   | [S3,MB6,F]  225-10-236ms   | [S3,MB6,B]  236-21-258ms   | [S3,MB7,F]  258-10-268ms   | [S3,MB7,B]  268-21-290ms  
[rank3]:2025-12-26 07:10:08,032 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_ratio_history/rank3/251226_0710_stage3_final800.svg
[rank3]:2025-12-26 07:10:08,166 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1/frozen_params_histogram/251226_0710_rank3_stage3.svg
[rank3]:	> Counts Sum: 1613, Total Sum: 2175 (74.16%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 46.66, 10.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 78.66, 5.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 76.0, 54.66, 1.33, 85.33]
[rank3]:2025-12-26 07:10:08,167 - Destroying the purge thread.
[rank3]:wandb: updating run metadata
[rank3]:wandb: uploading history steps 15-16, summary, console lines 351-371
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–â–‚â–‚â–â–â–â–â–â–‚â–â–„â–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 3.54802
[rank3]:wandb:               final/avg_loss 2.81776
[rank3]:wandb:             final/avg_mfu(%) 21.3122
[rank3]:wandb:             final/avg_tflops 72.19944
[rank3]:wandb:    final/avg_throughput(tps) 9235.57059
[rank3]:wandb:              final/grad_norm 0.14177
[rank3]:wandb:               final/max_loss 2.81776
[rank3]:wandb:                    grad_norm 0.14177
[rank3]:wandb: loss_metrics/global_avg_loss 2.81776
[rank3]:wandb: loss_metrics/global_max_loss 2.81776
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1226_1F1B_APF_th5e-2_42_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/gbicamzu
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th5e-2_42_dm1/20251226-0619/wandb/run-20251226_061948-gbicamzu/logs
[rank3]:2025-12-26 07:10:09,500 - Process group destroyed
[rank0]:2025-12-26 07:10:09,922 - Training completed
[rank0]:2025-12-26 07:10:09,923 - Destroying the purge thread.
[rank0]:2025-12-26 07:10:10,009 - Process group destroyed
[rank1]:Stage 1: Modules to keep: {'layers.4', 'layers.5', 'layers.7', 'layers.8', 'layers.6'}
[rank0]:Stage 0: Modules to keep: {'layers.1', 'layers.3', 'tok_embeddings', 'layers.2', 'layers.0'}
[rank2]:Stage 2: Modules to keep: {'layers.10', 'layers.9', 'layers.12', 'layers.11'}
[rank3]:Stage 3: Modules to keep: {'norm', 'output', 'layers.15', 'layers.13', 'layers.14'}
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1226_1F1B_APF_th5e-2_42_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 16
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 42
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 2
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1226_1F1B_APF_th5e-2_42_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: True
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.05
[rank3]:		- percentile: 80
[rank3]:
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
