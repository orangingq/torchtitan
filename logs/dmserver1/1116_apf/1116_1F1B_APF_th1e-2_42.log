
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 11. 16. (ì¼) 05:06:10 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 0,1,3,4
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/1116_1F1B_APF_th1e-2_42.log
âœ”ï¸APF configuration experiment on different threshold values.
âœ”ï¸Running with APF (threshold=1e-2) x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1116.toml --job.description="APF configuration experiment on different threshold values." --parallelism.pipeline_parallel_degree=4  --freezing.freeze --freezing.metric_type=apf --freezing.threshold=1e-2
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank3]:2025-11-16 05:06:16,987 - INFO - Starting job: "APF configuration experiment on different threshold values."
[rank2]:2025-11-16 05:06:16,951 - INFO - Starting job: "APF configuration experiment on different threshold values."
[rank0]:2025-11-16 05:06:17,109 - INFO - Starting job: "APF configuration experiment on different threshold values."
[rank2]:2025-11-16 05:06:17,127 - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:2025-11-16 05:06:17,129 - INFO - Building 1-D device mesh with ['pp'], [4]
[rank3]:2025-11-16 05:06:17,224 - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-11-16 05:06:17,226 - INFO - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-11-16 05:06:17,323 - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-11-16 05:06:17,326 - INFO - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-11-16 05:06:17,330 - INFO - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-11-16 05:06:17,331 - INFO - Loading tokenizer from tokenizer.json
[rank1]:2025-11-16 05:06:17,253 - INFO - Starting job: "APF configuration experiment on different threshold values."
[rank1]:2025-11-16 05:06:17,435 - WARNING - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-11-16 05:06:17,438 - INFO - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-11-16 05:06:17,723 - INFO - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank0]:2025-11-16 05:06:20,729 - INFO - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank2]:2025-11-16 05:06:20,666 - INFO - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-11-16 05:06:20,706 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-11-16 05:06:20,735 - INFO - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-11-16 05:06:20,735 - INFO - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-11-16 05:06:20,897 - INFO - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-11-16 05:06:20,938 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-11-16 05:06:20,939 - INFO - Model llama3 1B size: 1,498,482,688 total parameters
[rank1]:2025-11-16 05:06:20,938 - INFO - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-11-16 05:06:20,911 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-11-16 05:06:20,911 - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-11-16 05:06:20,911 - INFO - CUDA memory usage for model: 0.92GiB(1.94%)
[rank0]:2025-11-16 05:06:20,968 - INFO - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-11-16 05:06:20,968 - INFO - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-11-16 05:06:20,978 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-11-16 05:06:21,006 - INFO - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-11-16 05:06:21,006 - INFO - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-11-16 05:06:21,187 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-11-16 05:06:21,187 - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-11-16 05:06:21,188 - INFO - CUDA memory usage for model: 1.90GiB(3.99%)
[rank1]:2025-11-16 05:06:21,192 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-11-16 05:06:21,193 - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-11-16 05:06:21,193 - INFO - CUDA memory usage for model: 1.13GiB(2.39%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run stgt7p5m
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1116_1F1B_APF_th1e-2_42_dm1/20251116-0506/wandb/run-20251116_050621-stgt7p5m
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1116_1F1B_APF_th1e-2_42_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/stgt7p5m
[rank3]:2025-11-16 05:06:22,870 - INFO - WandB logging enabled
[rank3]:2025-11-16 05:06:22,871 - INFO - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-11-16 05:06:22,910 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-11-16 05:06:22,939 - INFO - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-11-16 05:06:22,939 - INFO - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-11-16 05:06:23,139 - INFO - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1116_1F1B_APF_th1e-2_42_dm1
[rank0]:2025-11-16 05:06:23,139 - INFO - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-11-16 05:06:23,140 - INFO - Trainer is initialized with local batch size 16, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-11-16 05:06:23,140 - INFO - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank2]:2025-11-16 05:06:23,139 - INFO - Mixed precision training with TP or PP is handled by autocast
[rank3]:2025-11-16 05:06:23,121 - WARNING - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-11-16 05:06:23,139 - INFO - Mixed precision training with TP or PP is handled by autocast
[rank3]:2025-11-16 05:06:23,122 - INFO - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-11-16 05:06:23,123 - INFO - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-11-16 05:06:23,139 - INFO - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-11-16 05:06:25,442 - INFO - [GC] GC collection for checkpoint loading. 0.01 seconds
[rank0]:2025-11-16 05:06:25,442 - INFO - Finished loading the checkpoint in 2.30 seconds.
[rank0]:2025-11-16 05:06:25,442 - INFO - Training starts at step 1
[rank3]:2025-11-16 05:06:31,000 - INFO -  step:  1  loss: 10.6088  grad_norm: 116.5378  memory: 12.97GiB(27.31%)  tps: 4,052  tflops: 31.67  mfu: 10.15%
[rank3]:2025-11-16 05:06:31,001 - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-11-16 05:06:30,990 - INFO -  step:  1  loss: -8.0000  grad_norm: 116.5378  memory:  4.63GiB(9.75%)  tps: 3,187  tflops: 24.91  mfu: 7.98%
[rank2]:2025-11-16 05:06:30,990 - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-11-16 05:06:31,027 - INFO -  step:  1  loss: -8.0000  grad_norm: 116.5378  memory:  9.19GiB(19.34%)  tps: 3,248  tflops: 25.39  mfu: 8.14%
[rank0]:2025-11-16 05:06:31,027 - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank1]:2025-11-16 05:06:30,995 - INFO -  step:  1  loss: -8.0000  grad_norm: 116.5378  memory:  6.76GiB(14.24%)  tps: 3,271  tflops: 25.57  mfu: 8.20%
[rank1]:2025-11-16 05:06:30,996 - INFO - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-11-16 05:08:32,231 - INFO - Avg. fwd time: 13.4178 / Avg. bwd time: 42.0890 / Avg. batch time: 507.6565 (ms) / GPU bubble ratio: 12.53%
[rank0]:2025-11-16 05:08:32,300 - INFO - Avg. fwd time: 7.3188 / Avg. bwd time: 23.5182 / Avg. batch time: 615.7784 (ms) / GPU bubble ratio: 59.94%
[rank2]:2025-11-16 05:08:32,269 - INFO - Avg. fwd time: 7.3535 / Avg. bwd time: 19.1042 / Avg. batch time: 539.7151 (ms) / GPU bubble ratio: 60.78%
[rank1]:2025-11-16 05:08:32,304 - INFO - Avg. fwd time: 9.3614 / Avg. bwd time: 23.8975 / Avg. batch time: 578.6651 (ms) / GPU bubble ratio: 54.02%
[rank0]:2025-11-16 05:10:34,839 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-11-16 05:10:39,587 - INFO - Avg. fwd time: 13.5779 / Avg. bwd time: 42.4122 / Avg. batch time: 511.4547 (ms) / GPU bubble ratio: 12.42%
[rank2]:2025-11-16 05:10:39,626 - INFO - Avg. fwd time: 7.3701 / Avg. bwd time: 19.1718 / Avg. batch time: 543.1395 (ms) / GPU bubble ratio: 60.91%
[rank0]:2025-11-16 05:10:39,657 - INFO - Avg. fwd time: 7.3352 / Avg. bwd time: 23.5813 / Avg. batch time: 618.4986 (ms) / GPU bubble ratio: 60.01%
[rank1]:2025-11-16 05:10:39,661 - INFO - Avg. fwd time: 9.4088 / Avg. bwd time: 24.0002 / Avg. batch time: 581.7771 (ms) / GPU bubble ratio: 54.06%
[rank2]:2025-11-16 05:10:39,885 - INFO -  step: 50  loss: -8.0000  grad_norm: 12.6910  memory:  6.43GiB(13.53%)  tps: 6,451  tflops: 50.43  mfu: 16.16%
[rank1]:2025-11-16 05:10:39,889 - INFO -  step: 50  loss: -8.0000  grad_norm: 12.6910  memory:  9.03GiB(19.01%)  tps: 6,451  tflops: 50.43  mfu: 16.16%
[rank3]:2025-11-16 05:10:39,898 - INFO -  step: 50  loss:  9.9143  grad_norm: 12.6910  memory: 16.39GiB(34.50%)  tps: 6,451  tflops: 50.43  mfu: 16.16%
[rank0]:2025-11-16 05:10:39,900 - INFO -  step: 50  loss: -8.0000  grad_norm: 12.6910  memory: 12.97GiB(27.31%)  tps: 6,452  tflops: 50.44  mfu: 16.17%
[rank3]:2025-11-16 05:11:30,632 - INFO - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:11:30,658 - INFO - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:11:30,717 - INFO - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:11:30,688 - INFO - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:12:21,603 - INFO - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:12:21,609 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:12:21,621 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:12:21,628 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:12:42,450 - INFO - Avg. fwd time: 13.6545 / Avg. bwd time: 41.7993 / Avg. batch time: 507.1240 (ms) / GPU bubble ratio: 12.52%
[rank2]:2025-11-16 05:12:42,466 - INFO - Avg. fwd time: 7.4632 / Avg. bwd time: 18.4952 / Avg. batch time: 537.9897 (ms) / GPU bubble ratio: 61.40%
[rank0]:2025-11-16 05:12:42,499 - INFO - Avg. fwd time: 7.4372 / Avg. bwd time: 22.5802 / Avg. batch time: 611.2445 (ms) / GPU bubble ratio: 60.71%
[rank1]:2025-11-16 05:12:42,484 - INFO - Avg. fwd time: 9.5138 / Avg. bwd time: 23.1421 / Avg. batch time: 575.6501 (ms) / GPU bubble ratio: 54.62%
[rank2]:2025-11-16 05:13:03,350 - INFO - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:13:03,350 - INFO - Freezing Ratio: [Stage0] 0.03, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:13:03,349 - INFO - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:13:03,381 - INFO - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:13:54,139 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:13:54,167 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:13:54,144 - INFO - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:13:54,160 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:14:31,511 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank2]:2025-11-16 05:14:35,387 - INFO - Avg. fwd time: 7.6292 / Avg. bwd time: 17.3145 / Avg. batch time: 529.0519 (ms) / GPU bubble ratio: 62.28%
[rank0]:2025-11-16 05:14:35,397 - INFO - Avg. fwd time: 7.6116 / Avg. bwd time: 20.8609 / Avg. batch time: 598.9738 (ms) / GPU bubble ratio: 61.97%
[rank3]:2025-11-16 05:14:35,370 - INFO - Avg. fwd time: 13.7559 / Avg. bwd time: 40.7392 / Avg. batch time: 499.4302 (ms) / GPU bubble ratio: 12.71%
[rank1]:2025-11-16 05:14:35,442 - INFO - Avg. fwd time: 9.6980 / Avg. bwd time: 21.6561 / Avg. batch time: 565.1699 (ms) / GPU bubble ratio: 55.62%
[rank2]:2025-11-16 05:14:35,623 - INFO - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:14:35,623 - INFO -  step: 100  loss: -8.0000  grad_norm:  7.2394  memory:  7.35GiB(15.47%)  tps: 6,950  tflops: 54.33  mfu: 17.41%
[rank1]:2025-11-16 05:14:35,623 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:14:35,624 - INFO -  step: 100  loss: -8.0000  grad_norm:  7.2394  memory: 10.16GiB(21.39%)  tps: 6,950  tflops: 54.33  mfu: 17.41%
[rank0]:2025-11-16 05:14:35,623 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:14:35,624 - INFO -  step: 100  loss: -8.0000  grad_norm:  7.2394  memory: 15.22GiB(32.04%)  tps: 6,951  tflops: 54.34  mfu: 17.42%
[rank3]:2025-11-16 05:14:35,653 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:14:35,656 - INFO -  step: 100  loss:  8.7892  grad_norm:  7.2394  memory: 19.34GiB(40.71%)  tps: 6,950  tflops: 54.33  mfu: 17.41%
[rank2]:2025-11-16 05:14:35,731 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0514_stage2_step100.svg
[rank1]:2025-11-16 05:14:35,733 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0514_stage1_step100.svg
[rank0]:2025-11-16 05:14:35,732 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0514_stage0_step100.svg
[rank3]:2025-11-16 05:14:35,825 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0514_real_step100_rank3.svg
[rank3]:> Batch Time: 511.24 ms, GPU Bubble Ratio: 73.00%, 65.74%, 72.49%, 25.39%
[rank3]:2025-11-16 05:14:35,870 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0514_stage3_step100.svg
[rank1]:2025-11-16 05:15:17,451 - INFO - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:15:17,451 - INFO - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:15:17,451 - INFO - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:15:17,482 - INFO - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:16:08,552 - INFO - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:16:08,557 - INFO - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:16:08,580 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:16:08,572 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:16:28,916 - INFO - Avg. fwd time: 7.7534 / Avg. bwd time: 19.4175 / Avg. batch time: 588.9184 (ms) / GPU bubble ratio: 63.09%
[rank3]:2025-11-16 05:16:28,939 - INFO - Avg. fwd time: 13.8381 / Avg. bwd time: 39.8643 / Avg. batch time: 493.0728 (ms) / GPU bubble ratio: 12.87%
[rank2]:2025-11-16 05:16:28,955 - INFO - Avg. fwd time: 7.7637 / Avg. bwd time: 16.3365 / Avg. batch time: 521.7745 (ms) / GPU bubble ratio: 63.05%
[rank1]:2025-11-16 05:16:29,012 - INFO - Avg. fwd time: 9.8443 / Avg. bwd time: 20.4206 / Avg. batch time: 556.6167 (ms) / GPU bubble ratio: 56.50%
[rank1]:2025-11-16 05:16:50,159 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:16:50,159 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:16:50,160 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:16:50,190 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:17:31,763 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:17:31,763 - INFO - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:17:31,764 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:17:31,795 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:18:09,317 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank2]:2025-11-16 05:18:13,479 - INFO - Avg. fwd time: 7.9547 / Avg. bwd time: 14.9998 / Avg. batch time: 511.8878 (ms) / GPU bubble ratio: 64.13%
[rank3]:2025-11-16 05:18:13,463 - INFO - Avg. fwd time: 13.9690 / Avg. bwd time: 38.6731 / Avg. batch time: 484.5719 (ms) / GPU bubble ratio: 13.09%
[rank1]:2025-11-16 05:18:13,496 - INFO - Avg. fwd time: 10.0506 / Avg. bwd time: 18.7391 / Avg. batch time: 545.0292 (ms) / GPU bubble ratio: 57.74%
[rank1]:2025-11-16 05:18:13,514 - INFO - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:18:13,515 - INFO -  step: 150  loss: -8.0000  grad_norm:  9.7503  memory: 10.16GiB(21.39%)  tps: 7,519  tflops: 58.78  mfu: 18.84%
[rank2]:2025-11-16 05:18:13,515 - INFO - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:18:13,515 - INFO -  step: 150  loss: -8.0000  grad_norm:  9.7503  memory:  7.35GiB(15.47%)  tps: 7,519  tflops: 58.78  mfu: 18.84%
[rank0]:2025-11-16 05:18:13,511 - INFO - Avg. fwd time: 7.9504 / Avg. bwd time: 17.4569 / Avg. batch time: 575.3383 (ms) / GPU bubble ratio: 64.67%
[rank0]:2025-11-16 05:18:13,515 - INFO - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:18:13,515 - INFO -  step: 150  loss: -8.0000  grad_norm:  9.7503  memory: 15.22GiB(32.04%)  tps: 7,519  tflops: 58.78  mfu: 18.84%
[rank3]:2025-11-16 05:18:13,544 - INFO - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:18:13,547 - INFO -  step: 150  loss:  5.3789  grad_norm:  9.7503  memory: 19.34GiB(40.71%)  tps: 7,519  tflops: 58.78  mfu: 18.84%
[rank2]:2025-11-16 05:19:04,754 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:19:04,760 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:19:04,782 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:19:04,775 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:19:46,696 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:19:46,664 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:19:46,665 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:19:46,664 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:20:07,261 - INFO - Avg. fwd time: 7.9841 / Avg. bwd time: 14.7896 / Avg. batch time: 510.6795 (ms) / GPU bubble ratio: 64.32%
[rank0]:2025-11-16 05:20:07,273 - INFO - Avg. fwd time: 7.9831 / Avg. bwd time: 17.1543 / Avg. batch time: 573.5325 (ms) / GPU bubble ratio: 64.94%
[rank3]:2025-11-16 05:20:07,245 - INFO - Avg. fwd time: 14.0076 / Avg. bwd time: 38.5143 / Avg. batch time: 483.6063 (ms) / GPU bubble ratio: 13.12%
[rank1]:2025-11-16 05:20:07,317 - INFO - Avg. fwd time: 10.0839 / Avg. bwd time: 18.4753 / Avg. batch time: 543.5468 (ms) / GPU bubble ratio: 57.97%
[rank1]:2025-11-16 05:20:28,479 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:20:28,508 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:20:28,479 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:20:28,479 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:21:10,198 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:21:10,198 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:21:10,199 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:21:10,230 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:21:47,811 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-11-16 05:21:51,774 - INFO - Avg. fwd time: 14.0896 / Avg. bwd time: 37.8073 / Avg. batch time: 478.6021 (ms) / GPU bubble ratio: 13.25%
[rank2]:2025-11-16 05:21:51,791 - INFO - Avg. fwd time: 8.0988 / Avg. bwd time: 13.9839 / Avg. batch time: 504.8387 (ms) / GPU bubble ratio: 65.01%
[rank1]:2025-11-16 05:21:51,850 - INFO - Avg. fwd time: 10.2092 / Avg. bwd time: 17.4644 / Avg. batch time: 536.6846 (ms) / GPU bubble ratio: 58.75%
[rank0]:2025-11-16 05:21:51,803 - INFO - Avg. fwd time: 8.1021 / Avg. bwd time: 15.9941 / Avg. batch time: 565.4835 (ms) / GPU bubble ratio: 65.91%
[rank2]:2025-11-16 05:21:52,038 - INFO - Freezing Ratio: [Stage2] 0.11, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:21:52,039 - INFO -  step: 200  loss: -8.0000  grad_norm:  7.8364  memory:  7.35GiB(15.47%)  tps: 7,498  tflops: 58.61  mfu: 18.79%
[rank1]:2025-11-16 05:21:52,038 - INFO - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:21:52,039 - INFO -  step: 200  loss: -8.0000  grad_norm:  7.8364  memory: 10.16GiB(21.39%)  tps: 7,498  tflops: 58.61  mfu: 18.79%
[rank3]:2025-11-16 05:21:52,070 - INFO - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:21:52,073 - INFO -  step: 200  loss:  1.6317  grad_norm:  7.8364  memory: 19.34GiB(40.71%)  tps: 7,498  tflops: 58.61  mfu: 18.79%
[rank0]:2025-11-16 05:21:52,039 - INFO - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:21:52,039 - INFO -  step: 200  loss: -8.0000  grad_norm:  7.8364  memory: 15.22GiB(32.04%)  tps: 7,498  tflops: 58.61  mfu: 18.79%
[rank2]:2025-11-16 05:21:52,128 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0521_stage2_step200.svg
[rank1]:2025-11-16 05:21:52,123 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0521_stage1_step200.svg
[rank0]:2025-11-16 05:21:52,130 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0521_stage0_step200.svg
[rank3]:2025-11-16 05:21:52,228 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0521_real_step200_rank3.svg
[rank3]:> Batch Time: 510.29 ms, GPU Bubble Ratio: 73.03%, 65.86%, 72.57%, 25.48%
[rank3]:2025-11-16 05:21:52,276 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0521_stage3_step200.svg
[rank3]:2025-11-16 05:22:43,239 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:22:43,218 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:22:43,224 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:22:43,247 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:23:24,695 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:23:24,695 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:23:24,696 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:23:24,726 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:23:45,588 - INFO - Avg. fwd time: 8.1192 / Avg. bwd time: 13.8310 / Avg. batch time: 503.7291 (ms) / GPU bubble ratio: 65.14%
[rank0]:2025-11-16 05:23:45,622 - INFO - Avg. fwd time: 8.1246 / Avg. bwd time: 15.7804 / Avg. batch time: 563.9502 (ms) / GPU bubble ratio: 66.09%
[rank1]:2025-11-16 05:23:45,607 - INFO - Avg. fwd time: 10.2316 / Avg. bwd time: 17.2757 / Avg. batch time: 535.3774 (ms) / GPU bubble ratio: 58.90%
[rank3]:2025-11-16 05:23:45,571 - INFO - Avg. fwd time: 14.0991 / Avg. bwd time: 37.6725 / Avg. batch time: 477.5985 (ms) / GPU bubble ratio: 13.28%
[rank0]:2025-11-16 05:24:06,341 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:24:06,340 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:24:06,341 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:24:06,372 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:24:48,044 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:24:48,045 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:24:48,075 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:24:48,045 - INFO - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:25:25,537 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-11-16 05:25:29,445 - INFO - Avg. fwd time: 8.1923 / Avg. bwd time: 15.1034 / Avg. batch time: 559.0494 (ms) / GPU bubble ratio: 66.66%
[rank2]:2025-11-16 05:25:29,433 - INFO - Avg. fwd time: 8.1848 / Avg. bwd time: 13.3576 / Avg. batch time: 500.1172 (ms) / GPU bubble ratio: 65.54%
[rank3]:2025-11-16 05:25:29,417 - INFO - Avg. fwd time: 14.1343 / Avg. bwd time: 37.2481 / Avg. batch time: 474.4804 (ms) / GPU bubble ratio: 13.37%
[rank1]:2025-11-16 05:25:29,489 - INFO - Avg. fwd time: 10.3026 / Avg. bwd time: 16.6881 / Avg. batch time: 531.1696 (ms) / GPU bubble ratio: 59.35%
[rank0]:2025-11-16 05:25:29,674 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:25:29,674 - INFO -  step: 250  loss: -8.0000  grad_norm:  5.6514  memory: 15.22GiB(32.04%)  tps: 7,528  tflops: 58.85  mfu: 18.86%
[rank2]:2025-11-16 05:25:29,673 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:25:29,673 - INFO -  step: 250  loss: -8.0000  grad_norm:  5.6514  memory:  7.35GiB(15.47%)  tps: 7,528  tflops: 58.85  mfu: 18.86%
[rank1]:2025-11-16 05:25:29,674 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:25:29,674 - INFO -  step: 250  loss: -8.0000  grad_norm:  5.6514  memory: 10.16GiB(21.39%)  tps: 7,528  tflops: 58.85  mfu: 18.86%
[rank3]:2025-11-16 05:25:29,705 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:25:29,708 - INFO -  step: 250  loss:  5.1468  grad_norm:  5.6514  memory: 19.34GiB(40.71%)  tps: 7,528  tflops: 58.85  mfu: 18.86%
[rank2]:2025-11-16 05:26:11,322 - INFO - Freezing Ratio: [Stage2] 0.06, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:26:11,322 - INFO - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:26:11,322 - INFO - Freezing Ratio: [Stage0] 0.03, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:26:11,353 - INFO - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:27:02,468 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:27:02,448 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:27:02,453 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:27:02,475 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:27:23,173 - INFO - Avg. fwd time: 14.1475 / Avg. bwd time: 37.2002 / Avg. batch time: 474.1990 (ms) / GPU bubble ratio: 13.37%
[rank2]:2025-11-16 05:27:23,188 - INFO - Avg. fwd time: 8.1926 / Avg. bwd time: 13.2923 / Avg. batch time: 499.7521 (ms) / GPU bubble ratio: 65.61%
[rank0]:2025-11-16 05:27:23,201 - INFO - Avg. fwd time: 8.2021 / Avg. bwd time: 15.0117 / Avg. batch time: 558.5009 (ms) / GPU bubble ratio: 66.75%
[rank1]:2025-11-16 05:27:23,246 - INFO - Avg. fwd time: 10.3101 / Avg. bwd time: 16.6085 / Avg. batch time: 530.7175 (ms) / GPU bubble ratio: 59.42%
[rank3]:2025-11-16 05:27:44,429 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:27:44,397 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:27:44,398 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:27:44,398 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:28:26,340 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:28:26,371 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:28:26,340 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:28:26,340 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:29:04,030 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-11-16 05:29:08,158 - INFO - Avg. fwd time: 14.1979 / Avg. bwd time: 36.8472 / Avg. batch time: 471.7758 (ms) / GPU bubble ratio: 13.44%
[rank1]:2025-11-16 05:29:08,194 - INFO - Avg. fwd time: 10.3725 / Avg. bwd time: 16.1032 / Avg. batch time: 527.3681 (ms) / GPU bubble ratio: 59.84%
[rank1]:2025-11-16 05:29:08,214 - INFO - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:29:08,215 - INFO -  step: 300  loss: -8.0000  grad_norm:  6.4257  memory: 10.16GiB(21.39%)  tps: 7,497  tflops: 58.61  mfu: 18.78%
[rank3]:2025-11-16 05:29:08,244 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:29:08,247 - INFO -  step: 300  loss:  3.8951  grad_norm:  6.4257  memory: 19.34GiB(40.71%)  tps: 7,497  tflops: 58.61  mfu: 18.78%
[rank0]:2025-11-16 05:29:08,211 - INFO - Avg. fwd time: 8.2608 / Avg. bwd time: 14.4303 / Avg. batch time: 554.5644 (ms) / GPU bubble ratio: 67.27%
[rank0]:2025-11-16 05:29:08,215 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:29:08,215 - INFO -  step: 300  loss: -8.0000  grad_norm:  6.4257  memory: 15.22GiB(32.04%)  tps: 7,497  tflops: 58.61  mfu: 18.78%
[rank2]:2025-11-16 05:29:08,175 - INFO - Avg. fwd time: 8.2500 / Avg. bwd time: 12.8898 / Avg. batch time: 496.9103 (ms) / GPU bubble ratio: 65.97%
[rank2]:2025-11-16 05:29:08,214 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:29:08,215 - INFO -  step: 300  loss: -8.0000  grad_norm:  6.4257  memory:  7.35GiB(15.47%)  tps: 7,497  tflops: 58.61  mfu: 18.78%
[rank1]:2025-11-16 05:29:08,295 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0529_stage1_step300.svg
[rank0]:2025-11-16 05:29:08,301 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0529_stage0_step300.svg
[rank2]:2025-11-16 05:29:08,298 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0529_stage2_step300.svg
[rank3]:2025-11-16 05:29:08,396 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0529_real_step300_rank3.svg
[rank3]:> Batch Time: 512.61 ms, GPU Bubble Ratio: 73.08%, 65.89%, 72.57%, 24.71%
[rank3]:2025-11-16 05:29:08,441 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0529_stage3_step300.svg
[rank2]:2025-11-16 05:29:50,117 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:29:50,117 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:29:50,118 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:29:50,148 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:30:31,886 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:30:31,886 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:30:31,917 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:30:31,886 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:30:52,300 - INFO - Avg. fwd time: 8.3030 / Avg. bwd time: 13.9849 / Avg. batch time: 551.5837 (ms) / GPU bubble ratio: 67.67%
[rank1]:2025-11-16 05:30:52,392 - INFO - Avg. fwd time: 10.4179 / Avg. bwd time: 15.7350 / Avg. batch time: 524.8427 (ms) / GPU bubble ratio: 60.14%
[rank3]:2025-11-16 05:30:52,320 - INFO - Avg. fwd time: 14.2229 / Avg. bwd time: 36.5865 / Avg. batch time: 469.8863 (ms) / GPU bubble ratio: 13.49%
[rank2]:2025-11-16 05:30:52,337 - INFO - Avg. fwd time: 8.2917 / Avg. bwd time: 12.5970 / Avg. batch time: 494.7557 (ms) / GPU bubble ratio: 66.22%
[rank0]:2025-11-16 05:31:13,497 - INFO - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:31:13,497 - INFO - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:31:13,527 - INFO - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:31:13,497 - INFO - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:32:04,393 - INFO - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:32:04,388 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:32:04,416 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:32:04,409 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:32:41,946 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank3]:2025-11-16 05:32:45,841 - INFO - Avg. fwd time: 14.2217 / Avg. bwd time: 36.5902 / Avg. batch time: 469.9068 (ms) / GPU bubble ratio: 13.49%
[rank0]:2025-11-16 05:32:45,870 - INFO - Avg. fwd time: 8.3008 / Avg. bwd time: 13.9847 / Avg. batch time: 551.5895 (ms) / GPU bubble ratio: 67.68%
[rank1]:2025-11-16 05:32:45,914 - INFO - Avg. fwd time: 10.4132 / Avg. bwd time: 15.7420 / Avg. batch time: 524.8558 (ms) / GPU bubble ratio: 60.13%
[rank2]:2025-11-16 05:32:45,855 - INFO - Avg. fwd time: 8.2893 / Avg. bwd time: 12.6031 / Avg. batch time: 494.7663 (ms) / GPU bubble ratio: 66.22%
[rank3]:2025-11-16 05:32:46,132 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:32:46,136 - INFO -  step: 350  loss:  1.5217  grad_norm:  3.5903  memory: 19.34GiB(40.71%)  tps: 7,520  tflops: 58.78  mfu: 18.84%
[rank1]:2025-11-16 05:32:46,101 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:32:46,101 - INFO -  step: 350  loss: -8.0000  grad_norm:  3.5903  memory: 10.16GiB(21.39%)  tps: 7,520  tflops: 58.78  mfu: 18.84%
[rank2]:2025-11-16 05:32:46,100 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:32:46,100 - INFO -  step: 350  loss: -8.0000  grad_norm:  3.5903  memory:  7.35GiB(15.47%)  tps: 7,520  tflops: 58.78  mfu: 18.84%
[rank0]:2025-11-16 05:32:46,101 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:32:46,102 - INFO -  step: 350  loss: -8.0000  grad_norm:  3.5903  memory: 15.22GiB(32.04%)  tps: 7,520  tflops: 58.78  mfu: 18.84%
[rank1]:2025-11-16 05:33:27,803 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:33:27,803 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:33:27,804 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:33:27,833 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:34:09,446 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:34:09,414 - INFO - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:34:09,414 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:34:09,414 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:34:30,103 - INFO - Avg. fwd time: 14.2427 / Avg. bwd time: 36.3398 / Avg. batch time: 468.0673 (ms) / GPU bubble ratio: 13.55%
[rank1]:2025-11-16 05:34:30,141 - INFO - Avg. fwd time: 10.4554 / Avg. bwd time: 15.3989 / Avg. batch time: 522.3824 (ms) / GPU bubble ratio: 60.41%
[rank2]:2025-11-16 05:34:30,121 - INFO - Avg. fwd time: 8.3282 / Avg. bwd time: 12.3273 / Avg. batch time: 492.6406 (ms) / GPU bubble ratio: 66.46%
[rank0]:2025-11-16 05:34:30,158 - INFO - Avg. fwd time: 8.3390 / Avg. bwd time: 13.5509 / Avg. batch time: 548.6749 (ms) / GPU bubble ratio: 68.08%
[rank0]:2025-11-16 05:34:50,958 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:34:50,989 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:34:50,958 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:34:50,957 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:35:32,573 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:35:32,543 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:35:32,543 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:35:32,544 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:36:10,072 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-11-16 05:36:14,012 - INFO - Avg. fwd time: 14.2568 / Avg. bwd time: 36.1518 / Avg. batch time: 466.6728 (ms) / GPU bubble ratio: 13.59%
[rank2]:2025-11-16 05:36:14,026 - INFO - Avg. fwd time: 8.3573 / Avg. bwd time: 12.1199 / Avg. batch time: 491.0288 (ms) / GPU bubble ratio: 66.64%
[rank0]:2025-11-16 05:36:13,988 - INFO - Avg. fwd time: 8.3682 / Avg. bwd time: 13.2383 / Avg. batch time: 546.4819 (ms) / GPU bubble ratio: 68.37%
[rank1]:2025-11-16 05:36:14,087 - INFO - Avg. fwd time: 10.4868 / Avg. bwd time: 15.1406 / Avg. batch time: 520.5079 (ms) / GPU bubble ratio: 60.61%
[rank0]:2025-11-16 05:36:14,276 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:36:14,276 - INFO -  step: 400  loss: -8.0000  grad_norm:  0.2701  memory: 15.22GiB(32.04%)  tps: 7,870  tflops: 61.53  mfu: 19.72%
[rank3]:2025-11-16 05:36:14,307 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:36:14,310 - INFO -  step: 400  loss:  0.4288  grad_norm:  0.2701  memory: 19.34GiB(40.71%)  tps: 7,870  tflops: 61.53  mfu: 19.72%
[rank2]:2025-11-16 05:36:14,275 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:36:14,276 - INFO -  step: 400  loss: -8.0000  grad_norm:  0.2701  memory:  7.35GiB(15.47%)  tps: 7,870  tflops: 61.53  mfu: 19.72%
[rank1]:2025-11-16 05:36:14,275 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:36:14,276 - INFO -  step: 400  loss: -8.0000  grad_norm:  0.2701  memory: 10.16GiB(21.39%)  tps: 7,870  tflops: 61.53  mfu: 19.72%
[rank0]:2025-11-16 05:36:14,362 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0536_stage0_step400.svg
[rank2]:2025-11-16 05:36:14,364 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0536_stage2_step400.svg
[rank1]:2025-11-16 05:36:14,362 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0536_stage1_step400.svg
[rank3]:2025-11-16 05:36:14,455 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0536_real_step400_rank3.svg
[rank3]:> Batch Time: 510.26 ms, GPU Bubble Ratio: 73.99%, 65.84%, 72.59%, 25.42%
[rank3]:2025-11-16 05:36:14,504 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0536_stage3_step400.svg
[rank3]:2025-11-16 05:36:38,100 - WARNING - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-11-16 05:36:38,335 - WARNING - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-11-16 05:36:38,348 - WARNING - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-11-16 05:36:38,355 - WARNING - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-11-16 05:36:56,078 - INFO - Freezing Ratio: [Stage2] 0.06, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:36:56,078 - INFO - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:36:56,079 - INFO - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:36:56,109 - INFO - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:37:47,117 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:37:47,123 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:37:47,145 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:37:47,138 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:38:07,791 - INFO - Avg. fwd time: 8.3626 / Avg. bwd time: 13.2728 / Avg. batch time: 546.9137 (ms) / GPU bubble ratio: 68.35%
[rank3]:2025-11-16 05:38:07,812 - INFO - Avg. fwd time: 14.2594 / Avg. bwd time: 36.1872 / Avg. batch time: 466.9765 (ms) / GPU bubble ratio: 13.58%
[rank2]:2025-11-16 05:38:07,827 - INFO - Avg. fwd time: 8.3520 / Avg. bwd time: 12.1547 / Avg. batch time: 491.3900 (ms) / GPU bubble ratio: 66.61%
[rank1]:2025-11-16 05:38:07,885 - INFO - Avg. fwd time: 10.4793 / Avg. bwd time: 15.1840 / Avg. batch time: 520.9085 (ms) / GPU bubble ratio: 60.59%
[rank2]:2025-11-16 05:38:28,797 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:38:28,797 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:38:28,797 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:38:28,828 - INFO - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:39:10,687 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:39:10,718 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:39:10,686 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:39:10,687 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:39:48,359 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank3]:2025-11-16 05:39:52,480 - INFO - Avg. fwd time: 14.2849 / Avg. bwd time: 36.0108 / Avg. batch time: 465.7683 (ms) / GPU bubble ratio: 13.61%
[rank2]:2025-11-16 05:39:52,500 - INFO - Avg. fwd time: 8.3812 / Avg. bwd time: 11.9527 / Avg. batch time: 489.9686 (ms) / GPU bubble ratio: 66.80%
[rank1]:2025-11-16 05:39:52,520 - INFO - Avg. fwd time: 10.5110 / Avg. bwd time: 14.9299 / Avg. batch time: 519.2314 (ms) / GPU bubble ratio: 60.80%
[rank0]:2025-11-16 05:39:52,538 - INFO - Avg. fwd time: 8.3920 / Avg. bwd time: 12.9655 / Avg. batch time: 544.9273 (ms) / GPU bubble ratio: 68.65%
[rank0]:2025-11-16 05:39:52,542 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:39:52,542 - INFO -  step: 450  loss: -8.0000  grad_norm:  4.0620  memory: 15.22GiB(32.04%)  tps: 7,506  tflops: 58.68  mfu: 18.81%
[rank3]:2025-11-16 05:39:52,570 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:39:52,574 - INFO -  step: 450  loss:  0.7544  grad_norm:  4.0620  memory: 19.34GiB(40.71%)  tps: 7,507  tflops: 58.68  mfu: 18.81%
[rank2]:2025-11-16 05:39:52,541 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:39:52,541 - INFO -  step: 450  loss: -8.0000  grad_norm:  4.0620  memory:  7.35GiB(15.47%)  tps: 7,506  tflops: 58.68  mfu: 18.81%
[rank1]:2025-11-16 05:39:52,541 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:39:52,542 - INFO -  step: 450  loss: -8.0000  grad_norm:  4.0620  memory: 10.16GiB(21.39%)  tps: 7,506  tflops: 58.68  mfu: 18.81%
[rank2]:2025-11-16 05:40:34,232 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:40:34,233 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:40:34,234 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:40:34,265 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:41:15,857 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:41:15,888 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:41:15,857 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:41:15,857 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:41:36,440 - INFO - Avg. fwd time: 8.4141 / Avg. bwd time: 12.7189 / Avg. batch time: 543.3262 (ms) / GPU bubble ratio: 68.88%
[rank3]:2025-11-16 05:41:36,457 - INFO - Avg. fwd time: 14.3004 / Avg. bwd time: 35.8720 / Avg. batch time: 464.7798 (ms) / GPU bubble ratio: 13.64%
[rank2]:2025-11-16 05:41:36,472 - INFO - Avg. fwd time: 8.4036 / Avg. bwd time: 11.7975 / Avg. batch time: 488.8163 (ms) / GPU bubble ratio: 66.94%
[rank1]:2025-11-16 05:41:36,530 - INFO - Avg. fwd time: 10.5354 / Avg. bwd time: 14.7347 / Avg. batch time: 517.8817 (ms) / GPU bubble ratio: 60.96%
[rank2]:2025-11-16 05:41:57,547 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:41:57,547 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:41:57,547 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:41:57,576 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:42:39,206 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:42:39,207 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:42:39,207 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:42:39,237 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:43:16,771 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-11-16 05:43:20,645 - INFO - Avg. fwd time: 14.3139 / Avg. bwd time: 35.7232 / Avg. batch time: 463.6948 (ms) / GPU bubble ratio: 13.67%
[rank2]:2025-11-16 05:43:20,666 - INFO - Avg. fwd time: 8.4266 / Avg. bwd time: 11.6342 / Avg. batch time: 487.5571 (ms) / GPU bubble ratio: 67.08%
[rank0]:2025-11-16 05:43:20,676 - INFO - Avg. fwd time: 8.4374 / Avg. bwd time: 12.4693 / Avg. batch time: 541.6047 (ms) / GPU bubble ratio: 69.12%
[rank1]:2025-11-16 05:43:20,719 - INFO - Avg. fwd time: 10.5602 / Avg. bwd time: 14.5287 / Avg. batch time: 516.4136 (ms) / GPU bubble ratio: 61.13%
[rank0]:2025-11-16 05:43:20,903 - INFO - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:43:20,903 - INFO -  step: 500  loss: -8.0000  grad_norm:  2.5125  memory: 15.22GiB(32.04%)  tps: 7,863  tflops: 61.47  mfu: 19.70%
[rank3]:2025-11-16 05:43:20,934 - INFO - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:43:20,937 - INFO -  step: 500  loss:  0.5395  grad_norm:  2.5125  memory: 19.34GiB(40.71%)  tps: 7,863  tflops: 61.47  mfu: 19.70%
[rank2]:2025-11-16 05:43:20,902 - INFO - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:43:20,902 - INFO -  step: 500  loss: -8.0000  grad_norm:  2.5125  memory:  7.35GiB(15.47%)  tps: 7,863  tflops: 61.47  mfu: 19.70%
[rank2]:2025-11-16 05:43:20,984 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0543_stage2_step500.svg
[rank1]:2025-11-16 05:43:20,902 - INFO - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:43:20,903 - INFO -  step: 500  loss: -8.0000  grad_norm:  2.5125  memory: 10.16GiB(21.39%)  tps: 7,863  tflops: 61.47  mfu: 19.70%
[rank1]:2025-11-16 05:43:20,984 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0543_stage1_step500.svg
[rank0]:2025-11-16 05:43:20,984 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0543_stage0_step500.svg
[rank3]:2025-11-16 05:43:21,084 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0543_real_step500_rank3.svg
[rank3]:> Batch Time: 511.90 ms, GPU Bubble Ratio: 72.99%, 65.79%, 72.53%, 25.28%
[rank3]:2025-11-16 05:43:21,132 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0543_stage3_step500.svg
[rank0]:2025-11-16 05:44:12,293 - INFO - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:44:12,286 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:44:12,263 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:44:12,271 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:44:54,160 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:44:54,190 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:44:54,159 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:44:54,159 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:45:15,022 - INFO - Avg. fwd time: 14.3173 / Avg. bwd time: 35.7751 / Avg. batch time: 464.1380 (ms) / GPU bubble ratio: 13.66%
[rank2]:2025-11-16 05:45:15,042 - INFO - Avg. fwd time: 8.4184 / Avg. bwd time: 11.6897 / Avg. batch time: 488.0762 (ms) / GPU bubble ratio: 67.04%
[rank0]:2025-11-16 05:45:15,082 - INFO - Avg. fwd time: 8.4295 / Avg. bwd time: 12.5391 / Avg. batch time: 542.2604 (ms) / GPU bubble ratio: 69.06%
[rank1]:2025-11-16 05:45:15,063 - INFO - Avg. fwd time: 10.5499 / Avg. bwd time: 14.5975 / Avg. batch time: 517.0002 (ms) / GPU bubble ratio: 61.09%
[rank0]:2025-11-16 05:45:36,083 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:45:36,114 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:45:36,082 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:45:36,081 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:46:17,862 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:46:17,891 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:46:17,862 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:46:17,861 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:46:55,483 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-11-16 05:46:59,387 - INFO - Avg. fwd time: 8.4475 / Avg. bwd time: 12.3461 / Avg. batch time: 541.0539 (ms) / GPU bubble ratio: 69.25%
[rank3]:2025-11-16 05:46:59,408 - INFO - Avg. fwd time: 14.3328 / Avg. bwd time: 35.6686 / Avg. batch time: 463.4101 (ms) / GPU bubble ratio: 13.68%
[rank2]:2025-11-16 05:46:59,430 - INFO - Avg. fwd time: 8.4362 / Avg. bwd time: 11.5693 / Avg. batch time: 487.2191 (ms) / GPU bubble ratio: 67.15%
[rank1]:2025-11-16 05:46:59,480 - INFO - Avg. fwd time: 10.5698 / Avg. bwd time: 14.4460 / Avg. batch time: 515.9903 (ms) / GPU bubble ratio: 61.22%
[rank1]:2025-11-16 05:46:59,658 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:46:59,658 - INFO -  step: 550  loss: -8.0000  grad_norm:  0.2990  memory: 10.16GiB(21.39%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank2]:2025-11-16 05:46:59,658 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:46:59,658 - INFO -  step: 550  loss: -8.0000  grad_norm:  0.2990  memory:  7.35GiB(15.47%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank0]:2025-11-16 05:46:59,658 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:46:59,659 - INFO -  step: 550  loss: -8.0000  grad_norm:  0.2990  memory: 15.22GiB(32.04%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank3]:2025-11-16 05:46:59,689 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:46:59,693 - INFO -  step: 550  loss:  0.3342  grad_norm:  0.2990  memory: 19.34GiB(40.71%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank1]:2025-11-16 05:47:41,529 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:47:41,529 - INFO - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:47:41,529 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:47:41,559 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:48:23,265 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:48:23,265 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:48:23,266 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:48:23,295 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:48:43,740 - INFO - Avg. fwd time: 8.4666 / Avg. bwd time: 12.1497 / Avg. batch time: 539.7036 (ms) / GPU bubble ratio: 69.44%
[rank3]:2025-11-16 05:48:43,761 - INFO - Avg. fwd time: 14.3447 / Avg. bwd time: 35.5505 / Avg. batch time: 462.5598 (ms) / GPU bubble ratio: 13.71%
[rank2]:2025-11-16 05:48:43,783 - INFO - Avg. fwd time: 8.4547 / Avg. bwd time: 11.4400 / Avg. batch time: 486.2307 (ms) / GPU bubble ratio: 67.27%
[rank1]:2025-11-16 05:48:43,839 - INFO - Avg. fwd time: 10.5903 / Avg. bwd time: 14.2831 / Avg. batch time: 514.8386 (ms) / GPU bubble ratio: 61.35%
[rank0]:2025-11-16 05:49:04,874 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:49:04,905 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:49:04,873 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:49:04,874 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:49:46,527 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:49:46,557 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:49:46,526 - INFO - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:49:46,526 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:50:24,038 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-11-16 05:50:28,306 - INFO - Avg. fwd time: 8.4840 / Avg. bwd time: 11.9610 / Avg. batch time: 538.4559 (ms) / GPU bubble ratio: 69.62%
[rank0]:2025-11-16 05:50:28,309 - INFO - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:50:28,310 - INFO -  step: 600  loss: -8.0000  grad_norm:  0.2566  memory: 15.22GiB(32.04%)  tps: 7,852  tflops: 61.39  mfu: 19.68%
[rank3]:2025-11-16 05:50:28,243 - INFO - Avg. fwd time: 14.3558 / Avg. bwd time: 35.4416 / Avg. batch time: 461.7760 (ms) / GPU bubble ratio: 13.73%
[rank3]:2025-11-16 05:50:28,338 - INFO - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:50:28,264 - INFO - Avg. fwd time: 8.4718 / Avg. bwd time: 11.3222 / Avg. batch time: 485.3216 (ms) / GPU bubble ratio: 67.37%
[rank2]:2025-11-16 05:50:28,308 - INFO - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:50:28,309 - INFO -  step: 600  loss: -8.0000  grad_norm:  0.2566  memory:  7.35GiB(15.47%)  tps: 7,852  tflops: 61.39  mfu: 19.68%
[rank1]:2025-11-16 05:50:28,286 - INFO - Avg. fwd time: 10.6093 / Avg. bwd time: 14.1345 / Avg. batch time: 513.7812 (ms) / GPU bubble ratio: 61.47%
[rank1]:2025-11-16 05:50:28,309 - INFO - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:50:28,309 - INFO -  step: 600  loss: -8.0000  grad_norm:  0.2566  memory: 10.16GiB(21.39%)  tps: 7,852  tflops: 61.39  mfu: 19.68%
[rank0]:2025-11-16 05:50:28,390 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0550_stage0_step600.svg
[rank3]:2025-11-16 05:50:28,341 - INFO -  step: 600  loss:  0.2972  grad_norm:  0.2566  memory: 19.34GiB(40.71%)  tps: 7,853  tflops: 61.39  mfu: 19.68%
[rank2]:2025-11-16 05:50:28,389 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0550_stage2_step600.svg
[rank1]:2025-11-16 05:50:28,391 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0550_stage1_step600.svg
[rank3]:2025-11-16 05:50:28,490 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0550_real_step600_rank3.svg
[rank3]:> Batch Time: 510.60 ms, GPU Bubble Ratio: 73.84%, 65.69%, 72.45%, 25.24%
[rank3]:2025-11-16 05:50:28,539 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0550_stage3_step600.svg
[rank1]:2025-11-16 05:51:19,604 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:51:19,597 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:51:19,627 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:51:19,619 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:52:01,335 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:52:01,335 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:52:01,334 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:52:01,365 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:52:22,070 - INFO - Avg. fwd time: 8.4733 / Avg. bwd time: 12.0655 / Avg. batch time: 539.2522 (ms) / GPU bubble ratio: 69.53%
[rank3]:2025-11-16 05:52:22,090 - INFO - Avg. fwd time: 14.3512 / Avg. bwd time: 35.5092 / Avg. batch time: 462.2830 (ms) / GPU bubble ratio: 13.71%
[rank2]:2025-11-16 05:52:22,114 - INFO - Avg. fwd time: 8.4607 / Avg. bwd time: 11.3979 / Avg. batch time: 485.9222 (ms) / GPU bubble ratio: 67.31%
[rank1]:2025-11-16 05:52:22,168 - INFO - Avg. fwd time: 10.5967 / Avg. bwd time: 14.2288 / Avg. batch time: 514.4735 (ms) / GPU bubble ratio: 61.40%
[rank3]:2025-11-16 05:52:43,214 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:52:43,185 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:52:43,185 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:52:43,185 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:53:25,179 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:53:25,211 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:53:25,179 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:53:25,179 - INFO - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:54:02,891 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank3]:2025-11-16 05:54:06,805 - INFO - Avg. fwd time: 14.3668 / Avg. bwd time: 35.4160 / Avg. batch time: 461.6628 (ms) / GPU bubble ratio: 13.73%
[rank2]:2025-11-16 05:54:06,828 - INFO - Avg. fwd time: 8.4768 / Avg. bwd time: 11.2903 / Avg. batch time: 485.1873 (ms) / GPU bubble ratio: 67.41%
[rank0]:2025-11-16 05:54:06,837 - INFO - Avg. fwd time: 8.4899 / Avg. bwd time: 11.9019 / Avg. batch time: 538.2149 (ms) / GPU bubble ratio: 69.69%
[rank1]:2025-11-16 05:54:06,881 - INFO - Avg. fwd time: 10.6145 / Avg. bwd time: 14.0940 / Avg. batch time: 513.6020 (ms) / GPU bubble ratio: 61.51%
[rank0]:2025-11-16 05:54:07,062 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:54:07,062 - INFO -  step: 650  loss: -8.0000  grad_norm:  0.9263  memory: 15.22GiB(32.04%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank3]:2025-11-16 05:54:07,093 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:54:07,096 - INFO -  step: 650  loss:  0.3272  grad_norm:  0.9263  memory: 19.34GiB(40.71%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank2]:2025-11-16 05:54:07,061 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:54:07,061 - INFO -  step: 650  loss: -8.0000  grad_norm:  0.9263  memory:  7.35GiB(15.47%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank1]:2025-11-16 05:54:07,061 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:54:07,062 - INFO -  step: 650  loss: -8.0000  grad_norm:  0.9263  memory: 10.16GiB(21.39%)  tps: 7,490  tflops: 58.55  mfu: 18.77%
[rank0]:2025-11-16 05:54:48,801 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:54:48,831 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:54:48,801 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:54:48,801 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:55:30,460 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:55:30,459 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:55:30,492 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:55:30,459 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:55:51,365 - INFO - Avg. fwd time: 8.4911 / Avg. bwd time: 11.1904 / Avg. batch time: 484.4376 (ms) / GPU bubble ratio: 67.50%
[rank3]:2025-11-16 05:55:51,344 - INFO - Avg. fwd time: 14.3770 / Avg. bwd time: 35.3254 / Avg. batch time: 461.0175 (ms) / GPU bubble ratio: 13.75%
[rank0]:2025-11-16 05:55:51,408 - INFO - Avg. fwd time: 8.5043 / Avg. bwd time: 11.7442 / Avg. batch time: 537.1788 (ms) / GPU bubble ratio: 69.84%
[rank1]:2025-11-16 05:55:51,388 - INFO - Avg. fwd time: 10.6303 / Avg. bwd time: 13.9689 / Avg. batch time: 512.7263 (ms) / GPU bubble ratio: 61.62%
[rank0]:2025-11-16 05:56:12,250 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:56:12,249 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:56:12,281 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:56:12,249 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:56:53,936 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:56:53,937 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:56:53,937 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:56:53,966 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:57:31,382 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-11-16 05:57:35,243 - INFO - Avg. fwd time: 8.5160 / Avg. bwd time: 11.6176 / Avg. batch time: 536.3253 (ms) / GPU bubble ratio: 69.97%
[rank3]:2025-11-16 05:57:35,261 - INFO - Avg. fwd time: 14.3833 / Avg. bwd time: 35.2521 / Avg. batch time: 460.4809 (ms) / GPU bubble ratio: 13.77%
[rank2]:2025-11-16 05:57:35,275 - INFO - Avg. fwd time: 8.5026 / Avg. bwd time: 11.1110 / Avg. batch time: 483.8158 (ms) / GPU bubble ratio: 67.57%
[rank1]:2025-11-16 05:57:35,336 - INFO - Avg. fwd time: 10.6430 / Avg. bwd time: 13.8692 / Avg. batch time: 512.0027 (ms) / GPU bubble ratio: 61.70%
[rank1]:2025-11-16 05:57:35,513 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:57:35,513 - INFO -  step: 700  loss: -8.0000  grad_norm:  0.6787  memory: 10.16GiB(21.39%)  tps: 7,860  tflops: 61.44  mfu: 19.69%
[rank0]:2025-11-16 05:57:35,513 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:57:35,514 - INFO -  step: 700  loss: -8.0000  grad_norm:  0.6787  memory: 15.22GiB(32.04%)  tps: 7,860  tflops: 61.44  mfu: 19.69%
[rank3]:2025-11-16 05:57:35,544 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:57:35,547 - INFO -  step: 700  loss:  0.2972  grad_norm:  0.6787  memory: 19.34GiB(40.71%)  tps: 7,860  tflops: 61.45  mfu: 19.69%
[rank2]:2025-11-16 05:57:35,513 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:57:35,513 - INFO -  step: 700  loss: -8.0000  grad_norm:  0.6787  memory:  7.35GiB(15.47%)  tps: 7,860  tflops: 61.44  mfu: 19.69%
[rank2]:2025-11-16 05:57:35,597 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0557_stage2_step700.svg
[rank1]:2025-11-16 05:57:35,600 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0557_stage1_step700.svg
[rank0]:2025-11-16 05:57:35,597 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0557_stage0_step700.svg
[rank3]:2025-11-16 05:57:35,695 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0557_real_step700_rank3.svg
[rank3]:> Batch Time: 510.54 ms, GPU Bubble Ratio: 73.83%, 65.66%, 72.43%, 25.03%
[rank3]:2025-11-16 05:57:35,746 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0557_stage3_step700.svg
[rank3]:2025-11-16 05:58:17,419 - INFO - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:58:17,388 - INFO - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:58:17,387 - INFO - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:58:17,387 - INFO - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:59:08,439 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:59:08,462 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:59:08,455 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:59:08,432 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 05:59:28,996 - INFO - Avg. fwd time: 8.5071 / Avg. bwd time: 11.6979 / Avg. batch time: 536.9134 (ms) / GPU bubble ratio: 69.89%
[rank3]:2025-11-16 05:59:29,011 - INFO - Avg. fwd time: 14.3775 / Avg. bwd time: 35.3035 / Avg. batch time: 460.8460 (ms) / GPU bubble ratio: 13.76%
[rank2]:2025-11-16 05:59:29,027 - INFO - Avg. fwd time: 8.4937 / Avg. bwd time: 11.1701 / Avg. batch time: 484.2541 (ms) / GPU bubble ratio: 67.51%
[rank1]:2025-11-16 05:59:29,087 - INFO - Avg. fwd time: 10.6332 / Avg. bwd time: 13.9428 / Avg. batch time: 512.5121 (ms) / GPU bubble ratio: 61.64%
[rank0]:2025-11-16 05:59:50,156 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-11-16 05:59:50,155 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-11-16 05:59:50,155 - INFO - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-11-16 05:59:50,186 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:00:31,904 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:00:31,905 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:00:31,904 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:00:31,936 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:01:09,455 - INFO - [GC] Peforming periodical GC collection 0.01 seconds
[rank2]:2025-11-16 06:01:13,610 - INFO - Avg. fwd time: 8.5063 / Avg. bwd time: 11.0850 / Avg. batch time: 483.5981 (ms) / GPU bubble ratio: 67.59%
[rank2]:2025-11-16 06:01:13,656 - INFO - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:01:13,657 - INFO -  step: 750  loss: -8.0000  grad_norm:  0.1535  memory:  7.35GiB(15.47%)  tps: 7,511  tflops: 58.71  mfu: 18.82%
[rank3]:2025-11-16 06:01:13,588 - INFO - Avg. fwd time: 14.3853 / Avg. bwd time: 35.2251 / Avg. batch time: 460.2806 (ms) / GPU bubble ratio: 13.77%
[rank0]:2025-11-16 06:01:13,654 - INFO - Avg. fwd time: 8.5198 / Avg. bwd time: 11.5699 / Avg. batch time: 536.0217 (ms) / GPU bubble ratio: 70.02%
[rank0]:2025-11-16 06:01:13,657 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:01:13,658 - INFO -  step: 750  loss: -8.0000  grad_norm:  0.1535  memory: 15.22GiB(32.04%)  tps: 7,511  tflops: 58.71  mfu: 18.82%
[rank1]:2025-11-16 06:01:13,633 - INFO - Avg. fwd time: 10.6467 / Avg. bwd time: 13.8361 / Avg. batch time: 511.7491 (ms) / GPU bubble ratio: 61.73%
[rank1]:2025-11-16 06:01:13,657 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:01:13,657 - INFO -  step: 750  loss: -8.0000  grad_norm:  0.1535  memory: 10.16GiB(21.39%)  tps: 7,511  tflops: 58.71  mfu: 18.82%
[rank3]:2025-11-16 06:01:13,686 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:01:13,689 - INFO -  step: 750  loss:  0.3180  grad_norm:  0.1535  memory: 19.34GiB(40.71%)  tps: 7,511  tflops: 58.72  mfu: 18.82%
[rank2]:2025-11-16 06:01:55,405 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:01:55,405 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:01:55,405 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:01:55,436 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:02:37,106 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:02:37,105 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:02:37,137 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:02:37,106 - INFO - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:02:57,709 - INFO - Avg. fwd time: 8.5163 / Avg. bwd time: 11.0167 / Avg. batch time: 483.0773 (ms) / GPU bubble ratio: 67.65%
[rank3]:2025-11-16 06:02:57,695 - INFO - Avg. fwd time: 14.3917 / Avg. bwd time: 35.1631 / Avg. batch time: 459.8338 (ms) / GPU bubble ratio: 13.79%
[rank0]:2025-11-16 06:02:57,676 - INFO - Avg. fwd time: 8.5296 / Avg. bwd time: 11.4605 / Avg. batch time: 535.3014 (ms) / GPU bubble ratio: 70.13%
[rank1]:2025-11-16 06:02:57,769 - INFO - Avg. fwd time: 10.6574 / Avg. bwd time: 13.7505 / Avg. batch time: 511.1413 (ms) / GPU bubble ratio: 61.80%
[rank2]:2025-11-16 06:03:18,823 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:03:18,824 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:03:18,823 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:03:18,853 - INFO - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:04:00,500 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:04:00,500 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:04:00,500 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:04:00,532 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:04:38,055 - INFO - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-11-16 06:04:42,008 - INFO - Avg. fwd time: 8.5405 / Avg. bwd time: 11.3408 / Avg. batch time: 534.5131 (ms) / GPU bubble ratio: 70.24%
[rank3]:2025-11-16 06:04:42,027 - INFO - Avg. fwd time: 14.3988 / Avg. bwd time: 35.0948 / Avg. batch time: 459.3441 (ms) / GPU bubble ratio: 13.80%
[rank2]:2025-11-16 06:04:42,052 - INFO - Avg. fwd time: 8.5273 / Avg. bwd time: 10.9417 / Avg. batch time: 482.5066 (ms) / GPU bubble ratio: 67.72%
[rank1]:2025-11-16 06:04:42,108 - INFO - Avg. fwd time: 10.6693 / Avg. bwd time: 13.6566 / Avg. batch time: 510.4754 (ms) / GPU bubble ratio: 61.88%
[rank2]:2025-11-16 06:04:42,292 - INFO - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank2]:2025-11-16 06:04:42,292 - INFO -  step: 800  loss: -8.0000  grad_norm:  0.1238  memory:  7.35GiB(15.47%)  tps: 7,853  tflops: 61.39  mfu: 19.68%
[rank2]:2025-11-16 06:04:42,292 - INFO -  final step: 800  loss: -8.0000  grad_norm:  0.1238  tps: 7,954  tflops: 62.18  mfu: 18.19%
[rank2]:2025-11-16 06:04:42,292 - INFO - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-11-16 06:04:42,293 - INFO - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-11-16 06:04:42,292 - INFO - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-11-16 06:04:42,293 - INFO -  step: 800  loss: -8.0000  grad_norm:  0.1238  memory: 15.22GiB(32.04%)  tps: 7,853  tflops: 61.39  mfu: 19.68%
[rank0]:2025-11-16 06:04:42,293 - INFO -  final step: 800  loss: -8.0000  grad_norm:  0.1238  tps: 7,955  tflops: 62.19  mfu: 18.20%
[rank0]:2025-11-16 06:04:42,293 - INFO - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-11-16 06:04:42,294 - INFO - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-11-16 06:04:42,323 - INFO - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-11-16 06:04:42,326 - INFO -  step: 800  loss:  0.2993  grad_norm:  0.1238  memory: 19.34GiB(40.71%)  tps: 7,853  tflops: 61.39  mfu: 19.68%
[rank3]:2025-11-16 06:04:42,327 - INFO -  final step: 800  loss:  0.2993  grad_norm:  0.1238  tps: 7,959  tflops: 62.22  mfu: 18.32%
[rank3]:2025-11-16 06:04:42,327 - INFO - Saving the checkpoint (or staging if async is enabled).
[rank3]:2025-11-16 06:04:42,328 - INFO - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-11-16 06:04:42,292 - INFO - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank1]:2025-11-16 06:04:42,292 - INFO -  step: 800  loss: -8.0000  grad_norm:  0.1238  memory: 10.16GiB(21.39%)  tps: 7,853  tflops: 61.39  mfu: 19.68%
[rank1]:2025-11-16 06:04:42,292 - INFO -  final step: 800  loss: -8.0000  grad_norm:  0.1238  tps: 7,955  tflops: 62.19  mfu: 18.21%
[rank1]:2025-11-16 06:04:42,293 - INFO - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-11-16 06:04:42,293 - INFO - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-11-16 06:04:44,219 - INFO - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank2]:2025-11-16 06:04:44,286 - INFO - Frozen Ratio History of Rank 2 (Stage 2)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank2/251116_0604_stage2_final800.svg
[rank0]:2025-11-16 06:04:44,288 - INFO - Frozen Ratio History of Rank 0 (Stage 0)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank0/251116_0604_stage0_final800.svg
[rank1]:2025-11-16 06:04:44,288 - INFO - Frozen Ratio History of Rank 1 (Stage 1)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank1/251116_0604_stage1_final800.svg
[rank2]:2025-11-16 06:04:44,444 - INFO - Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/frozen_params_histogram/251116_0604_rank2_stage2.svg
[rank2]:	> Counts Sum: 1947, Total Sum: 2700 (72.11%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 16.0, 10.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 32.0, 12.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 60.0, 17.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 32.0, 26.66]
[rank2]:2025-11-16 06:04:44,444 - INFO - Destroying the purge thread.
[rank0]:2025-11-16 06:04:44,449 - INFO - Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/frozen_params_histogram/251116_0604_rank0_stage0.svg
[rank0]:	> Counts Sum: 1945, Total Sum: 2775 (70.09%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 58.66, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 32.0, 26.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 1.33]
[rank0]:2025-11-16 06:04:44,449 - INFO - Sleeping 2 seconds for other ranks to complete
[rank3]:2025-11-16 06:04:44,381 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0604_real_final800_rank3.svg
[rank3]:> Batch Time: 511.95 ms, GPU Bubble Ratio: 73.27%, 65.83%, 72.57%, 25.40%
[rank1]:2025-11-16 06:04:44,444 - INFO - Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/frozen_params_histogram/251116_0604_rank1_stage1.svg
[rank1]:	> Counts Sum: 2378, Total Sum: 3375 (70.46%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 18.66, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 34.66, 54.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 1.33, 73.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 1.33]
[rank1]:2025-11-16 06:04:44,444 - INFO - Destroying the purge thread.
[rank3]:2025-11-16 06:04:44,527 - INFO - Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/pipeline_schedule/251116_0604_thry_final800_rank3.svg
[rank3]:> Batch Time: 355.27 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:2025-11-16 06:04:44,578 - INFO - Frozen Ratio History of Rank 3 (Stage 3)  is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/freeze_ratio_history/rank3/251116_0604_stage3_final800.svg
[rank1]:2025-11-16 06:04:44,674 - INFO - Process group destroyed
[rank2]:2025-11-16 06:04:44,680 - INFO - Process group destroyed
[rank3]:2025-11-16 06:04:44,714 - INFO - Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1/frozen_params_histogram/251116_0604_rank3_stage3.svg
[rank3]:	> Counts Sum: 1423, Total Sum: 2175 (65.43%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 6.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 57.33, 1.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 40.0, 0.0, 0.0]
[rank3]:2025-11-16 06:04:44,715 - INFO - Destroying the purge thread.
[rank3]:wandb: updating run metadata
[rank3]:wandb: uploading history steps 15-16, summary, console lines 320-333
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–ˆâ–‡â–„â–‚â–„â–ƒâ–‚â–â–â–â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–ˆâ–‡â–„â–‚â–„â–ƒâ–‚â–â–â–â–â–â–â–â–â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 4.11692
[rank3]:wandb:               final/avg_loss 0.29927
[rank3]:wandb:             final/avg_mfu(%) 18.32198
[rank3]:wandb:             final/avg_tflops 62.22249
[rank3]:wandb:    final/avg_throughput(tps) 7959.3449
[rank3]:wandb:              final/grad_norm 0.12381
[rank3]:wandb:               final/max_loss 0.29927
[rank3]:wandb:                    grad_norm 0.12381
[rank3]:wandb: loss_metrics/global_avg_loss 0.29927
[rank3]:wandb: loss_metrics/global_max_loss 0.29927
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1116_1F1B_APF_th1e-2_42_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/stgt7p5m
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1116_1F1B_APF_th1e-2_42_dm1/20251116-0506/wandb/run-20251116_050621-stgt7p5m/logs
[rank3]:2025-11-16 06:04:46,198 - INFO - Process group destroyed
[rank0]:2025-11-16 06:04:46,449 - INFO - Training completed
[rank0]:2025-11-16 06:04:46,450 - INFO - Destroying the purge thread.
[rank0]:2025-11-16 06:04:46,698 - INFO - Process group destroyed
[rank2]:Stage 2: Modules to keep: {'layers.11', 'layers.9', 'layers.12', 'layers.10'}
[rank1]:Stage 1: Modules to keep: {'layers.7', 'layers.6', 'layers.5', 'layers.4', 'layers.8'}
[rank0]:Stage 0: Modules to keep: {'layers.2', 'layers.1', 'tok_embeddings', 'layers.3', 'layers.0'}
[rank3]:Stage 3: Modules to keep: {'layers.14', 'output', 'layers.13', 'layers.15', 'norm'}
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1116.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "APF configuration experiment on different threshold values."
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1116_1F1B_APF_th1e-2_42_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 16
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 42
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 2
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1116_1F1B_APF_th1e-2_42_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: True
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.01
[rank3]:		- percentile: 80
[rank3]:
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
