
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 12. 26. (ê¸ˆ) 08:00:35 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 1,2,3,4
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/1226_1F1B_APF_th0.2_42.log
âœ”ï¸APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged

âœ”ï¸Running with APF (threshold=0.2) x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml --job.description="APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged
" --parallelism.pipeline_parallel_degree=4  --freezing.freeze --freezing.metric_type=apf --freezing.threshold=0.2
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank0]:2025-12-26 08:00:42,027 - Starting job: "APF configuration experiment on different threshold values.
[rank0]:1226: everything same as 1116, but debugged
[rank0]:"
[rank1]:2025-12-26 08:00:42,025 - Starting job: "APF configuration experiment on different threshold values.
[rank1]:1226: everything same as 1116, but debugged
[rank1]:"
[rank2]:2025-12-26 08:00:42,036 - Starting job: "APF configuration experiment on different threshold values.
[rank2]:1226: everything same as 1116, but debugged
[rank2]:"
[rank3]:2025-12-26 08:00:42,153 - Starting job: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank0]:2025-12-26 08:00:42,299 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-26 08:00:42,301 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 08:00:42,304 - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-12-26 08:00:42,305 - Loading tokenizer from tokenizer.json
[rank1]:2025-12-26 08:00:42,285 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-12-26 08:00:42,287 - Building 1-D device mesh with ['pp'], [4]
[rank2]:2025-12-26 08:00:42,330 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:2025-12-26 08:00:42,332 - Building 1-D device mesh with ['pp'], [4]
[rank3]:2025-12-26 08:00:42,458 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-12-26 08:00:42,461 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 08:00:42,697 - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank0]:2025-12-26 08:00:45,884 - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank0]:2025-12-26 08:00:46,036 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-26 08:00:46,079 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 08:00:46,080 - Model llama3 1B size: 1,498,482,688 total parameters
[rank0]:2025-12-26 08:00:46,107 - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-12-26 08:00:46,107 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-26 08:00:46,377 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-26 08:00:46,295 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 08:00:46,295 - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-12-26 08:00:46,296 - CUDA memory usage for model: 1.90GiB(3.99%)
[rank2]:2025-12-26 08:00:46,413 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-26 08:00:46,440 - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-12-26 08:00:46,440 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-26 08:00:46,595 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank1]:2025-12-26 08:00:46,635 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 08:00:46,662 - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-12-26 08:00:46,662 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-26 08:00:46,625 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-26 08:00:46,625 - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-12-26 08:00:46,626 - CUDA memory usage for model: 0.92GiB(1.94%)
[rank1]:2025-12-26 08:00:46,848 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 08:00:46,848 - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-12-26 08:00:46,849 - CUDA memory usage for model: 1.13GiB(2.39%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run stxg55rz
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.2_42_dm1/20251226-0800/wandb/run-20251226_080047-stxg55rz
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1226_1F1B_APF_th0.2_42_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/stxg55rz
[rank3]:2025-12-26 08:00:48,692 - WandB logging enabled
[rank3]:2025-12-26 08:00:48,692 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-12-26 08:00:48,731 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 08:00:48,760 - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-12-26 08:00:48,760 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank3]:2025-12-26 08:00:48,954 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 08:00:48,955 - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-12-26 08:00:48,956 - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-12-26 08:00:48,972 - Mixed precision training with TP or PP is handled by autocast
[rank1]:2025-12-26 08:00:48,973 - Mixed precision training with TP or PP is handled by autocast
[rank2]:2025-12-26 08:00:48,973 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 08:00:48,972 - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th0.2_42_dm1
[rank0]:2025-12-26 08:00:48,973 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 08:00:48,973 - Trainer is initialized with local batch size 16, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-12-26 08:00:48,973 - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank0]:2025-12-26 08:00:51,487 - [GC] GC collection for checkpoint loading. 0.00 seconds
[rank0]:2025-12-26 08:00:51,487 - Finished loading the checkpoint in 2.51 seconds.
[rank0]:2025-12-26 08:00:51,487 - Training starts at step 1
[rank1]:2025-12-26 08:00:57,194 -  step:  1  loss: -8.0000  grad_norm: 116.5372  memory:  7.10GiB(14.94%)  tps: 3,103  tflops: 24.26  mfu: 7.78%
[rank1]:2025-12-26 08:00:57,195 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-12-26 08:00:57,192 -  step:  1  loss: -8.0000  grad_norm: 116.5372  memory:  5.20GiB(10.94%)  tps: 3,040  tflops: 23.77  mfu: 7.62%
[rank2]:2025-12-26 08:00:57,192 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-12-26 08:00:57,202 -  step:  1  loss: 10.6088  grad_norm: 116.5372  memory: 12.97GiB(27.31%)  tps: 3,869  tflops: 30.25  mfu: 9.70%
[rank3]:2025-12-26 08:00:57,203 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-26 08:00:57,230 -  step:  1  loss: -8.0000  grad_norm: 116.5372  memory:  9.62GiB(20.24%)  tps: 2,939  tflops: 22.97  mfu: 7.36%
[rank0]:2025-12-26 08:00:57,230 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-12-26 08:02:59,617 - Avg. fwd time: 7.3712 / Avg. bwd time: 19.9371 / Avg. batch time: 543.4669 (ms) / GPU bubble ratio: 59.80%
[rank3]:2025-12-26 08:02:59,592 - Avg. fwd time: 13.4369 / Avg. bwd time: 42.4343 / Avg. batch time: 510.5780 (ms) / GPU bubble ratio: 12.46%
[rank1]:2025-12-26 08:02:59,647 - Avg. fwd time: 9.2806 / Avg. bwd time: 24.7634 / Avg. batch time: 583.4418 (ms) / GPU bubble ratio: 53.32%
[rank0]:2025-12-26 08:02:59,676 - Avg. fwd time: 7.6339 / Avg. bwd time: 24.9280 / Avg. batch time: 622.1186 (ms) / GPU bubble ratio: 58.13%
[rank0]:2025-12-26 08:05:02,949 - [GC] Peforming periodical GC collection 0.00 seconds
[rank2]:2025-12-26 08:05:07,987 - Avg. fwd time: 7.3696 / Avg. bwd time: 19.9784 / Avg. batch time: 545.5170 (ms) / GPU bubble ratio: 59.89%
[rank3]:2025-12-26 08:05:07,961 - Avg. fwd time: 13.5677 / Avg. bwd time: 42.6148 / Avg. batch time: 512.9952 (ms) / GPU bubble ratio: 12.39%
[rank1]:2025-12-26 08:05:08,017 - Avg. fwd time: 9.2790 / Avg. bwd time: 24.8159 / Avg. batch time: 585.1178 (ms) / GPU bubble ratio: 53.38%
[rank2]:2025-12-26 08:05:08,068 -  step: 50  loss: -8.0000  grad_norm: 13.1818  memory:  6.98GiB(14.69%)  tps: 6,400  tflops: 50.03  mfu: 16.04%
[rank0]:2025-12-26 08:05:08,046 - Avg. fwd time: 7.6406 / Avg. bwd time: 24.9712 / Avg. batch time: 623.4680 (ms) / GPU bubble ratio: 58.15%
[rank0]:2025-12-26 08:05:08,082 -  step: 50  loss: -8.0000  grad_norm: 13.1818  memory: 13.42GiB(28.26%)  tps: 6,401  tflops: 50.04  mfu: 16.04%
[rank3]:2025-12-26 08:05:08,080 -  step: 50  loss:  9.9250  grad_norm: 13.1818  memory: 16.39GiB(34.50%)  tps: 6,400  tflops: 50.03  mfu: 16.04%
[rank1]:2025-12-26 08:05:08,071 -  step: 50  loss: -8.0000  grad_norm: 13.1818  memory:  9.50GiB(19.99%)  tps: 6,400  tflops: 50.03  mfu: 16.04%
[rank3]:2025-12-26 08:05:54,008 - Freezing Ratio: [Stage3] 0.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:05:54,226 - Freezing Ratio: [Stage2] 0.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:05:54,280 - Freezing Ratio: [Stage0] 0.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:05:54,253 - Freezing Ratio: [Stage1] 0.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:06:45,771 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:06:45,764 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:06:45,784 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:06:45,791 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:07:06,165 - Avg. fwd time: 13.6583 / Avg. bwd time: 40.9798 / Avg. batch time: 500.5988 (ms) / GPU bubble ratio: 12.68%
[rank1]:2025-12-26 08:07:06,195 - Avg. fwd time: 9.4125 / Avg. bwd time: 23.7142 / Avg. batch time: 570.4558 (ms) / GPU bubble ratio: 53.54%
[rank2]:2025-12-26 08:07:06,179 - Avg. fwd time: 7.4883 / Avg. bwd time: 19.0909 / Avg. batch time: 532.0962 (ms) / GPU bubble ratio: 60.04%
[rank0]:2025-12-26 08:07:06,208 - Avg. fwd time: 7.7594 / Avg. bwd time: 23.6323 / Avg. batch time: 607.3194 (ms) / GPU bubble ratio: 58.65%
[rank2]:2025-12-26 08:07:19,779 - Freezing Ratio: [Stage2] 0.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:07:19,799 - Freezing Ratio: [Stage3] 0.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:07:19,801 - Freezing Ratio: [Stage0] 0.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:07:19,799 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:08:11,337 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:08:11,358 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:08:11,365 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:08:11,342 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:08:45,196 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:08:45,196 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:08:45,199 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:08:45,201 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:08:45,196 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:08:48,487 - Avg. fwd time: 7.6819 / Avg. bwd time: 17.6224 / Avg. batch time: 509.1792 (ms) / GPU bubble ratio: 60.24%
[rank2]:2025-12-26 08:08:48,512 -  step: 100  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 7,432  tflops: 58.10  mfu: 18.62%
[rank3]:2025-12-26 08:08:48,473 - Avg. fwd time: 13.7396 / Avg. bwd time: 38.2303 / Avg. batch time: 479.2253 (ms) / GPU bubble ratio: 13.24%
[rank3]:2025-12-26 08:08:48,513 -  step: 100  loss:  9.0691  grad_norm:  0.0257  memory: 19.83GiB(41.74%)  tps: 7,433  tflops: 58.11  mfu: 18.62%
[rank0]:2025-12-26 08:08:48,510 - Avg. fwd time: 7.9501 / Avg. bwd time: 21.3676 / Avg. batch time: 580.1321 (ms) / GPU bubble ratio: 59.57%
[rank0]:2025-12-26 08:08:48,512 -  step: 100  loss: -8.0000  grad_norm:  0.0257  memory: 15.36GiB(32.33%)  tps: 7,433  tflops: 58.11  mfu: 18.62%
[rank1]:2025-12-26 08:08:48,503 - Avg. fwd time: 9.6388 / Avg. bwd time: 21.8871 / Avg. batch time: 545.6247 (ms) / GPU bubble ratio: 53.78%
[rank1]:2025-12-26 08:08:48,512 -  step: 100  loss: -8.0000  grad_norm:  0.0000  memory: 10.69GiB(22.50%)  tps: 7,432  tflops: 58.10  mfu: 18.62%
[rank2]:2025-12-26 08:08:48,582 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0808_stage2_step100.svg
[rank0]:2025-12-26 08:08:48,582 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0808_stage0_step100.svg
[rank1]:2025-12-26 08:08:48,585 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0808_stage1_step100.svg
[rank3]:2025-12-26 08:08:48,679 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0808_step100_rank3.svg
[rank3]:			> Batch Time: 414.66 ms, GPU Bubble Ratio: 67.05%, 57.98%, 66.17%, 31.39%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-204ms    | [S0,MB3,B]  232-7-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  276-8-284ms    | [S0,MB5,B]  319-7-326ms    | [S0,MB6,B]  361-7-369ms    | [S0,MB7,B]  406-7-414ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-182ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  392-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-299ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  379-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-348ms   | [S3,MB7,B]  354-21-376ms  
[rank3]:2025-12-26 08:08:48,724 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0808_stage3_step100.svg
[rank2]:2025-12-26 08:09:18,787 - Freezing Ratio: [Stage2] 0.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:09:18,802 - Freezing Ratio: [Stage3] 0.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:09:18,803 - Freezing Ratio: [Stage0] 0.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:09:18,800 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:10:10,370 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:10:10,392 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:10:10,376 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:10:10,403 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:10:30,388 - Avg. fwd time: 7.7970 / Avg. bwd time: 16.7403 / Avg. batch time: 495.4596 (ms) / GPU bubble ratio: 60.38%
[rank1]:2025-12-26 08:10:30,405 - Avg. fwd time: 9.7749 / Avg. bwd time: 20.7910 / Avg. batch time: 530.7599 (ms) / GPU bubble ratio: 53.93%
[rank3]:2025-12-26 08:10:30,373 - Avg. fwd time: 13.7856 / Avg. bwd time: 36.5743 / Avg. batch time: 466.3208 (ms) / GPU bubble ratio: 13.60%
[rank0]:2025-12-26 08:10:30,412 - Avg. fwd time: 8.0427 / Avg. bwd time: 19.3481 / Avg. batch time: 563.1940 (ms) / GPU bubble ratio: 61.09%
[rank2]:2025-12-26 08:10:43,887 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:10:43,901 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:10:43,901 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:10:43,902 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:11:17,319 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:11:17,331 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:11:17,333 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:11:17,335 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:11:51,214 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:11:51,214 - Freezing Ratio: [Stage3] 0.03, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:11:51,211 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:11:51,220 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:11:51,221 - Freezing Ratio: [Stage0] 0.05, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:11:56,267 - Avg. fwd time: 13.8477 / Avg. bwd time: 34.1791 / Avg. batch time: 447.6343 (ms) / GPU bubble ratio: 14.17%
[rank2]:2025-12-26 08:11:56,293 - Avg. fwd time: 7.9659 / Avg. bwd time: 15.4695 / Avg. batch time: 475.4504 (ms) / GPU bubble ratio: 60.57%
[rank2]:2025-12-26 08:11:56,376 -  step: 150  loss: -8.0000  grad_norm: 10.5514  memory:  7.91GiB(16.66%)  tps: 8,721  tflops: 68.18  mfu: 21.85%
[rank3]:2025-12-26 08:11:56,389 -  step: 150  loss:  6.6733  grad_norm: 10.5514  memory: 19.83GiB(41.74%)  tps: 8,721  tflops: 68.17  mfu: 21.85%
[rank1]:2025-12-26 08:11:56,324 - Avg. fwd time: 9.9710 / Avg. bwd time: 19.2131 / Avg. batch time: 509.1411 (ms) / GPU bubble ratio: 54.14%
[rank1]:2025-12-26 08:11:56,380 -  step: 150  loss: -8.0000  grad_norm: 10.5514  memory: 10.69GiB(22.50%)  tps: 8,721  tflops: 68.18  mfu: 21.85%
[rank0]:2025-12-26 08:11:56,355 - Avg. fwd time: 8.1930 / Avg. bwd time: 17.0180 / Avg. batch time: 539.2008 (ms) / GPU bubble ratio: 62.59%
[rank0]:2025-12-26 08:11:56,390 -  step: 150  loss: -8.0000  grad_norm: 10.5514  memory: 15.49GiB(32.61%)  tps: 8,721  tflops: 68.17  mfu: 21.85%
[rank2]:2025-12-26 08:12:42,737 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:12:42,744 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:12:42,760 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:12:42,767 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:13:16,243 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:13:16,257 - Freezing Ratio: [Stage3] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:13:16,257 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:13:16,258 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:13:36,107 - Avg. fwd time: 8.0164 / Avg. bwd time: 15.0807 / Avg. batch time: 469.4087 (ms) / GPU bubble ratio: 60.64%
[rank3]:2025-12-26 08:13:36,092 - Avg. fwd time: 13.8724 / Avg. bwd time: 33.4537 / Avg. batch time: 442.0165 (ms) / GPU bubble ratio: 14.35%
[rank1]:2025-12-26 08:13:36,124 - Avg. fwd time: 10.0305 / Avg. bwd time: 18.7318 / Avg. batch time: 502.5964 (ms) / GPU bubble ratio: 54.22%
[rank0]:2025-12-26 08:13:36,130 - Avg. fwd time: 8.2265 / Avg. bwd time: 15.9923 / Avg. batch time: 531.5796 (ms) / GPU bubble ratio: 63.55%
[rank2]:2025-12-26 08:13:49,474 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:13:49,476 - Freezing Ratio: [Stage3] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:13:49,487 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:13:49,487 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:14:23,351 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:14:23,362 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:14:23,371 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:14:23,369 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:14:57,223 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:14:57,231 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:14:57,232 - Freezing Ratio: [Stage0] 0.05, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:14:57,211 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:14:57,227 - Freezing Ratio: [Stage3] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:15:02,325 - Avg. fwd time: 13.9130 / Avg. bwd time: 32.0548 / Avg. batch time: 431.1512 (ms) / GPU bubble ratio: 14.71%
[rank2]:2025-12-26 08:15:02,352 - Avg. fwd time: 8.1151 / Avg. bwd time: 14.3339 / Avg. batch time: 457.7668 (ms) / GPU bubble ratio: 60.77%
[rank1]:2025-12-26 08:15:02,384 - Avg. fwd time: 10.1467 / Avg. bwd time: 17.8051 / Avg. batch time: 490.0091 (ms) / GPU bubble ratio: 54.37%
[rank1]:2025-12-26 08:15:02,440 -  step: 200  loss: -8.0000  grad_norm: 12.8381  memory: 10.83GiB(22.79%)  tps: 8,806  tflops: 68.84  mfu: 22.06%
[rank0]:2025-12-26 08:15:02,415 - Avg. fwd time: 8.3200 / Avg. bwd time: 14.8362 / Avg. batch time: 517.7997 (ms) / GPU bubble ratio: 64.22%
[rank0]:2025-12-26 08:15:02,451 -  step: 200  loss: -8.0000  grad_norm: 12.8381  memory: 15.49GiB(32.61%)  tps: 8,806  tflops: 68.84  mfu: 22.06%
[rank2]:2025-12-26 08:15:02,437 -  step: 200  loss: -8.0000  grad_norm: 12.8381  memory:  7.91GiB(16.66%)  tps: 8,806  tflops: 68.84  mfu: 22.06%
[rank3]:2025-12-26 08:15:02,449 -  step: 200  loss:  4.4164  grad_norm: 12.8381  memory: 19.83GiB(41.74%)  tps: 8,806  tflops: 68.84  mfu: 22.06%
[rank1]:2025-12-26 08:15:02,503 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0815_stage1_step200.svg
[rank0]:2025-12-26 08:15:02,500 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0815_stage0_step200.svg
[rank2]:2025-12-26 08:15:02,500 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0815_stage2_step200.svg
[rank3]:2025-12-26 08:15:02,592 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0815_step200_rank3.svg
[rank3]:			> Batch Time: 412.86 ms, GPU Bubble Ratio: 70.16%, 57.88%, 66.11%, 31.20%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-6-108ms    | [S0,MB4,F]  108-8-117ms    | [S0,MB1,B]  145-6-151ms    | [S0,MB5,F]  151-8-160ms    | [S0,MB2,B]  188-6-195ms    | [S0,MB6,F]  195-8-203ms    | [S0,MB3,B]  232-6-239ms    | [S0,MB7,F]  239-8-247ms    | [S0,MB4,B]  277-6-283ms    | [S0,MB5,B]  319-6-325ms    | [S0,MB6,B]  362-6-368ms    | [S0,MB7,B]  406-6-412ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-10-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  261-10-271ms   | [S1,MB7,F]  275-10-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-358ms   | [S1,MB7,B]  392-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  159-8-167ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  215-8-223ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  336-8-344ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-287ms   | [S3,MB6,F]  290-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 08:15:02,637 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0815_stage3_step200.svg
[rank2]:2025-12-26 08:15:49,003 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:15:49,026 - Freezing Ratio: [Stage3] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:15:49,010 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:15:49,034 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:16:22,750 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:16:22,751 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:16:22,732 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:16:22,733 - Freezing Ratio: [Stage3] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:16:43,092 - Avg. fwd time: 8.1381 / Avg. bwd time: 14.1572 / Avg. batch time: 455.1249 (ms) / GPU bubble ratio: 60.81%
[rank3]:2025-12-26 08:16:43,076 - Avg. fwd time: 13.9254 / Avg. bwd time: 31.7280 / Avg. batch time: 428.6443 (ms) / GPU bubble ratio: 14.79%
[rank1]:2025-12-26 08:16:43,109 - Avg. fwd time: 10.1733 / Avg. bwd time: 17.5897 / Avg. batch time: 487.1405 (ms) / GPU bubble ratio: 54.41%
[rank0]:2025-12-26 08:16:43,122 - Avg. fwd time: 8.3438 / Avg. bwd time: 14.6417 / Avg. batch time: 514.7209 (ms) / GPU bubble ratio: 64.28%
[rank2]:2025-12-26 08:16:56,515 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:16:56,516 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:16:56,527 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:16:56,534 - Freezing Ratio: [Stage0] 0.92, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:17:30,504 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:17:30,513 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:17:30,511 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:17:30,512 - Freezing Ratio: [Stage3] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:18:03,835 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:18:03,849 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:18:03,847 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:18:03,848 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:18:03,849 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:18:07,190 - Avg. fwd time: 8.2108 / Avg. bwd time: 13.6048 / Avg. batch time: 446.4615 (ms) / GPU bubble ratio: 60.91%
[rank2]:2025-12-26 08:18:07,221 -  step: 250  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,867  tflops: 69.31  mfu: 22.22%
[rank3]:2025-12-26 08:18:07,174 - Avg. fwd time: 13.9514 / Avg. bwd time: 30.6914 / Avg. batch time: 420.5565 (ms) / GPU bubble ratio: 15.08%
[rank3]:2025-12-26 08:18:07,223 -  step: 250  loss:  7.3824  grad_norm:  0.0483  memory: 19.83GiB(41.74%)  tps: 8,867  tflops: 69.32  mfu: 22.22%
[rank1]:2025-12-26 08:18:07,207 - Avg. fwd time: 10.2572 / Avg. bwd time: 16.9071 / Avg. batch time: 477.7829 (ms) / GPU bubble ratio: 54.52%
[rank1]:2025-12-26 08:18:07,221 -  step: 250  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,867  tflops: 69.32  mfu: 22.22%
[rank0]:2025-12-26 08:18:07,220 - Avg. fwd time: 8.4060 / Avg. bwd time: 13.6250 / Avg. batch time: 504.3137 (ms) / GPU bubble ratio: 65.05%
[rank0]:2025-12-26 08:18:07,222 -  step: 250  loss: -8.0000  grad_norm:  0.0483  memory: 15.49GiB(32.61%)  tps: 8,867  tflops: 69.32  mfu: 22.22%
[rank2]:2025-12-26 08:18:37,648 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:18:37,667 - Freezing Ratio: [Stage3] 0.03, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:18:37,661 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:18:37,668 - Freezing Ratio: [Stage0] 0.08, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:19:29,119 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:19:29,142 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:19:29,126 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:19:29,150 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:19:49,153 - Avg. fwd time: 8.2147 / Avg. bwd time: 13.5678 / Avg. batch time: 445.9423 (ms) / GPU bubble ratio: 60.92%
[rank3]:2025-12-26 08:19:49,136 - Avg. fwd time: 13.9567 / Avg. bwd time: 30.6278 / Avg. batch time: 420.0912 (ms) / GPU bubble ratio: 15.10%
[rank1]:2025-12-26 08:19:49,171 - Avg. fwd time: 10.2609 / Avg. bwd time: 16.8621 / Avg. batch time: 477.2122 (ms) / GPU bubble ratio: 54.53%
[rank0]:2025-12-26 08:19:49,178 - Avg. fwd time: 8.4079 / Avg. bwd time: 13.5024 / Avg. batch time: 503.6104 (ms) / GPU bubble ratio: 65.19%
[rank2]:2025-12-26 08:20:02,475 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:20:02,487 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:20:02,488 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:20:02,488 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:20:36,412 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:20:36,431 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:20:36,424 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:20:36,432 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:21:10,320 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:21:10,329 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:21:10,330 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:21:10,325 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:21:10,325 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:21:13,609 - Avg. fwd time: 13.9754 / Avg. bwd time: 29.8570 / Avg. batch time: 414.0738 (ms) / GPU bubble ratio: 15.31%
[rank0]:2025-12-26 08:21:13,650 - Avg. fwd time: 8.4594 / Avg. bwd time: 12.8567 / Avg. batch time: 495.9921 (ms) / GPU bubble ratio: 65.62%
[rank0]:2025-12-26 08:21:13,651 -  step: 300  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,788  tflops: 68.70  mfu: 22.02%
[rank2]:2025-12-26 08:21:13,625 - Avg. fwd time: 8.2683 / Avg. bwd time: 13.1577 / Avg. batch time: 439.4974 (ms) / GPU bubble ratio: 61.00%
[rank2]:2025-12-26 08:21:13,651 -  step: 300  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,788  tflops: 68.70  mfu: 22.02%
[rank2]:2025-12-26 08:21:13,700 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0821_stage2_step300.svg
[rank3]:2025-12-26 08:21:13,652 -  step: 300  loss:  6.8053  grad_norm:  0.0989  memory: 19.83GiB(41.74%)  tps: 8,788  tflops: 68.70  mfu: 22.02%
[rank1]:2025-12-26 08:21:13,643 - Avg. fwd time: 10.3233 / Avg. bwd time: 16.3524 / Avg. batch time: 470.2517 (ms) / GPU bubble ratio: 54.62%
[rank1]:2025-12-26 08:21:13,651 -  step: 300  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,788  tflops: 68.70  mfu: 22.02%
[rank1]:2025-12-26 08:21:13,700 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0821_stage1_step300.svg
[rank0]:2025-12-26 08:21:13,700 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0821_stage0_step300.svg
[rank3]:2025-12-26 08:21:13,792 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0821_step300_rank3.svg
[rank3]:			> Batch Time: 415.22 ms, GPU Bubble Ratio: 67.07%, 58.06%, 66.24%, 31.57%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  19-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-7-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  277-8-285ms    | [S0,MB5,B]  320-7-327ms    | [S0,MB6,B]  362-7-370ms    | [S0,MB7,B]  407-7-415ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-11-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-10-241ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-359ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  171-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  292-8-300ms    | [S2,MB7,F]  304-8-313ms    | [S2,MB6,B]  336-8-345ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-85ms     | [S3,MB1,B]  91-20-111ms    | [S3,MB2,F]  114-13-128ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  246-14-260ms   | [S3,MB5,B]  266-21-288ms   | [S3,MB6,F]  290-14-305ms   | [S3,MB6,B]  311-21-333ms   | [S3,MB7,F]  335-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 08:21:13,835 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0821_stage3_step300.svg
[rank2]:2025-12-26 08:21:43,720 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:21:43,732 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:21:43,732 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:21:43,732 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:22:17,033 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:22:17,020 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:22:17,032 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:22:17,033 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:22:37,297 - Avg. fwd time: 8.3137 / Avg. bwd time: 12.8105 / Avg. batch time: 434.0606 (ms) / GPU bubble ratio: 61.07%
[rank3]:2025-12-26 08:22:37,281 - Avg. fwd time: 13.9906 / Avg. bwd time: 29.2032 / Avg. batch time: 408.9588 (ms) / GPU bubble ratio: 15.50%
[rank1]:2025-12-26 08:22:37,316 - Avg. fwd time: 10.3764 / Avg. bwd time: 15.9213 / Avg. batch time: 464.3787 (ms) / GPU bubble ratio: 54.70%
[rank0]:2025-12-26 08:22:37,330 - Avg. fwd time: 8.4933 / Avg. bwd time: 11.9855 / Avg. batch time: 489.2286 (ms) / GPU bubble ratio: 66.51%
[rank0]:2025-12-26 08:22:50,971 - Freezing Ratio: [Stage0] 0.08, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:22:50,951 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:22:50,970 - Freezing Ratio: [Stage3] 0.07, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:22:50,964 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:23:42,444 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:23:42,466 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:23:42,451 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:23:42,474 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:24:15,905 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:24:15,915 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:24:15,918 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:24:15,921 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:24:15,922 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:24:19,237 - Avg. fwd time: 13.9921 / Avg. bwd time: 29.2611 / Avg. batch time: 409.4326 (ms) / GPU bubble ratio: 15.49%
[rank1]:2025-12-26 08:24:19,273 - Avg. fwd time: 10.3718 / Avg. bwd time: 15.9579 / Avg. batch time: 464.9000 (ms) / GPU bubble ratio: 54.69%
[rank0]:2025-12-26 08:24:19,281 - Avg. fwd time: 8.4874 / Avg. bwd time: 11.9752 / Avg. batch time: 489.7337 (ms) / GPU bubble ratio: 66.57%
[rank0]:2025-12-26 08:24:19,282 -  step: 350  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank2]:2025-12-26 08:24:19,255 - Avg. fwd time: 8.3097 / Avg. bwd time: 12.8391 / Avg. batch time: 434.5500 (ms) / GPU bubble ratio: 61.07%
[rank2]:2025-12-26 08:24:19,282 -  step: 350  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank3]:2025-12-26 08:24:19,284 -  step: 350  loss:  4.7243  grad_norm:  0.0444  memory: 19.83GiB(41.74%)  tps: 8,826  tflops: 69.00  mfu: 22.12%
[rank1]:2025-12-26 08:24:19,282 -  step: 350  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank1]:2025-12-26 08:24:49,315 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:24:49,316 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:24:49,303 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:24:49,316 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:25:23,486 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:25:23,485 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:25:23,476 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:25:23,484 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:25:43,751 - Avg. fwd time: 8.3467 / Avg. bwd time: 12.5596 / Avg. batch time: 430.1953 (ms) / GPU bubble ratio: 61.12%
[rank1]:2025-12-26 08:25:43,770 - Avg. fwd time: 10.4148 / Avg. bwd time: 15.6130 / Avg. batch time: 460.1936 (ms) / GPU bubble ratio: 54.75%
[rank3]:2025-12-26 08:25:43,733 - Avg. fwd time: 14.0069 / Avg. bwd time: 28.7387 / Avg. batch time: 405.3697 (ms) / GPU bubble ratio: 15.64%
[rank0]:2025-12-26 08:25:43,785 - Avg. fwd time: 8.5197 / Avg. bwd time: 11.4913 / Avg. batch time: 484.5337 (ms) / GPU bubble ratio: 66.96%
[rank1]:2025-12-26 08:25:57,360 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:25:57,348 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:25:57,367 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:25:57,368 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:26:30,619 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:26:30,608 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:26:30,619 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:26:30,619 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:27:03,995 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:27:03,996 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:27:03,993 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:27:03,981 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:27:03,991 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:27:07,367 - Avg. fwd time: 8.3794 / Avg. bwd time: 12.3149 / Avg. batch time: 426.3629 (ms) / GPU bubble ratio: 61.17%
[rank3]:2025-12-26 08:27:07,349 - Avg. fwd time: 14.0187 / Avg. bwd time: 28.2804 / Avg. batch time: 401.7921 (ms) / GPU bubble ratio: 15.78%
[rank0]:2025-12-26 08:27:07,395 - Avg. fwd time: 8.5396 / Avg. bwd time: 10.8371 / Avg. batch time: 479.7260 (ms) / GPU bubble ratio: 67.69%
[rank0]:2025-12-26 08:27:07,396 -  step: 400  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 9,746  tflops: 76.19  mfu: 24.42%
[rank0]:2025-12-26 08:27:07,450 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0827_stage0_step400.svg
[rank1]:2025-12-26 08:27:07,386 - Avg. fwd time: 10.4527 / Avg. bwd time: 15.3114 / Avg. batch time: 456.0552 (ms) / GPU bubble ratio: 54.81%
[rank1]:2025-12-26 08:27:07,396 -  step: 400  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 9,746  tflops: 76.19  mfu: 24.42%
[rank1]:2025-12-26 08:27:07,450 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0827_stage1_step400.svg
[rank2]:2025-12-26 08:27:07,396 -  step: 400  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,746  tflops: 76.19  mfu: 24.42%
[rank2]:2025-12-26 08:27:07,450 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0827_stage2_step400.svg
[rank3]:2025-12-26 08:27:07,398 -  step: 400  loss:  3.3366  grad_norm:  0.0056  memory: 19.83GiB(41.74%)  tps: 9,746  tflops: 76.19  mfu: 24.42%
[rank3]:2025-12-26 08:27:07,530 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0827_step400_rank3.svg
[rank3]:			> Batch Time: 405.50 ms, GPU Bubble Ratio: 82.67%, 57.02%, 65.46%, 29.92%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-27ms      | [S0,MB3,F]  27-8-36ms      | [S0,MB0,B]  102-0-102ms    | [S0,MB4,F]  102-8-110ms    | [S0,MB1,B]  145-0-145ms    | [S0,MB5,F]  145-8-153ms    | [S0,MB2,B]  188-0-188ms    | [S0,MB6,F]  188-8-196ms    | [S0,MB3,B]  232-0-232ms    | [S0,MB7,F]  232-8-240ms    | [S0,MB4,B]  276-0-276ms    | [S0,MB5,B]  319-0-319ms    | [S0,MB6,B]  361-0-361ms    | [S0,MB7,B]  405-0-405ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-139ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-182ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  216-10-226ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  391-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-28ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  258-8-267ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  379-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  28-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  176-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-242ms   | [S3,MB5,F]  245-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  333-14-348ms   | [S3,MB7,B]  354-21-376ms  
[rank3]:2025-12-26 08:27:07,577 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0827_stage3_step400.svg
[rank3]:2025-12-26 08:27:26,423 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-26 08:27:26,598 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-26 08:27:26,613 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 08:27:26,612 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 08:27:37,497 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:27:37,485 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:27:37,497 - Freezing Ratio: [Stage3] 0.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:27:37,497 - Freezing Ratio: [Stage0] 0.05, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:28:28,981 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:28:28,974 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:28:28,997 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:28:29,005 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:28:48,987 - Avg. fwd time: 10.4437 / Avg. bwd time: 15.3768 / Avg. batch time: 456.9961 (ms) / GPU bubble ratio: 54.80%
[rank2]:2025-12-26 08:28:48,967 - Avg. fwd time: 8.3722 / Avg. bwd time: 12.3677 / Avg. batch time: 427.2409 (ms) / GPU bubble ratio: 61.17%
[rank3]:2025-12-26 08:28:48,949 - Avg. fwd time: 14.0184 / Avg. bwd time: 28.3817 / Avg. batch time: 402.5980 (ms) / GPU bubble ratio: 15.75%
[rank0]:2025-12-26 08:28:48,996 - Avg. fwd time: 8.5277 / Avg. bwd time: 10.7862 / Avg. batch time: 480.6115 (ms) / GPU bubble ratio: 67.85%
[rank1]:2025-12-26 08:29:02,130 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:29:02,117 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:29:02,129 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:29:02,130 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:29:35,903 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:29:35,890 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:29:35,909 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:29:35,910 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:30:09,874 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:30:09,877 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:30:09,884 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:30:09,885 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:30:09,877 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:30:13,195 - Avg. fwd time: 10.4747 / Avg. bwd time: 15.1199 / Avg. batch time: 453.4327 (ms) / GPU bubble ratio: 54.84%
[rank1]:2025-12-26 08:30:13,205 -  step: 450  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,818  tflops: 68.93  mfu: 22.09%
[rank2]:2025-12-26 08:30:13,175 - Avg. fwd time: 8.3991 / Avg. bwd time: 12.1616 / Avg. batch time: 423.9381 (ms) / GPU bubble ratio: 61.20%
[rank2]:2025-12-26 08:30:13,205 -  step: 450  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,818  tflops: 68.93  mfu: 22.09%
[rank0]:2025-12-26 08:30:13,204 - Avg. fwd time: 8.5546 / Avg. bwd time: 10.5067 / Avg. batch time: 476.7638 (ms) / GPU bubble ratio: 68.02%
[rank0]:2025-12-26 08:30:13,205 -  step: 450  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,818  tflops: 68.93  mfu: 22.09%
[rank3]:2025-12-26 08:30:13,157 - Avg. fwd time: 14.0247 / Avg. bwd time: 27.9894 / Avg. batch time: 399.5108 (ms) / GPU bubble ratio: 15.87%
[rank3]:2025-12-26 08:30:13,207 -  step: 450  loss:  5.3133  grad_norm:  0.0201  memory: 19.83GiB(41.74%)  tps: 8,818  tflops: 68.93  mfu: 22.09%
[rank1]:2025-12-26 08:30:43,124 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:30:43,111 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:30:43,124 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:30:43,123 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:31:16,322 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:31:16,310 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:31:16,322 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:31:16,322 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:31:36,345 - Avg. fwd time: 14.0313 / Avg. bwd time: 27.6385 / Avg. batch time: 396.7518 (ms) / GPU bubble ratio: 15.98%
[rank1]:2025-12-26 08:31:36,383 - Avg. fwd time: 10.5026 / Avg. bwd time: 14.8901 / Avg. batch time: 450.2471 (ms) / GPU bubble ratio: 54.88%
[rank2]:2025-12-26 08:31:36,363 - Avg. fwd time: 8.4235 / Avg. bwd time: 11.9771 / Avg. batch time: 420.9850 (ms) / GPU bubble ratio: 61.23%
[rank0]:2025-12-26 08:31:36,393 - Avg. fwd time: 8.5702 / Avg. bwd time: 9.9539 / Avg. batch time: 473.0153 (ms) / GPU bubble ratio: 68.67%
[rank2]:2025-12-26 08:31:49,688 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:31:49,701 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:31:49,701 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:31:49,701 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:32:23,139 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:32:23,151 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:32:23,151 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:32:23,151 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:32:56,573 - Freezing Ratio: [Stage3] 0.07, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:32:56,560 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:32:56,573 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:32:56,577 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:32:56,578 - Freezing Ratio: [Stage0] 0.05, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:33:01,658 - Avg. fwd time: 8.4424 / Avg. bwd time: 11.8340 / Avg. batch time: 418.7128 (ms) / GPU bubble ratio: 61.26%
[rank3]:2025-12-26 08:33:01,627 - Avg. fwd time: 14.0378 / Avg. bwd time: 27.3674 / Avg. batch time: 394.6303 (ms) / GPU bubble ratio: 16.06%
[rank2]:2025-12-26 08:33:01,749 -  step: 500  loss: -8.0000  grad_norm: 10.8527  memory:  7.91GiB(16.66%)  tps: 9,721  tflops: 75.99  mfu: 24.36%
[rank1]:2025-12-26 08:33:01,692 - Avg. fwd time: 10.5244 / Avg. bwd time: 14.7118 / Avg. batch time: 447.7946 (ms) / GPU bubble ratio: 54.91%
[rank1]:2025-12-26 08:33:01,752 -  step: 500  loss: -8.0000  grad_norm: 10.8527  memory: 10.83GiB(22.79%)  tps: 9,721  tflops: 75.99  mfu: 24.36%
[rank3]:2025-12-26 08:33:01,761 -  step: 500  loss:  5.2696  grad_norm: 10.8527  memory: 19.83GiB(41.74%)  tps: 9,720  tflops: 75.99  mfu: 24.36%
[rank0]:2025-12-26 08:33:01,727 - Avg. fwd time: 8.5826 / Avg. bwd time: 9.5479 / Avg. batch time: 470.1509 (ms) / GPU bubble ratio: 69.15%
[rank0]:2025-12-26 08:33:01,763 -  step: 500  loss: -8.0000  grad_norm: 10.8527  memory: 15.49GiB(32.61%)  tps: 9,720  tflops: 75.99  mfu: 24.36%
[rank2]:2025-12-26 08:33:01,810 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0833_stage2_step500.svg
[rank1]:2025-12-26 08:33:01,811 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0833_stage1_step500.svg
[rank0]:2025-12-26 08:33:01,810 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0833_stage0_step500.svg
[rank3]:2025-12-26 08:33:01,903 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0833_step500_rank3.svg
[rank3]:			> Batch Time: 411.34 ms, GPU Bubble Ratio: 78.60%, 57.54%, 65.85%, 30.54%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-27ms      | [S0,MB3,F]  27-8-36ms      | [S0,MB0,B]  102-2-104ms    | [S0,MB4,F]  104-8-113ms    | [S0,MB1,B]  145-2-147ms    | [S0,MB5,F]  147-8-156ms    | [S0,MB2,B]  189-2-191ms    | [S0,MB6,F]  191-8-200ms    | [S0,MB3,B]  233-2-235ms    | [S0,MB7,F]  236-8-244ms    | [S0,MB4,B]  279-2-281ms    | [S0,MB5,B]  321-2-323ms    | [S0,MB6,B]  364-2-366ms    | [S0,MB7,B]  409-2-411ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  144-11-155ms   | [S1,MB2,B]  173-10-184ms   | [S1,MB5,F]  187-11-198ms   | [S1,MB3,B]  217-10-228ms   | [S1,MB6,F]  232-11-243ms   | [S1,MB4,B]  262-10-273ms   | [S1,MB7,F]  277-11-288ms   | [S1,MB5,B]  307-10-318ms   | [S1,MB6,B]  350-10-361ms   | [S1,MB7,B]  395-10-405ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  159-8-168ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  216-8-225ms    | [S2,MB4,B]  249-8-257ms    | [S2,MB6,F]  261-8-270ms    | [S2,MB5,B]  293-8-302ms    | [S2,MB7,F]  305-8-314ms    | [S2,MB6,B]  338-8-346ms    | [S2,MB7,B]  383-8-391ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-21-111ms    | [S3,MB2,F]  114-13-128ms   | [S3,MB2,B]  134-21-155ms   | [S3,MB3,F]  157-14-172ms   | [S3,MB3,B]  178-21-200ms   | [S3,MB4,F]  202-14-216ms   | [S3,MB4,B]  223-21-244ms   | [S3,MB5,F]  247-14-261ms   | [S3,MB5,B]  268-21-289ms   | [S3,MB6,F]  291-14-306ms   | [S3,MB6,B]  312-21-334ms   | [S3,MB7,F]  336-14-351ms   | [S3,MB7,B]  357-22-379ms  
[rank3]:2025-12-26 08:33:01,946 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0833_stage3_step500.svg
[rank2]:2025-12-26 08:33:48,300 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:33:48,308 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:33:48,330 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:33:48,323 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:34:21,651 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:34:21,638 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:34:21,651 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:34:21,650 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:34:41,653 - Avg. fwd time: 8.4359 / Avg. bwd time: 11.8790 / Avg. batch time: 419.4363 (ms) / GPU bubble ratio: 61.25%
[rank1]:2025-12-26 08:34:41,675 - Avg. fwd time: 10.5170 / Avg. bwd time: 14.7674 / Avg. batch time: 448.5730 (ms) / GPU bubble ratio: 54.91%
[rank3]:2025-12-26 08:34:41,635 - Avg. fwd time: 14.0370 / Avg. bwd time: 27.4510 / Avg. batch time: 395.2912 (ms) / GPU bubble ratio: 16.04%
[rank0]:2025-12-26 08:34:41,684 - Avg. fwd time: 8.5742 / Avg. bwd time: 9.5212 / Avg. batch time: 470.9019 (ms) / GPU bubble ratio: 69.26%
[rank2]:2025-12-26 08:34:55,097 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:34:55,109 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:34:55,109 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:34:55,111 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:35:29,096 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:35:29,095 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:35:29,087 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:35:29,095 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:36:02,421 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:36:02,427 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:36:02,428 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:36:02,413 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:36:02,426 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:36:05,772 - Avg. fwd time: 8.4551 / Avg. bwd time: 11.7337 / Avg. batch time: 417.1395 (ms) / GPU bubble ratio: 61.28%
[rank2]:2025-12-26 08:36:05,804 -  step: 550  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,902  tflops: 69.59  mfu: 22.30%
[rank1]:2025-12-26 08:36:05,793 - Avg. fwd time: 10.5393 / Avg. bwd time: 14.5866 / Avg. batch time: 446.0940 (ms) / GPU bubble ratio: 54.94%
[rank1]:2025-12-26 08:36:05,804 -  step: 550  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,902  tflops: 69.59  mfu: 22.30%
[rank3]:2025-12-26 08:36:05,753 - Avg. fwd time: 14.0445 / Avg. bwd time: 27.1761 / Avg. batch time: 393.1488 (ms) / GPU bubble ratio: 16.12%
[rank3]:2025-12-26 08:36:05,805 -  step: 550  loss:  3.7935  grad_norm:  0.0064  memory: 19.83GiB(41.74%)  tps: 8,902  tflops: 69.59  mfu: 22.31%
[rank0]:2025-12-26 08:36:05,803 - Avg. fwd time: 8.5908 / Avg. bwd time: 9.2338 / Avg. batch time: 468.1312 (ms) / GPU bubble ratio: 69.54%
[rank0]:2025-12-26 08:36:05,804 -  step: 550  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,902  tflops: 69.59  mfu: 22.31%
[rank2]:2025-12-26 08:36:35,821 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:36:35,833 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:36:35,833 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:36:35,833 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:37:09,256 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:37:09,244 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:37:09,256 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:37:09,256 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:37:29,203 - Avg. fwd time: 10.5599 / Avg. bwd time: 14.4218 / Avg. batch time: 443.8307 (ms) / GPU bubble ratio: 54.97%
[rank2]:2025-12-26 08:37:29,181 - Avg. fwd time: 8.4728 / Avg. bwd time: 11.6008 / Avg. batch time: 415.0417 (ms) / GPU bubble ratio: 61.31%
[rank3]:2025-12-26 08:37:29,161 - Avg. fwd time: 14.0513 / Avg. bwd time: 26.9250 / Avg. batch time: 391.1912 (ms) / GPU bubble ratio: 16.20%
[rank0]:2025-12-26 08:37:29,213 - Avg. fwd time: 8.6012 / Avg. bwd time: 8.8325 / Avg. batch time: 465.4590 (ms) / GPU bubble ratio: 70.04%
[rank0]:2025-12-26 08:37:42,581 - Freezing Ratio: [Stage0] 0.95, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:37:42,568 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:37:42,580 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:37:42,580 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:38:16,410 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:38:16,411 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:38:16,404 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:38:16,391 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:38:49,721 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:38:49,731 - Freezing Ratio: [Stage3] 0.07, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:38:49,735 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:38:49,736 - Freezing Ratio: [Stage0] 0.08, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:38:49,734 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:38:54,853 - Avg. fwd time: 14.0572 / Avg. bwd time: 26.7318 / Avg. batch time: 389.6917 (ms) / GPU bubble ratio: 16.26%
[rank2]:2025-12-26 08:38:54,885 - Avg. fwd time: 8.4865 / Avg. bwd time: 11.4980 / Avg. batch time: 413.4323 (ms) / GPU bubble ratio: 61.33%
[rank0]:2025-12-26 08:38:54,957 - Avg. fwd time: 8.6120 / Avg. bwd time: 8.6131 / Avg. batch time: 463.4978 (ms) / GPU bubble ratio: 70.27%
[rank1]:2025-12-26 08:38:54,921 - Avg. fwd time: 10.5761 / Avg. bwd time: 14.2944 / Avg. batch time: 442.0937 (ms) / GPU bubble ratio: 55.00%
[rank1]:2025-12-26 08:38:54,982 -  step: 600  loss: -8.0000  grad_norm: 35.5095  memory: 10.83GiB(22.79%)  tps: 9,684  tflops: 75.71  mfu: 24.27%
[rank2]:2025-12-26 08:38:54,979 -  step: 600  loss: -8.0000  grad_norm: 35.5095  memory:  7.91GiB(16.66%)  tps: 9,685  tflops: 75.71  mfu: 24.27%
[rank3]:2025-12-26 08:38:54,991 -  step: 600  loss:  3.0485  grad_norm: 35.5095  memory: 19.83GiB(41.74%)  tps: 9,684  tflops: 75.71  mfu: 24.26%
[rank0]:2025-12-26 08:38:54,993 -  step: 600  loss: -8.0000  grad_norm: 35.5095  memory: 15.49GiB(32.61%)  tps: 9,684  tflops: 75.70  mfu: 24.26%
[rank0]:2025-12-26 08:38:55,044 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0838_stage0_step600.svg
[rank1]:2025-12-26 08:38:55,043 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0838_stage1_step600.svg
[rank2]:2025-12-26 08:38:55,044 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0838_stage2_step600.svg
[rank3]:2025-12-26 08:38:55,127 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0838_step600_rank3.svg
[rank3]:			> Batch Time: 405.25 ms, GPU Bubble Ratio: 82.64%, 57.07%, 65.46%, 30.05%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-27ms      | [S0,MB3,F]  27-8-36ms      | [S0,MB0,B]  102-0-102ms    | [S0,MB4,F]  102-8-110ms    | [S0,MB1,B]  145-0-145ms    | [S0,MB5,F]  145-8-153ms    | [S0,MB2,B]  188-0-188ms    | [S0,MB6,F]  188-8-196ms    | [S0,MB3,B]  231-0-231ms    | [S0,MB7,F]  231-8-240ms    | [S0,MB4,B]  275-0-275ms    | [S0,MB5,B]  318-0-318ms    | [S0,MB6,B]  361-0-361ms    | [S0,MB7,B]  405-0-405ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-10-111ms   | [S1,MB1,B]  129-10-139ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  172-10-182ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  215-10-226ms   | [S1,MB6,F]  229-10-240ms   | [S1,MB4,B]  259-10-270ms   | [S1,MB7,F]  274-10-285ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  391-10-401ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-28ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-123ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-210ms    | [S2,MB5,F]  214-8-222ms    | [S2,MB4,B]  246-8-254ms    | [S2,MB6,F]  258-8-267ms    | [S2,MB5,B]  290-8-299ms    | [S2,MB7,F]  302-8-311ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  379-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  28-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  176-21-198ms   | [S3,MB4,F]  200-14-214ms   | [S3,MB4,B]  220-21-242ms   | [S3,MB5,F]  244-14-258ms   | [S3,MB5,B]  265-21-286ms   | [S3,MB6,F]  289-14-303ms   | [S3,MB6,B]  309-21-331ms   | [S3,MB7,F]  333-14-348ms   | [S3,MB7,B]  354-21-376ms  
[rank3]:2025-12-26 08:38:55,171 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0838_stage3_step600.svg
[rank2]:2025-12-26 08:39:41,566 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:39:41,589 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:39:41,596 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:39:41,573 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:40:14,744 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:40:14,756 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:40:14,756 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:40:14,757 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:40:34,763 - Avg. fwd time: 8.4796 / Avg. bwd time: 11.5496 / Avg. batch time: 414.2530 (ms) / GPU bubble ratio: 61.32%
[rank3]:2025-12-26 08:40:34,742 - Avg. fwd time: 14.0555 / Avg. bwd time: 26.8279 / Avg. batch time: 390.4469 (ms) / GPU bubble ratio: 16.23%
[rank0]:2025-12-26 08:40:34,796 - Avg. fwd time: 8.6028 / Avg. bwd time: 8.6284 / Avg. batch time: 464.3926 (ms) / GPU bubble ratio: 70.32%
[rank1]:2025-12-26 08:40:34,785 - Avg. fwd time: 10.5679 / Avg. bwd time: 14.3586 / Avg. batch time: 442.9773 (ms) / GPU bubble ratio: 54.98%
[rank1]:2025-12-26 08:40:48,039 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:40:48,027 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:40:48,039 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:40:48,039 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:41:22,053 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:41:22,044 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:41:22,052 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:41:22,052 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:41:55,375 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:41:55,389 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:41:55,389 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:41:55,388 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:41:55,383 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:41:58,678 - Avg. fwd time: 14.0606 / Avg. bwd time: 26.6182 / Avg. batch time: 388.8071 (ms) / GPU bubble ratio: 16.30%
[rank0]:2025-12-26 08:41:58,731 - Avg. fwd time: 8.6151 / Avg. bwd time: 8.4201 / Avg. batch time: 462.2818 (ms) / GPU bubble ratio: 70.52%
[rank0]:2025-12-26 08:41:58,733 -  step: 650  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,917  tflops: 69.71  mfu: 22.34%
[rank1]:2025-12-26 08:41:58,720 - Avg. fwd time: 10.5847 / Avg. bwd time: 14.2221 / Avg. batch time: 441.0814 (ms) / GPU bubble ratio: 55.01%
[rank1]:2025-12-26 08:41:58,732 -  step: 650  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,916  tflops: 69.70  mfu: 22.34%
[rank3]:2025-12-26 08:41:58,734 -  step: 650  loss:  4.1454  grad_norm:  0.0610  memory: 19.83GiB(41.74%)  tps: 8,917  tflops: 69.71  mfu: 22.34%
[rank2]:2025-12-26 08:41:58,698 - Avg. fwd time: 8.4943 / Avg. bwd time: 11.4394 / Avg. batch time: 412.4965 (ms) / GPU bubble ratio: 61.34%
[rank2]:2025-12-26 08:41:58,732 -  step: 650  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,916  tflops: 69.70  mfu: 22.34%
[rank2]:2025-12-26 08:42:28,620 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:42:28,632 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:42:28,632 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:42:28,632 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:43:01,807 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:43:01,807 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:43:01,806 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:43:01,794 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:43:22,166 - Avg. fwd time: 10.6003 / Avg. bwd time: 14.0957 / Avg. batch time: 439.3081 (ms) / GPU bubble ratio: 55.03%
[rank3]:2025-12-26 08:43:22,123 - Avg. fwd time: 14.0641 / Avg. bwd time: 26.4230 / Avg. batch time: 387.2705 (ms) / GPU bubble ratio: 16.36%
[rank2]:2025-12-26 08:43:22,144 - Avg. fwd time: 8.5078 / Avg. bwd time: 11.3371 / Avg. batch time: 410.8517 (ms) / GPU bubble ratio: 61.36%
[rank0]:2025-12-26 08:43:22,184 - Avg. fwd time: 8.6238 / Avg. bwd time: 8.1652 / Avg. batch time: 460.2467 (ms) / GPU bubble ratio: 70.82%
[rank1]:2025-12-26 08:43:35,663 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:43:35,668 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:43:35,650 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:43:35,669 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:44:09,211 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:44:09,213 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:44:09,199 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:44:09,214 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:44:42,486 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:44:42,476 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:44:42,490 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:44:42,491 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:44:42,489 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:44:45,761 - Avg. fwd time: 14.0675 / Avg. bwd time: 26.2417 / Avg. batch time: 385.8456 (ms) / GPU bubble ratio: 16.42%
[rank2]:2025-12-26 08:44:45,782 - Avg. fwd time: 8.5203 / Avg. bwd time: 11.2421 / Avg. batch time: 409.3259 (ms) / GPU bubble ratio: 61.38%
[rank2]:2025-12-26 08:44:45,817 -  step: 700  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,806  tflops: 76.66  mfu: 24.57%
[rank0]:2025-12-26 08:44:45,816 - Avg. fwd time: 8.6328 / Avg. bwd time: 7.9404 / Avg. batch time: 458.3702 (ms) / GPU bubble ratio: 71.07%
[rank0]:2025-12-26 08:44:45,818 -  step: 700  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 9,806  tflops: 76.66  mfu: 24.57%
[rank1]:2025-12-26 08:44:45,804 - Avg. fwd time: 10.6148 / Avg. bwd time: 13.9784 / Avg. batch time: 437.6627 (ms) / GPU bubble ratio: 55.05%
[rank1]:2025-12-26 08:44:45,817 -  step: 700  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 9,806  tflops: 76.66  mfu: 24.57%
[rank1]:2025-12-26 08:44:45,870 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0844_stage1_step700.svg
[rank3]:2025-12-26 08:44:45,819 -  step: 700  loss:  4.2889  grad_norm:  0.0105  memory: 19.83GiB(41.74%)  tps: 9,806  tflops: 76.66  mfu: 24.57%
[rank2]:2025-12-26 08:44:45,872 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0844_stage2_step700.svg
[rank0]:2025-12-26 08:44:45,872 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0844_stage0_step700.svg
[rank3]:2025-12-26 08:44:45,951 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0844_step700_rank3.svg
[rank3]:			> Batch Time: 405.25 ms, GPU Bubble Ratio: 82.61%, 56.90%, 65.34%, 29.91%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-27ms      | [S0,MB3,F]  27-8-36ms      | [S0,MB0,B]  102-0-102ms    | [S0,MB4,F]  102-8-110ms    | [S0,MB1,B]  145-0-145ms    | [S0,MB5,F]  145-8-153ms    | [S0,MB2,B]  187-0-187ms    | [S0,MB6,F]  187-8-196ms    | [S0,MB3,B]  231-0-231ms    | [S0,MB7,F]  231-8-240ms    | [S0,MB4,B]  275-0-275ms    | [S0,MB5,B]  318-0-318ms    | [S0,MB6,B]  360-0-360ms    | [S0,MB7,B]  405-0-405ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-139ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  171-10-182ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  215-10-226ms   | [S1,MB6,F]  229-11-240ms   | [S1,MB4,B]  259-10-270ms   | [S1,MB7,F]  273-11-284ms   | [S1,MB5,B]  303-10-314ms   | [S1,MB6,B]  346-10-357ms   | [S1,MB7,B]  391-10-401ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-28ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-123ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-166ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  201-8-210ms    | [S2,MB5,F]  213-8-222ms    | [S2,MB4,B]  245-8-254ms    | [S2,MB6,F]  257-8-266ms    | [S2,MB5,B]  290-8-298ms    | [S2,MB7,F]  302-8-310ms    | [S2,MB6,B]  334-8-343ms    | [S2,MB7,B]  379-8-387ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  28-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  70-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  176-21-197ms   | [S3,MB4,F]  200-14-214ms   | [S3,MB4,B]  220-21-241ms   | [S3,MB5,F]  244-14-258ms   | [S3,MB5,B]  264-21-285ms   | [S3,MB6,F]  288-14-303ms   | [S3,MB6,B]  308-21-330ms   | [S3,MB7,F]  332-14-347ms   | [S3,MB7,B]  353-21-375ms  
[rank3]:2025-12-26 08:44:45,996 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0844_stage3_step700.svg
[rank1]:2025-12-26 08:45:15,910 - Freezing Ratio: [Stage1] 0.02, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:45:15,910 - Freezing Ratio: [Stage3] 0.07, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:45:15,897 - Freezing Ratio: [Stage2] 0.03, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:45:15,910 - Freezing Ratio: [Stage0] 0.08, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:46:07,378 - Freezing Ratio: [Stage1] 0.98, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:46:07,394 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:46:07,371 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:46:07,404 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:46:27,317 - Avg. fwd time: 14.0633 / Avg. bwd time: 26.3687 / Avg. batch time: 386.8267 (ms) / GPU bubble ratio: 16.38%
[rank2]:2025-12-26 08:46:27,339 - Avg. fwd time: 8.5111 / Avg. bwd time: 11.3111 / Avg. batch time: 410.3879 (ms) / GPU bubble ratio: 61.36%
[rank0]:2025-12-26 08:46:27,374 - Avg. fwd time: 8.6231 / Avg. bwd time: 8.0108 / Avg. batch time: 459.5889 (ms) / GPU bubble ratio: 71.05%
[rank1]:2025-12-26 08:46:27,362 - Avg. fwd time: 10.6041 / Avg. bwd time: 14.0643 / Avg. batch time: 438.8100 (ms) / GPU bubble ratio: 55.03%
[rank0]:2025-12-26 08:46:40,798 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:46:40,799 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:46:40,798 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:46:40,786 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:47:14,081 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:47:14,069 - Freezing Ratio: [Stage2] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:47:14,081 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:47:14,081 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:47:48,071 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 08:47:48,072 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:47:48,061 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:47:48,064 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:47:48,064 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:47:51,398 - Avg. fwd time: 14.0673 / Avg. bwd time: 26.2019 / Avg. batch time: 385.5229 (ms) / GPU bubble ratio: 16.44%
[rank3]:2025-12-26 08:47:51,459 -  step: 750  loss:  3.4292  grad_norm:  0.0128  memory: 19.83GiB(41.74%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank2]:2025-12-26 08:47:51,420 - Avg. fwd time: 8.5229 / Avg. bwd time: 11.2237 / Avg. batch time: 408.9914 (ms) / GPU bubble ratio: 61.37%
[rank2]:2025-12-26 08:47:51,457 -  step: 750  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank0]:2025-12-26 08:47:51,456 - Avg. fwd time: 8.6348 / Avg. bwd time: 7.8504 / Avg. batch time: 457.9199 (ms) / GPU bubble ratio: 71.20%
[rank0]:2025-12-26 08:47:51,458 -  step: 750  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank1]:2025-12-26 08:47:51,443 - Avg. fwd time: 10.6175 / Avg. bwd time: 13.9561 / Avg. batch time: 437.3032 (ms) / GPU bubble ratio: 55.05%
[rank1]:2025-12-26 08:47:51,457 -  step: 750  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,826  tflops: 69.00  mfu: 22.11%
[rank2]:2025-12-26 08:48:21,392 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:48:21,405 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:48:21,404 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:48:21,404 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:48:54,716 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:48:54,728 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:48:54,729 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:48:54,729 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:49:14,945 - Avg. fwd time: 14.0700 / Avg. bwd time: 26.0450 / Avg. batch time: 384.2890 (ms) / GPU bubble ratio: 16.49%
[rank2]:2025-12-26 08:49:14,967 - Avg. fwd time: 8.5339 / Avg. bwd time: 11.1417 / Avg. batch time: 407.6709 (ms) / GPU bubble ratio: 61.39%
[rank0]:2025-12-26 08:49:15,009 - Avg. fwd time: 8.6437 / Avg. bwd time: 7.6467 / Avg. batch time: 456.2875 (ms) / GPU bubble ratio: 71.44%
[rank1]:2025-12-26 08:49:14,990 - Avg. fwd time: 10.6300 / Avg. bwd time: 13.8547 / Avg. batch time: 435.8797 (ms) / GPU bubble ratio: 55.06%
[rank1]:2025-12-26 08:49:28,555 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:49:28,561 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:49:28,542 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:49:28,562 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:50:01,770 - Freezing Ratio: [Stage0] 0.97, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:50:01,770 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:50:01,758 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:50:01,770 - Freezing Ratio: [Stage3] 0.93, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:50:35,265 - Freezing Ratio: [Stage3] 0.97, Threshold: 2.0000e-01
[rank2]:2025-12-26 08:50:35,253 - Freezing Ratio: [Stage2] 1.00, Threshold: 2.0000e-01
[rank0]:2025-12-26 08:50:35,269 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:50:35,270 - Freezing Ratio: [Stage0] 1.00, Threshold: 2.0000e-01
[rank1]:2025-12-26 08:50:35,265 - Freezing Ratio: [Stage1] 1.00, Threshold: 2.0000e-01
[rank3]:2025-12-26 08:50:38,630 - Avg. fwd time: 14.0734 / Avg. bwd time: 25.8989 / Avg. batch time: 383.1458 (ms) / GPU bubble ratio: 16.54%
[rank2]:2025-12-26 08:50:38,653 - Avg. fwd time: 8.5444 / Avg. bwd time: 11.0649 / Avg. batch time: 406.4470 (ms) / GPU bubble ratio: 61.40%
[rank0]:2025-12-26 08:50:38,690 - Avg. fwd time: 8.6517 / Avg. bwd time: 7.4661 / Avg. batch time: 454.7823 (ms) / GPU bubble ratio: 71.65%
[rank0]:2025-12-26 08:50:38,692 -  step: 800  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 9,797  tflops: 76.59  mfu: 24.55%
[rank0]:2025-12-26 08:50:38,692 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0000  tps: 9,307  tflops: 72.76  mfu: 21.37%
[rank0]:2025-12-26 08:50:38,692 - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-12-26 08:50:38,692 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-12-26 08:50:38,677 - Avg. fwd time: 10.6420 / Avg. bwd time: 13.7599 / Avg. batch time: 434.5600 (ms) / GPU bubble ratio: 55.08%
[rank1]:2025-12-26 08:50:38,691 -  step: 800  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 9,797  tflops: 76.59  mfu: 24.55%
[rank1]:2025-12-26 08:50:38,691 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0000  tps: 9,309  tflops: 72.77  mfu: 21.39%
[rank1]:2025-12-26 08:50:38,691 - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-12-26 08:50:38,692 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-12-26 08:50:38,693 -  step: 800  loss:  2.8078  grad_norm:  0.0058  memory: 19.83GiB(41.74%)  tps: 9,797  tflops: 76.59  mfu: 24.55%
[rank3]:2025-12-26 08:50:38,693 - â„¹ï¸ final step: 800  loss:  2.8078  grad_norm:  0.0058  tps: 9,316  tflops: 72.82  mfu: 21.51%
[rank3]:2025-12-26 08:50:38,694 - Saving the checkpoint (or staging if async is enabled).
[rank3]:2025-12-26 08:50:38,694 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank2]:2025-12-26 08:50:38,691 -  step: 800  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,797  tflops: 76.59  mfu: 24.55%
[rank2]:2025-12-26 08:50:38,691 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0000  tps: 9,308  tflops: 72.77  mfu: 21.39%
[rank2]:2025-12-26 08:50:38,691 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-26 08:50:38,692 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-26 08:50:40,705 - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank2]:2025-12-26 08:50:40,774 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank2/251226_0850_stage2_final800.svg
[rank0]:2025-12-26 08:50:40,774 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank0/251226_0850_stage0_final800.svg
[rank1]:2025-12-26 08:50:40,775 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank1/251226_0850_stage1_final800.svg
[rank3]:2025-12-26 08:50:40,858 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0850_final800_rank3.svg
[rank3]:			> Batch Time: 409.85 ms, GPU Bubble Ratio: 78.54%, 57.46%, 65.79%, 30.49%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-27ms      | [S0,MB3,F]  27-8-36ms      | [S0,MB0,B]  102-2-104ms    | [S0,MB4,F]  105-8-114ms    | [S0,MB1,B]  145-2-147ms    | [S0,MB5,F]  148-8-157ms    | [S0,MB2,B]  188-2-191ms    | [S0,MB6,F]  192-8-200ms    | [S0,MB3,B]  233-2-235ms    | [S0,MB7,F]  236-8-244ms    | [S0,MB4,B]  277-2-279ms    | [S0,MB5,B]  320-2-322ms    | [S0,MB6,B]  363-2-365ms    | [S0,MB7,B]  407-2-409ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-10-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-10-198ms   | [S1,MB3,B]  217-10-227ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  276-10-286ms   | [S1,MB5,B]  306-10-317ms   | [S1,MB6,B]  349-10-360ms   | [S1,MB7,B]  393-10-404ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-136ms    | [S2,MB2,B]  159-8-167ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-211ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  260-8-268ms    | [S2,MB5,B]  292-8-301ms    | [S2,MB7,F]  304-8-313ms    | [S2,MB6,B]  337-8-345ms    | [S2,MB7,B]  381-8-390ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-216ms   | [S3,MB4,B]  222-21-243ms   | [S3,MB5,F]  246-14-260ms   | [S3,MB5,B]  266-21-288ms   | [S3,MB6,F]  290-14-305ms   | [S3,MB6,B]  311-21-333ms   | [S3,MB7,F]  335-14-350ms   | [S3,MB7,B]  356-21-378ms  
[rank0]:2025-12-26 08:50:40,927 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_params_histogram/251226_0850_rank0_stage0.svg
[rank0]:	> Counts Sum: 2350, Total Sum: 2775 (84.68%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 81.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 74.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 76.0, 85.33]
[rank0]:2025-12-26 08:50:40,927 - Sleeping 2 seconds for other ranks to complete
[rank1]:2025-12-26 08:50:40,923 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_params_histogram/251226_0850_rank1_stage1.svg
[rank1]:	> Counts Sum: 2879, Total Sum: 3375 (85.30%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33]
[rank1]:2025-12-26 08:50:40,923 - Destroying the purge thread.
[rank3]:2025-12-26 08:50:40,986 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/pipeline_schedule/251226_0850_thry_final800_rank3.svg
[rank3]:			> Batch Time: 353.23 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-10-10ms      | [S0,MB1,F]  10-10-21ms     | [S0,MB2,F]  21-10-32ms     | [S0,MB3,F]  32-10-42ms     | [S0,MB0,B]  107-21-128ms   | [S0,MB4,F]  128-10-139ms   | [S0,MB1,B]  139-21-160ms   | [S0,MB5,F]  160-10-171ms   | [S0,MB2,B]  171-21-192ms   | [S0,MB6,F]  192-10-203ms   | [S0,MB3,B]  203-21-224ms   | [S0,MB7,F]  224-10-235ms   | [S0,MB4,B]  235-21-256ms   | [S0,MB5,B]  267-21-289ms   | [S0,MB6,B]  299-21-321ms   | [S0,MB7,B]  331-21-353ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  10-10-21ms     | [S1,MB1,F]  21-10-32ms     | [S1,MB2,F]  32-10-42ms     | [S1,MB0,B]  85-21-107ms    | [S1,MB3,F]  107-10-117ms   | [S1,MB1,B]  117-21-139ms   | [S1,MB4,F]  139-10-149ms   | [S1,MB2,B]  149-21-171ms   | [S1,MB5,F]  171-10-181ms   | [S1,MB3,B]  181-21-203ms   | [S1,MB6,F]  203-10-214ms   | [S1,MB4,B]  214-21-235ms   | [S1,MB7,F]  235-10-246ms   | [S1,MB5,B]  246-21-267ms   | [S1,MB6,B]  278-21-299ms   | [S1,MB7,B]  310-21-331ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  21-10-32ms     | [S2,MB1,F]  32-10-42ms     | [S2,MB0,B]  64-21-85ms     | [S2,MB2,F]  85-10-96ms     | [S2,MB1,B]  96-21-117ms    | [S2,MB3,F]  117-10-128ms   | [S2,MB2,B]  128-21-149ms   | [S2,MB4,F]  149-10-160ms   | [S2,MB3,B]  160-21-181ms   | [S2,MB5,F]  181-10-192ms   | [S2,MB4,B]  192-21-214ms   | [S2,MB6,F]  214-10-224ms   | [S2,MB5,B]  224-21-246ms   | [S2,MB7,F]  246-10-256ms   | [S2,MB6,B]  256-21-278ms   | [S2,MB7,B]  289-21-310ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  32-10-42ms     | [S3,MB0,B]  42-21-64ms     | [S3,MB1,F]  64-10-74ms     | [S3,MB1,B]  74-21-96ms     | [S3,MB2,F]  96-10-107ms    | [S3,MB2,B]  107-21-128ms   | [S3,MB3,F]  128-10-139ms   | [S3,MB3,B]  139-21-160ms   | [S3,MB4,F]  160-10-171ms   | [S3,MB4,B]  171-21-192ms   | [S3,MB5,F]  192-10-203ms   | [S3,MB5,B]  203-21-224ms   | [S3,MB6,F]  224-10-235ms   | [S3,MB6,B]  235-21-256ms   | [S3,MB7,F]  256-10-267ms   | [S3,MB7,B]  267-21-289ms  
[rank2]:2025-12-26 08:50:40,927 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_params_histogram/251226_0850_rank2_stage2.svg
[rank2]:	> Counts Sum: 2302, Total Sum: 2700 (85.26%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66]
[rank2]:2025-12-26 08:50:40,927 - Destroying the purge thread.
[rank1]:2025-12-26 08:50:41,035 - Process group destroyed
[rank3]:2025-12-26 08:50:41,032 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_ratio_history/rank3/251226_0850_stage3_final800.svg
[rank2]:2025-12-26 08:50:41,041 - Process group destroyed
[rank3]:2025-12-26 08:50:41,165 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1/frozen_params_histogram/251226_0850_rank3_stage3.svg
[rank3]:	> Counts Sum: 1795, Total Sum: 2175 (82.53%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 74.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 17.33, 85.33]
[rank3]:2025-12-26 08:50:41,166 - Destroying the purge thread.
[rank3]:wandb: updating run metadata
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–â–‚â–‚â–â–â–â–â–â–‚â–â–ƒâ–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–‚â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–‚â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 3.51756
[rank3]:wandb:               final/avg_loss 2.8078
[rank3]:wandb:             final/avg_mfu(%) 21.50813
[rank3]:wandb:             final/avg_tflops 72.82476
[rank3]:wandb:    final/avg_throughput(tps) 9315.56012
[rank3]:wandb:              final/grad_norm 0.00578
[rank3]:wandb:               final/max_loss 2.8078
[rank3]:wandb:                    grad_norm 0.00578
[rank3]:wandb: loss_metrics/global_avg_loss 2.8078
[rank3]:wandb: loss_metrics/global_max_loss 2.8078
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1226_1F1B_APF_th0.2_42_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/stxg55rz
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.2_42_dm1/20251226-0800/wandb/run-20251226_080047-stxg55rz/logs
[rank3]:2025-12-26 08:50:42,523 - Process group destroyed
[rank0]:2025-12-26 08:50:42,928 - Training completed
[rank0]:2025-12-26 08:50:42,928 - Destroying the purge thread.
[rank0]:2025-12-26 08:50:43,039 - Process group destroyed
[rank0]:Stage 0: Modules to keep: {'layers.2', 'layers.1', 'layers.3', 'tok_embeddings', 'layers.0'}
[rank2]:Stage 2: Modules to keep: {'layers.11', 'layers.12', 'layers.10', 'layers.9'}
[rank1]:Stage 1: Modules to keep: {'layers.7', 'layers.5', 'layers.8', 'layers.4', 'layers.6'}
[rank3]:Stage 3: Modules to keep: {'layers.13', 'output', 'layers.15', 'norm', 'layers.14'}
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1226_1F1B_APF_th0.2_42_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1226_1F1B_APF_th0.2_42_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 16
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 42
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 2
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1226_1F1B_APF_th0.2_42_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: True
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.2
[rank3]:		- percentile: 80
[rank3]:
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
