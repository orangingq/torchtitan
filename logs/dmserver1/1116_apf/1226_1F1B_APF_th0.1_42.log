
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 12. 26. (ê¸ˆ) 07:10:12 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 1,2,3,4
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1116_apf/1226_1F1B_APF_th0.1_42.log
âœ”ï¸APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged

âœ”ï¸Running with APF (threshold=0.1) x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml --job.description="APF configuration experiment on different threshold values.
1226: everything same as 1116, but debugged
" --parallelism.pipeline_parallel_degree=4  --freezing.freeze --freezing.metric_type=apf --freezing.threshold=0.1
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank2]:2025-12-26 07:10:18,339 - Starting job: "APF configuration experiment on different threshold values.
[rank2]:1226: everything same as 1116, but debugged
[rank2]:"
[rank3]:2025-12-26 07:10:18,364 - Starting job: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank1]:2025-12-26 07:10:18,558 - Starting job: "APF configuration experiment on different threshold values.
[rank1]:1226: everything same as 1116, but debugged
[rank1]:"
[rank0]:2025-12-26 07:10:18,491 - Starting job: "APF configuration experiment on different threshold values.
[rank0]:1226: everything same as 1116, but debugged
[rank0]:"
[rank2]:2025-12-26 07:10:18,658 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:2025-12-26 07:10:18,661 - Building 1-D device mesh with ['pp'], [4]
[rank3]:2025-12-26 07:10:18,729 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-12-26 07:10:18,731 - Building 1-D device mesh with ['pp'], [4]
[rank1]:2025-12-26 07:10:18,977 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-12-26 07:10:18,979 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 07:10:18,973 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-26 07:10:18,976 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-26 07:10:18,979 - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-12-26 07:10:18,981 - Loading tokenizer from tokenizer.json
[rank0]:2025-12-26 07:10:19,378 - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank0]:2025-12-26 07:10:22,068 - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank1]:2025-12-26 07:10:22,221 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-26 07:10:22,221 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-26 07:10:22,274 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 07:10:22,275 - Model llama3 1B size: 1,498,482,688 total parameters
[rank2]:2025-12-26 07:10:22,214 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-12-26 07:10:22,268 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 07:10:22,277 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 07:10:22,303 - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-12-26 07:10:22,303 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-12-26 07:10:22,301 - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-12-26 07:10:22,301 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-26 07:10:22,295 - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-12-26 07:10:22,295 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-26 07:10:22,500 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-26 07:10:22,501 - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-12-26 07:10:22,502 - CUDA memory usage for model: 1.13GiB(2.39%)
[rank0]:2025-12-26 07:10:22,526 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-26 07:10:22,526 - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-12-26 07:10:22,527 - CUDA memory usage for model: 1.90GiB(3.99%)
[rank2]:2025-12-26 07:10:22,494 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-26 07:10:22,494 - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-12-26 07:10:22,495 - CUDA memory usage for model: 0.92GiB(1.94%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run myocaf1e
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.1_42_dm1/20251226-0710/wandb/run-20251226_071023-myocaf1e
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1226_1F1B_APF_th0.1_42_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/myocaf1e
[rank3]:2025-12-26 07:10:24,322 - WandB logging enabled
[rank3]:2025-12-26 07:10:24,323 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-12-26 07:10:24,361 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 07:10:24,389 - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-12-26 07:10:24,390 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-26 07:10:24,614 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 07:10:24,614 - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th0.1_42_dm1
[rank0]:2025-12-26 07:10:24,614 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 07:10:24,615 - Trainer is initialized with local batch size 16, global batch size 128, gradient accumulation steps 8, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-12-26 07:10:24,615 - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank2]:2025-12-26 07:10:24,614 - Mixed precision training with TP or PP is handled by autocast
[rank3]:2025-12-26 07:10:24,597 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-26 07:10:24,598 - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-12-26 07:10:24,599 - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-12-26 07:10:24,613 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-26 07:10:27,263 - [GC] GC collection for checkpoint loading. 0.00 seconds
[rank0]:2025-12-26 07:10:27,263 - Finished loading the checkpoint in 2.65 seconds.
[rank0]:2025-12-26 07:10:27,263 - Training starts at step 1
[rank1]:2025-12-26 07:10:33,074 -  step:  1  loss: -8.0000  grad_norm: 116.5371  memory:  7.10GiB(14.94%)  tps: 3,035  tflops: 23.73  mfu: 7.60%
[rank1]:2025-12-26 07:10:33,075 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-12-26 07:10:33,068 -  step:  1  loss: -8.0000  grad_norm: 116.5371  memory:  5.20GiB(10.94%)  tps: 3,034  tflops: 23.72  mfu: 7.60%
[rank2]:2025-12-26 07:10:33,068 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-12-26 07:10:33,079 -  step:  1  loss: 10.6088  grad_norm: 116.5371  memory: 12.97GiB(27.31%)  tps: 3,760  tflops: 29.39  mfu: 9.42%
[rank3]:2025-12-26 07:10:33,079 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-26 07:10:33,103 -  step:  1  loss: -8.0000  grad_norm: 116.5371  memory:  9.62GiB(20.24%)  tps: 3,026  tflops: 23.66  mfu: 7.58%
[rank0]:2025-12-26 07:10:33,104 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank2]:2025-12-26 07:12:35,714 - Avg. fwd time: 7.3815 / Avg. bwd time: 19.9390 / Avg. batch time: 544.8811 (ms) / GPU bubble ratio: 59.89%
[rank3]:2025-12-26 07:12:35,689 - Avg. fwd time: 13.5179 / Avg. bwd time: 42.5293 / Avg. batch time: 511.9185 (ms) / GPU bubble ratio: 12.41%
[rank1]:2025-12-26 07:12:35,744 - Avg. fwd time: 9.2711 / Avg. bwd time: 24.7611 / Avg. batch time: 584.8379 (ms) / GPU bubble ratio: 53.45%
[rank0]:2025-12-26 07:12:35,773 - Avg. fwd time: 7.6481 / Avg. bwd time: 24.9259 / Avg. batch time: 623.9729 (ms) / GPU bubble ratio: 58.24%
[rank0]:2025-12-26 07:14:39,127 - [GC] Peforming periodical GC collection 0.00 seconds
[rank2]:2025-12-26 07:14:44,165 - Avg. fwd time: 7.3768 / Avg. bwd time: 19.9806 / Avg. batch time: 546.5688 (ms) / GPU bubble ratio: 59.96%
[rank1]:2025-12-26 07:14:44,195 - Avg. fwd time: 9.2741 / Avg. bwd time: 24.8156 / Avg. batch time: 586.1616 (ms) / GPU bubble ratio: 53.47%
[rank3]:2025-12-26 07:14:44,140 - Avg. fwd time: 13.6185 / Avg. bwd time: 42.6977 / Avg. batch time: 513.9928 (ms) / GPU bubble ratio: 12.35%
[rank2]:2025-12-26 07:14:44,246 -  step: 50  loss: -8.0000  grad_norm: 12.4043  memory:  6.98GiB(14.69%)  tps: 6,392  tflops: 49.97  mfu: 16.02%
[rank0]:2025-12-26 07:14:44,225 - Avg. fwd time: 7.6488 / Avg. bwd time: 24.9740 / Avg. batch time: 624.7220 (ms) / GPU bubble ratio: 58.22%
[rank0]:2025-12-26 07:14:44,261 -  step: 50  loss: -8.0000  grad_norm: 12.4043  memory: 13.42GiB(28.26%)  tps: 6,393  tflops: 49.98  mfu: 16.02%
[rank1]:2025-12-26 07:14:44,250 -  step: 50  loss: -8.0000  grad_norm: 12.4043  memory:  9.50GiB(19.99%)  tps: 6,392  tflops: 49.97  mfu: 16.02%
[rank3]:2025-12-26 07:14:44,258 -  step: 50  loss:  9.9039  grad_norm: 12.4043  memory: 16.39GiB(34.50%)  tps: 6,392  tflops: 49.97  mfu: 16.02%
[rank3]:2025-12-26 07:15:30,318 - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:15:30,539 - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:15:30,566 - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:15:30,593 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:16:22,074 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:16:22,094 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:16:22,103 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:16:22,081 - Freezing Ratio: [Stage1] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:16:42,552 - Avg. fwd time: 7.4931 / Avg. bwd time: 19.0945 / Avg. batch time: 533.1361 (ms) / GPU bubble ratio: 60.10%
[rank3]:2025-12-26 07:16:42,538 - Avg. fwd time: 13.7060 / Avg. bwd time: 41.0640 / Avg. batch time: 501.5956 (ms) / GPU bubble ratio: 12.65%
[rank0]:2025-12-26 07:16:42,582 - Avg. fwd time: 7.7703 / Avg. bwd time: 23.6865 / Avg. batch time: 608.5472 (ms) / GPU bubble ratio: 58.65%
[rank1]:2025-12-26 07:16:42,568 - Avg. fwd time: 9.4079 / Avg. bwd time: 23.7160 / Avg. batch time: 571.4848 (ms) / GPU bubble ratio: 53.63%
[rank2]:2025-12-26 07:16:56,181 - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:16:56,182 - Freezing Ratio: [Stage3] 0.10, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:16:56,182 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:16:56,181 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:17:47,762 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:17:47,778 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:17:47,755 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:17:47,785 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:18:21,693 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:18:21,693 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:18:21,696 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:18:21,698 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:18:21,694 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:18:24,998 - Avg. fwd time: 7.6841 / Avg. bwd time: 17.6254 / Avg. batch time: 510.0973 (ms) / GPU bubble ratio: 60.31%
[rank1]:2025-12-26 07:18:25,014 - Avg. fwd time: 9.6354 / Avg. bwd time: 21.8893 / Avg. batch time: 546.5317 (ms) / GPU bubble ratio: 53.85%
[rank1]:2025-12-26 07:18:25,024 -  step: 100  loss: -8.0000  grad_norm:  0.1344  memory: 10.69GiB(22.50%)  tps: 7,421  tflops: 58.02  mfu: 18.59%
[rank0]:2025-12-26 07:18:25,022 - Avg. fwd time: 7.9615 / Avg. bwd time: 21.5091 / Avg. batch time: 581.2776 (ms) / GPU bubble ratio: 59.44%
[rank0]:2025-12-26 07:18:25,024 -  step: 100  loss: -8.0000  grad_norm:  0.1344  memory: 15.36GiB(32.33%)  tps: 7,422  tflops: 58.02  mfu: 18.60%
[rank3]:2025-12-26 07:18:24,984 - Avg. fwd time: 13.7839 / Avg. bwd time: 38.3048 / Avg. batch time: 480.1116 (ms) / GPU bubble ratio: 13.21%
[rank3]:2025-12-26 07:18:25,025 -  step: 100  loss:  9.0576  grad_norm:  0.1344  memory: 19.83GiB(41.74%)  tps: 7,421  tflops: 58.02  mfu: 18.60%
[rank2]:2025-12-26 07:18:25,024 -  step: 100  loss: -8.0000  grad_norm:  0.1344  memory:  7.91GiB(16.66%)  tps: 7,421  tflops: 58.01  mfu: 18.59%
[rank2]:2025-12-26 07:18:25,093 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0718_stage2_step100.svg
[rank1]:2025-12-26 07:18:25,097 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0718_stage1_step100.svg
[rank0]:2025-12-26 07:18:25,103 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0718_stage0_step100.svg
[rank3]:2025-12-26 07:18:25,185 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0718_step100_rank3.svg
[rank3]:			> Batch Time: 415.20 ms, GPU Bubble Ratio: 65.84%, 57.99%, 66.18%, 31.34%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  19-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-8-110ms    | [S0,MB4,F]  111-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  277-8-285ms    | [S0,MB5,B]  319-8-327ms    | [S0,MB6,B]  361-8-370ms    | [S0,MB7,B]  406-8-415ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  171-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-288ms   | [S3,MB6,F]  290-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 07:18:25,226 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0718_stage3_step100.svg
[rank1]:2025-12-26 07:18:55,348 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:18:55,349 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:18:55,348 - Freezing Ratio: [Stage3] 0.10, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:18:55,348 - Freezing Ratio: [Stage2] 0.06, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:19:46,853 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:19:46,830 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:19:46,837 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:19:46,861 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:20:07,133 - Avg. fwd time: 13.8252 / Avg. bwd time: 36.6375 / Avg. batch time: 467.0815 (ms) / GPU bubble ratio: 13.57%
[rank2]:2025-12-26 07:20:07,148 - Avg. fwd time: 7.7986 / Avg. bwd time: 16.7417 / Avg. batch time: 496.2226 (ms) / GPU bubble ratio: 60.44%
[rank1]:2025-12-26 07:20:07,164 - Avg. fwd time: 9.7721 / Avg. bwd time: 20.7943 / Avg. batch time: 531.5133 (ms) / GPU bubble ratio: 53.99%
[rank0]:2025-12-26 07:20:07,178 - Avg. fwd time: 8.0638 / Avg. bwd time: 19.8841 / Avg. batch time: 564.5491 (ms) / GPU bubble ratio: 60.40%
[rank3]:2025-12-26 07:20:20,897 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:20:20,896 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:20:20,896 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:20:20,897 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:20:54,774 - Freezing Ratio: [Stage3] 0.86, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:20:54,775 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:20:54,775 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:20:54,776 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:21:28,666 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:21:28,668 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:21:28,661 - Freezing Ratio: [Stage3] 0.14, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:21:28,660 - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:21:28,660 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:21:33,709 - Avg. fwd time: 13.8833 / Avg. bwd time: 34.2434 / Avg. batch time: 448.3853 (ms) / GPU bubble ratio: 14.13%
[rank2]:2025-12-26 07:21:33,735 - Avg. fwd time: 7.9672 / Avg. bwd time: 15.4725 / Avg. batch time: 476.2047 (ms) / GPU bubble ratio: 60.62%
[rank1]:2025-12-26 07:21:33,766 - Avg. fwd time: 9.9693 / Avg. bwd time: 19.2187 / Avg. batch time: 509.8879 (ms) / GPU bubble ratio: 54.20%
[rank3]:2025-12-26 07:21:33,831 -  step: 150  loss:  6.6674  grad_norm: 10.5252  memory: 19.83GiB(41.74%)  tps: 8,678  tflops: 67.84  mfu: 21.74%
[rank2]:2025-12-26 07:21:33,818 -  step: 150  loss: -8.0000  grad_norm: 10.5252  memory:  7.91GiB(16.66%)  tps: 8,678  tflops: 67.84  mfu: 21.74%
[rank1]:2025-12-26 07:21:33,822 -  step: 150  loss: -8.0000  grad_norm: 10.5252  memory: 10.69GiB(22.50%)  tps: 8,678  tflops: 67.84  mfu: 21.74%
[rank0]:2025-12-26 07:21:33,797 - Avg. fwd time: 8.2295 / Avg. bwd time: 18.0375 / Avg. batch time: 541.0067 (ms) / GPU bubble ratio: 61.16%
[rank0]:2025-12-26 07:21:33,833 -  step: 150  loss: -8.0000  grad_norm: 10.5252  memory: 15.49GiB(32.61%)  tps: 8,678  tflops: 67.84  mfu: 21.74%
[rank3]:2025-12-26 07:22:20,169 - Freezing Ratio: [Stage3] 0.86, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:22:20,145 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:22:20,152 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:22:20,175 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:22:54,252 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:22:54,251 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:22:54,251 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:22:54,252 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:23:14,498 - Avg. fwd time: 13.9043 / Avg. bwd time: 33.5171 / Avg. batch time: 442.7364 (ms) / GPU bubble ratio: 14.31%
[rank2]:2025-12-26 07:23:14,513 - Avg. fwd time: 8.0174 / Avg. bwd time: 15.0849 / Avg. batch time: 470.1326 (ms) / GPU bubble ratio: 60.69%
[rank1]:2025-12-26 07:23:14,530 - Avg. fwd time: 10.0290 / Avg. bwd time: 18.7373 / Avg. batch time: 503.3121 (ms) / GPU bubble ratio: 54.28%
[rank0]:2025-12-26 07:23:14,544 - Avg. fwd time: 8.2820 / Avg. bwd time: 17.5138 / Avg. batch time: 533.8692 (ms) / GPU bubble ratio: 61.35%
[rank3]:2025-12-26 07:23:28,174 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:23:28,174 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:23:28,174 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:23:28,176 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:24:02,081 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:24:02,080 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:24:02,080 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:24:02,079 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:24:36,044 - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:24:36,062 - Freezing Ratio: [Stage3] 0.17, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:24:36,062 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:24:36,066 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:24:36,068 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:24:41,182 - Avg. fwd time: 8.1158 / Avg. bwd time: 14.3396 / Avg. batch time: 458.4313 (ms) / GPU bubble ratio: 60.81%
[rank3]:2025-12-26 07:24:41,155 - Avg. fwd time: 13.9411 / Avg. bwd time: 32.1155 / Avg. batch time: 431.8113 (ms) / GPU bubble ratio: 14.67%
[rank0]:2025-12-26 07:24:41,245 - Avg. fwd time: 8.3799 / Avg. bwd time: 16.4094 / Avg. batch time: 520.0839 (ms) / GPU bubble ratio: 61.87%
[rank2]:2025-12-26 07:24:41,266 -  step: 200  loss: -8.0000  grad_norm: 12.8217  memory:  7.91GiB(16.66%)  tps: 8,741  tflops: 68.33  mfu: 21.90%
[rank3]:2025-12-26 07:24:41,279 -  step: 200  loss:  4.4127  grad_norm: 12.8217  memory: 19.83GiB(41.74%)  tps: 8,741  tflops: 68.33  mfu: 21.90%
[rank1]:2025-12-26 07:24:41,213 - Avg. fwd time: 10.1450 / Avg. bwd time: 17.8104 / Avg. batch time: 490.6667 (ms) / GPU bubble ratio: 54.42%
[rank1]:2025-12-26 07:24:41,270 -  step: 200  loss: -8.0000  grad_norm: 12.8217  memory: 10.83GiB(22.79%)  tps: 8,741  tflops: 68.33  mfu: 21.90%
[rank0]:2025-12-26 07:24:41,281 -  step: 200  loss: -8.0000  grad_norm: 12.8217  memory: 15.49GiB(32.61%)  tps: 8,741  tflops: 68.33  mfu: 21.90%
[rank0]:2025-12-26 07:24:41,331 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0724_stage0_step200.svg
[rank2]:2025-12-26 07:24:41,330 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0724_stage2_step200.svg
[rank1]:2025-12-26 07:24:41,331 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0724_stage1_step200.svg
[rank3]:2025-12-26 07:24:41,417 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0724_step200_rank3.svg
[rank3]:			> Batch Time: 414.70 ms, GPU Bubble Ratio: 67.02%, 58.07%, 66.26%, 31.41%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-7-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  277-8-285ms    | [S0,MB5,B]  319-7-327ms    | [S0,MB6,B]  362-7-370ms    | [S0,MB7,B]  406-7-414ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-10-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  230-10-241ms   | [S1,MB4,B]  261-10-271ms   | [S1,MB7,F]  275-10-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-359ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  171-8-179ms    | [S2,MB3,B]  203-8-211ms    | [S2,MB5,F]  215-8-223ms    | [S2,MB4,B]  247-8-255ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  336-8-345ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-287ms   | [S3,MB6,F]  290-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 07:24:41,461 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0724_stage3_step200.svg
[rank1]:2025-12-26 07:25:27,766 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:25:27,790 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:25:27,759 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:25:27,782 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:26:01,722 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:26:01,724 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:26:01,722 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:26:01,723 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:26:22,189 - Avg. fwd time: 8.4049 / Avg. bwd time: 16.1825 / Avg. batch time: 516.9015 (ms) / GPU bubble ratio: 61.95%
[rank2]:2025-12-26 07:26:22,156 - Avg. fwd time: 8.1386 / Avg. bwd time: 14.1612 / Avg. batch time: 455.7168 (ms) / GPU bubble ratio: 60.85%
[rank3]:2025-12-26 07:26:22,141 - Avg. fwd time: 13.9492 / Avg. bwd time: 31.7862 / Avg. batch time: 429.2371 (ms) / GPU bubble ratio: 14.76%
[rank1]:2025-12-26 07:26:22,174 - Avg. fwd time: 10.1722 / Avg. bwd time: 17.5941 / Avg. batch time: 487.7260 (ms) / GPU bubble ratio: 54.46%
[rank1]:2025-12-26 07:26:35,660 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:26:35,661 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:26:35,660 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:26:35,660 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:27:09,647 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:27:09,647 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:27:09,647 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:27:09,646 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:27:43,664 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:27:43,665 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:27:43,658 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:27:43,642 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:27:43,654 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:27:46,991 - Avg. fwd time: 13.9734 / Avg. bwd time: 30.7486 / Avg. batch time: 421.1302 (ms) / GPU bubble ratio: 15.04%
[rank2]:2025-12-26 07:27:47,007 - Avg. fwd time: 8.2107 / Avg. bwd time: 13.6078 / Avg. batch time: 447.0352 (ms) / GPU bubble ratio: 60.95%
[rank2]:2025-12-26 07:27:47,039 -  step: 250  loss: -8.0000  grad_norm:  0.1264  memory:  7.91GiB(16.66%)  tps: 8,819  tflops: 68.95  mfu: 22.10%
[rank1]:2025-12-26 07:27:47,024 - Avg. fwd time: 10.2565 / Avg. bwd time: 16.9112 / Avg. batch time: 478.3507 (ms) / GPU bubble ratio: 54.56%
[rank1]:2025-12-26 07:27:47,039 -  step: 250  loss: -8.0000  grad_norm:  0.1264  memory: 10.83GiB(22.79%)  tps: 8,820  tflops: 68.95  mfu: 22.10%
[rank0]:2025-12-26 07:27:47,037 - Avg. fwd time: 8.4748 / Avg. bwd time: 15.3570 / Avg. batch time: 506.6725 (ms) / GPU bubble ratio: 62.37%
[rank0]:2025-12-26 07:27:47,039 -  step: 250  loss: -8.0000  grad_norm:  0.1264  memory: 15.49GiB(32.61%)  tps: 8,820  tflops: 68.95  mfu: 22.10%
[rank3]:2025-12-26 07:27:47,040 -  step: 250  loss:  7.4130  grad_norm:  0.1264  memory: 19.83GiB(41.74%)  tps: 8,820  tflops: 68.95  mfu: 22.10%
[rank1]:2025-12-26 07:28:17,473 - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:28:17,473 - Freezing Ratio: [Stage2] 0.14, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:28:17,474 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:28:17,473 - Freezing Ratio: [Stage3] 0.14, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:29:08,921 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:29:08,937 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:29:08,914 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:29:08,944 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:29:29,347 - Avg. fwd time: 13.9781 / Avg. bwd time: 30.6793 / Avg. batch time: 420.6170 (ms) / GPU bubble ratio: 15.06%
[rank2]:2025-12-26 07:29:29,364 - Avg. fwd time: 8.2142 / Avg. bwd time: 13.5693 / Avg. batch time: 446.4663 (ms) / GPU bubble ratio: 60.97%
[rank0]:2025-12-26 07:29:29,398 - Avg. fwd time: 8.4775 / Avg. bwd time: 15.2662 / Avg. batch time: 505.9498 (ms) / GPU bubble ratio: 62.46%
[rank1]:2025-12-26 07:29:29,382 - Avg. fwd time: 10.2605 / Avg. bwd time: 16.8653 / Avg. batch time: 477.7299 (ms) / GPU bubble ratio: 54.58%
[rank1]:2025-12-26 07:29:42,964 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:29:42,965 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:29:42,965 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:29:42,965 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:30:16,843 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:30:16,844 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:30:16,843 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:30:16,843 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:30:50,709 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:30:50,710 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:30:50,699 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:30:50,705 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:30:50,705 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:30:54,051 - Avg. fwd time: 10.3231 / Avg. bwd time: 16.3565 / Avg. batch time: 470.7112 (ms) / GPU bubble ratio: 54.66%
[rank1]:2025-12-26 07:30:54,064 -  step: 300  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,760  tflops: 68.48  mfu: 21.95%
[rank3]:2025-12-26 07:30:54,016 - Avg. fwd time: 13.9948 / Avg. bwd time: 29.9032 / Avg. batch time: 414.5392 (ms) / GPU bubble ratio: 15.28%
[rank3]:2025-12-26 07:30:54,065 -  step: 300  loss:  6.8488  grad_norm:  0.0802  memory: 19.83GiB(41.74%)  tps: 8,760  tflops: 68.49  mfu: 21.95%
[rank2]:2025-12-26 07:30:54,033 - Avg. fwd time: 8.2676 / Avg. bwd time: 13.1598 / Avg. batch time: 439.9619 (ms) / GPU bubble ratio: 61.04%
[rank2]:2025-12-26 07:30:54,064 -  step: 300  loss: -8.0000  grad_norm:  0.0802  memory:  7.91GiB(16.66%)  tps: 8,760  tflops: 68.48  mfu: 21.95%
[rank0]:2025-12-26 07:30:54,062 - Avg. fwd time: 8.5272 / Avg. bwd time: 14.6038 / Avg. batch time: 498.2493 (ms) / GPU bubble ratio: 62.86%
[rank0]:2025-12-26 07:30:54,064 -  step: 300  loss: -8.0000  grad_norm:  0.0802  memory: 15.49GiB(32.61%)  tps: 8,760  tflops: 68.48  mfu: 21.95%
[rank0]:2025-12-26 07:30:54,114 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0730_stage0_step300.svg
[rank1]:2025-12-26 07:30:54,114 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0730_stage1_step300.svg
[rank2]:2025-12-26 07:30:54,116 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0730_stage2_step300.svg
[rank3]:2025-12-26 07:30:54,207 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0730_step300_rank3.svg
[rank3]:			> Batch Time: 414.75 ms, GPU Bubble Ratio: 66.99%, 58.00%, 66.19%, 31.50%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-119ms    | [S0,MB1,B]  145-8-153ms    | [S0,MB5,F]  153-8-162ms    | [S0,MB2,B]  188-8-196ms    | [S0,MB6,F]  196-8-205ms    | [S0,MB3,B]  232-8-240ms    | [S0,MB7,F]  240-8-249ms    | [S0,MB4,B]  277-8-285ms    | [S0,MB5,B]  319-7-327ms    | [S0,MB6,B]  362-7-370ms    | [S0,MB7,B]  406-8-414ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  216-10-227ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  261-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-316ms   | [S1,MB6,B]  348-10-359ms   | [S1,MB7,B]  392-10-403ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  85-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  203-8-211ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  336-8-345ms    | [S2,MB7,B]  380-8-389ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-85ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  201-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-377ms  
[rank3]:2025-12-26 07:30:54,250 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0730_stage3_step300.svg
[rank0]:2025-12-26 07:31:24,445 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:31:24,440 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:31:24,444 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:31:24,444 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:31:58,268 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:31:58,249 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:31:58,269 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:31:58,262 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:32:18,169 - Avg. fwd time: 14.0093 / Avg. bwd time: 29.2460 / Avg. batch time: 409.3929 (ms) / GPU bubble ratio: 15.47%
[rank2]:2025-12-26 07:32:18,186 - Avg. fwd time: 8.3128 / Avg. bwd time: 12.8128 / Avg. batch time: 434.4948 (ms) / GPU bubble ratio: 61.10%
[rank0]:2025-12-26 07:32:18,212 - Avg. fwd time: 8.5612 / Avg. bwd time: 13.7956 / Avg. batch time: 491.5174 (ms) / GPU bubble ratio: 63.61%
[rank1]:2025-12-26 07:32:18,205 - Avg. fwd time: 10.3762 / Avg. bwd time: 15.9254 / Avg. batch time: 464.8080 (ms) / GPU bubble ratio: 54.73%
[rank0]:2025-12-26 07:32:31,626 - Freezing Ratio: [Stage0] 0.14, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:32:31,626 - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:32:31,626 - Freezing Ratio: [Stage3] 0.17, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:32:31,625 - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:33:23,118 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:33:23,096 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:33:23,089 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:33:23,111 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:33:57,057 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:33:57,058 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:33:57,050 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:33:57,050 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:33:57,051 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:34:00,422 - Avg. fwd time: 8.3086 / Avg. bwd time: 12.8409 / Avg. batch time: 434.9418 (ms) / GPU bubble ratio: 61.10%
[rank3]:2025-12-26 07:34:00,404 - Avg. fwd time: 14.0103 / Avg. bwd time: 29.2991 / Avg. batch time: 409.8232 (ms) / GPU bubble ratio: 15.46%
[rank0]:2025-12-26 07:34:00,455 - Avg. fwd time: 8.5557 / Avg. bwd time: 13.7871 / Avg. batch time: 491.9813 (ms) / GPU bubble ratio: 63.67%
[rank0]:2025-12-26 07:34:00,456 -  step: 350  loss: -8.0000  grad_norm:  0.0200  memory: 15.49GiB(32.61%)  tps: 8,790  tflops: 68.72  mfu: 22.02%
[rank1]:2025-12-26 07:34:00,440 - Avg. fwd time: 10.3714 / Avg. bwd time: 15.9613 / Avg. batch time: 465.2866 (ms) / GPU bubble ratio: 54.72%
[rank1]:2025-12-26 07:34:00,456 -  step: 350  loss: -8.0000  grad_norm:  0.0200  memory: 10.83GiB(22.79%)  tps: 8,790  tflops: 68.72  mfu: 22.02%
[rank2]:2025-12-26 07:34:00,456 -  step: 350  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,790  tflops: 68.72  mfu: 22.02%
[rank3]:2025-12-26 07:34:00,457 -  step: 350  loss:  4.7421  grad_norm:  0.0200  memory: 19.83GiB(41.74%)  tps: 8,790  tflops: 68.72  mfu: 22.02%
[rank2]:2025-12-26 07:34:30,850 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:34:30,869 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:34:30,870 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:34:30,869 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:35:04,566 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:35:04,560 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:35:04,564 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:35:04,565 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:35:24,692 - Avg. fwd time: 10.4143 / Avg. bwd time: 15.6167 / Avg. batch time: 460.4946 (ms) / GPU bubble ratio: 54.78%
[rank2]:2025-12-26 07:35:24,673 - Avg. fwd time: 8.3455 / Avg. bwd time: 12.5615 / Avg. batch time: 430.5010 (ms) / GPU bubble ratio: 61.15%
[rank3]:2025-12-26 07:35:24,655 - Avg. fwd time: 14.0215 / Avg. bwd time: 28.7700 / Avg. batch time: 405.6734 (ms) / GPU bubble ratio: 15.61%
[rank0]:2025-12-26 07:35:24,704 - Avg. fwd time: 8.5847 / Avg. bwd time: 13.2033 / Avg. batch time: 486.5905 (ms) / GPU bubble ratio: 64.18%
[rank0]:2025-12-26 07:35:38,175 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:35:38,174 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:35:38,174 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:35:38,174 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:36:12,040 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:36:12,031 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:36:12,039 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:36:12,039 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:36:45,883 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:36:45,884 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:36:45,875 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:36:45,863 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:36:45,879 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:36:49,312 - Avg. fwd time: 10.4525 / Avg. bwd time: 15.3155 / Avg. batch time: 456.3186 (ms) / GPU bubble ratio: 54.82%
[rank2]:2025-12-26 07:36:49,292 - Avg. fwd time: 8.3782 / Avg. bwd time: 12.3175 / Avg. batch time: 426.6314 (ms) / GPU bubble ratio: 61.19%
[rank3]:2025-12-26 07:36:49,274 - Avg. fwd time: 14.0322 / Avg. bwd time: 28.3076 / Avg. batch time: 402.0573 (ms) / GPU bubble ratio: 15.75%
[rank3]:2025-12-26 07:36:49,330 -  step: 400  loss:  3.3433  grad_norm:  0.0075  memory: 19.83GiB(41.74%)  tps: 9,702  tflops: 75.85  mfu: 24.31%
[rank0]:2025-12-26 07:36:49,327 - Avg. fwd time: 8.6141 / Avg. bwd time: 12.7972 / Avg. batch time: 481.9999 (ms) / GPU bubble ratio: 64.46%
[rank0]:2025-12-26 07:36:49,329 -  step: 400  loss: -8.0000  grad_norm:  0.0075  memory: 15.49GiB(32.61%)  tps: 9,702  tflops: 75.85  mfu: 24.31%
[rank0]:2025-12-26 07:36:49,382 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0736_stage0_step400.svg
[rank1]:2025-12-26 07:36:49,328 -  step: 400  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 9,702  tflops: 75.85  mfu: 24.31%
[rank1]:2025-12-26 07:36:49,381 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0736_stage1_step400.svg
[rank2]:2025-12-26 07:36:49,328 -  step: 400  loss: -8.0000  grad_norm:  0.0075  memory:  7.91GiB(16.66%)  tps: 9,702  tflops: 75.85  mfu: 24.31%
[rank2]:2025-12-26 07:36:49,382 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0736_stage2_step400.svg
[rank3]:2025-12-26 07:36:49,468 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0736_step400_rank3.svg
[rank3]:			> Batch Time: 411.88 ms, GPU Bubble Ratio: 70.02%, 57.64%, 65.99%, 31.10%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-6-108ms    | [S0,MB4,F]  108-8-117ms    | [S0,MB1,B]  145-6-151ms    | [S0,MB5,F]  151-8-160ms    | [S0,MB2,B]  188-6-194ms    | [S0,MB6,F]  194-8-203ms    | [S0,MB3,B]  232-6-238ms    | [S0,MB7,F]  238-8-247ms    | [S0,MB4,B]  276-6-283ms    | [S0,MB5,B]  319-6-325ms    | [S0,MB6,B]  361-6-367ms    | [S0,MB7,B]  405-6-411ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  216-10-226ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  275-11-286ms   | [S1,MB5,B]  305-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  391-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-211ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  247-8-255ms    | [S2,MB6,F]  259-8-268ms    | [S2,MB5,B]  291-8-300ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  379-8-387ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-171ms   | [S3,MB3,B]  177-21-198ms   | [S3,MB4,F]  200-14-215ms   | [S3,MB4,B]  221-21-243ms   | [S3,MB5,F]  245-14-260ms   | [S3,MB5,B]  266-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-331ms   | [S3,MB7,F]  333-14-348ms   | [S3,MB7,B]  354-21-375ms  
[rank3]:2025-12-26 07:36:49,514 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0736_stage3_step400.svg
[rank3]:2025-12-26 07:37:08,634 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-26 07:37:08,811 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 07:37:08,823 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-26 07:37:08,829 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-26 07:37:19,857 - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:37:19,863 - Freezing Ratio: [Stage3] 0.17, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:37:19,864 - Freezing Ratio: [Stage0] 0.08, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:37:19,863 - Freezing Ratio: [Stage2] 0.14, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:38:11,283 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:38:11,253 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:38:11,261 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:38:11,276 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:38:31,662 - Avg. fwd time: 14.0318 / Avg. bwd time: 28.4040 / Avg. batch time: 402.8265 (ms) / GPU bubble ratio: 15.72%
[rank0]:2025-12-26 07:38:31,716 - Avg. fwd time: 8.6077 / Avg. bwd time: 12.8898 / Avg. batch time: 482.9942 (ms) / GPU bubble ratio: 64.39%
[rank2]:2025-12-26 07:38:31,680 - Avg. fwd time: 8.3709 / Avg. bwd time: 12.3695 / Avg. batch time: 427.4732 (ms) / GPU bubble ratio: 61.19%
[rank1]:2025-12-26 07:38:31,699 - Avg. fwd time: 10.4435 / Avg. bwd time: 15.3802 / Avg. batch time: 457.2217 (ms) / GPU bubble ratio: 54.82%
[rank2]:2025-12-26 07:38:45,159 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:38:45,159 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:38:45,159 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:38:45,160 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:39:18,894 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:39:18,912 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:39:18,912 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:39:18,913 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:39:52,887 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:39:52,893 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:39:52,895 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:39:52,886 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:39:52,884 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:39:56,230 - Avg. fwd time: 8.3978 / Avg. bwd time: 12.1630 / Avg. batch time: 424.1594 (ms) / GPU bubble ratio: 61.22%
[rank1]:2025-12-26 07:39:56,250 - Avg. fwd time: 10.4746 / Avg. bwd time: 15.1230 / Avg. batch time: 453.6473 (ms) / GPU bubble ratio: 54.86%
[rank1]:2025-12-26 07:39:56,267 -  step: 450  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,764  tflops: 68.52  mfu: 21.96%
[rank3]:2025-12-26 07:39:56,212 - Avg. fwd time: 14.0379 / Avg. bwd time: 28.0113 / Avg. batch time: 399.7311 (ms) / GPU bubble ratio: 15.85%
[rank3]:2025-12-26 07:39:56,269 -  step: 450  loss:  5.4456  grad_norm:  0.0500  memory: 19.83GiB(41.74%)  tps: 8,764  tflops: 68.52  mfu: 21.96%
[rank0]:2025-12-26 07:39:56,266 - Avg. fwd time: 8.6337 / Avg. bwd time: 12.5854 / Avg. batch time: 479.1117 (ms) / GPU bubble ratio: 64.57%
[rank0]:2025-12-26 07:39:56,268 -  step: 450  loss: -8.0000  grad_norm:  0.0500  memory: 15.49GiB(32.61%)  tps: 8,764  tflops: 68.52  mfu: 21.96%
[rank2]:2025-12-26 07:39:56,267 -  step: 450  loss: -8.0000  grad_norm:  0.0500  memory:  7.91GiB(16.66%)  tps: 8,764  tflops: 68.52  mfu: 21.96%
[rank0]:2025-12-26 07:40:26,661 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:40:26,660 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:40:26,654 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:40:26,660 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:41:00,380 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:41:00,400 - Freezing Ratio: [Stage0] 0.92, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:41:00,393 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:41:00,399 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:41:20,684 - Avg. fwd time: 14.0450 / Avg. bwd time: 27.6612 / Avg. batch time: 396.9872 (ms) / GPU bubble ratio: 15.95%
[rank0]:2025-12-26 07:41:20,738 - Avg. fwd time: 8.6548 / Avg. bwd time: 12.2608 / Avg. batch time: 475.6080 (ms) / GPU bubble ratio: 64.82%
[rank2]:2025-12-26 07:41:20,702 - Avg. fwd time: 8.4220 / Avg. bwd time: 11.9782 / Avg. batch time: 421.2200 (ms) / GPU bubble ratio: 61.25%
[rank1]:2025-12-26 07:41:20,722 - Avg. fwd time: 10.5027 / Avg. bwd time: 14.8929 / Avg. batch time: 450.4744 (ms) / GPU bubble ratio: 54.90%
[rank3]:2025-12-26 07:41:34,234 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:41:34,215 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:41:34,234 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:41:34,227 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:42:08,116 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:42:08,118 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:42:08,110 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:42:08,116 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:42:41,821 - Freezing Ratio: [Stage3] 0.14, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:42:41,804 - Freezing Ratio: [Stage2] 0.14, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:42:41,825 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:42:41,826 - Freezing Ratio: [Stage0] 0.16, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:42:41,817 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:42:46,874 - Avg. fwd time: 8.4409 / Avg. bwd time: 11.8350 / Avg. batch time: 418.9298 (ms) / GPU bubble ratio: 61.28%
[rank1]:2025-12-26 07:42:46,909 - Avg. fwd time: 10.5245 / Avg. bwd time: 14.7140 / Avg. batch time: 448.0030 (ms) / GPU bubble ratio: 54.93%
[rank3]:2025-12-26 07:42:46,844 - Avg. fwd time: 14.0503 / Avg. bwd time: 27.3885 / Avg. batch time: 394.8484 (ms) / GPU bubble ratio: 16.04%
[rank2]:2025-12-26 07:42:46,965 -  step: 500  loss: -8.0000  grad_norm: 11.7538  memory:  7.91GiB(16.66%)  tps: 9,598  tflops: 75.03  mfu: 24.05%
[rank0]:2025-12-26 07:42:46,943 - Avg. fwd time: 8.6707 / Avg. bwd time: 12.0058 / Avg. batch time: 472.8766 (ms) / GPU bubble ratio: 65.02%
[rank0]:2025-12-26 07:42:46,979 -  step: 500  loss: -8.0000  grad_norm: 11.7538  memory: 15.49GiB(32.61%)  tps: 9,598  tflops: 75.03  mfu: 24.05%
[rank1]:2025-12-26 07:42:46,968 -  step: 500  loss: -8.0000  grad_norm: 11.7538  memory: 10.83GiB(22.79%)  tps: 9,598  tflops: 75.03  mfu: 24.05%
[rank3]:2025-12-26 07:42:46,978 -  step: 500  loss:  5.3958  grad_norm: 11.7538  memory: 19.83GiB(41.74%)  tps: 9,598  tflops: 75.03  mfu: 24.05%
[rank2]:2025-12-26 07:42:47,028 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0742_stage2_step500.svg
[rank0]:2025-12-26 07:42:47,027 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0742_stage0_step500.svg
[rank1]:2025-12-26 07:42:47,028 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0742_stage1_step500.svg
[rank3]:2025-12-26 07:42:47,118 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0742_step500_rank3.svg
[rank3]:			> Batch Time: 415.18 ms, GPU Bubble Ratio: 70.16%, 57.94%, 66.17%, 31.18%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-6-109ms    | [S0,MB4,F]  109-8-117ms    | [S0,MB1,B]  145-6-152ms    | [S0,MB5,F]  152-8-161ms    | [S0,MB2,B]  189-6-195ms    | [S0,MB6,F]  195-8-204ms    | [S0,MB3,B]  233-6-239ms    | [S0,MB7,F]  239-8-248ms    | [S0,MB4,B]  278-6-284ms    | [S0,MB5,B]  321-6-327ms    | [S0,MB6,B]  364-6-370ms    | [S0,MB7,B]  408-6-415ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-11-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  144-11-155ms   | [S1,MB2,B]  173-10-184ms   | [S1,MB5,F]  187-11-198ms   | [S1,MB3,B]  217-10-228ms   | [S1,MB6,F]  231-11-242ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  276-11-287ms   | [S1,MB5,B]  307-10-318ms   | [S1,MB6,B]  350-10-361ms   | [S1,MB7,B]  394-10-405ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-136ms    | [S2,MB2,B]  159-8-168ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  248-8-256ms    | [S2,MB6,F]  260-8-269ms    | [S2,MB5,B]  293-8-302ms    | [S2,MB7,F]  305-8-314ms    | [S2,MB6,B]  338-8-347ms    | [S2,MB7,B]  382-8-391ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-85ms     | [S3,MB1,B]  91-21-112ms    | [S3,MB2,F]  114-13-127ms   | [S3,MB2,B]  134-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  178-21-199ms   | [S3,MB4,F]  202-14-216ms   | [S3,MB4,B]  222-21-244ms   | [S3,MB5,F]  246-14-261ms   | [S3,MB5,B]  267-22-289ms   | [S3,MB6,F]  291-14-306ms   | [S3,MB6,B]  312-21-334ms   | [S3,MB7,F]  336-14-351ms   | [S3,MB7,B]  357-22-379ms  
[rank3]:2025-12-26 07:42:47,161 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0742_stage3_step500.svg
[rank2]:2025-12-26 07:43:33,437 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:43:33,444 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:43:33,460 - Freezing Ratio: [Stage3] 0.86, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:43:33,466 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:44:07,465 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:44:07,467 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:44:07,465 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:44:07,466 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:44:27,668 - Avg. fwd time: 14.0490 / Avg. bwd time: 27.4715 / Avg. batch time: 395.4997 (ms) / GPU bubble ratio: 16.01%
[rank2]:2025-12-26 07:44:27,688 - Avg. fwd time: 8.4344 / Avg. bwd time: 11.8789 / Avg. batch time: 419.6430 (ms) / GPU bubble ratio: 61.28%
[rank1]:2025-12-26 07:44:27,709 - Avg. fwd time: 10.5170 / Avg. bwd time: 14.7688 / Avg. batch time: 448.7700 (ms) / GPU bubble ratio: 54.92%
[rank0]:2025-12-26 07:44:27,725 - Avg. fwd time: 8.6659 / Avg. bwd time: 12.1002 / Avg. batch time: 473.7362 (ms) / GPU bubble ratio: 64.93%
[rank2]:2025-12-26 07:44:41,286 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:44:41,305 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:44:41,304 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:44:41,305 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:45:15,004 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:45:15,010 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:45:15,010 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:45:15,011 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:45:48,770 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:45:48,789 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:45:48,791 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:45:48,781 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:45:48,784 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:45:52,148 - Avg. fwd time: 14.0544 / Avg. bwd time: 27.1944 / Avg. batch time: 393.3267 (ms) / GPU bubble ratio: 16.10%
[rank2]:2025-12-26 07:45:52,167 - Avg. fwd time: 8.4535 / Avg. bwd time: 11.7334 / Avg. batch time: 417.3153 (ms) / GPU bubble ratio: 61.30%
[rank2]:2025-12-26 07:45:52,206 -  step: 550  loss: -8.0000  grad_norm:  0.0845  memory:  7.91GiB(16.66%)  tps: 8,845  tflops: 69.14  mfu: 22.16%
[rank0]:2025-12-26 07:45:52,205 - Avg. fwd time: 8.6826 / Avg. bwd time: 11.8424 / Avg. batch time: 470.9607 (ms) / GPU bubble ratio: 65.14%
[rank0]:2025-12-26 07:45:52,206 -  step: 550  loss: -8.0000  grad_norm:  0.0845  memory: 15.49GiB(32.61%)  tps: 8,845  tflops: 69.15  mfu: 22.16%
[rank1]:2025-12-26 07:45:52,188 - Avg. fwd time: 10.5393 / Avg. bwd time: 14.5875 / Avg. batch time: 446.2595 (ms) / GPU bubble ratio: 54.96%
[rank1]:2025-12-26 07:45:52,206 -  step: 550  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,845  tflops: 69.15  mfu: 22.16%
[rank3]:2025-12-26 07:45:52,208 -  step: 550  loss:  3.8514  grad_norm:  0.0845  memory: 19.83GiB(41.74%)  tps: 8,845  tflops: 69.15  mfu: 22.16%
[rank2]:2025-12-26 07:46:22,648 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:46:22,650 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:46:22,642 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:46:22,649 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:46:56,101 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:46:56,115 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:46:56,113 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:46:56,115 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:47:16,271 - Avg. fwd time: 14.0596 / Avg. bwd time: 26.9414 / Avg. batch time: 391.3418 (ms) / GPU bubble ratio: 16.18%
[rank2]:2025-12-26 07:47:16,290 - Avg. fwd time: 8.4711 / Avg. bwd time: 11.6004 / Avg. batch time: 415.1898 (ms) / GPU bubble ratio: 61.33%
[rank0]:2025-12-26 07:47:16,329 - Avg. fwd time: 8.6954 / Avg. bwd time: 11.5220 / Avg. batch time: 468.3427 (ms) / GPU bubble ratio: 65.47%
[rank1]:2025-12-26 07:47:16,312 - Avg. fwd time: 10.5599 / Avg. bwd time: 14.4219 / Avg. batch time: 443.9681 (ms) / GPU bubble ratio: 54.98%
[rank2]:2025-12-26 07:47:29,864 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:47:29,865 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:47:29,857 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:47:29,864 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:48:03,234 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:48:03,235 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:48:03,220 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:48:03,235 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:48:37,126 - Freezing Ratio: [Stage2] 0.14, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:48:37,148 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:48:37,149 - Freezing Ratio: [Stage0] 0.16, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:48:37,139 - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:48:37,144 - Freezing Ratio: [Stage3] 0.17, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:48:42,256 - Avg. fwd time: 14.0640 / Avg. bwd time: 26.7457 / Avg. batch time: 389.8078 (ms) / GPU bubble ratio: 16.25%
[rank2]:2025-12-26 07:48:42,288 - Avg. fwd time: 8.4847 / Avg. bwd time: 11.4973 / Avg. batch time: 413.5461 (ms) / GPU bubble ratio: 61.35%
[rank0]:2025-12-26 07:48:42,360 - Avg. fwd time: 8.7059 / Avg. bwd time: 11.2949 / Avg. batch time: 466.3372 (ms) / GPU bubble ratio: 65.69%
[rank1]:2025-12-26 07:48:42,324 - Avg. fwd time: 10.5760 / Avg. bwd time: 14.2940 / Avg. batch time: 442.1960 (ms) / GPU bubble ratio: 55.01%
[rank1]:2025-12-26 07:48:42,385 -  step: 600  loss: -8.0000  grad_norm: 19.5628  memory: 10.83GiB(22.79%)  tps: 9,627  tflops: 75.26  mfu: 24.12%
[rank3]:2025-12-26 07:48:42,395 -  step: 600  loss:  2.9530  grad_norm: 19.5628  memory: 19.83GiB(41.74%)  tps: 9,627  tflops: 75.26  mfu: 24.12%
[rank2]:2025-12-26 07:48:42,382 -  step: 600  loss: -8.0000  grad_norm: 19.5628  memory:  7.91GiB(16.66%)  tps: 9,628  tflops: 75.26  mfu: 24.12%
[rank2]:2025-12-26 07:48:42,447 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0748_stage2_step600.svg
[rank0]:2025-12-26 07:48:42,397 -  step: 600  loss: -8.0000  grad_norm: 19.5628  memory: 15.49GiB(32.61%)  tps: 9,627  tflops: 75.26  mfu: 24.12%
[rank0]:2025-12-26 07:48:42,446 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0748_stage0_step600.svg
[rank1]:2025-12-26 07:48:42,446 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0748_stage1_step600.svg
[rank3]:2025-12-26 07:48:42,548 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0748_step600_rank3.svg
[rank3]:			> Batch Time: 413.99 ms, GPU Bubble Ratio: 67.05%, 57.98%, 66.20%, 31.62%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  110-8-118ms    | [S0,MB1,B]  144-8-152ms    | [S0,MB5,F]  153-8-161ms    | [S0,MB2,B]  187-7-195ms    | [S0,MB6,F]  195-8-204ms    | [S0,MB3,B]  231-8-239ms    | [S0,MB7,F]  239-8-248ms    | [S0,MB4,B]  276-8-284ms    | [S0,MB5,B]  318-7-326ms    | [S0,MB6,B]  361-7-369ms    | [S0,MB7,B]  406-7-413ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-10-111ms   | [S1,MB1,B]  128-10-139ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  171-10-182ms   | [S1,MB5,F]  186-10-197ms   | [S1,MB3,B]  215-10-226ms   | [S1,MB6,F]  230-10-241ms   | [S1,MB4,B]  260-10-271ms   | [S1,MB7,F]  274-10-285ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  391-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-123ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-166ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  202-8-210ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  258-8-267ms    | [S2,MB5,B]  290-8-299ms    | [S2,MB7,F]  303-8-311ms    | [S2,MB6,B]  335-8-343ms    | [S2,MB7,B]  379-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  176-21-198ms   | [S3,MB4,F]  200-14-214ms   | [S3,MB4,B]  220-21-242ms   | [S3,MB5,F]  244-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-303ms   | [S3,MB6,B]  309-21-331ms   | [S3,MB7,F]  333-14-348ms   | [S3,MB7,B]  354-21-376ms  
[rank3]:2025-12-26 07:48:42,595 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0748_stage3_step600.svg
[rank2]:2025-12-26 07:49:28,898 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:49:28,928 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:49:28,905 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:49:28,921 - Freezing Ratio: [Stage3] 0.86, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:50:02,857 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:50:02,856 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:50:02,857 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:50:02,856 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:50:22,901 - Avg. fwd time: 10.5677 / Avg. bwd time: 14.3582 / Avg. batch time: 443.0745 (ms) / GPU bubble ratio: 54.99%
[rank3]:2025-12-26 07:50:22,858 - Avg. fwd time: 14.0619 / Avg. bwd time: 26.8413 / Avg. batch time: 390.5541 (ms) / GPU bubble ratio: 16.22%
[rank2]:2025-12-26 07:50:22,878 - Avg. fwd time: 8.4777 / Avg. bwd time: 11.5485 / Avg. batch time: 414.3621 (ms) / GPU bubble ratio: 61.34%
[rank0]:2025-12-26 07:50:22,912 - Avg. fwd time: 8.6984 / Avg. bwd time: 11.3406 / Avg. batch time: 467.2610 (ms) / GPU bubble ratio: 65.69%
[rank3]:2025-12-26 07:50:36,145 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:50:36,145 - Freezing Ratio: [Stage2] 0.94, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:50:36,145 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:50:36,145 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:51:09,852 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:51:09,847 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:51:09,851 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:51:09,851 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:51:43,759 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:51:43,772 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:51:43,780 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:51:43,781 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:51:43,774 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:51:47,121 - Avg. fwd time: 10.5846 / Avg. bwd time: 14.2224 / Avg. batch time: 441.1854 (ms) / GPU bubble ratio: 55.02%
[rank3]:2025-12-26 07:51:47,079 - Avg. fwd time: 14.0671 / Avg. bwd time: 26.6320 / Avg. batch time: 388.9189 (ms) / GPU bubble ratio: 16.28%
[rank3]:2025-12-26 07:51:47,138 -  step: 650  loss:  4.1058  grad_norm:  0.0116  memory: 19.83GiB(41.74%)  tps: 8,869  tflops: 69.33  mfu: 22.22%
[rank2]:2025-12-26 07:51:47,099 - Avg. fwd time: 8.4923 / Avg. bwd time: 11.4389 / Avg. batch time: 412.6115 (ms) / GPU bubble ratio: 61.36%
[rank2]:2025-12-26 07:51:47,136 -  step: 650  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,868  tflops: 69.33  mfu: 22.22%
[rank1]:2025-12-26 07:51:47,136 -  step: 650  loss: -8.0000  grad_norm:  0.0000  memory: 10.83GiB(22.79%)  tps: 8,868  tflops: 69.33  mfu: 22.22%
[rank0]:2025-12-26 07:51:47,134 - Avg. fwd time: 8.7081 / Avg. bwd time: 11.0715 / Avg. batch time: 465.0954 (ms) / GPU bubble ratio: 65.98%
[rank0]:2025-12-26 07:51:47,136 -  step: 650  loss: -8.0000  grad_norm:  0.0116  memory: 15.49GiB(32.61%)  tps: 8,869  tflops: 69.33  mfu: 22.22%
[rank3]:2025-12-26 07:52:17,178 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:52:17,164 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:52:17,177 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:52:17,179 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:52:50,407 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:52:50,407 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:52:50,406 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:52:50,394 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:53:10,411 - Avg. fwd time: 14.0712 / Avg. bwd time: 26.4369 / Avg. batch time: 387.3868 (ms) / GPU bubble ratio: 16.35%
[rank2]:2025-12-26 07:53:10,432 - Avg. fwd time: 8.5059 / Avg. bwd time: 11.3372 / Avg. batch time: 410.9723 (ms) / GPU bubble ratio: 61.37%
[rank1]:2025-12-26 07:53:10,455 - Avg. fwd time: 10.6001 / Avg. bwd time: 14.0969 / Avg. batch time: 439.4186 (ms) / GPU bubble ratio: 55.04%
[rank0]:2025-12-26 07:53:10,467 - Avg. fwd time: 8.7127 / Avg. bwd time: 10.6822 / Avg. batch time: 462.9291 (ms) / GPU bubble ratio: 66.48%
[rank1]:2025-12-26 07:53:23,734 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:53:23,734 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:53:23,733 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:53:23,733 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:53:57,790 - Freezing Ratio: [Stage1] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:53:57,798 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:53:57,798 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:53:57,777 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:54:31,566 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:54:31,549 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:54:31,562 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:54:31,570 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 07:54:31,571 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:54:34,898 - Avg. fwd time: 8.5184 / Avg. bwd time: 11.2426 / Avg. batch time: 409.4636 (ms) / GPU bubble ratio: 61.39%
[rank1]:2025-12-26 07:54:34,921 - Avg. fwd time: 10.6145 / Avg. bwd time: 13.9801 / Avg. batch time: 437.7906 (ms) / GPU bubble ratio: 55.06%
[rank1]:2025-12-26 07:54:34,939 -  step: 700  loss: -8.0000  grad_norm:  0.0104  memory: 10.83GiB(22.79%)  tps: 9,764  tflops: 76.33  mfu: 24.46%
[rank0]:2025-12-26 07:54:34,938 - Avg. fwd time: 8.7231 / Avg. bwd time: 10.5132 / Avg. batch time: 461.1273 (ms) / GPU bubble ratio: 66.63%
[rank0]:2025-12-26 07:54:34,940 -  step: 700  loss: -8.0000  grad_norm:  0.0104  memory: 15.49GiB(32.61%)  tps: 9,764  tflops: 76.33  mfu: 24.46%
[rank3]:2025-12-26 07:54:34,877 - Avg. fwd time: 14.0754 / Avg. bwd time: 26.2565 / Avg. batch time: 385.9785 (ms) / GPU bubble ratio: 16.41%
[rank3]:2025-12-26 07:54:34,941 -  step: 700  loss:  4.2610  grad_norm:  0.0104  memory: 19.83GiB(41.74%)  tps: 9,764  tflops: 76.33  mfu: 24.46%
[rank2]:2025-12-26 07:54:34,939 -  step: 700  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,764  tflops: 76.33  mfu: 24.46%
[rank2]:2025-12-26 07:54:34,992 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0754_stage2_step700.svg
[rank1]:2025-12-26 07:54:34,994 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0754_stage1_step700.svg
[rank0]:2025-12-26 07:54:34,993 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0754_stage0_step700.svg
[rank3]:2025-12-26 07:54:35,078 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0754_step700_rank3.svg
[rank3]:			> Batch Time: 412.66 ms, GPU Bubble Ratio: 70.03%, 57.65%, 65.96%, 31.05%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-6-108ms    | [S0,MB4,F]  108-8-117ms    | [S0,MB1,B]  145-6-151ms    | [S0,MB5,F]  151-8-160ms    | [S0,MB2,B]  187-6-194ms    | [S0,MB6,F]  194-8-202ms    | [S0,MB3,B]  231-6-238ms    | [S0,MB7,F]  238-8-246ms    | [S0,MB4,B]  276-6-282ms    | [S0,MB5,B]  319-6-325ms    | [S0,MB6,B]  362-6-368ms    | [S0,MB7,B]  406-6-412ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-10-20ms      | [S1,MB1,F]  23-11-34ms     | [S1,MB2,F]  37-11-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  100-11-111ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-11-154ms   | [S1,MB2,B]  172-10-182ms   | [S1,MB5,F]  186-11-197ms   | [S1,MB3,B]  215-10-226ms   | [S1,MB6,F]  230-11-241ms   | [S1,MB4,B]  259-10-270ms   | [S1,MB7,F]  274-11-285ms   | [S1,MB5,B]  304-10-315ms   | [S1,MB6,B]  347-10-358ms   | [S1,MB7,B]  392-10-402ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  72-8-81ms      | [S2,MB2,F]  84-8-93ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  127-8-136ms    | [S2,MB2,B]  158-8-167ms    | [S2,MB4,F]  170-8-179ms    | [S2,MB3,B]  201-8-210ms    | [S2,MB5,F]  214-8-223ms    | [S2,MB4,B]  246-8-255ms    | [S2,MB6,F]  258-8-267ms    | [S2,MB5,B]  291-8-299ms    | [S2,MB7,F]  303-8-312ms    | [S2,MB6,B]  335-8-344ms    | [S2,MB7,B]  380-8-388ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-68ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  113-13-127ms   | [S3,MB2,B]  133-21-154ms   | [S3,MB3,F]  156-14-170ms   | [S3,MB3,B]  176-21-198ms   | [S3,MB4,F]  200-14-214ms   | [S3,MB4,B]  220-21-242ms   | [S3,MB5,F]  244-14-259ms   | [S3,MB5,B]  265-21-287ms   | [S3,MB6,F]  289-14-304ms   | [S3,MB6,B]  310-21-332ms   | [S3,MB7,F]  334-14-349ms   | [S3,MB7,B]  355-21-376ms  
[rank3]:2025-12-26 07:54:35,124 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0754_stage3_step700.svg
[rank2]:2025-12-26 07:55:05,347 - Freezing Ratio: [Stage2] 0.14, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:55:05,364 - Freezing Ratio: [Stage0] 0.19, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:55:05,364 - Freezing Ratio: [Stage1] 0.09, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:55:05,363 - Freezing Ratio: [Stage3] 0.17, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:55:56,885 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:55:56,915 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:55:56,892 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:55:56,908 - Freezing Ratio: [Stage3] 0.90, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:56:17,279 - Avg. fwd time: 10.6037 / Avg. bwd time: 14.0661 / Avg. batch time: 438.9723 (ms) / GPU bubble ratio: 55.04%
[rank3]:2025-12-26 07:56:17,235 - Avg. fwd time: 14.0736 / Avg. bwd time: 26.3852 / Avg. batch time: 386.9931 (ms) / GPU bubble ratio: 16.36%
[rank2]:2025-12-26 07:56:17,256 - Avg. fwd time: 8.5092 / Avg. bwd time: 11.3116 / Avg. batch time: 410.5602 (ms) / GPU bubble ratio: 61.38%
[rank0]:2025-12-26 07:56:17,300 - Avg. fwd time: 8.7139 / Avg. bwd time: 10.6194 / Avg. batch time: 462.4153 (ms) / GPU bubble ratio: 66.55%
[rank1]:2025-12-26 07:56:30,998 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:56:30,998 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:56:30,998 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:56:30,998 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:57:04,164 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:57:04,177 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:57:04,176 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:57:04,176 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:57:37,717 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:57:37,716 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:57:37,718 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:57:37,723 - [GC] Peforming periodical GC collection 0.01 seconds
[rank0]:2025-12-26 07:57:37,724 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:57:41,090 - Avg. fwd time: 14.0774 / Avg. bwd time: 26.2177 / Avg. batch time: 385.6800 (ms) / GPU bubble ratio: 16.42%
[rank2]:2025-12-26 07:57:41,112 - Avg. fwd time: 8.5210 / Avg. bwd time: 11.2245 / Avg. batch time: 409.1546 (ms) / GPU bubble ratio: 61.39%
[rank1]:2025-12-26 07:57:41,135 - Avg. fwd time: 10.6172 / Avg. bwd time: 13.9587 / Avg. batch time: 437.4580 (ms) / GPU bubble ratio: 55.06%
[rank1]:2025-12-26 07:57:41,155 -  step: 750  loss: -8.0000  grad_norm:  0.0683  memory: 10.83GiB(22.79%)  tps: 8,798  tflops: 68.78  mfu: 22.05%
[rank0]:2025-12-26 07:57:41,154 - Avg. fwd time: 8.7222 / Avg. bwd time: 10.3694 / Avg. batch time: 460.6447 (ms) / GPU bubble ratio: 66.84%
[rank0]:2025-12-26 07:57:41,156 -  step: 750  loss: -8.0000  grad_norm:  0.0683  memory: 15.49GiB(32.61%)  tps: 8,798  tflops: 68.78  mfu: 22.05%
[rank3]:2025-12-26 07:57:41,157 -  step: 750  loss:  3.5013  grad_norm:  0.0683  memory: 19.83GiB(41.74%)  tps: 8,798  tflops: 68.78  mfu: 22.05%
[rank2]:2025-12-26 07:57:41,155 -  step: 750  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 8,798  tflops: 68.78  mfu: 22.05%
[rank2]:2025-12-26 07:58:11,562 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:58:11,581 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:58:11,582 - Freezing Ratio: [Stage0] 0.97, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:58:11,581 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:58:45,048 - Freezing Ratio: [Stage1] 0.96, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:58:45,049 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:58:45,048 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:58:45,034 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:59:04,895 - Avg. fwd time: 14.0806 / Avg. bwd time: 26.0604 / Avg. batch time: 384.4455 (ms) / GPU bubble ratio: 16.47%
[rank2]:2025-12-26 07:59:04,917 - Avg. fwd time: 8.5321 / Avg. bwd time: 11.1427 / Avg. batch time: 407.8338 (ms) / GPU bubble ratio: 61.41%
[rank1]:2025-12-26 07:59:04,941 - Avg. fwd time: 10.6298 / Avg. bwd time: 13.8582 / Avg. batch time: 436.0355 (ms) / GPU bubble ratio: 55.07%
[rank0]:2025-12-26 07:59:04,953 - Avg. fwd time: 8.7288 / Avg. bwd time: 10.1368 / Avg. batch time: 458.9833 (ms) / GPU bubble ratio: 67.12%
[rank2]:2025-12-26 07:59:18,256 - Freezing Ratio: [Stage2] 0.97, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:59:18,269 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:59:18,268 - Freezing Ratio: [Stage0] 0.95, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:59:18,268 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank0]:2025-12-26 07:59:52,173 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 07:59:52,172 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 07:59:52,172 - Freezing Ratio: [Stage3] 0.93, Threshold: 1.0000e-01
[rank2]:2025-12-26 07:59:52,171 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank0]:2025-12-26 08:00:25,467 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-26 08:00:25,468 - Freezing Ratio: [Stage0] 1.00, Threshold: 1.0000e-01
[rank1]:2025-12-26 08:00:25,467 - Freezing Ratio: [Stage1] 0.98, Threshold: 1.0000e-01
[rank3]:2025-12-26 08:00:25,464 - Freezing Ratio: [Stage3] 0.97, Threshold: 1.0000e-01
[rank2]:2025-12-26 08:00:25,453 - Freezing Ratio: [Stage2] 1.00, Threshold: 1.0000e-01
[rank3]:2025-12-26 08:00:28,828 - Avg. fwd time: 14.0844 / Avg. bwd time: 25.9139 / Avg. batch time: 383.3015 (ms) / GPU bubble ratio: 16.52%
[rank2]:2025-12-26 08:00:28,850 - Avg. fwd time: 8.5426 / Avg. bwd time: 11.0661 / Avg. batch time: 406.6091 (ms) / GPU bubble ratio: 61.42%
[rank0]:2025-12-26 08:00:28,888 - Avg. fwd time: 8.7364 / Avg. bwd time: 9.9203 / Avg. batch time: 457.4425 (ms) / GPU bubble ratio: 67.37%
[rank0]:2025-12-26 08:00:28,889 -  step: 800  loss: -8.0000  grad_norm:  0.0000  memory: 15.49GiB(32.61%)  tps: 9,768  tflops: 76.36  mfu: 24.47%
[rank0]:2025-12-26 08:00:28,889 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0000  tps: 9,264  tflops: 72.42  mfu: 21.28%
[rank0]:2025-12-26 08:00:28,889 - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-12-26 08:00:28,890 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-12-26 08:00:28,874 - Avg. fwd time: 10.6417 / Avg. bwd time: 13.7640 / Avg. batch time: 434.7159 (ms) / GPU bubble ratio: 55.09%
[rank1]:2025-12-26 08:00:28,889 -  step: 800  loss: -8.0000  grad_norm:  0.0099  memory: 10.83GiB(22.79%)  tps: 9,768  tflops: 76.36  mfu: 24.47%
[rank1]:2025-12-26 08:00:28,889 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0099  tps: 9,264  tflops: 72.42  mfu: 21.28%
[rank1]:2025-12-26 08:00:28,889 - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-12-26 08:00:28,890 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-12-26 08:00:28,891 -  step: 800  loss:  2.8784  grad_norm:  0.0099  memory: 19.83GiB(41.74%)  tps: 9,768  tflops: 76.36  mfu: 24.47%
[rank3]:2025-12-26 08:00:28,891 - â„¹ï¸ final step: 800  loss:  2.8784  grad_norm:  0.0099  tps: 9,270  tflops: 72.47  mfu: 21.39%
[rank3]:2025-12-26 08:00:28,892 - Saving the checkpoint (or staging if async is enabled).
[rank3]:2025-12-26 08:00:28,893 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank2]:2025-12-26 08:00:28,889 -  step: 800  loss: -8.0000  grad_norm:  0.0000  memory:  7.91GiB(16.66%)  tps: 9,768  tflops: 76.36  mfu: 24.47%
[rank2]:2025-12-26 08:00:28,889 - â„¹ï¸ final step: 800  loss: -8.0000  grad_norm:  0.0000  tps: 9,264  tflops: 72.42  mfu: 21.28%
[rank2]:2025-12-26 08:00:28,889 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-26 08:00:28,890 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-26 08:00:31,022 - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank0]:2025-12-26 08:00:31,102 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank0/251226_0800_stage0_final800.svg
[rank1]:2025-12-26 08:00:31,103 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank1/251226_0800_stage1_final800.svg
[rank2]:2025-12-26 08:00:31,104 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank2/251226_0800_stage2_final800.svg
[rank3]:2025-12-26 08:00:31,226 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0800_final800_rank3.svg
[rank3]:			> Batch Time: 415.89 ms, GPU Bubble Ratio: 67.48%, 58.05%, 66.27%, 31.47%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-9-9ms        | [S0,MB1,F]  9-9-18ms       | [S0,MB2,F]  18-9-28ms      | [S0,MB3,F]  28-9-37ms      | [S0,MB0,B]  102-7-110ms    | [S0,MB4,F]  109-8-118ms    | [S0,MB1,B]  145-7-153ms    | [S0,MB5,F]  152-8-161ms    | [S0,MB2,B]  188-7-196ms    | [S0,MB6,F]  195-8-204ms    | [S0,MB3,B]  233-7-240ms    | [S0,MB7,F]  239-8-248ms    | [S0,MB4,B]  277-7-285ms    | [S0,MB5,B]  320-7-328ms    | [S0,MB6,B]  363-7-371ms    | [S0,MB7,B]  408-7-415ms   
[rank3]:			  [Rank 1]	[S1,MB0,F]  9-11-20ms      | [S1,MB1,F]  23-10-34ms     | [S1,MB2,F]  37-10-48ms     | [S1,MB0,B]  86-10-97ms     | [S1,MB3,F]  101-10-112ms   | [S1,MB1,B]  129-10-140ms   | [S1,MB4,F]  143-10-154ms   | [S1,MB2,B]  172-10-183ms   | [S1,MB5,F]  187-10-198ms   | [S1,MB3,B]  217-10-227ms   | [S1,MB6,F]  231-10-242ms   | [S1,MB4,B]  261-10-272ms   | [S1,MB7,F]  276-10-287ms   | [S1,MB5,B]  306-10-317ms   | [S1,MB6,B]  349-10-360ms   | [S1,MB7,B]  393-10-404ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  20-8-29ms      | [S2,MB1,F]  34-8-43ms      | [S2,MB0,B]  73-8-81ms      | [S2,MB2,F]  85-8-94ms      | [S2,MB1,B]  115-8-124ms    | [S2,MB3,F]  128-8-136ms    | [S2,MB2,B]  159-8-167ms    | [S2,MB4,F]  171-8-180ms    | [S2,MB3,B]  203-8-212ms    | [S2,MB5,F]  215-8-224ms    | [S2,MB4,B]  247-8-256ms    | [S2,MB6,F]  260-8-268ms    | [S2,MB5,B]  292-8-301ms    | [S2,MB7,F]  304-8-313ms    | [S2,MB6,B]  337-8-346ms    | [S2,MB7,B]  381-8-390ms   
[rank3]:			  [Rank 3]	[S3,MB0,F]  29-13-42ms     | [S3,MB0,B]  48-20-69ms     | [S3,MB1,F]  71-13-84ms     | [S3,MB1,B]  90-20-111ms    | [S3,MB2,F]  114-13-128ms   | [S3,MB2,B]  133-21-155ms   | [S3,MB3,F]  157-14-171ms   | [S3,MB3,B]  177-21-199ms   | [S3,MB4,F]  201-14-216ms   | [S3,MB4,B]  222-21-244ms   | [S3,MB5,F]  246-14-260ms   | [S3,MB5,B]  266-21-288ms   | [S3,MB6,F]  290-14-305ms   | [S3,MB6,B]  311-21-333ms   | [S3,MB7,F]  335-14-350ms   | [S3,MB7,B]  356-21-378ms  
[rank0]:2025-12-26 08:00:31,260 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_params_histogram/251226_0800_rank0_stage0.svg
[rank0]:	> Counts Sum: 2271, Total Sum: 2775 (81.84%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 64.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 42.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 66.66, 69.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 58.66, 82.66]
[rank0]:2025-12-26 08:00:31,260 - Sleeping 2 seconds for other ranks to complete
[rank1]:2025-12-26 08:00:31,253 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_params_histogram/251226_0800_rank1_stage1.svg
[rank1]:	> Counts Sum: 2853, Total Sum: 3375 (84.53%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66, 73.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 65.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33]
[rank1]:2025-12-26 08:00:31,254 - Destroying the purge thread.
[rank2]:2025-12-26 08:00:31,279 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_params_histogram/251226_0800_rank2_stage2.svg
[rank2]:	> Counts Sum: 2287, Total Sum: 2700 (84.70%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 78.66, 82.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 76.0]
[rank2]:2025-12-26 08:00:31,280 - Destroying the purge thread.
[rank3]:2025-12-26 08:00:31,356 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/pipeline_schedule/251226_0800_thry_final800_rank3.svg
[rank3]:			> Batch Time: 354.27 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-10-10ms      | [S0,MB1,F]  10-10-21ms     | [S0,MB2,F]  21-10-32ms     | [S0,MB3,F]  32-10-42ms     | [S0,MB0,B]  107-21-128ms   | [S0,MB4,F]  128-10-139ms   | [S0,MB1,B]  139-21-161ms   | [S0,MB5,F]  161-10-171ms   | [S0,MB2,B]  171-21-193ms   | [S0,MB6,F]  193-10-203ms   | [S0,MB3,B]  203-21-225ms   | [S0,MB7,F]  225-10-236ms   | [S0,MB4,B]  236-21-257ms   | [S0,MB5,B]  268-21-289ms   | [S0,MB6,B]  300-21-322ms   | [S0,MB7,B]  332-21-354ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  10-10-21ms     | [S1,MB1,F]  21-10-32ms     | [S1,MB2,F]  32-10-42ms     | [S1,MB0,B]  85-21-107ms    | [S1,MB3,F]  107-10-118ms   | [S1,MB1,B]  118-21-139ms   | [S1,MB4,F]  139-10-150ms   | [S1,MB2,B]  150-21-171ms   | [S1,MB5,F]  171-10-182ms   | [S1,MB3,B]  182-21-203ms   | [S1,MB6,F]  203-10-214ms   | [S1,MB4,B]  214-21-236ms   | [S1,MB7,F]  236-10-246ms   | [S1,MB5,B]  246-21-268ms   | [S1,MB6,B]  279-21-300ms   | [S1,MB7,B]  311-21-332ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  21-10-32ms     | [S2,MB1,F]  32-10-42ms     | [S2,MB0,B]  64-21-85ms     | [S2,MB2,F]  85-10-96ms     | [S2,MB1,B]  96-21-118ms    | [S2,MB3,F]  118-10-128ms   | [S2,MB2,B]  128-21-150ms   | [S2,MB4,F]  150-10-161ms   | [S2,MB3,B]  161-21-182ms   | [S2,MB5,F]  182-10-193ms   | [S2,MB4,B]  193-21-214ms   | [S2,MB6,F]  214-10-225ms   | [S2,MB5,B]  225-21-246ms   | [S2,MB7,F]  246-10-257ms   | [S2,MB6,B]  257-21-279ms   | [S2,MB7,B]  289-21-311ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  32-10-42ms     | [S3,MB0,B]  42-21-64ms     | [S3,MB1,F]  64-10-75ms     | [S3,MB1,B]  75-21-96ms     | [S3,MB2,F]  96-10-107ms    | [S3,MB2,B]  107-21-128ms   | [S3,MB3,F]  128-10-139ms   | [S3,MB3,B]  139-21-161ms   | [S3,MB4,F]  161-10-171ms   | [S3,MB4,B]  171-21-193ms   | [S3,MB5,F]  193-10-203ms   | [S3,MB5,B]  203-21-225ms   | [S3,MB6,F]  225-10-236ms   | [S3,MB6,B]  236-21-257ms   | [S3,MB7,F]  257-10-268ms   | [S3,MB7,B]  268-21-289ms  
[rank3]:2025-12-26 08:00:31,402 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_ratio_history/rank3/251226_0800_stage3_final800.svg
[rank3]:2025-12-26 08:00:31,532 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1/frozen_params_histogram/251226_0800_rank3_stage3.svg
[rank3]:	> Counts Sum: 1764, Total Sum: 2175 (81.10%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 84.0, 84.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 82.66, 56.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 77.33, 5.33, 85.33]
[rank3]:2025-12-26 08:00:31,533 - Destroying the purge thread.
[rank3]:wandb: updating run metadata
[rank1]:2025-12-26 08:00:31,758 - Process group destroyed
[rank2]:2025-12-26 08:00:31,786 - Process group destroyed
[rank3]:wandb: uploading history steps 15-16, summary, console lines 350-371
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–â–‚â–‚â–â–â–â–â–â–‚â–â–‚â–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–‚â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–‡â–‡â–„â–‚â–…â–…â–ƒâ–â–ƒâ–ƒâ–‚â–â–‚â–‚â–‚â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 3.53469
[rank3]:wandb:               final/avg_loss 2.87841
[rank3]:wandb:             final/avg_mfu(%) 21.38607
[rank3]:wandb:             final/avg_tflops 72.47165
[rank3]:wandb:    final/avg_throughput(tps) 9270.39135
[rank3]:wandb:              final/grad_norm 0.00988
[rank3]:wandb:               final/max_loss 2.87841
[rank3]:wandb:                    grad_norm 0.00988
[rank3]:wandb: loss_metrics/global_avg_loss 2.87841
[rank3]:wandb: loss_metrics/global_max_loss 2.87841
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1226_1F1B_APF_th0.1_42_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/myocaf1e
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.1_42_dm1/20251226-0710/wandb/run-20251226_071023-myocaf1e/logs
[rank3]:2025-12-26 08:00:32,719 - Process group destroyed
[rank0]:2025-12-26 08:00:33,260 - Training completed
[rank0]:2025-12-26 08:00:33,261 - Destroying the purge thread.
[rank0]:2025-12-26 08:00:33,785 - Process group destroyed
[rank1]:Stage 1: Modules to keep: {'layers.5', 'layers.7', 'layers.4', 'layers.8', 'layers.6'}
[rank0]:Stage 0: Modules to keep: {'layers.2', 'layers.0', 'layers.3', 'tok_embeddings', 'layers.1'}
[rank2]:Stage 2: Modules to keep: {'layers.10', 'layers.11', 'layers.12', 'layers.9'}
[rank3]:Stage 3: Modules to keep: {'output', 'layers.15', 'layers.13', 'layers.14', 'norm'}
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1116_apf/config_1226.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "APF configuration experiment on different threshold values.
[rank3]:1226: everything same as 1116, but debugged
[rank3]:"
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1226_1F1B_APF_th0.1_42_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1226_1F1B_APF_th0.1_42_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 16
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 42
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 2
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1226_1F1B_APF_th0.1_42_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: True
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.1
[rank3]:		- percentile: 80
[rank3]:
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
