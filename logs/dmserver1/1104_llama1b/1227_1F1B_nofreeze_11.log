
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 12. 28. (ì¼) 23:34:14 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 3,4,5,6
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/1227_1F1B_nofreeze_11.log
âœ”ï¸Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
1109: switch to alpaca_gpt4+alpaca_cleaned dataset
1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
1227: everything same as 1224 but seed=42->11

âœ”ï¸Running with nofreeze x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1104_llama1b/config_1227.toml --job.description="Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
1109: switch to alpaca_gpt4+alpaca_cleaned dataset
1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
1227: everything same as 1224 but seed=42->11
" --parallelism.pipeline_parallel_degree=4  --freezing.no-freeze
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank3]:2025-12-28 23:34:21,099 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank3]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank3]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank3]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank3]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank3]:1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
[rank3]:1227: everything same as 1224 but seed=42->11
[rank3]:"
[rank2]:2025-12-28 23:34:21,103 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank2]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank2]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank2]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank2]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank2]:1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
[rank2]:1227: everything same as 1224 but seed=42->11
[rank2]:"
[rank0]:2025-12-28 23:34:21,250 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank0]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank0]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank0]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank0]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank0]:1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
[rank0]:1227: everything same as 1224 but seed=42->11
[rank0]:"
[rank1]:2025-12-28 23:34:21,284 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank1]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank1]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank1]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank1]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank1]:1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
[rank1]:1227: everything same as 1224 but seed=42->11
[rank1]:"
[rank3]:2025-12-28 23:34:21,425 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-12-28 23:34:21,428 - Building 1-D device mesh with ['pp'], [4]
[rank2]:2025-12-28 23:34:21,441 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank2]:2025-12-28 23:34:21,443 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-28 23:34:21,575 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-28 23:34:21,578 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-28 23:34:21,581 - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-12-28 23:34:21,583 - Loading tokenizer from tokenizer.json
[rank1]:2025-12-28 23:34:21,650 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-12-28 23:34:21,653 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-28 23:34:21,980 - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank2]:2025-12-28 23:34:24,946 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-12-28 23:34:24,987 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-28 23:34:25,010 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-28 23:34:25,035 - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank2]:2025-12-28 23:34:25,015 - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-12-28 23:34:25,015 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-28 23:34:25,049 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-28 23:34:25,076 - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-12-28 23:34:25,077 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-12-28 23:34:25,189 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-28 23:34:25,233 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-28 23:34:25,234 - Model llama3 1B size: 1,498,482,688 total parameters
[rank0]:2025-12-28 23:34:25,260 - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-12-28 23:34:25,260 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-28 23:34:25,226 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-28 23:34:25,226 - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-12-28 23:34:25,227 - CUDA memory usage for model: 0.92GiB(1.94%)
[rank1]:2025-12-28 23:34:25,284 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-28 23:34:25,284 - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-12-28 23:34:25,285 - CUDA memory usage for model: 1.13GiB(2.39%)
[rank0]:2025-12-28 23:34:25,460 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-28 23:34:25,461 - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-12-28 23:34:25,462 - CUDA memory usage for model: 1.90GiB(3.99%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run xz0jv6f3
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1227_1F1B_nofreeze_11_dm1/20251228-2334/wandb/run-20251228_233426-xz0jv6f3
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1227_1F1B_nofreeze_11_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/xz0jv6f3
[rank3]:2025-12-28 23:34:27,413 - WandB logging enabled
[rank3]:2025-12-28 23:34:27,413 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-12-28 23:34:27,452 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-28 23:34:27,481 - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-12-28 23:34:27,482 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-28 23:34:27,686 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-28 23:34:27,687 - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1227_1F1B_nofreeze_11_dm1
[rank0]:2025-12-28 23:34:27,687 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-28 23:34:27,688 - Trainer is initialized with local batch size 32, global batch size 128, gradient accumulation steps 4, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-12-28 23:34:27,688 - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank1]:2025-12-28 23:34:27,687 - Mixed precision training with TP or PP is handled by autocast
[rank3]:2025-12-28 23:34:27,669 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-28 23:34:27,670 - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-12-28 23:34:27,671 - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-12-28 23:34:27,686 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-28 23:34:30,261 - [GC] GC collection for checkpoint loading. 0.00 seconds
[rank0]:2025-12-28 23:34:30,261 - Finished loading the checkpoint in 2.57 seconds.
[rank0]:2025-12-28 23:34:30,262 - Training starts at step 1
[rank2]:2025-12-28 23:34:35,559 -  step:  1  loss: -4.0000  grad_norm: 203.0657  memory:  6.84GiB(14.41%)  tps: 3,099  tflops: 24.23  mfu: 7.77%
[rank2]:2025-12-28 23:34:35,560 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-28 23:34:35,597 -  step:  1  loss: -4.0000  grad_norm: 203.0657  memory: 13.10GiB(27.57%)  tps: 3,162  tflops: 24.72  mfu: 7.92%
[rank0]:2025-12-28 23:34:35,597 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank1]:2025-12-28 23:34:35,563 -  step:  1  loss: -4.0000  grad_norm: 203.0657  memory: 10.58GiB(22.26%)  tps: 3,117  tflops: 24.37  mfu: 7.81%
[rank1]:2025-12-28 23:34:35,563 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-12-28 23:34:35,569 -  step:  1  loss: 10.6092  grad_norm: 203.0657  memory: 21.88GiB(46.05%)  tps: 4,038  tflops: 31.57  mfu: 10.12%
[rank3]:2025-12-28 23:34:35,569 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-28 23:38:28,721 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:38:33,396 - Avg. fwd time: 24.6954 / Avg. bwd time: 81.0589 / Avg. batch time: 991.3734 (ms) / GPU bubble ratio: 14.66%
[rank2]:2025-12-28 23:38:33,438 - Avg. fwd time: 14.8676 / Avg. bwd time: 35.3156 / Avg. batch time: 1049.6132 (ms) / GPU bubble ratio: 61.75%
[rank1]:2025-12-28 23:38:33,490 - Avg. fwd time: 19.8241 / Avg. bwd time: 45.7009 / Avg. batch time: 1122.4234 (ms) / GPU bubble ratio: 53.30%
[rank3]:2025-12-28 23:38:33,572 -  step: 50  loss:  9.8838  grad_norm: 23.9907  memory: 25.79GiB(54.28%)  tps: 6,746  tflops: 52.74  mfu: 16.90%
[rank0]:2025-12-28 23:38:33,538 - Avg. fwd time: 16.2050 / Avg. bwd time: 41.9000 / Avg. batch time: 1188.5272 (ms) / GPU bubble ratio: 60.89%
[rank0]:2025-12-28 23:38:33,576 -  step: 50  loss: -4.0000  grad_norm: 23.9907  memory: 16.87GiB(35.50%)  tps: 6,747  tflops: 52.74  mfu: 16.91%
[rank1]:2025-12-28 23:38:33,563 -  step: 50  loss: -4.0000  grad_norm: 23.9907  memory: 12.86GiB(27.07%)  tps: 6,746  tflops: 52.74  mfu: 16.90%
[rank2]:2025-12-28 23:38:33,560 -  step: 50  loss: -4.0000  grad_norm: 23.9907  memory:  8.66GiB(18.23%)  tps: 6,746  tflops: 52.74  mfu: 16.90%
[rank0]:2025-12-28 23:42:32,040 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:42:36,699 - Avg. fwd time: 24.7353 / Avg. bwd time: 81.2481 / Avg. batch time: 993.1667 (ms) / GPU bubble ratio: 14.63%
[rank2]:2025-12-28 23:42:36,742 - Avg. fwd time: 14.8652 / Avg. bwd time: 35.4132 / Avg. batch time: 1051.0731 (ms) / GPU bubble ratio: 61.73%
[rank1]:2025-12-28 23:42:36,795 - Avg. fwd time: 19.8293 / Avg. bwd time: 45.8145 / Avg. batch time: 1123.6175 (ms) / GPU bubble ratio: 53.26%
[rank0]:2025-12-28 23:42:36,844 - Avg. fwd time: 16.2229 / Avg. bwd time: 41.9774 / Avg. batch time: 1189.3805 (ms) / GPU bubble ratio: 60.85%
[rank2]:2025-12-28 23:42:36,865 -  step: 100  loss: -4.0000  grad_norm: 17.5397  memory:  8.66GiB(18.23%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank1]:2025-12-28 23:42:36,869 -  step: 100  loss: -4.0000  grad_norm: 17.5397  memory: 12.86GiB(27.07%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank3]:2025-12-28 23:42:36,878 -  step: 100  loss:  8.2363  grad_norm: 17.5397  memory: 25.79GiB(54.28%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank0]:2025-12-28 23:42:36,881 -  step: 100  loss: -4.0000  grad_norm: 17.5397  memory: 16.87GiB(35.50%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank3]:2025-12-28 23:42:37,049 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251228_2342_step100_rank3.svg
[rank3]:			> Batch Time: 1183.09 ms, GPU Bubble Ratio: 60.49%, 55.48%, 65.94%, 28.02%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-15-32ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  275-42-317ms   | [S0,MB4,F]  317-15-333ms   | [S0,MB1,B]  398-42-440ms   | [S0,MB5,F]  440-15-456ms   | [S0,MB2,B]  523-42-565ms   | [S0,MB6,F]  565-15-581ms   | [S0,MB3,B]  648-42-690ms   | [S0,MB7,F]  690-16-706ms   | [S0,MB4,B]  774-42-816ms   | [S0,MB5,B]  898-42-940ms   | [S0,MB6,B]  1018-42-1060ms | [S0,MB7,B]  1141-42-1183ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  221-46-267ms   | [S1,MB3,F]  272-20-292ms   | [S1,MB1,B]  344-46-391ms   | [S1,MB4,F]  395-20-416ms   | [S1,MB2,B]  469-46-515ms   | [S1,MB5,F]  520-20-540ms   | [S1,MB3,B]  594-46-640ms   | [S1,MB6,F]  644-20-665ms   | [S1,MB4,B]  720-45-766ms   | [S1,MB7,F]  770-20-791ms   | [S1,MB5,B]  845-45-891ms   | [S1,MB6,B]  965-45-1011ms  | [S1,MB7,B]  1088-45-1134ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-35-211ms   | [S2,MB2,F]  218-14-233ms   | [S2,MB1,B]  298-35-334ms   | [S2,MB3,F]  341-14-356ms   | [S2,MB2,B]  423-35-459ms   | [S2,MB4,F]  466-14-481ms   | [S2,MB3,B]  549-35-584ms   | [S2,MB5,F]  591-14-606ms   | [S2,MB4,B]  674-35-709ms   | [S2,MB6,F]  716-14-731ms   | [S2,MB5,B]  800-35-835ms   | [S2,MB7,F]  842-14-857ms   | [S2,MB6,B]  924-35-959ms   | [S2,MB7,B]  1047-35-1082ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-75ms     | [S3,MB0,B]  87-77-165ms    | [S3,MB1,F]  172-24-196ms   | [S3,MB1,B]  208-81-289ms   | [S3,MB2,F]  295-24-320ms   | [S3,MB2,B]  332-82-415ms   | [S3,MB3,F]  420-25-446ms   | [S3,MB3,B]  457-82-540ms   | [S3,MB4,F]  546-24-571ms   | [S3,MB4,B]  583-82-665ms   | [S3,MB5,F]  671-25-696ms   | [S3,MB5,B]  708-82-790ms   | [S3,MB6,F]  797-24-822ms   | [S3,MB6,B]  832-82-915ms   | [S3,MB7,F]  921-24-946ms   | [S3,MB7,B]  957-82-1040ms 
[rank0]:2025-12-28 23:46:35,472 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:46:40,225 - Avg. fwd time: 24.7425 / Avg. bwd time: 81.3244 / Avg. batch time: 993.8095 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-28 23:46:40,268 - Avg. fwd time: 14.8601 / Avg. bwd time: 35.4487 / Avg. batch time: 1051.7650 (ms) / GPU bubble ratio: 61.73%
[rank1]:2025-12-28 23:46:40,321 - Avg. fwd time: 19.8257 / Avg. bwd time: 45.8652 / Avg. batch time: 1124.2390 (ms) / GPU bubble ratio: 53.25%
[rank0]:2025-12-28 23:46:40,370 - Avg. fwd time: 16.2261 / Avg. bwd time: 42.0006 / Avg. batch time: 1189.8920 (ms) / GPU bubble ratio: 60.85%
[rank0]:2025-12-28 23:46:40,407 -  step: 150  loss: -4.0000  grad_norm: 34.3554  memory: 16.87GiB(35.50%)  tps: 6,728  tflops: 52.60  mfu: 16.86%
[rank2]:2025-12-28 23:46:40,391 -  step: 150  loss: -4.0000  grad_norm: 34.3554  memory:  8.66GiB(18.23%)  tps: 6,728  tflops: 52.60  mfu: 16.86%
[rank3]:2025-12-28 23:46:40,404 -  step: 150  loss:  3.2698  grad_norm: 34.3554  memory: 25.79GiB(54.28%)  tps: 6,728  tflops: 52.60  mfu: 16.86%
[rank1]:2025-12-28 23:46:40,395 -  step: 150  loss: -4.0000  grad_norm: 34.3554  memory: 12.86GiB(27.07%)  tps: 6,728  tflops: 52.60  mfu: 16.86%
[rank0]:2025-12-28 23:50:39,178 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:50:43,937 - Avg. fwd time: 24.7627 / Avg. bwd time: 81.3700 / Avg. batch time: 994.3204 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-28 23:50:43,980 - Avg. fwd time: 14.8657 / Avg. bwd time: 35.5084 / Avg. batch time: 1052.2188 (ms) / GPU bubble ratio: 61.70%
[rank1]:2025-12-28 23:50:44,033 - Avg. fwd time: 19.8114 / Avg. bwd time: 45.9227 / Avg. batch time: 1124.7022 (ms) / GPU bubble ratio: 53.24%
[rank2]:2025-12-28 23:50:44,104 -  step: 200  loss: -4.0000  grad_norm: 16.2904  memory:  8.66GiB(18.23%)  tps: 6,723  tflops: 52.55  mfu: 16.84%
[rank0]:2025-12-28 23:50:44,083 - Avg. fwd time: 16.2420 / Avg. bwd time: 42.0463 / Avg. batch time: 1190.3424 (ms) / GPU bubble ratio: 60.83%
[rank0]:2025-12-28 23:50:44,120 -  step: 200  loss: -4.0000  grad_norm: 16.2904  memory: 16.87GiB(35.50%)  tps: 6,723  tflops: 52.55  mfu: 16.84%
[rank1]:2025-12-28 23:50:44,108 -  step: 200  loss: -4.0000  grad_norm: 16.2904  memory: 12.86GiB(27.07%)  tps: 6,723  tflops: 52.55  mfu: 16.84%
[rank3]:2025-12-28 23:50:44,116 -  step: 200  loss:  1.0645  grad_norm: 16.2904  memory: 25.79GiB(54.28%)  tps: 6,723  tflops: 52.56  mfu: 16.84%
[rank3]:2025-12-28 23:50:44,266 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251228_2350_step200_rank3.svg
[rank3]:			> Batch Time: 1189.31 ms, GPU Bubble Ratio: 60.55%, 55.61%, 65.83%, 28.11%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-16-33ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  276-42-319ms   | [S0,MB4,F]  319-15-334ms   | [S0,MB1,B]  400-42-442ms   | [S0,MB5,F]  442-15-458ms   | [S0,MB2,B]  526-42-568ms   | [S0,MB6,F]  568-16-584ms   | [S0,MB3,B]  651-42-693ms   | [S0,MB7,F]  693-15-709ms   | [S0,MB4,B]  777-42-819ms   | [S0,MB5,B]  902-42-944ms   | [S0,MB6,B]  1024-42-1066ms | [S0,MB7,B]  1147-42-1189ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-37ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  222-46-268ms   | [S1,MB3,F]  273-19-293ms   | [S1,MB1,B]  346-46-392ms   | [S1,MB4,F]  396-20-417ms   | [S1,MB2,B]  471-46-517ms   | [S1,MB5,F]  522-20-543ms   | [S1,MB3,B]  596-46-643ms   | [S1,MB6,F]  647-20-667ms   | [S1,MB4,B]  723-45-769ms   | [S1,MB7,F]  773-20-794ms   | [S1,MB5,B]  849-46-895ms   | [S1,MB6,B]  971-46-1017ms  | [S1,MB7,B]  1094-45-1140ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  37-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  219-14-233ms   | [S2,MB1,B]  300-35-336ms   | [S2,MB3,F]  343-14-358ms   | [S2,MB2,B]  425-35-461ms   | [S2,MB4,F]  468-14-483ms   | [S2,MB3,B]  551-35-586ms   | [S2,MB5,F]  594-15-609ms   | [S2,MB4,B]  677-35-712ms   | [S2,MB6,F]  720-15-735ms   | [S2,MB5,B]  803-35-839ms   | [S2,MB7,F]  846-15-861ms   | [S2,MB6,B]  929-35-965ms   | [S2,MB7,B]  1052-35-1088ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  172-24-196ms   | [S3,MB1,B]  208-82-290ms   | [S3,MB2,F]  297-24-322ms   | [S3,MB2,B]  334-82-416ms   | [S3,MB3,F]  422-25-448ms   | [S3,MB3,B]  459-82-542ms   | [S3,MB4,F]  547-25-573ms   | [S3,MB4,B]  585-83-668ms   | [S3,MB5,F]  674-24-699ms   | [S3,MB5,B]  711-83-794ms   | [S3,MB6,F]  800-25-825ms   | [S3,MB6,B]  837-83-920ms   | [S3,MB7,F]  926-24-951ms   | [S3,MB7,B]  963-82-1045ms 
[rank0]:2025-12-28 23:54:42,983 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:54:47,687 - Avg. fwd time: 24.7764 / Avg. bwd time: 81.3784 / Avg. batch time: 994.4914 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-28 23:54:47,730 - Avg. fwd time: 14.8684 / Avg. bwd time: 35.5686 / Avg. batch time: 1052.4626 (ms) / GPU bubble ratio: 61.66%
[rank1]:2025-12-28 23:54:47,783 - Avg. fwd time: 19.8112 / Avg. bwd time: 45.9723 / Avg. batch time: 1124.9664 (ms) / GPU bubble ratio: 53.22%
[rank2]:2025-12-28 23:54:47,855 -  step: 250  loss: -4.0000  grad_norm: 24.1858  memory:  8.66GiB(18.23%)  tps: 6,722  tflops: 52.55  mfu: 16.84%
[rank0]:2025-12-28 23:54:47,833 - Avg. fwd time: 16.2480 / Avg. bwd time: 42.0721 / Avg. batch time: 1190.5957 (ms) / GPU bubble ratio: 60.81%
[rank0]:2025-12-28 23:54:47,870 -  step: 250  loss: -4.0000  grad_norm: 24.1858  memory: 16.87GiB(35.50%)  tps: 6,722  tflops: 52.55  mfu: 16.84%
[rank1]:2025-12-28 23:54:47,858 -  step: 250  loss: -4.0000  grad_norm: 24.1858  memory: 12.86GiB(27.07%)  tps: 6,722  tflops: 52.55  mfu: 16.84%
[rank3]:2025-12-28 23:54:47,868 -  step: 250  loss:  0.4035  grad_norm: 24.1858  memory: 25.79GiB(54.28%)  tps: 6,722  tflops: 52.55  mfu: 16.84%
[rank0]:2025-12-28 23:58:46,294 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-28 23:58:51,005 - Avg. fwd time: 24.7769 / Avg. bwd time: 81.3529 / Avg. batch time: 994.2881 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-28 23:58:51,049 - Avg. fwd time: 14.8688 / Avg. bwd time: 35.6154 / Avg. batch time: 1052.2404 (ms) / GPU bubble ratio: 61.62%
[rank1]:2025-12-28 23:58:51,103 - Avg. fwd time: 19.7964 / Avg. bwd time: 46.0015 / Avg. batch time: 1124.7582 (ms) / GPU bubble ratio: 53.20%
[rank2]:2025-12-28 23:58:51,175 -  step: 300  loss: -4.0000  grad_norm:  1.1746  memory:  8.66GiB(18.23%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank0]:2025-12-28 23:58:51,153 - Avg. fwd time: 16.2536 / Avg. bwd time: 42.0941 / Avg. batch time: 1190.3908 (ms) / GPU bubble ratio: 60.79%
[rank0]:2025-12-28 23:58:51,192 -  step: 300  loss: -4.0000  grad_norm:  1.1746  memory: 16.87GiB(35.50%)  tps: 6,733  tflops: 52.64  mfu: 16.87%
[rank1]:2025-12-28 23:58:51,178 -  step: 300  loss: -4.0000  grad_norm:  1.1746  memory: 12.86GiB(27.07%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank3]:2025-12-28 23:58:51,188 -  step: 300  loss:  0.2748  grad_norm:  1.1746  memory: 25.79GiB(54.28%)  tps: 6,734  tflops: 52.64  mfu: 16.87%
[rank3]:2025-12-28 23:58:51,342 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251228_2358_step300_rank3.svg
[rank3]:			> Batch Time: 1187.31 ms, GPU Bubble Ratio: 60.46%, 55.65%, 65.74%, 28.32%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-15-32ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  276-42-319ms   | [S0,MB4,F]  319-15-334ms   | [S0,MB1,B]  398-42-440ms   | [S0,MB5,F]  440-16-456ms   | [S0,MB2,B]  522-42-564ms   | [S0,MB6,F]  565-16-581ms   | [S0,MB3,B]  648-42-690ms   | [S0,MB7,F]  690-16-706ms   | [S0,MB4,B]  774-42-816ms   | [S0,MB5,B]  899-42-941ms   | [S0,MB6,B]  1021-42-1063ms | [S0,MB7,B]  1145-42-1187ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-19-36ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  221-46-268ms   | [S1,MB3,F]  273-19-293ms   | [S1,MB1,B]  344-46-390ms   | [S1,MB4,F]  395-20-415ms   | [S1,MB2,B]  468-46-514ms   | [S1,MB5,F]  519-20-539ms   | [S1,MB3,B]  593-46-640ms   | [S1,MB6,F]  644-20-665ms   | [S1,MB4,B]  720-46-766ms   | [S1,MB7,F]  770-20-791ms   | [S1,MB5,B]  846-46-892ms   | [S1,MB6,B]  968-46-1014ms  | [S1,MB7,B]  1091-45-1137ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  218-14-233ms   | [S2,MB1,B]  297-35-333ms   | [S2,MB3,F]  341-14-355ms   | [S2,MB2,B]  422-35-458ms   | [S2,MB4,F]  465-15-480ms   | [S2,MB3,B]  547-35-583ms   | [S2,MB5,F]  590-14-605ms   | [S2,MB4,B]  673-35-709ms   | [S2,MB6,F]  716-15-731ms   | [S2,MB5,B]  800-35-836ms   | [S2,MB7,F]  843-14-858ms   | [S2,MB6,B]  926-35-962ms   | [S2,MB7,B]  1049-35-1085ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  171-24-196ms   | [S3,MB1,B]  207-82-289ms   | [S3,MB2,F]  294-24-319ms   | [S3,MB2,B]  331-81-413ms   | [S3,MB3,F]  419-25-444ms   | [S3,MB3,B]  456-82-538ms   | [S3,MB4,F]  544-24-569ms   | [S3,MB4,B]  580-82-663ms   | [S3,MB5,F]  670-25-695ms   | [S3,MB5,B]  707-82-790ms   | [S3,MB6,F]  797-24-822ms   | [S3,MB6,B]  833-82-915ms   | [S3,MB7,F]  923-24-948ms   | [S3,MB7,B]  960-82-1043ms 
[rank0]:2025-12-29 00:02:49,904 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:02:54,648 - Avg. fwd time: 24.7802 / Avg. bwd time: 81.3533 / Avg. batch time: 994.3136 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-29 00:02:54,692 - Avg. fwd time: 14.8724 / Avg. bwd time: 35.6466 / Avg. batch time: 1052.3141 (ms) / GPU bubble ratio: 61.59%
[rank1]:2025-12-29 00:02:54,745 - Avg. fwd time: 19.8002 / Avg. bwd time: 46.0226 / Avg. batch time: 1124.8395 (ms) / GPU bubble ratio: 53.19%
[rank1]:2025-12-29 00:02:54,820 -  step: 350  loss: -4.0000  grad_norm:  0.2622  memory: 12.86GiB(27.07%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank0]:2025-12-29 00:02:54,795 - Avg. fwd time: 16.2580 / Avg. bwd time: 42.1080 / Avg. batch time: 1190.4680 (ms) / GPU bubble ratio: 60.78%
[rank0]:2025-12-29 00:02:54,833 -  step: 350  loss: -4.0000  grad_norm:  0.2622  memory: 16.87GiB(35.50%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank3]:2025-12-29 00:02:54,829 -  step: 350  loss:  0.2238  grad_norm:  0.2622  memory: 25.79GiB(54.28%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank2]:2025-12-29 00:02:54,817 -  step: 350  loss: -4.0000  grad_norm:  0.2622  memory:  8.66GiB(18.23%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank0]:2025-12-29 00:06:53,582 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:06:58,350 - Avg. fwd time: 24.7845 / Avg. bwd time: 81.3671 / Avg. batch time: 994.4567 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-29 00:06:58,394 - Avg. fwd time: 14.8760 / Avg. bwd time: 35.6663 / Avg. batch time: 1052.4402 (ms) / GPU bubble ratio: 61.58%
[rank1]:2025-12-29 00:06:58,448 - Avg. fwd time: 19.7902 / Avg. bwd time: 46.0310 / Avg. batch time: 1124.9685 (ms) / GPU bubble ratio: 53.19%
[rank2]:2025-12-29 00:06:58,520 -  step: 400  loss: -4.0000  grad_norm:  1.1182  memory:  8.66GiB(18.23%)  tps: 6,723  tflops: 52.56  mfu: 16.85%
[rank1]:2025-12-29 00:06:58,523 -  step: 400  loss: -4.0000  grad_norm:  1.1182  memory: 12.86GiB(27.07%)  tps: 6,723  tflops: 52.56  mfu: 16.85%
[rank3]:2025-12-29 00:06:58,532 -  step: 400  loss:  0.2149  grad_norm:  1.1182  memory: 25.79GiB(54.28%)  tps: 6,723  tflops: 52.56  mfu: 16.85%
[rank0]:2025-12-29 00:06:58,498 - Avg. fwd time: 16.2616 / Avg. bwd time: 42.1181 / Avg. batch time: 1190.5979 (ms) / GPU bubble ratio: 60.77%
[rank0]:2025-12-29 00:06:58,535 -  step: 400  loss: -4.0000  grad_norm:  1.1182  memory: 16.87GiB(35.50%)  tps: 6,723  tflops: 52.56  mfu: 16.85%
[rank3]:2025-12-29 00:06:58,680 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0006_step400_rank3.svg
[rank3]:			> Batch Time: 1192.31 ms, GPU Bubble Ratio: 60.65%, 55.91%, 65.92%, 28.10%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-16-33ms     | [S0,MB2,F]  33-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  278-42-320ms   | [S0,MB4,F]  320-15-336ms   | [S0,MB1,B]  402-42-444ms   | [S0,MB5,F]  444-16-460ms   | [S0,MB2,B]  527-42-569ms   | [S0,MB6,F]  569-15-584ms   | [S0,MB3,B]  654-42-696ms   | [S0,MB7,F]  697-15-712ms   | [S0,MB4,B]  779-42-821ms   | [S0,MB5,B]  904-42-946ms   | [S0,MB6,B]  1028-42-1070ms | [S0,MB7,B]  1150-42-1192ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-37ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  223-46-269ms   | [S1,MB3,F]  274-19-294ms   | [S1,MB1,B]  348-46-394ms   | [S1,MB4,F]  398-20-418ms   | [S1,MB2,B]  472-46-518ms   | [S1,MB5,F]  523-19-543ms   | [S1,MB3,B]  599-46-646ms   | [S1,MB6,F]  651-20-672ms   | [S1,MB4,B]  724-45-770ms   | [S1,MB7,F]  775-20-796ms   | [S1,MB5,B]  851-46-897ms   | [S1,MB6,B]  975-45-1021ms  | [S1,MB7,B]  1098-45-1144ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  37-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  177-36-213ms   | [S2,MB2,F]  220-14-235ms   | [S2,MB1,B]  302-35-337ms   | [S2,MB3,F]  345-14-359ms   | [S2,MB2,B]  426-35-462ms   | [S2,MB4,F]  469-15-484ms   | [S2,MB3,B]  554-35-589ms   | [S2,MB5,F]  597-14-611ms   | [S2,MB4,B]  679-35-714ms   | [S2,MB6,F]  722-14-736ms   | [S2,MB5,B]  806-35-841ms   | [S2,MB7,F]  848-15-863ms   | [S2,MB6,B]  933-35-969ms   | [S2,MB7,B]  1056-35-1092ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-78-167ms    | [S3,MB1,F]  174-24-198ms   | [S3,MB1,B]  210-82-292ms   | [S3,MB2,F]  298-25-323ms   | [S3,MB2,B]  335-82-418ms   | [S3,MB3,F]  423-25-449ms   | [S3,MB3,B]  461-83-544ms   | [S3,MB4,F]  551-24-575ms   | [S3,MB4,B]  587-82-669ms   | [S3,MB5,F]  676-25-701ms   | [S3,MB5,B]  712-83-795ms   | [S3,MB6,F]  803-25-828ms   | [S3,MB6,B]  840-83-923ms   | [S3,MB7,F]  930-24-955ms   | [S3,MB7,B]  967-83-1050ms 
[rank3]:2025-12-29 00:07:25,985 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-29 00:07:26,404 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-29 00:07:26,454 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-29 00:07:26,498 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-29 00:10:57,053 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:11:01,739 - Avg. fwd time: 24.7843 / Avg. bwd time: 81.3624 / Avg. batch time: 994.4156 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-29 00:11:01,784 - Avg. fwd time: 14.8779 / Avg. bwd time: 35.6801 / Avg. batch time: 1052.4273 (ms) / GPU bubble ratio: 61.57%
[rank1]:2025-12-29 00:11:01,837 - Avg. fwd time: 19.7791 / Avg. bwd time: 46.0340 / Avg. batch time: 1124.9533 (ms) / GPU bubble ratio: 53.20%
[rank0]:2025-12-29 00:11:01,888 - Avg. fwd time: 16.2657 / Avg. bwd time: 42.1250 / Avg. batch time: 1190.5802 (ms) / GPU bubble ratio: 60.76%
[rank2]:2025-12-29 00:11:01,909 -  step: 450  loss: -4.0000  grad_norm:  0.2467  memory:  8.66GiB(18.23%)  tps: 6,732  tflops: 52.62  mfu: 16.87%
[rank1]:2025-12-29 00:11:01,913 -  step: 450  loss: -4.0000  grad_norm:  0.2467  memory: 12.86GiB(27.07%)  tps: 6,732  tflops: 52.62  mfu: 16.87%
[rank3]:2025-12-29 00:11:01,922 -  step: 450  loss:  0.2246  grad_norm:  0.2467  memory: 25.79GiB(54.28%)  tps: 6,732  tflops: 52.62  mfu: 16.87%
[rank0]:2025-12-29 00:11:01,925 -  step: 450  loss: -4.0000  grad_norm:  0.2467  memory: 16.87GiB(35.50%)  tps: 6,732  tflops: 52.62  mfu: 16.87%
[rank0]:2025-12-29 00:15:00,291 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:15:04,976 - Avg. fwd time: 24.7820 / Avg. bwd time: 81.3502 / Avg. batch time: 994.2994 (ms) / GPU bubble ratio: 14.61%
[rank2]:2025-12-29 00:15:05,020 - Avg. fwd time: 14.8779 / Avg. bwd time: 35.6868 / Avg. batch time: 1052.2871 (ms) / GPU bubble ratio: 61.56%
[rank1]:2025-12-29 00:15:05,076 - Avg. fwd time: 19.7741 / Avg. bwd time: 46.0364 / Avg. batch time: 1124.8160 (ms) / GPU bubble ratio: 53.19%
[rank1]:2025-12-29 00:15:05,151 -  step: 500  loss: -4.0000  grad_norm:  0.8985  memory: 12.86GiB(27.07%)  tps: 6,736  tflops: 52.66  mfu: 16.88%
[rank2]:2025-12-29 00:15:05,148 -  step: 500  loss: -4.0000  grad_norm:  0.8985  memory:  8.66GiB(18.23%)  tps: 6,736  tflops: 52.66  mfu: 16.88%
[rank0]:2025-12-29 00:15:05,126 - Avg. fwd time: 16.2621 / Avg. bwd time: 42.1290 / Avg. batch time: 1190.4375 (ms) / GPU bubble ratio: 60.76%
[rank0]:2025-12-29 00:15:05,164 -  step: 500  loss: -4.0000  grad_norm:  0.8985  memory: 16.87GiB(35.50%)  tps: 6,736  tflops: 52.66  mfu: 16.88%
[rank3]:2025-12-29 00:15:05,161 -  step: 500  loss:  0.2183  grad_norm:  0.8985  memory: 25.79GiB(54.28%)  tps: 6,736  tflops: 52.66  mfu: 16.88%
[rank3]:2025-12-29 00:15:05,311 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0015_step500_rank3.svg
[rank3]:			> Batch Time: 1183.25 ms, GPU Bubble Ratio: 60.48%, 55.51%, 65.76%, 28.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-15-32ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-65ms     | [S0,MB0,B]  275-42-318ms   | [S0,MB4,F]  318-15-334ms   | [S0,MB1,B]  398-42-440ms   | [S0,MB5,F]  440-15-456ms   | [S0,MB2,B]  521-42-563ms   | [S0,MB6,F]  563-16-579ms   | [S0,MB3,B]  646-42-688ms   | [S0,MB7,F]  688-15-704ms   | [S0,MB4,B]  772-42-814ms   | [S0,MB5,B]  898-42-940ms   | [S0,MB6,B]  1019-42-1061ms | [S0,MB7,B]  1141-42-1183ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-19-36ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-85ms     | [S1,MB0,B]  221-46-267ms   | [S1,MB3,F]  272-19-292ms   | [S1,MB1,B]  344-46-390ms   | [S1,MB4,F]  395-20-415ms   | [S1,MB2,B]  467-46-513ms   | [S1,MB5,F]  518-20-538ms   | [S1,MB3,B]  591-46-637ms   | [S1,MB6,F]  642-20-663ms   | [S1,MB4,B]  717-45-763ms   | [S1,MB7,F]  769-20-789ms   | [S1,MB5,B]  845-46-891ms   | [S1,MB6,B]  967-45-1013ms  | [S1,MB7,B]  1088-46-1135ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  218-14-233ms   | [S2,MB1,B]  298-35-334ms   | [S2,MB3,F]  341-14-356ms   | [S2,MB2,B]  421-35-457ms   | [S2,MB4,F]  464-14-479ms   | [S2,MB3,B]  545-35-581ms   | [S2,MB5,F]  588-14-603ms   | [S2,MB4,B]  672-35-708ms   | [S2,MB6,F]  714-14-729ms   | [S2,MB5,B]  799-35-835ms   | [S2,MB7,F]  842-14-857ms   | [S2,MB6,B]  924-35-960ms   | [S2,MB7,B]  1046-35-1082ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  172-24-196ms   | [S3,MB1,B]  208-80-289ms   | [S3,MB2,F]  295-24-320ms   | [S3,MB2,B]  332-81-413ms   | [S3,MB3,F]  418-25-444ms   | [S3,MB3,B]  455-82-537ms   | [S3,MB4,F]  542-24-567ms   | [S3,MB4,B]  580-82-662ms   | [S3,MB5,F]  669-25-694ms   | [S3,MB5,B]  706-82-788ms   | [S3,MB6,F]  796-24-821ms   | [S3,MB6,B]  832-82-915ms   | [S3,MB7,F]  921-24-946ms   | [S3,MB7,B]  958-81-1040ms 
[rank0]:2025-12-29 00:19:02,425 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:19:07,160 - Avg. fwd time: 24.7698 / Avg. bwd time: 81.2870 / Avg. batch time: 993.6935 (ms) / GPU bubble ratio: 14.62%
[rank1]:2025-12-29 00:19:07,260 - Avg. fwd time: 19.7734 / Avg. bwd time: 46.0323 / Avg. batch time: 1124.2160 (ms) / GPU bubble ratio: 53.17%
[rank2]:2025-12-29 00:19:07,205 - Avg. fwd time: 14.8772 / Avg. bwd time: 35.6853 / Avg. batch time: 1051.6922 (ms) / GPU bubble ratio: 61.54%
[rank0]:2025-12-29 00:19:07,312 - Avg. fwd time: 16.2530 / Avg. bwd time: 42.1260 / Avg. batch time: 1189.8212 (ms) / GPU bubble ratio: 60.75%
[rank1]:2025-12-29 00:19:07,337 -  step: 550  loss: -4.0000  grad_norm:  0.4190  memory: 12.86GiB(27.07%)  tps: 6,765  tflops: 52.89  mfu: 16.95%
[rank2]:2025-12-29 00:19:07,333 -  step: 550  loss: -4.0000  grad_norm:  0.4190  memory:  8.66GiB(18.23%)  tps: 6,765  tflops: 52.89  mfu: 16.95%
[rank0]:2025-12-29 00:19:07,349 -  step: 550  loss: -4.0000  grad_norm:  0.4190  memory: 16.87GiB(35.50%)  tps: 6,765  tflops: 52.89  mfu: 16.95%
[rank3]:2025-12-29 00:19:07,346 -  step: 550  loss:  0.2264  grad_norm:  0.4190  memory: 25.79GiB(54.28%)  tps: 6,765  tflops: 52.89  mfu: 16.95%
[rank0]:2025-12-29 00:23:05,563 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:23:10,332 - Avg. fwd time: 24.7721 / Avg. bwd time: 81.2748 / Avg. batch time: 993.6137 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-29 00:23:10,378 - Avg. fwd time: 14.8841 / Avg. bwd time: 35.6863 / Avg. batch time: 1051.5901 (ms) / GPU bubble ratio: 61.53%
[rank1]:2025-12-29 00:23:10,433 - Avg. fwd time: 19.7738 / Avg. bwd time: 46.0298 / Avg. batch time: 1124.1084 (ms) / GPU bubble ratio: 53.17%
[rank0]:2025-12-29 00:23:10,485 - Avg. fwd time: 16.2490 / Avg. bwd time: 42.1257 / Avg. batch time: 1189.7074 (ms) / GPU bubble ratio: 60.75%
[rank0]:2025-12-29 00:23:10,522 -  step: 600  loss: -4.0000  grad_norm:  0.8922  memory: 16.87GiB(35.50%)  tps: 6,738  tflops: 52.67  mfu: 16.88%
[rank3]:2025-12-29 00:23:10,519 -  step: 600  loss:  0.2195  grad_norm:  0.8922  memory: 25.79GiB(54.28%)  tps: 6,738  tflops: 52.67  mfu: 16.88%
[rank2]:2025-12-29 00:23:10,506 -  step: 600  loss: -4.0000  grad_norm:  0.8922  memory:  8.66GiB(18.23%)  tps: 6,738  tflops: 52.67  mfu: 16.88%
[rank1]:2025-12-29 00:23:10,510 -  step: 600  loss: -4.0000  grad_norm:  0.8922  memory: 12.86GiB(27.07%)  tps: 6,738  tflops: 52.67  mfu: 16.88%
[rank3]:2025-12-29 00:23:10,670 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0023_step600_rank3.svg
[rank3]:			> Batch Time: 1188.19 ms, GPU Bubble Ratio: 60.59%, 55.86%, 65.88%, 28.14%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-15-32ms     | [S0,MB2,F]  33-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  276-42-318ms   | [S0,MB4,F]  319-15-334ms   | [S0,MB1,B]  400-42-442ms   | [S0,MB5,F]  442-15-458ms   | [S0,MB2,B]  525-42-567ms   | [S0,MB6,F]  567-15-582ms   | [S0,MB3,B]  649-42-691ms   | [S0,MB7,F]  691-16-707ms   | [S0,MB4,B]  777-42-819ms   | [S0,MB5,B]  902-42-944ms   | [S0,MB6,B]  1023-42-1065ms | [S0,MB7,B]  1146-42-1188ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-37ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  221-46-268ms   | [S1,MB3,F]  272-19-292ms   | [S1,MB1,B]  346-45-392ms   | [S1,MB4,F]  396-20-417ms   | [S1,MB2,B]  470-45-516ms   | [S1,MB5,F]  521-20-541ms   | [S1,MB3,B]  595-46-641ms   | [S1,MB6,F]  645-20-666ms   | [S1,MB4,B]  722-46-768ms   | [S1,MB7,F]  773-20-793ms   | [S1,MB5,B]  849-45-895ms   | [S1,MB6,B]  971-45-1017ms  | [S1,MB7,B]  1093-45-1139ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  37-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  218-14-233ms   | [S2,MB1,B]  300-35-336ms   | [S2,MB3,F]  343-14-358ms   | [S2,MB2,B]  424-35-460ms   | [S2,MB4,F]  467-14-482ms   | [S2,MB3,B]  549-35-585ms   | [S2,MB5,F]  592-14-607ms   | [S2,MB4,B]  676-35-712ms   | [S2,MB6,F]  719-15-734ms   | [S2,MB5,B]  804-35-839ms   | [S2,MB7,F]  847-15-862ms   | [S2,MB6,B]  929-35-965ms   | [S2,MB7,B]  1052-35-1087ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  172-24-196ms   | [S3,MB1,B]  208-82-290ms   | [S3,MB2,F]  297-25-322ms   | [S3,MB2,B]  334-82-416ms   | [S3,MB3,F]  421-25-446ms   | [S3,MB3,B]  459-82-541ms   | [S3,MB4,F]  546-24-571ms   | [S3,MB4,B]  584-82-667ms   | [S3,MB5,F]  673-25-699ms   | [S3,MB5,B]  711-82-794ms   | [S3,MB6,F]  800-24-825ms   | [S3,MB6,B]  837-82-920ms   | [S3,MB7,F]  926-24-950ms   | [S3,MB7,B]  963-82-1045ms 
[rank0]:2025-12-29 00:27:09,026 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:27:13,709 - Avg. fwd time: 24.7761 / Avg. bwd time: 81.2672 / Avg. batch time: 993.5838 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-29 00:27:13,755 - Avg. fwd time: 14.8917 / Avg. bwd time: 35.6900 / Avg. batch time: 1051.5782 (ms) / GPU bubble ratio: 61.52%
[rank0]:2025-12-29 00:27:13,863 - Avg. fwd time: 16.2487 / Avg. bwd time: 42.1296 / Avg. batch time: 1189.6891 (ms) / GPU bubble ratio: 60.74%
[rank2]:2025-12-29 00:27:13,884 -  step: 650  loss: -4.0000  grad_norm:  0.1954  memory:  8.66GiB(18.23%)  tps: 6,732  tflops: 52.63  mfu: 16.87%
[rank1]:2025-12-29 00:27:13,811 - Avg. fwd time: 19.7632 / Avg. bwd time: 46.0261 / Avg. batch time: 1124.0898 (ms) / GPU bubble ratio: 53.18%
[rank1]:2025-12-29 00:27:13,887 -  step: 650  loss: -4.0000  grad_norm:  0.1954  memory: 12.86GiB(27.07%)  tps: 6,732  tflops: 52.63  mfu: 16.87%
[rank0]:2025-12-29 00:27:13,901 -  step: 650  loss: -4.0000  grad_norm:  0.1954  memory: 16.87GiB(35.50%)  tps: 6,732  tflops: 52.63  mfu: 16.87%
[rank3]:2025-12-29 00:27:13,897 -  step: 650  loss:  0.2274  grad_norm:  0.1954  memory: 25.79GiB(54.28%)  tps: 6,732  tflops: 52.63  mfu: 16.87%
[rank0]:2025-12-29 00:31:12,002 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:31:16,684 - Avg. fwd time: 24.7750 / Avg. bwd time: 81.2547 / Avg. batch time: 993.4724 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-29 00:31:16,730 - Avg. fwd time: 14.8982 / Avg. bwd time: 35.6938 / Avg. batch time: 1051.4523 (ms) / GPU bubble ratio: 61.51%
[rank1]:2025-12-29 00:31:16,785 - Avg. fwd time: 19.7577 / Avg. bwd time: 46.0259 / Avg. batch time: 1123.9598 (ms) / GPU bubble ratio: 53.18%
[rank0]:2025-12-29 00:31:16,837 - Avg. fwd time: 16.2500 / Avg. bwd time: 42.1339 / Avg. batch time: 1189.5608 (ms) / GPU bubble ratio: 60.74%
[rank0]:2025-12-29 00:31:16,874 -  step: 700  loss: -4.0000  grad_norm:  0.4261  memory: 16.87GiB(35.50%)  tps: 6,743  tflops: 52.71  mfu: 16.90%
[rank2]:2025-12-29 00:31:16,859 -  step: 700  loss: -4.0000  grad_norm:  0.4261  memory:  8.66GiB(18.23%)  tps: 6,743  tflops: 52.71  mfu: 16.90%
[rank1]:2025-12-29 00:31:16,862 -  step: 700  loss: -4.0000  grad_norm:  0.4261  memory: 12.86GiB(27.07%)  tps: 6,743  tflops: 52.71  mfu: 16.90%
[rank3]:2025-12-29 00:31:16,871 -  step: 700  loss:  0.1843  grad_norm:  0.4261  memory: 25.79GiB(54.28%)  tps: 6,743  tflops: 52.71  mfu: 16.90%
[rank3]:2025-12-29 00:31:17,022 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0031_step700_rank3.svg
[rank3]:			> Batch Time: 1186.28 ms, GPU Bubble Ratio: 60.45%, 55.73%, 65.72%, 28.29%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-15-32ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  276-42-318ms   | [S0,MB4,F]  319-15-334ms   | [S0,MB1,B]  397-42-439ms   | [S0,MB5,F]  440-15-455ms   | [S0,MB2,B]  523-42-565ms   | [S0,MB6,F]  565-16-581ms   | [S0,MB3,B]  647-42-689ms   | [S0,MB7,F]  690-16-706ms   | [S0,MB4,B]  774-42-816ms   | [S0,MB5,B]  899-42-941ms   | [S0,MB6,B]  1021-42-1063ms | [S0,MB7,B]  1144-42-1186ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  221-46-268ms   | [S1,MB3,F]  272-19-292ms   | [S1,MB1,B]  343-45-389ms   | [S1,MB4,F]  394-20-414ms   | [S1,MB2,B]  468-46-515ms   | [S1,MB5,F]  519-20-539ms   | [S1,MB3,B]  593-46-639ms   | [S1,MB6,F]  644-20-664ms   | [S1,MB4,B]  719-46-766ms   | [S1,MB7,F]  770-20-791ms   | [S1,MB5,B]  846-45-892ms   | [S1,MB6,B]  968-45-1014ms  | [S1,MB7,B]  1092-45-1138ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  218-14-233ms   | [S2,MB1,B]  297-35-333ms   | [S2,MB3,F]  340-14-355ms   | [S2,MB2,B]  422-35-458ms   | [S2,MB4,F]  465-15-480ms   | [S2,MB3,B]  547-35-583ms   | [S2,MB5,F]  590-15-605ms   | [S2,MB4,B]  673-35-709ms   | [S2,MB6,F]  716-15-731ms   | [S2,MB5,B]  800-35-836ms   | [S2,MB7,F]  843-15-858ms   | [S2,MB6,B]  926-35-962ms   | [S2,MB7,B]  1049-35-1085ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  172-24-196ms   | [S3,MB1,B]  208-81-289ms   | [S3,MB2,F]  294-25-319ms   | [S3,MB2,B]  333-82-415ms   | [S3,MB3,F]  419-24-444ms   | [S3,MB3,B]  456-82-539ms   | [S3,MB4,F]  544-24-568ms   | [S3,MB4,B]  581-82-664ms   | [S3,MB5,F]  670-25-695ms   | [S3,MB5,B]  708-82-790ms   | [S3,MB6,F]  797-24-822ms   | [S3,MB6,B]  834-82-916ms   | [S3,MB7,F]  923-24-948ms   | [S3,MB7,B]  960-82-1043ms 
[rank0]:2025-12-29 00:35:15,573 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:35:20,328 - Avg. fwd time: 24.7798 / Avg. bwd time: 81.2588 / Avg. batch time: 993.5418 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-29 00:35:20,374 - Avg. fwd time: 14.9040 / Avg. bwd time: 35.6982 / Avg. batch time: 1051.5399 (ms) / GPU bubble ratio: 61.50%
[rank2]:2025-12-29 00:35:20,504 -  step: 750  loss: -4.0000  grad_norm:  0.5128  memory:  8.66GiB(18.23%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank1]:2025-12-29 00:35:20,430 - Avg. fwd time: 19.7512 / Avg. bwd time: 46.0279 / Avg. batch time: 1124.0431 (ms) / GPU bubble ratio: 53.18%
[rank1]:2025-12-29 00:35:20,507 -  step: 750  loss: -4.0000  grad_norm:  0.5128  memory: 12.86GiB(27.07%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank0]:2025-12-29 00:35:20,482 - Avg. fwd time: 16.2529 / Avg. bwd time: 42.1396 / Avg. batch time: 1189.6478 (ms) / GPU bubble ratio: 60.73%
[rank0]:2025-12-29 00:35:20,519 -  step: 750  loss: -4.0000  grad_norm:  0.5128  memory: 16.87GiB(35.50%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank3]:2025-12-29 00:35:20,516 -  step: 750  loss:  0.2318  grad_norm:  0.5128  memory: 25.79GiB(54.28%)  tps: 6,725  tflops: 52.57  mfu: 16.85%
[rank0]:2025-12-29 00:39:18,166 - [GC] Peforming periodical GC collection 0.00 seconds
[rank3]:2025-12-29 00:39:22,931 - Avg. fwd time: 24.7754 / Avg. bwd time: 81.2383 / Avg. batch time: 993.3405 (ms) / GPU bubble ratio: 14.62%
[rank2]:2025-12-29 00:39:22,978 - Avg. fwd time: 14.9085 / Avg. bwd time: 35.6987 / Avg. batch time: 1051.3233 (ms) / GPU bubble ratio: 61.49%
[rank1]:2025-12-29 00:39:23,034 - Avg. fwd time: 19.7439 / Avg. bwd time: 46.0239 / Avg. batch time: 1123.8146 (ms) / GPU bubble ratio: 53.18%
[rank3]:2025-12-29 00:39:23,120 -  step: 800  loss:  0.2326  grad_norm:  1.2097  memory: 25.79GiB(54.28%)  tps: 6,753  tflops: 52.80  mfu: 16.92%
[rank3]:2025-12-29 00:39:23,121 - â„¹ï¸ final step: 800  loss:  0.2326  grad_norm:  1.2097  tps: 7,150  tflops: 55.89  mfu: 16.48%
[rank3]:2025-12-29 00:39:23,121 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-29 00:39:23,108 -  step: 800  loss: -4.0000  grad_norm:  1.2097  memory:  8.66GiB(18.23%)  tps: 6,753  tflops: 52.79  mfu: 16.92%
[rank2]:2025-12-29 00:39:23,108 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  1.2097  tps: 7,145  tflops: 55.86  mfu: 16.34%
[rank2]:2025-12-29 00:39:23,108 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-29 00:39:23,109 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-12-29 00:39:23,111 -  step: 800  loss: -4.0000  grad_norm:  1.2097  memory: 12.86GiB(27.07%)  tps: 6,753  tflops: 52.79  mfu: 16.92%
[rank1]:2025-12-29 00:39:23,111 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  1.2097  tps: 7,145  tflops: 55.86  mfu: 16.34%
[rank1]:2025-12-29 00:39:23,112 - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-12-29 00:39:23,112 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-29 00:39:23,086 - Avg. fwd time: 16.2497 / Avg. bwd time: 42.1389 / Avg. batch time: 1189.4140 (ms) / GPU bubble ratio: 60.73%
[rank0]:2025-12-29 00:39:23,123 -  step: 800  loss: -4.0000  grad_norm:  1.2097  memory: 16.87GiB(35.50%)  tps: 6,753  tflops: 52.79  mfu: 16.92%
[rank0]:2025-12-29 00:39:23,123 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  1.2097  tps: 7,146  tflops: 55.86  mfu: 16.35%
[rank0]:2025-12-29 00:39:23,123 - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-12-29 00:39:23,124 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-12-29 00:39:23,122 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-29 00:39:25,549 - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank0]:2025-12-29 00:39:25,570 - Sleeping 2 seconds for other ranks to complete
[rank2]:2025-12-29 00:39:25,569 - Destroying the purge thread.
[rank1]:2025-12-29 00:39:25,569 - Destroying the purge thread.
[rank3]:2025-12-29 00:39:25,714 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0039_final800_rank3.svg
[rank3]:			> Batch Time: 1189.25 ms, GPU Bubble Ratio: 60.60%, 55.79%, 65.89%, 28.22%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-16-32ms     | [S0,MB2,F]  32-16-49ms     | [S0,MB3,F]  49-16-66ms     | [S0,MB0,B]  276-42-319ms   | [S0,MB4,F]  319-15-334ms   | [S0,MB1,B]  399-42-441ms   | [S0,MB5,F]  441-15-457ms   | [S0,MB2,B]  524-42-566ms   | [S0,MB6,F]  567-16-583ms   | [S0,MB3,B]  650-42-692ms   | [S0,MB7,F]  692-15-708ms   | [S0,MB4,B]  776-42-818ms   | [S0,MB5,B]  901-42-943ms   | [S0,MB6,B]  1023-42-1065ms | [S0,MB7,B]  1147-42-1189ms
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-37ms     | [S1,MB1,F]  43-18-61ms     | [S1,MB2,F]  67-18-86ms     | [S1,MB0,B]  222-46-268ms   | [S1,MB3,F]  273-19-292ms   | [S1,MB1,B]  345-46-391ms   | [S1,MB4,F]  396-20-416ms   | [S1,MB2,B]  470-46-516ms   | [S1,MB5,F]  521-20-541ms   | [S1,MB3,B]  595-46-642ms   | [S1,MB6,F]  646-20-667ms   | [S1,MB4,B]  722-46-768ms   | [S1,MB7,F]  772-20-793ms   | [S1,MB5,B]  848-45-894ms   | [S1,MB6,B]  971-45-1017ms  | [S1,MB7,B]  1093-45-1139ms
[rank3]:			  [Rank 2]	[S2,MB0,F]  37-15-52ms     | [S2,MB1,F]  61-14-75ms     | [S2,MB0,B]  175-36-211ms   | [S2,MB2,F]  219-14-233ms   | [S2,MB1,B]  299-35-335ms   | [S2,MB3,F]  342-14-357ms   | [S2,MB2,B]  424-35-460ms   | [S2,MB4,F]  467-14-482ms   | [S2,MB3,B]  550-35-585ms   | [S2,MB5,F]  593-14-607ms   | [S2,MB4,B]  676-35-711ms   | [S2,MB6,F]  719-14-733ms   | [S2,MB5,B]  803-35-838ms   | [S2,MB7,F]  845-14-860ms   | [S2,MB6,B]  929-35-964ms   | [S2,MB7,B]  1052-35-1087ms
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-77-165ms    | [S3,MB1,F]  172-24-197ms   | [S3,MB1,B]  208-81-290ms   | [S3,MB2,F]  296-24-321ms   | [S3,MB2,B]  333-82-415ms   | [S3,MB3,F]  421-25-446ms   | [S3,MB3,B]  458-82-541ms   | [S3,MB4,F]  546-25-571ms   | [S3,MB4,B]  584-82-666ms   | [S3,MB5,F]  673-25-698ms   | [S3,MB5,B]  710-82-793ms   | [S3,MB6,F]  799-24-824ms   | [S3,MB6,B]  836-82-919ms   | [S3,MB7,F]  926-24-950ms   | [S3,MB7,B]  963-82-1045ms 
[rank2]:2025-12-29 00:39:25,662 - Process group destroyed
[rank1]:2025-12-29 00:39:25,705 - Process group destroyed
[rank3]:2025-12-29 00:39:25,855 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1/pipeline_schedule/251229_0039_thry_final800_rank3.svg
[rank3]:			> Batch Time: 623.37 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-18-18ms      | [S0,MB1,F]  18-18-37ms     | [S0,MB2,F]  37-18-56ms     | [S0,MB3,F]  56-18-75ms     | [S0,MB0,B]  188-37-226ms   | [S0,MB4,F]  226-18-245ms   | [S0,MB1,B]  245-37-283ms   | [S0,MB5,F]  283-18-302ms   | [S0,MB2,B]  302-37-340ms   | [S0,MB6,F]  340-18-358ms   | [S0,MB3,B]  358-37-396ms   | [S0,MB7,F]  396-18-415ms   | [S0,MB4,B]  415-37-453ms   | [S0,MB5,B]  472-37-510ms   | [S0,MB6,B]  528-37-566ms   | [S0,MB7,B]  585-37-623ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  18-18-37ms     | [S1,MB1,F]  37-18-56ms     | [S1,MB2,F]  56-18-75ms     | [S1,MB0,B]  151-37-188ms   | [S1,MB3,F]  188-18-207ms   | [S1,MB1,B]  207-37-245ms   | [S1,MB4,F]  245-18-264ms   | [S1,MB2,B]  264-37-302ms   | [S1,MB5,F]  302-18-321ms   | [S1,MB3,B]  321-37-358ms   | [S1,MB6,F]  358-18-377ms   | [S1,MB4,B]  377-37-415ms   | [S1,MB7,F]  415-18-434ms   | [S1,MB5,B]  434-37-472ms   | [S1,MB6,B]  491-37-528ms   | [S1,MB7,B]  547-37-585ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  37-18-56ms     | [S2,MB1,F]  56-18-75ms     | [S2,MB0,B]  113-37-151ms   | [S2,MB2,F]  151-18-170ms   | [S2,MB1,B]  170-37-207ms   | [S2,MB3,F]  207-18-226ms   | [S2,MB2,B]  226-37-264ms   | [S2,MB4,F]  264-18-283ms   | [S2,MB3,B]  283-37-321ms   | [S2,MB5,F]  321-18-340ms   | [S2,MB4,B]  340-37-377ms   | [S2,MB6,F]  377-18-396ms   | [S2,MB5,B]  396-37-434ms   | [S2,MB7,F]  434-18-453ms   | [S2,MB6,B]  453-37-491ms   | [S2,MB7,B]  510-37-547ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  56-18-75ms     | [S3,MB0,B]  75-37-113ms    | [S3,MB1,F]  113-18-132ms   | [S3,MB1,B]  132-37-170ms   | [S3,MB2,F]  170-18-188ms   | [S3,MB2,B]  188-37-226ms   | [S3,MB3,F]  226-18-245ms   | [S3,MB3,B]  245-37-283ms   | [S3,MB4,F]  283-18-302ms   | [S3,MB4,B]  302-37-340ms   | [S3,MB5,F]  340-18-358ms   | [S3,MB5,B]  358-37-396ms   | [S3,MB6,F]  396-18-415ms   | [S3,MB6,B]  415-37-453ms   | [S3,MB7,F]  453-18-472ms   | [S3,MB7,B]  472-37-510ms  
[rank3]:2025-12-29 00:39:25,856 - Destroying the purge thread.
[rank3]:wandb: updating run metadata
[rank3]:wandb: uploading history steps 15-16, summary, console lines 258-275
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–‚â–‚â–‚â–‚â–â–â–â–â–â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–ˆâ–†â–ƒâ–‚â–â–â–â–â–â–â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–ˆâ–†â–ƒâ–‚â–â–â–â–â–â–â–â–â–â–â–â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 4.5831
[rank3]:wandb:               final/avg_loss 0.23258
[rank3]:wandb:             final/avg_mfu(%) 16.47746
[rank3]:wandb:             final/avg_tflops 55.89348
[rank3]:wandb:    final/avg_throughput(tps) 7149.75322
[rank3]:wandb:              final/grad_norm 1.2097
[rank3]:wandb:               final/max_loss 0.23258
[rank3]:wandb:                    grad_norm 1.2097
[rank3]:wandb: loss_metrics/global_avg_loss 0.23258
[rank3]:wandb: loss_metrics/global_max_loss 0.23258
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1227_1F1B_nofreeze_11_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/xz0jv6f3
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1227_1F1B_nofreeze_11_dm1/20251228-2334/wandb/run-20251228_233426-xz0jv6f3/logs
[rank3]:2025-12-29 00:39:27,165 - Process group destroyed
[rank0]:2025-12-29 00:39:27,570 - Training completed
[rank0]:2025-12-29 00:39:27,571 - Destroying the purge thread.
[rank0]:2025-12-29 00:39:27,734 - Process group destroyed
[rank2]:Stage 2: Modules to keep: {'layers.10', 'layers.12', 'layers.9', 'layers.11'}
[rank1]:Stage 1: Modules to keep: {'layers.5', 'layers.6', 'layers.4', 'layers.8', 'layers.7'}
[rank0]:Stage 0: Modules to keep: {'layers.2', 'layers.1', 'layers.3', 'tok_embeddings', 'layers.0'}
[rank3]:Stage 3: Modules to keep: {'norm', 'output', 'layers.13', 'layers.14', 'layers.15'}
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/config_1227.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank3]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank3]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank3]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank3]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank3]:1224: everything same as 1109 (dataset: alpaca_gpt4) but debugged requires_grad bug
[rank3]:1227: everything same as 1224 but seed=42->11
[rank3]:"
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1227_1F1B_nofreeze_11_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1227_1F1B_nofreeze_11_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1227_1F1B_nofreeze_11_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1227_1F1B_nofreeze_11_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1227_1F1B_nofreeze_11_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1227_1F1B_nofreeze_11_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 11
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 4
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1227_1F1B_nofreeze_11_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1227_1F1B_nofreeze_11_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: False
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.05
[rank3]:		- percentile: 80
[rank3]:
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
