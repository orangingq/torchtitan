
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
âœ”ï¸Current Timestamp: 2025. 12. 24. (ìˆ˜) 07:17:07 KST
âœ”ï¸SERVER: dmserver1 (143.248.135.95),  GPUs: 2,3,4,5
âœ”ï¸SCRIPT: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/run.sh
âœ”ï¸OUTPUT: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/1224_1F1B_apf_42.log
âœ”ï¸Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
1109: switch to alpaca_gpt4+alpaca_cleaned dataset
1224: everything same as 1109 but debugged requires_grad bug

âœ”ï¸Running with apf x 1F1B ... 
â˜‘ï¸> torchrun --standalone --nnodes=1 --nproc_per_node=4 --local_addr=127.0.0.1 --local-ranks-filter=0,1,2,3 --role=rank --tee=3 -m timelyfreeze.train --job.config_file=/home/shcho/torchtitan/logs/dmserver1/1104_llama1b/config_1224.toml --job.description="Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
1109: switch to alpaca_gpt4+alpaca_cleaned dataset
1224: everything same as 1109 but debugged requires_grad bug
" --parallelism.pipeline_parallel_degree=4  --freezing.freeze --freezing.metric_type=apf --freezing.threshold=0.01 --freezing.percentile=80 --freezing.max_freeze_ratio=0.8
ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
[rank2]:2025-12-24 07:17:13,427 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank2]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank2]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank2]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank2]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank2]:1224: everything same as 1109 but debugged requires_grad bug
[rank2]:"
[rank3]:2025-12-24 07:17:13,432 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank3]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank3]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank3]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank3]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank3]:1224: everything same as 1109 but debugged requires_grad bug
[rank3]:"
[rank1]:2025-12-24 07:17:13,669 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank1]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank1]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank1]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank1]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank1]:1224: everything same as 1109 but debugged requires_grad bug
[rank1]:"
[rank2]:2025-12-24 07:17:13,651 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-24 07:17:13,628 - Starting job: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank2]:2025-12-24 07:17:13,653 - Building 1-D device mesh with ['pp'], [4]
[rank0]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank0]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank0]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank0]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank0]:1224: everything same as 1109 but debugged requires_grad bug
[rank0]:"
[rank3]:2025-12-24 07:17:13,639 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank3]:2025-12-24 07:17:13,641 - Building 1-D device mesh with ['pp'], [4]
[rank1]:2025-12-24 07:17:13,880 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank1]:2025-12-24 07:17:13,883 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-24 07:17:13,816 - ENV[TORCH_NCCL_ASYNC_ERROR_HANDLING] = 1 will be overridden to 3 based on job config
[rank0]:2025-12-24 07:17:13,819 - Building 1-D device mesh with ['pp'], [4]
[rank0]:2025-12-24 07:17:13,822 - [GC] Initial GC collection 0.00 seconds
[rank0]:2025-12-24 07:17:13,824 - Loading tokenizer from tokenizer.json
[rank0]:2025-12-24 07:17:14,220 - Preparing alpaca_gpt4 dataset from vicgalle/alpaca-gpt4
[rank0]:2025-12-24 07:17:16,961 - Building llama3 1B with TransformerModelArgs(_enforced='This field is used to enforce all fields have defaults.', dim=2048, n_layers=16, n_heads=32, n_kv_heads=8, vocab_size=128256, multiple_of=256, ffn_dim_multiplier=1.5, norm_eps=1e-05, rope_theta=500000, max_seq_len=1024, depth_init=True, use_flex_attn=False, attn_mask_type='causal', eos_id=0)
[rank0]:2025-12-24 07:17:17,111 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank0]:2025-12-24 07:17:17,161 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-24 07:17:17,162 - Model llama3 1B size: 1,498,482,688 total parameters
[rank0]:2025-12-24 07:17:17,188 - PP rank 0 is building stage_idx 0 with modules ['tok_embeddings', 'layers.0', 'layers.1', 'layers.2', 'layers.3']
[rank0]:2025-12-24 07:17:17,189 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank0]:2025-12-24 07:17:17,376 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank0]:2025-12-24 07:17:17,376 - Peak FLOPS used for computing MFU: 3.120e+14
[rank0]:2025-12-24 07:17:17,377 - CUDA memory usage for model: 1.90GiB(3.99%)
[rank1]:2025-12-24 07:17:17,474 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-12-24 07:17:17,430 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank2]:2025-12-24 07:17:17,466 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-24 07:17:17,502 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-24 07:17:17,524 - PP rank 1 is building stage_idx 1 with modules ['layers.4', 'layers.5', 'layers.6', 'layers.7', 'layers.8']
[rank1]:2025-12-24 07:17:17,525 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-24 07:17:17,494 - PP rank 2 is building stage_idx 2 with modules ['layers.9', 'layers.10', 'layers.11', 'layers.12']
[rank2]:2025-12-24 07:17:17,495 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank2]:2025-12-24 07:17:17,676 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank2]:2025-12-24 07:17:17,676 - Peak FLOPS used for computing MFU: 3.120e+14
[rank2]:2025-12-24 07:17:17,676 - CUDA memory usage for model: 0.92GiB(1.94%)
[rank1]:2025-12-24 07:17:17,708 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank1]:2025-12-24 07:17:17,708 - Peak FLOPS used for computing MFU: 3.120e+14
[rank1]:2025-12-24 07:17:17,709 - CUDA memory usage for model: 1.13GiB(2.39%)
[rank3]:wandb: Currently logged in as: orangingq to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
[rank3]:wandb: setting up run igb7defx
[rank3]:wandb: Tracking run with wandb version 0.22.2
[rank3]:wandb: Run data is saved locally in /data2/shcho/torchtitan/tb/1224_1F1B_apf_42_dm1/20251224-0717/wandb/run-20251224_071718-igb7defx
[rank3]:wandb: Run `wandb offline` to turn off syncing.
[rank3]:wandb: Syncing run 1224_1F1B_apf_42_dm1
[rank3]:wandb: â­ï¸ View project at https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: ðŸš€ View run at https://wandb.ai/orangingq/torchtitan/runs/igb7defx
[rank3]:2025-12-24 07:17:19,479 - WandB logging enabled
[rank3]:2025-12-24 07:17:19,479 - CUDA capacity: NVIDIA RTX 6000 Ada Generation with 47.51GiB memory
[rank3]:2025-12-24 07:17:19,517 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-24 07:17:19,546 - PP rank 3 is building stage_idx 3 with modules ['layers.13', 'layers.14', 'layers.15', 'norm', 'output']
[rank3]:2025-12-24 07:17:19,546 - Using pipeline schedule 1F1B with 8 microbatches and 4 stages.
[rank1]:2025-12-24 07:17:19,753 - Mixed precision training with TP or PP is handled by autocast
[rank2]:2025-12-24 07:17:19,752 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-24 07:17:19,752 - Checkpointing active. Checkpoints will be loaded from and saved to /data2/shcho/torchtitan/checkpoint/1224_1F1B_apf_42_dm1
[rank0]:2025-12-24 07:17:19,752 - Mixed precision training with TP or PP is handled by autocast
[rank3]:2025-12-24 07:17:19,735 - Peak flops undefined for: NVIDIA RTX 6000 Ada Generation, fallback to A100
[rank3]:2025-12-24 07:17:19,735 - Peak FLOPS used for computing MFU: 3.120e+14
[rank3]:2025-12-24 07:17:19,736 - CUDA memory usage for model: 1.66GiB(3.50%)
[rank3]:2025-12-24 07:17:19,752 - Mixed precision training with TP or PP is handled by autocast
[rank0]:2025-12-24 07:17:19,753 - Trainer is initialized with local batch size 32, global batch size 128, gradient accumulation steps 4, sequence length 1024, total steps 800 (warmup 100)
[rank0]:2025-12-24 07:17:19,753 - Loading the checkpoint from /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp.
[rank0]:2025-12-24 07:17:22,238 - [GC] GC collection for checkpoint loading. 0.00 seconds
[rank0]:2025-12-24 07:17:22,238 - Finished loading the checkpoint in 2.49 seconds.
[rank0]:2025-12-24 07:17:22,238 - Training starts at step 1
[rank2]:2025-12-24 07:17:27,512 -  step:  1  loss: -4.0000  grad_norm: 203.0658  memory:  6.84GiB(14.41%)  tps: 3,262  tflops: 25.50  mfu: 8.17%
[rank2]:2025-12-24 07:17:27,513 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank3]:2025-12-24 07:17:27,524 -  step:  1  loss: 10.6092  grad_norm: 203.0658  memory: 21.88GiB(46.05%)  tps: 4,094  tflops: 32.00  mfu: 10.26%
[rank3]:2025-12-24 07:17:27,525 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-24 07:17:27,551 -  step:  1  loss: -4.0000  grad_norm: 203.0658  memory: 13.10GiB(27.57%)  tps: 3,154  tflops: 24.65  mfu: 7.90%
[rank0]:2025-12-24 07:17:27,552 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank1]:2025-12-24 07:17:27,517 -  step:  1  loss: -4.0000  grad_norm: 203.0658  memory: 10.58GiB(22.26%)  tps: 3,272  tflops: 25.58  mfu: 8.20%
[rank1]:2025-12-24 07:17:27,517 - Synchronizing and adjusting timeout for all ProcessGroups to 0:05:00
[rank0]:2025-12-24 07:21:20,738 - [GC] Peforming periodical GC collection 0.00 seconds
[rank2]:2025-12-24 07:21:25,454 - Avg. fwd time: 15.3742 / Avg. bwd time: 35.9498 / Avg. batch time: 1049.1444 (ms) / GPU bubble ratio: 60.86%
[rank3]:2025-12-24 07:21:25,411 - Avg. fwd time: 24.6881 / Avg. bwd time: 80.9126 / Avg. batch time: 989.9242 (ms) / GPU bubble ratio: 14.66%
[rank1]:2025-12-24 07:21:25,506 - Avg. fwd time: 19.8721 / Avg. bwd time: 46.4458 / Avg. batch time: 1122.9439 (ms) / GPU bubble ratio: 52.75%
[rank3]:2025-12-24 07:21:25,588 -  step: 50  loss:  9.8851  grad_norm: 24.5315  memory: 25.79GiB(54.28%)  tps: 6,745  tflops: 52.73  mfu: 16.90%
[rank2]:2025-12-24 07:21:25,576 -  step: 50  loss: -4.0000  grad_norm: 24.5315  memory:  8.66GiB(18.23%)  tps: 6,745  tflops: 52.73  mfu: 16.90%
[rank0]:2025-12-24 07:21:25,554 - Avg. fwd time: 16.0148 / Avg. bwd time: 41.5390 / Avg. batch time: 1188.7696 (ms) / GPU bubble ratio: 61.27%
[rank0]:2025-12-24 07:21:25,593 -  step: 50  loss: -4.0000  grad_norm: 24.5315  memory: 16.87GiB(35.50%)  tps: 6,745  tflops: 52.73  mfu: 16.90%
[rank1]:2025-12-24 07:21:25,579 -  step: 50  loss: -4.0000  grad_norm: 24.5315  memory: 12.86GiB(27.07%)  tps: 6,745  tflops: 52.73  mfu: 16.90%
[rank3]:2025-12-24 07:22:08,873 - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:22:09,277 - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:22:09,327 - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:22:09,371 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:22:58,074 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:22:58,064 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:22:58,045 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:22:58,051 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:23:38,721 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:23:38,721 - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:23:38,751 - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:23:38,721 - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:24:27,596 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:24:27,587 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:24:27,564 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:24:27,571 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:25:08,055 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:25:08,057 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:25:08,055 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:25:08,084 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:25:08,055 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:25:12,000 - Avg. fwd time: 15.5116 / Avg. bwd time: 32.3260 / Avg. batch time: 1019.6047 (ms) / GPU bubble ratio: 62.47%
[rank3]:2025-12-24 07:25:11,975 - Avg. fwd time: 25.0768 / Avg. bwd time: 77.3549 / Avg. batch time: 964.4540 (ms) / GPU bubble ratio: 15.03%
[rank0]:2025-12-24 07:25:12,055 - Avg. fwd time: 16.1777 / Avg. bwd time: 36.7572 / Avg. batch time: 1148.8773 (ms) / GPU bubble ratio: 63.14%
[rank0]:2025-12-24 07:25:12,057 -  step: 100  loss: -4.0000  grad_norm: 14.0365  memory: 18.72GiB(39.41%)  tps: 7,235  tflops: 56.56  mfu: 18.13%
[rank2]:2025-12-24 07:25:12,057 -  step: 100  loss: -4.0000  grad_norm: 14.0365  memory:  9.58GiB(20.16%)  tps: 7,234  tflops: 56.55  mfu: 18.13%
[rank3]:2025-12-24 07:25:12,072 -  step: 100  loss:  8.7909  grad_norm: 14.0365  memory: 27.74GiB(58.39%)  tps: 7,234  tflops: 56.55  mfu: 18.13%
[rank1]:2025-12-24 07:25:12,030 - Avg. fwd time: 20.0513 / Avg. bwd time: 41.7087 / Avg. batch time: 1088.2622 (ms) / GPU bubble ratio: 54.60%
[rank1]:2025-12-24 07:25:12,056 -  step: 100  loss: -4.0000  grad_norm: 14.0365  memory: 14.00GiB(29.46%)  tps: 7,234  tflops: 56.55  mfu: 18.13%
[rank0]:2025-12-24 07:25:12,149 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0725_stage0_step100.svg
[rank2]:2025-12-24 07:25:12,151 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0725_stage2_step100.svg
[rank1]:2025-12-24 07:25:12,150 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0725_stage1_step100.svg
[rank3]:2025-12-24 07:25:12,242 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0725_step100_rank3.svg
[rank3]:			> Batch Time: 992.11 ms, GPU Bubble Ratio: 71.59%, 64.38%, 72.27%, 27.86%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  218-18-236ms   | [S0,MB4,F]  237-16-253ms   | [S0,MB1,B]  325-18-343ms   | [S0,MB5,F]  343-16-359ms   | [S0,MB2,B]  434-18-452ms   | [S0,MB6,F]  453-16-469ms   | [S0,MB3,B]  544-18-563ms   | [S0,MB7,F]  563-16-579ms   | [S0,MB4,B]  654-18-672ms   | [S0,MB5,B]  760-18-778ms   | [S0,MB6,B]  867-18-886ms   | [S0,MB7,B]  973-18-992ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  184-23-207ms   | [S1,MB3,F]  214-20-235ms   | [S1,MB1,B]  291-23-314ms   | [S1,MB4,F]  321-20-342ms   | [S1,MB2,B]  400-23-423ms   | [S1,MB5,F]  431-20-451ms   | [S1,MB3,B]  510-23-533ms   | [S1,MB6,F]  541-20-561ms   | [S1,MB4,B]  620-23-643ms   | [S1,MB7,F]  650-20-671ms   | [S1,MB5,B]  730-23-753ms   | [S1,MB6,B]  837-23-860ms   | [S1,MB7,B]  943-23-966ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  157-18-176ms   | [S2,MB2,F]  180-15-196ms   | [S2,MB1,B]  264-18-283ms   | [S2,MB3,F]  287-16-303ms   | [S2,MB2,B]  374-18-392ms   | [S2,MB4,F]  397-16-413ms   | [S2,MB3,B]  483-18-502ms   | [S2,MB5,F]  506-15-522ms   | [S2,MB4,B]  593-18-611ms   | [S2,MB6,F]  616-16-632ms   | [S2,MB5,B]  703-18-722ms   | [S2,MB7,F]  726-15-742ms   | [S2,MB6,B]  813-18-831ms   | [S2,MB7,B]  918-18-936ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-75ms     | [S3,MB0,B]  87-59-147ms    | [S3,MB1,F]  154-25-179ms   | [S3,MB1,B]  192-62-255ms   | [S3,MB2,F]  261-26-288ms   | [S3,MB2,B]  300-64-364ms   | [S3,MB3,F]  371-26-397ms   | [S3,MB3,B]  409-64-473ms   | [S3,MB4,F]  480-26-507ms   | [S3,MB4,B]  519-64-583ms   | [S3,MB5,F]  590-26-617ms   | [S3,MB5,B]  629-63-692ms   | [S3,MB6,F]  700-26-727ms   | [S3,MB6,B]  739-64-803ms   | [S3,MB7,F]  810-26-836ms   | [S3,MB7,B]  848-64-912ms  
[rank3]:2025-12-24 07:25:12,289 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0725_stage3_step100.svg
[rank1]:2025-12-24 07:25:48,671 - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:25:48,671 - Freezing Ratio: [Stage0] 0.03, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:25:48,670 - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:25:48,700 - Freezing Ratio: [Stage3] 0.00, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:26:37,424 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:26:37,449 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:26:37,417 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:26:37,440 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:27:18,022 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:27:18,023 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:27:18,052 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:27:18,023 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:27:58,548 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:27:58,547 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:27:58,577 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:27:58,548 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:28:38,997 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:28:38,999 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:28:38,993 - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:28:39,023 - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:28:38,994 - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:28:43,732 - Avg. fwd time: 25.3994 / Avg. bwd time: 73.9980 / Avg. batch time: 940.1256 (ms) / GPU bubble ratio: 15.42%
[rank2]:2025-12-24 07:28:43,775 - Avg. fwd time: 15.6385 / Avg. bwd time: 28.9929 / Avg. batch time: 991.9110 (ms) / GPU bubble ratio: 64.00%
[rank1]:2025-12-24 07:28:43,828 - Avg. fwd time: 20.2048 / Avg. bwd time: 37.3665 / Avg. batch time: 1056.0893 (ms) / GPU bubble ratio: 56.39%
[rank0]:2025-12-24 07:28:43,876 - Avg. fwd time: 16.3142 / Avg. bwd time: 32.3885 / Avg. batch time: 1112.1613 (ms) / GPU bubble ratio: 64.97%
[rank0]:2025-12-24 07:28:43,915 -  step: 150  loss: -4.0000  grad_norm: 19.0186  memory: 18.76GiB(39.49%)  tps: 7,733  tflops: 60.46  mfu: 19.38%
[rank2]:2025-12-24 07:28:43,898 -  step: 150  loss: -4.0000  grad_norm: 19.0186  memory:  9.58GiB(20.16%)  tps: 7,734  tflops: 60.46  mfu: 19.38%
[rank3]:2025-12-24 07:28:43,910 -  step: 150  loss:  5.3603  grad_norm: 19.0186  memory: 27.89GiB(58.72%)  tps: 7,734  tflops: 60.46  mfu: 19.38%
[rank1]:2025-12-24 07:28:43,901 -  step: 150  loss: -4.0000  grad_norm: 19.0186  memory: 14.00GiB(29.46%)  tps: 7,734  tflops: 60.46  mfu: 19.38%
[rank0]:2025-12-24 07:29:27,784 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:29:27,752 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:29:27,777 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:29:27,759 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:30:08,352 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:30:08,351 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:30:08,381 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:30:08,351 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:30:48,928 - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:30:48,929 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:30:48,929 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:30:48,958 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:31:29,509 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:31:29,510 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:31:29,508 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:31:29,539 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:32:10,169 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:32:10,171 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:32:10,169 - Freezing Ratio: [Stage2] 0.11, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:32:10,199 - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:32:10,169 - Freezing Ratio: [Stage1] 0.02, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:32:15,016 - Avg. fwd time: 15.7045 / Avg. bwd time: 27.2251 / Avg. batch time: 977.5675 (ms) / GPU bubble ratio: 64.87%
[rank3]:2025-12-24 07:32:14,972 - Avg. fwd time: 25.5852 / Avg. bwd time: 72.2572 / Avg. batch time: 927.6521 (ms) / GPU bubble ratio: 15.62%
[rank1]:2025-12-24 07:32:15,069 - Avg. fwd time: 20.2876 / Avg. bwd time: 35.0833 / Avg. batch time: 1039.4120 (ms) / GPU bubble ratio: 57.38%
[rank0]:2025-12-24 07:32:15,118 - Avg. fwd time: 16.3929 / Avg. bwd time: 30.0949 / Avg. batch time: 1093.1309 (ms) / GPU bubble ratio: 65.98%
[rank2]:2025-12-24 07:32:15,140 -  step: 200  loss: -4.0000  grad_norm: 15.1623  memory:  9.58GiB(20.16%)  tps: 7,756  tflops: 60.63  mfu: 19.43%
[rank1]:2025-12-24 07:32:15,143 -  step: 200  loss: -4.0000  grad_norm: 15.1623  memory: 14.00GiB(29.46%)  tps: 7,756  tflops: 60.63  mfu: 19.43%
[rank0]:2025-12-24 07:32:15,156 -  step: 200  loss: -4.0000  grad_norm: 15.1623  memory: 18.76GiB(39.49%)  tps: 7,756  tflops: 60.63  mfu: 19.43%
[rank0]:2025-12-24 07:32:15,219 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0732_stage0_step200.svg
[rank2]:2025-12-24 07:32:15,217 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0732_stage2_step200.svg
[rank3]:2025-12-24 07:32:15,152 -  step: 200  loss:  1.6054  grad_norm: 15.1623  memory: 27.89GiB(58.72%)  tps: 7,756  tflops: 60.63  mfu: 19.43%
[rank1]:2025-12-24 07:32:15,211 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0732_stage1_step200.svg
[rank3]:2025-12-24 07:32:15,304 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0732_step200_rank3.svg
[rank3]:			> Batch Time: 998.14 ms, GPU Bubble Ratio: 71.67%, 64.50%, 72.36%, 27.82%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  218-18-236ms   | [S0,MB4,F]  236-16-252ms   | [S0,MB1,B]  325-18-344ms   | [S0,MB5,F]  344-16-360ms   | [S0,MB2,B]  435-18-454ms   | [S0,MB6,F]  454-16-470ms   | [S0,MB3,B]  546-18-564ms   | [S0,MB7,F]  564-16-580ms   | [S0,MB4,B]  656-18-674ms   | [S0,MB5,B]  763-18-782ms   | [S0,MB6,B]  872-18-890ms   | [S0,MB7,B]  979-18-998ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  183-23-207ms   | [S1,MB3,F]  214-20-235ms   | [S1,MB1,B]  291-23-314ms   | [S1,MB4,F]  322-20-342ms   | [S1,MB2,B]  401-23-425ms   | [S1,MB5,F]  432-20-453ms   | [S1,MB3,B]  512-23-535ms   | [S1,MB6,F]  542-20-563ms   | [S1,MB4,B]  622-23-645ms   | [S1,MB7,F]  652-20-673ms   | [S1,MB5,B]  733-23-757ms   | [S1,MB6,B]  842-23-865ms   | [S1,MB7,B]  949-23-973ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  157-18-175ms   | [S2,MB2,F]  180-16-196ms   | [S2,MB1,B]  265-18-283ms   | [S2,MB3,F]  288-16-304ms   | [S2,MB2,B]  375-18-393ms   | [S2,MB4,F]  398-16-414ms   | [S2,MB3,B]  485-18-504ms   | [S2,MB5,F]  508-16-524ms   | [S2,MB4,B]  595-18-614ms   | [S2,MB6,F]  618-16-634ms   | [S2,MB5,B]  706-18-725ms   | [S2,MB7,F]  729-16-745ms   | [S2,MB6,B]  817-18-835ms   | [S2,MB7,B]  924-18-943ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-59-147ms    | [S3,MB1,F]  154-25-179ms   | [S3,MB1,B]  191-62-254ms   | [S3,MB2,F]  262-26-288ms   | [S3,MB2,B]  301-64-365ms   | [S3,MB3,F]  371-26-398ms   | [S3,MB3,B]  410-64-475ms   | [S3,MB4,F]  482-27-510ms   | [S3,MB4,B]  521-64-586ms   | [S3,MB5,F]  592-27-619ms   | [S3,MB5,B]  632-64-696ms   | [S3,MB6,F]  704-26-731ms   | [S3,MB6,B]  742-64-807ms   | [S3,MB7,F]  814-27-842ms   | [S3,MB7,B]  854-64-918ms  
[rank3]:2025-12-24 07:32:15,352 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0732_stage3_step200.svg
[rank2]:2025-12-24 07:32:59,184 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:32:59,192 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:32:59,216 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:32:59,207 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:33:39,766 - Freezing Ratio: [Stage1] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:33:39,767 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:33:39,796 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:33:39,766 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:34:20,273 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:34:20,302 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:34:20,272 - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:34:20,273 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:35:00,870 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:35:00,870 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:35:00,869 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:35:00,900 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:35:41,497 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:35:41,499 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:35:41,493 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:35:41,494 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:35:41,524 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:35:45,490 - Avg. fwd time: 15.7468 / Avg. bwd time: 26.0826 / Avg. batch time: 968.2170 (ms) / GPU bubble ratio: 65.44%
[rank3]:2025-12-24 07:35:45,464 - Avg. fwd time: 25.6962 / Avg. bwd time: 71.1217 / Avg. batch time: 919.4329 (ms) / GPU bubble ratio: 15.76%
[rank1]:2025-12-24 07:35:45,520 - Avg. fwd time: 20.3408 / Avg. bwd time: 33.6113 / Avg. batch time: 1028.5478 (ms) / GPU bubble ratio: 58.04%
[rank1]:2025-12-24 07:35:45,548 -  step: 250  loss: -4.0000  grad_norm: 11.6318  memory: 14.00GiB(29.46%)  tps: 7,787  tflops: 60.87  mfu: 19.51%
[rank0]:2025-12-24 07:35:45,546 - Avg. fwd time: 16.4362 / Avg. bwd time: 28.6250 / Avg. batch time: 1080.7590 (ms) / GPU bubble ratio: 66.64%
[rank0]:2025-12-24 07:35:45,548 -  step: 250  loss: -4.0000  grad_norm: 11.6318  memory: 18.76GiB(39.49%)  tps: 7,787  tflops: 60.88  mfu: 19.51%
[rank2]:2025-12-24 07:35:45,548 -  step: 250  loss: -4.0000  grad_norm: 11.6318  memory:  9.58GiB(20.16%)  tps: 7,787  tflops: 60.87  mfu: 19.51%
[rank3]:2025-12-24 07:35:45,563 -  step: 250  loss:  5.0730  grad_norm: 11.6318  memory: 27.89GiB(58.72%)  tps: 7,787  tflops: 60.87  mfu: 19.51%
[rank2]:2025-12-24 07:36:22,010 - Freezing Ratio: [Stage2] 0.11, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:36:22,012 - Freezing Ratio: [Stage0] 0.00, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:36:22,041 - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:36:22,011 - Freezing Ratio: [Stage1] 0.00, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:37:10,651 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:37:10,667 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:37:10,676 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:37:10,643 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:37:51,206 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:37:51,236 - Freezing Ratio: [Stage3] 0.72, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:37:51,207 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:37:51,205 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:38:31,900 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:38:31,899 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:38:31,900 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:38:31,930 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:39:12,390 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:39:12,420 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:39:12,391 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:39:12,393 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:39:12,390 - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:39:16,345 - Avg. fwd time: 25.7560 / Avg. bwd time: 70.4200 / Avg. batch time: 914.2931 (ms) / GPU bubble ratio: 15.85%
[rank2]:2025-12-24 07:39:16,372 - Avg. fwd time: 15.7687 / Avg. bwd time: 25.3742 / Avg. batch time: 962.3142 (ms) / GPU bubble ratio: 65.80%
[rank1]:2025-12-24 07:39:16,402 - Avg. fwd time: 20.3626 / Avg. bwd time: 32.7012 / Avg. batch time: 1021.7012 (ms) / GPU bubble ratio: 58.45%
[rank1]:2025-12-24 07:39:16,430 -  step: 300  loss: -4.0000  grad_norm: 13.0708  memory: 14.00GiB(29.46%)  tps: 7,769  tflops: 60.74  mfu: 19.47%
[rank3]:2025-12-24 07:39:16,445 -  step: 300  loss:  3.7701  grad_norm: 13.0708  memory: 27.89GiB(58.72%)  tps: 7,769  tflops: 60.74  mfu: 19.47%
[rank0]:2025-12-24 07:39:16,428 - Avg. fwd time: 16.4626 / Avg. bwd time: 27.7204 / Avg. batch time: 1072.9743 (ms) / GPU bubble ratio: 67.06%
[rank0]:2025-12-24 07:39:16,430 -  step: 300  loss: -4.0000  grad_norm: 13.0708  memory: 18.76GiB(39.49%)  tps: 7,769  tflops: 60.74  mfu: 19.47%
[rank2]:2025-12-24 07:39:16,430 -  step: 300  loss: -4.0000  grad_norm: 13.0708  memory:  9.58GiB(20.16%)  tps: 7,769  tflops: 60.74  mfu: 19.47%
[rank2]:2025-12-24 07:39:16,493 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0739_stage2_step300.svg
[rank1]:2025-12-24 07:39:16,491 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0739_stage1_step300.svg
[rank0]:2025-12-24 07:39:16,498 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0739_stage0_step300.svg
[rank3]:2025-12-24 07:39:16,592 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0739_step300_rank3.svg
[rank3]:			> Batch Time: 993.56 ms, GPU Bubble Ratio: 71.60%, 64.51%, 72.36%, 27.81%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  217-18-235ms   | [S0,MB4,F]  236-16-252ms   | [S0,MB1,B]  324-18-343ms   | [S0,MB5,F]  343-16-359ms   | [S0,MB2,B]  434-18-452ms   | [S0,MB6,F]  453-16-469ms   | [S0,MB3,B]  544-18-562ms   | [S0,MB7,F]  562-16-578ms   | [S0,MB4,B]  653-18-671ms   | [S0,MB5,B]  758-18-777ms   | [S0,MB6,B]  867-18-886ms   | [S0,MB7,B]  975-18-993ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  183-23-206ms   | [S1,MB3,F]  213-20-234ms   | [S1,MB1,B]  290-23-313ms   | [S1,MB4,F]  320-20-341ms   | [S1,MB2,B]  399-23-423ms   | [S1,MB5,F]  430-20-451ms   | [S1,MB3,B]  509-23-533ms   | [S1,MB6,F]  540-20-561ms   | [S1,MB4,B]  618-23-642ms   | [S1,MB7,F]  649-20-670ms   | [S1,MB5,B]  728-23-752ms   | [S1,MB6,B]  836-23-860ms   | [S1,MB7,B]  944-23-967ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  157-18-175ms   | [S2,MB2,F]  180-15-196ms   | [S2,MB1,B]  264-18-282ms   | [S2,MB3,F]  287-16-303ms   | [S2,MB2,B]  373-18-391ms   | [S2,MB4,F]  396-15-412ms   | [S2,MB3,B]  484-18-502ms   | [S2,MB5,F]  506-15-522ms   | [S2,MB4,B]  592-18-611ms   | [S2,MB6,F]  615-16-631ms   | [S2,MB5,B]  702-18-721ms   | [S2,MB7,F]  725-16-741ms   | [S2,MB6,B]  812-18-831ms   | [S2,MB7,B]  918-18-936ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-59-147ms    | [S3,MB1,F]  154-25-179ms   | [S3,MB1,B]  191-62-253ms   | [S3,MB2,F]  261-26-288ms   | [S3,MB2,B]  299-64-363ms   | [S3,MB3,F]  370-26-397ms   | [S3,MB3,B]  410-63-473ms   | [S3,MB4,F]  480-26-507ms   | [S3,MB4,B]  518-64-582ms   | [S3,MB5,F]  589-27-617ms   | [S3,MB5,B]  628-63-692ms   | [S3,MB6,F]  699-26-726ms   | [S3,MB6,B]  738-64-802ms   | [S3,MB7,F]  809-27-836ms   | [S3,MB7,B]  847-64-911ms  
[rank3]:2025-12-24 07:39:16,639 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0739_stage3_step300.svg
[rank0]:2025-12-24 07:39:53,020 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:39:53,018 - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:39:53,019 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:39:53,048 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:40:33,578 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:40:33,579 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:40:33,609 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:40:33,580 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:41:14,197 - Freezing Ratio: [Stage0] 0.03, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:41:14,226 - Freezing Ratio: [Stage3] 0.03, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:41:14,196 - Freezing Ratio: [Stage2] 0.06, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:41:14,196 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:42:02,893 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:42:02,870 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:42:02,877 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:42:02,902 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:42:43,366 - Freezing Ratio: [Stage2] 0.92, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:42:43,366 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:42:43,396 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:42:43,369 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:42:43,371 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:42:47,361 - Avg. fwd time: 25.8007 / Avg. bwd time: 69.9162 / Avg. batch time: 910.6140 (ms) / GPU bubble ratio: 15.91%
[rank0]:2025-12-24 07:42:47,444 - Avg. fwd time: 16.4824 / Avg. bwd time: 27.0720 / Avg. batch time: 1067.4586 (ms) / GPU bubble ratio: 67.36%
[rank0]:2025-12-24 07:42:47,447 -  step: 350  loss: -4.0000  grad_norm:  7.3804  memory: 18.76GiB(39.49%)  tps: 7,764  tflops: 60.70  mfu: 19.45%
[rank2]:2025-12-24 07:42:47,387 - Avg. fwd time: 15.7859 / Avg. bwd time: 24.8722 / Avg. batch time: 958.1489 (ms) / GPU bubble ratio: 66.05%
[rank2]:2025-12-24 07:42:47,446 -  step: 350  loss: -4.0000  grad_norm:  7.3804  memory:  9.58GiB(20.16%)  tps: 7,764  tflops: 60.70  mfu: 19.45%
[rank1]:2025-12-24 07:42:47,418 - Avg. fwd time: 20.3821 / Avg. bwd time: 32.0486 / Avg. batch time: 1016.8620 (ms) / GPU bubble ratio: 58.75%
[rank1]:2025-12-24 07:42:47,446 -  step: 350  loss: -4.0000  grad_norm:  7.3804  memory: 14.00GiB(29.46%)  tps: 7,764  tflops: 60.70  mfu: 19.45%
[rank3]:2025-12-24 07:42:47,462 -  step: 350  loss:  1.3169  grad_norm:  7.3804  memory: 27.89GiB(58.72%)  tps: 7,764  tflops: 60.70  mfu: 19.45%
[rank1]:2025-12-24 07:43:23,954 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:43:23,955 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:43:23,984 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:43:23,953 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:44:04,620 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:44:04,621 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:44:04,620 - Freezing Ratio: [Stage2] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:44:04,650 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:44:45,094 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:44:45,095 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:44:45,094 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:44:45,124 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:45:25,489 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:45:25,490 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:45:25,489 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:45:25,519 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:46:06,091 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:46:06,091 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:46:06,092 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:46:06,094 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:46:06,121 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:46:10,142 - Avg. fwd time: 15.8126 / Avg. bwd time: 24.0599 / Avg. batch time: 951.2824 (ms) / GPU bubble ratio: 66.47%
[rank1]:2025-12-24 07:46:10,173 - Avg. fwd time: 20.4180 / Avg. bwd time: 30.9853 / Avg. batch time: 1008.9217 (ms) / GPU bubble ratio: 59.24%
[rank3]:2025-12-24 07:46:10,115 - Avg. fwd time: 25.8772 / Avg. bwd time: 69.0890 / Avg. batch time: 904.6043 (ms) / GPU bubble ratio: 16.02%
[rank2]:2025-12-24 07:46:10,201 -  step: 400  loss: -4.0000  grad_norm:  0.7222  memory:  9.58GiB(20.16%)  tps: 8,081  tflops: 63.17  mfu: 20.25%
[rank1]:2025-12-24 07:46:10,201 -  step: 400  loss: -4.0000  grad_norm:  0.7222  memory: 14.00GiB(29.46%)  tps: 8,081  tflops: 63.17  mfu: 20.25%
[rank1]:2025-12-24 07:46:10,268 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0746_stage1_step400.svg
[rank0]:2025-12-24 07:46:10,200 - Avg. fwd time: 16.5174 / Avg. bwd time: 26.0073 / Avg. batch time: 1058.4407 (ms) / GPU bubble ratio: 67.86%
[rank0]:2025-12-24 07:46:10,202 -  step: 400  loss: -4.0000  grad_norm:  0.7222  memory: 18.76GiB(39.49%)  tps: 8,081  tflops: 63.17  mfu: 20.25%
[rank0]:2025-12-24 07:46:10,268 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0746_stage0_step400.svg
[rank3]:2025-12-24 07:46:10,217 -  step: 400  loss:  0.3932  grad_norm:  0.7222  memory: 27.89GiB(58.72%)  tps: 8,081  tflops: 63.17  mfu: 20.25%
[rank2]:2025-12-24 07:46:10,268 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0746_stage2_step400.svg
[rank3]:2025-12-24 07:46:10,361 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0746_step400_rank3.svg
[rank3]:			> Batch Time: 994.59 ms, GPU Bubble Ratio: 71.57%, 64.46%, 72.27%, 27.85%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-34ms     | [S0,MB2,F]  34-17-51ms     | [S0,MB3,F]  51-17-69ms     | [S0,MB0,B]  217-18-236ms   | [S0,MB4,F]  236-16-252ms   | [S0,MB1,B]  324-18-343ms   | [S0,MB5,F]  343-16-359ms   | [S0,MB2,B]  434-18-452ms   | [S0,MB6,F]  452-16-468ms   | [S0,MB3,B]  544-18-562ms   | [S0,MB7,F]  562-16-578ms   | [S0,MB4,B]  655-18-673ms   | [S0,MB5,B]  760-18-779ms   | [S0,MB6,B]  869-18-887ms   | [S0,MB7,B]  976-18-994ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  70-20-90ms     | [S1,MB0,B]  183-23-207ms   | [S1,MB3,F]  214-20-234ms   | [S1,MB1,B]  290-23-314ms   | [S1,MB4,F]  321-20-342ms   | [S1,MB2,B]  400-23-423ms   | [S1,MB5,F]  430-20-451ms   | [S1,MB3,B]  510-23-533ms   | [S1,MB6,F]  540-20-561ms   | [S1,MB4,B]  620-23-644ms   | [S1,MB7,F]  651-20-671ms   | [S1,MB5,B]  730-23-753ms   | [S1,MB6,B]  838-23-862ms   | [S1,MB7,B]  945-23-969ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  157-18-175ms   | [S2,MB2,F]  180-16-196ms   | [S2,MB1,B]  264-18-283ms   | [S2,MB3,F]  287-16-303ms   | [S2,MB2,B]  374-18-392ms   | [S2,MB4,F]  397-15-413ms   | [S2,MB3,B]  483-18-502ms   | [S2,MB5,F]  506-16-522ms   | [S2,MB4,B]  594-18-612ms   | [S2,MB6,F]  617-16-633ms   | [S2,MB5,B]  703-18-722ms   | [S2,MB7,F]  726-16-743ms   | [S2,MB6,B]  814-18-832ms   | [S2,MB7,B]  920-18-939ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-59-147ms    | [S3,MB1,F]  154-25-179ms   | [S3,MB1,B]  191-62-253ms   | [S3,MB2,F]  261-26-288ms   | [S3,MB2,B]  300-63-364ms   | [S3,MB3,F]  371-27-398ms   | [S3,MB3,B]  409-64-473ms   | [S3,MB4,F]  481-26-507ms   | [S3,MB4,B]  520-64-584ms   | [S3,MB5,F]  591-27-618ms   | [S3,MB5,B]  630-64-694ms   | [S3,MB6,F]  700-27-727ms   | [S3,MB6,B]  740-64-804ms   | [S3,MB7,F]  811-27-839ms   | [S3,MB7,B]  850-64-914ms  
[rank3]:2025-12-24 07:46:10,414 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0746_stage3_step400.svg
[rank3]:2025-12-24 07:46:33,057 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-24 07:46:33,498 - Dataset alpaca_gpt4 is being re-looped
[rank1]:2025-12-24 07:46:33,525 - Dataset alpaca_gpt4 is being re-looped
[rank0]:2025-12-24 07:46:33,544 - Dataset alpaca_gpt4 is being re-looped
[rank2]:2025-12-24 07:46:46,778 - Freezing Ratio: [Stage2] 0.06, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:46:46,777 - Freezing Ratio: [Stage1] 0.09, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:46:46,778 - Freezing Ratio: [Stage0] 0.03, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:46:46,807 - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:47:35,388 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:47:35,395 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:47:35,420 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:47:35,411 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:48:15,917 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:48:15,918 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:48:15,946 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:48:15,917 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:48:56,720 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:48:56,720 - Freezing Ratio: [Stage1] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:48:56,749 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:48:56,720 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:49:37,619 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:49:37,619 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:49:37,649 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:49:37,623 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:49:37,625 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:49:41,609 - Avg. fwd time: 25.9136 / Avg. bwd time: 68.8656 / Avg. batch time: 903.1113 (ms) / GPU bubble ratio: 16.04%
[rank2]:2025-12-24 07:49:41,637 - Avg. fwd time: 15.8173 / Avg. bwd time: 23.8279 / Avg. batch time: 949.5752 (ms) / GPU bubble ratio: 66.60%
[rank2]:2025-12-24 07:49:41,695 -  step: 450  loss: -4.0000  grad_norm:  4.3502  memory:  9.58GiB(20.16%)  tps: 7,747  tflops: 60.56  mfu: 19.41%
[rank1]:2025-12-24 07:49:41,668 - Avg. fwd time: 20.4243 / Avg. bwd time: 30.6675 / Avg. batch time: 1006.8865 (ms) / GPU bubble ratio: 59.41%
[rank1]:2025-12-24 07:49:41,695 -  step: 450  loss: -4.0000  grad_norm:  4.3502  memory: 14.00GiB(29.46%)  tps: 7,747  tflops: 60.56  mfu: 19.41%
[rank3]:2025-12-24 07:49:41,711 -  step: 450  loss:  0.5132  grad_norm:  4.3502  memory: 27.89GiB(58.72%)  tps: 7,747  tflops: 60.56  mfu: 19.41%
[rank0]:2025-12-24 07:49:41,694 - Avg. fwd time: 16.5251 / Avg. bwd time: 25.6900 / Avg. batch time: 1056.0732 (ms) / GPU bubble ratio: 68.02%
[rank0]:2025-12-24 07:49:41,696 -  step: 450  loss: -4.0000  grad_norm:  4.3502  memory: 18.76GiB(39.49%)  tps: 7,747  tflops: 60.56  mfu: 19.41%
[rank2]:2025-12-24 07:50:18,377 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:50:18,376 - Freezing Ratio: [Stage1] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:50:18,406 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:50:18,377 - Freezing Ratio: [Stage0] 0.78, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:50:59,148 - Freezing Ratio: [Stage1] 0.91, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:50:59,150 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:50:59,149 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:50:59,179 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:51:39,930 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:51:39,929 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:51:39,931 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:51:39,960 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:52:20,863 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:52:20,862 - Freezing Ratio: [Stage2] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:52:20,862 - Freezing Ratio: [Stage1] 0.91, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:52:20,892 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:53:01,690 - Freezing Ratio: [Stage2] 0.08, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:53:01,690 - Freezing Ratio: [Stage1] 0.11, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:53:01,691 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:53:01,693 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:53:01,720 - Freezing Ratio: [Stage3] 0.10, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:53:06,421 - Avg. fwd time: 25.9885 / Avg. bwd time: 68.4063 / Avg. batch time: 900.0359 (ms) / GPU bubble ratio: 16.10%
[rank2]:2025-12-24 07:53:06,466 - Avg. fwd time: 15.8336 / Avg. bwd time: 23.3315 / Avg. batch time: 945.9762 (ms) / GPU bubble ratio: 66.88%
[rank2]:2025-12-24 07:53:06,593 -  step: 500  loss: -4.0000  grad_norm: 26.6468  memory:  9.58GiB(20.16%)  tps: 7,996  tflops: 62.51  mfu: 20.04%
[rank1]:2025-12-24 07:53:06,521 - Avg. fwd time: 20.4427 / Avg. bwd time: 30.0022 / Avg. batch time: 1002.6070 (ms) / GPU bubble ratio: 59.75%
[rank1]:2025-12-24 07:53:06,596 -  step: 500  loss: -4.0000  grad_norm: 26.6468  memory: 14.00GiB(29.46%)  tps: 7,996  tflops: 62.51  mfu: 20.04%
[rank0]:2025-12-24 07:53:06,571 - Avg. fwd time: 16.5430 / Avg. bwd time: 24.9464 / Avg. batch time: 1051.0296 (ms) / GPU bubble ratio: 68.42%
[rank0]:2025-12-24 07:53:06,609 -  step: 500  loss: -4.0000  grad_norm: 26.6468  memory: 18.76GiB(39.49%)  tps: 7,996  tflops: 62.51  mfu: 20.03%
[rank3]:2025-12-24 07:53:06,606 -  step: 500  loss:  0.4392  grad_norm: 26.6468  memory: 27.89GiB(58.72%)  tps: 7,996  tflops: 62.51  mfu: 20.04%
[rank2]:2025-12-24 07:53:06,656 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0753_stage2_step500.svg
[rank0]:2025-12-24 07:53:06,655 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0753_stage0_step500.svg
[rank1]:2025-12-24 07:53:06,655 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0753_stage1_step500.svg
[rank3]:2025-12-24 07:53:06,762 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0753_step500_rank3.svg
[rank3]:			> Batch Time: 1003.48 ms, GPU Bubble Ratio: 71.89%, 64.87%, 72.53%, 27.61%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  219-18-238ms   | [S0,MB4,F]  238-16-254ms   | [S0,MB1,B]  328-18-347ms   | [S0,MB5,F]  347-16-363ms   | [S0,MB2,B]  439-18-458ms   | [S0,MB6,F]  458-16-474ms   | [S0,MB3,B]  551-18-569ms   | [S0,MB7,F]  569-16-585ms   | [S0,MB4,B]  662-18-680ms   | [S0,MB5,B]  769-18-787ms   | [S0,MB6,B]  878-18-897ms   | [S0,MB7,B]  985-18-1003ms 
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  185-23-209ms   | [S1,MB3,F]  216-20-236ms   | [S1,MB1,B]  294-23-318ms   | [S1,MB4,F]  325-20-345ms   | [S1,MB2,B]  405-23-429ms   | [S1,MB5,F]  436-20-456ms   | [S1,MB3,B]  516-23-540ms   | [S1,MB6,F]  547-20-568ms   | [S1,MB4,B]  628-23-651ms   | [S1,MB7,F]  658-20-679ms   | [S1,MB5,B]  738-23-762ms   | [S1,MB6,B]  848-23-871ms   | [S1,MB7,B]  954-23-978ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  159-18-177ms   | [S2,MB2,F]  182-15-198ms   | [S2,MB1,B]  268-18-286ms   | [S2,MB3,F]  291-16-307ms   | [S2,MB2,B]  379-18-397ms   | [S2,MB4,F]  402-16-418ms   | [S2,MB3,B]  490-18-508ms   | [S2,MB5,F]  513-15-529ms   | [S2,MB4,B]  601-18-620ms   | [S2,MB6,F]  624-16-640ms   | [S2,MB5,B]  712-18-730ms   | [S2,MB7,F]  735-15-751ms   | [S2,MB6,B]  823-18-842ms   | [S2,MB7,B]  929-18-948ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-61-149ms    | [S3,MB1,F]  156-25-182ms   | [S3,MB1,B]  194-64-258ms   | [S3,MB2,F]  265-27-292ms   | [S3,MB2,B]  304-64-369ms   | [S3,MB3,F]  376-26-403ms   | [S3,MB3,B]  415-64-480ms   | [S3,MB4,F]  487-27-514ms   | [S3,MB4,B]  526-64-591ms   | [S3,MB5,F]  598-27-625ms   | [S3,MB5,B]  638-64-703ms   | [S3,MB6,F]  709-27-736ms   | [S3,MB6,B]  747-64-812ms   | [S3,MB7,F]  820-27-847ms   | [S3,MB7,B]  859-64-923ms  
[rank3]:2025-12-24 07:53:06,804 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0753_stage3_step500.svg
[rank1]:2025-12-24 07:53:50,683 - Freezing Ratio: [Stage1] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:53:50,699 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:53:50,676 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:53:50,708 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:54:31,309 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:54:31,309 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:54:31,310 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:54:31,339 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:55:11,951 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:55:11,952 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:55:11,952 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:55:11,981 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:55:52,543 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:55:52,542 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:55:52,542 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:55:52,571 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:56:33,171 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:56:33,174 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:56:33,176 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:56:33,171 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:56:33,202 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:56:37,173 - Avg. fwd time: 26.0082 / Avg. bwd time: 68.2556 / Avg. batch time: 898.9867 (ms) / GPU bubble ratio: 16.12%
[rank2]:2025-12-24 07:56:37,201 - Avg. fwd time: 15.8397 / Avg. bwd time: 23.1817 / Avg. batch time: 944.7934 (ms) / GPU bubble ratio: 66.96%
[rank2]:2025-12-24 07:56:37,262 -  step: 550  loss: -4.0000  grad_norm:  0.4347  memory:  9.58GiB(20.16%)  tps: 7,777  tflops: 60.80  mfu: 19.49%
[rank0]:2025-12-24 07:56:37,260 - Avg. fwd time: 16.5479 / Avg. bwd time: 24.6660 / Avg. batch time: 1049.3329 (ms) / GPU bubble ratio: 68.58%
[rank0]:2025-12-24 07:56:37,262 -  step: 550  loss: -4.0000  grad_norm:  0.4347  memory: 18.76GiB(39.49%)  tps: 7,778  tflops: 60.80  mfu: 19.49%
[rank1]:2025-12-24 07:56:37,234 - Avg. fwd time: 20.4495 / Avg. bwd time: 29.7948 / Avg. batch time: 1001.2097 (ms) / GPU bubble ratio: 59.85%
[rank1]:2025-12-24 07:56:37,262 -  step: 550  loss: -4.0000  grad_norm:  0.4347  memory: 14.00GiB(29.46%)  tps: 7,777  tflops: 60.80  mfu: 19.49%
[rank3]:2025-12-24 07:56:37,277 -  step: 550  loss:  0.3209  grad_norm:  0.4347  memory: 27.97GiB(58.88%)  tps: 7,777  tflops: 60.80  mfu: 19.49%
[rank2]:2025-12-24 07:57:13,829 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:57:13,829 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:57:13,829 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:57:13,859 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:57:54,524 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:57:54,523 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:57:54,524 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:57:54,553 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:58:35,150 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:58:35,151 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:58:35,150 - Freezing Ratio: [Stage2] 0.83, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:58:35,180 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:59:15,748 - Freezing Ratio: [Stage1] 0.87, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:59:15,749 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:59:15,748 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:59:15,778 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 07:59:56,407 - Freezing Ratio: [Stage1] 0.07, Threshold: 1.0000e-02
[rank0]:2025-12-24 07:59:56,407 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 07:59:56,408 - Freezing Ratio: [Stage0] 0.11, Threshold: 1.0000e-02
[rank2]:2025-12-24 07:59:56,406 - Freezing Ratio: [Stage2] 0.00, Threshold: 1.0000e-02
[rank3]:2025-12-24 07:59:56,436 - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:00:01,241 - Avg. fwd time: 15.8536 / Avg. bwd time: 22.8264 / Avg. batch time: 941.8961 (ms) / GPU bubble ratio: 67.15%
[rank3]:2025-12-24 08:00:01,195 - Avg. fwd time: 26.0525 / Avg. bwd time: 67.8969 / Avg. batch time: 896.4683 (ms) / GPU bubble ratio: 16.16%
[rank1]:2025-12-24 08:00:01,297 - Avg. fwd time: 20.4660 / Avg. bwd time: 29.3197 / Avg. batch time: 997.8313 (ms) / GPU bubble ratio: 60.08%
[rank0]:2025-12-24 08:00:01,347 - Avg. fwd time: 16.5608 / Avg. bwd time: 24.1047 / Avg. batch time: 1045.3734 (ms) / GPU bubble ratio: 68.88%
[rank1]:2025-12-24 08:00:01,372 -  step: 600  loss: -4.0000  grad_norm:  7.4877  memory: 14.00GiB(29.46%)  tps: 8,027  tflops: 62.75  mfu: 20.11%
[rank0]:2025-12-24 08:00:01,384 -  step: 600  loss: -4.0000  grad_norm:  7.4877  memory: 18.76GiB(39.49%)  tps: 8,027  tflops: 62.75  mfu: 20.11%
[rank0]:2025-12-24 08:00:01,432 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0800_stage0_step600.svg
[rank2]:2025-12-24 08:00:01,369 -  step: 600  loss: -4.0000  grad_norm:  7.4877  memory:  9.58GiB(20.16%)  tps: 8,027  tflops: 62.75  mfu: 20.11%
[rank2]:2025-12-24 08:00:01,432 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0800_stage2_step600.svg
[rank3]:2025-12-24 08:00:01,382 -  step: 600  loss:  0.2927  grad_norm:  7.4877  memory: 27.97GiB(58.88%)  tps: 8,027  tflops: 62.75  mfu: 20.11%
[rank1]:2025-12-24 08:00:01,432 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0800_stage1_step600.svg
[rank3]:2025-12-24 08:00:01,536 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0800_step600_rank3.svg
[rank3]:			> Batch Time: 998.06 ms, GPU Bubble Ratio: 72.91%, 64.58%, 72.30%, 27.55%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  219-17-236ms   | [S0,MB4,F]  236-16-252ms   | [S0,MB1,B]  327-17-344ms   | [S0,MB5,F]  344-16-360ms   | [S0,MB2,B]  437-17-454ms   | [S0,MB6,F]  454-16-470ms   | [S0,MB3,B]  546-17-563ms   | [S0,MB7,F]  564-16-580ms   | [S0,MB4,B]  656-17-673ms   | [S0,MB5,B]  762-17-779ms   | [S0,MB6,B]  872-17-889ms   | [S0,MB7,B]  981-17-998ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  184-23-208ms   | [S1,MB3,F]  215-20-236ms   | [S1,MB1,B]  293-23-316ms   | [S1,MB4,F]  323-20-344ms   | [S1,MB2,B]  403-23-426ms   | [S1,MB5,F]  433-20-454ms   | [S1,MB3,B]  512-23-536ms   | [S1,MB6,F]  542-20-563ms   | [S1,MB4,B]  622-23-646ms   | [S1,MB7,F]  652-20-673ms   | [S1,MB5,B]  732-23-756ms   | [S1,MB6,B]  841-23-865ms   | [S1,MB7,B]  950-23-974ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  158-18-177ms   | [S2,MB2,F]  181-16-197ms   | [S2,MB1,B]  266-18-285ms   | [S2,MB3,F]  289-15-305ms   | [S2,MB2,B]  376-18-395ms   | [S2,MB4,F]  399-16-415ms   | [S2,MB3,B]  485-18-504ms   | [S2,MB5,F]  509-16-525ms   | [S2,MB4,B]  596-18-614ms   | [S2,MB6,F]  619-16-635ms   | [S2,MB5,B]  706-18-724ms   | [S2,MB7,F]  729-16-745ms   | [S2,MB6,B]  816-18-835ms   | [S2,MB7,B]  925-18-943ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-60-148ms    | [S3,MB1,F]  155-25-181ms   | [S3,MB1,B]  193-64-257ms   | [S3,MB2,F]  263-26-290ms   | [S3,MB2,B]  302-64-366ms   | [S3,MB3,F]  373-26-400ms   | [S3,MB3,B]  412-64-476ms   | [S3,MB4,F]  483-27-510ms   | [S3,MB4,B]  521-64-586ms   | [S3,MB5,F]  593-27-620ms   | [S3,MB5,B]  631-64-696ms   | [S3,MB6,F]  703-26-730ms   | [S3,MB6,B]  742-64-806ms   | [S3,MB7,F]  813-27-841ms   | [S3,MB7,B]  853-64-918ms  
[rank3]:2025-12-24 08:00:01,580 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0800_stage3_step600.svg
[rank1]:2025-12-24 08:00:45,537 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:00:45,530 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:00:45,562 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:00:45,553 - Freezing Ratio: [Stage3] 0.83, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:01:26,119 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:01:26,118 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:01:26,119 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:01:26,148 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:02:06,690 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:02:06,691 - Freezing Ratio: [Stage0] 0.89, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:02:06,720 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:02:06,690 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:02:47,265 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:02:47,265 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:02:47,265 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:02:47,295 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:03:28,063 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:03:28,063 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:03:28,066 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 08:03:28,068 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:03:28,093 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:03:32,035 - Avg. fwd time: 26.0674 / Avg. bwd time: 67.8047 / Avg. batch time: 895.8488 (ms) / GPU bubble ratio: 16.17%
[rank1]:2025-12-24 08:03:32,096 - Avg. fwd time: 20.4683 / Avg. bwd time: 29.2023 / Avg. batch time: 997.0210 (ms) / GPU bubble ratio: 60.14%
[rank2]:2025-12-24 08:03:32,063 - Avg. fwd time: 15.8569 / Avg. bwd time: 22.7429 / Avg. batch time: 941.2061 (ms) / GPU bubble ratio: 67.19%
[rank2]:2025-12-24 08:03:32,124 -  step: 650  loss: -4.0000  grad_norm:  0.8783  memory:  9.58GiB(20.16%)  tps: 7,774  tflops: 60.77  mfu: 19.48%
[rank0]:2025-12-24 08:03:32,122 - Avg. fwd time: 16.5639 / Avg. bwd time: 23.9308 / Avg. batch time: 1044.3839 (ms) / GPU bubble ratio: 68.98%
[rank0]:2025-12-24 08:03:32,124 -  step: 650  loss: -4.0000  grad_norm:  0.8783  memory: 18.76GiB(39.49%)  tps: 7,775  tflops: 60.78  mfu: 19.48%
[rank3]:2025-12-24 08:03:32,140 -  step: 650  loss:  0.2987  grad_norm:  0.8783  memory: 27.97GiB(58.88%)  tps: 7,774  tflops: 60.77  mfu: 19.48%
[rank1]:2025-12-24 08:03:32,124 -  step: 650  loss: -4.0000  grad_norm:  0.8783  memory: 14.00GiB(29.46%)  tps: 7,774  tflops: 60.77  mfu: 19.48%
[rank1]:2025-12-24 08:04:08,615 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:04:08,614 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:04:08,615 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:04:08,644 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:04:49,120 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:04:49,149 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:04:49,119 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:04:49,120 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:05:29,782 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:05:29,811 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:05:29,782 - Freezing Ratio: [Stage1] 0.84, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:05:29,782 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:06:10,394 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:06:10,395 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:06:10,395 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:06:10,424 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:06:50,886 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 08:06:50,888 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:06:50,915 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:06:50,886 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:06:50,886 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:06:54,853 - Avg. fwd time: 26.1012 / Avg. bwd time: 67.4864 / Avg. batch time: 893.5734 (ms) / GPU bubble ratio: 16.21%
[rank2]:2025-12-24 08:06:54,883 - Avg. fwd time: 15.8678 / Avg. bwd time: 22.4447 / Avg. batch time: 938.6114 (ms) / GPU bubble ratio: 67.35%
[rank2]:2025-12-24 08:06:54,945 -  step: 700  loss: -4.0000  grad_norm:  0.6441  memory:  9.58GiB(20.16%)  tps: 8,078  tflops: 63.15  mfu: 20.24%
[rank1]:2025-12-24 08:06:54,917 - Avg. fwd time: 20.4816 / Avg. bwd time: 28.8077 / Avg. batch time: 994.0279 (ms) / GPU bubble ratio: 60.33%
[rank1]:2025-12-24 08:06:54,945 -  step: 700  loss: -4.0000  grad_norm:  0.6441  memory: 14.00GiB(29.46%)  tps: 8,078  tflops: 63.15  mfu: 20.24%
[rank0]:2025-12-24 08:06:54,944 - Avg. fwd time: 16.5744 / Avg. bwd time: 23.4494 / Avg. batch time: 1040.8988 (ms) / GPU bubble ratio: 69.24%
[rank0]:2025-12-24 08:06:54,946 -  step: 700  loss: -4.0000  grad_norm:  0.6441  memory: 18.76GiB(39.49%)  tps: 8,078  tflops: 63.15  mfu: 20.24%
[rank3]:2025-12-24 08:06:54,961 -  step: 700  loss:  0.2689  grad_norm:  0.6441  memory: 27.97GiB(58.88%)  tps: 8,078  tflops: 63.15  mfu: 20.24%
[rank2]:2025-12-24 08:06:55,012 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0806_stage2_step700.svg
[rank1]:2025-12-24 08:06:55,011 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0806_stage1_step700.svg
[rank0]:2025-12-24 08:06:55,011 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0806_stage0_step700.svg
[rank3]:2025-12-24 08:06:55,110 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0806_step700_rank3.svg
[rank3]:			> Batch Time: 994.17 ms, GPU Bubble Ratio: 72.74%, 64.35%, 72.22%, 27.73%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  218-17-235ms   | [S0,MB4,F]  235-16-251ms   | [S0,MB1,B]  324-17-341ms   | [S0,MB5,F]  341-16-357ms   | [S0,MB2,B]  433-17-450ms   | [S0,MB6,F]  450-16-466ms   | [S0,MB3,B]  544-17-561ms   | [S0,MB7,F]  561-16-577ms   | [S0,MB4,B]  654-17-671ms   | [S0,MB5,B]  761-17-778ms   | [S0,MB6,B]  869-17-886ms   | [S0,MB7,B]  977-17-994ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  42-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  184-23-207ms   | [S1,MB3,F]  214-20-235ms   | [S1,MB1,B]  290-23-314ms   | [S1,MB4,F]  321-20-341ms   | [S1,MB2,B]  399-23-423ms   | [S1,MB5,F]  430-20-450ms   | [S1,MB3,B]  509-23-533ms   | [S1,MB6,F]  540-20-561ms   | [S1,MB4,B]  620-23-644ms   | [S1,MB7,F]  650-20-671ms   | [S1,MB5,B]  730-23-754ms   | [S1,MB6,B]  838-23-862ms   | [S1,MB7,B]  946-23-970ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  157-18-176ms   | [S2,MB2,F]  180-15-196ms   | [S2,MB1,B]  264-18-282ms   | [S2,MB3,F]  287-16-303ms   | [S2,MB2,B]  372-18-391ms   | [S2,MB4,F]  396-15-412ms   | [S2,MB3,B]  483-18-501ms   | [S2,MB5,F]  506-16-522ms   | [S2,MB4,B]  594-18-612ms   | [S2,MB6,F]  617-16-633ms   | [S2,MB5,B]  704-18-722ms   | [S2,MB7,F]  727-16-743ms   | [S2,MB6,B]  813-18-832ms   | [S2,MB7,B]  921-18-939ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-75ms     | [S3,MB0,B]  87-59-147ms    | [S3,MB1,F]  154-25-179ms   | [S3,MB1,B]  191-62-254ms   | [S3,MB2,F]  261-26-287ms   | [S3,MB2,B]  299-63-362ms   | [S3,MB3,F]  370-27-397ms   | [S3,MB3,B]  408-63-472ms   | [S3,MB4,F]  479-27-507ms   | [S3,MB4,B]  519-64-583ms   | [S3,MB5,F]  590-27-618ms   | [S3,MB5,B]  629-64-694ms   | [S3,MB6,F]  701-27-728ms   | [S3,MB6,B]  739-64-804ms   | [S3,MB7,F]  810-27-837ms   | [S3,MB7,B]  850-64-914ms  
[rank3]:2025-12-24 08:06:55,156 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0806_stage3_step700.svg
[rank2]:2025-12-24 08:07:31,563 - Freezing Ratio: [Stage2] 0.03, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:07:31,564 - Freezing Ratio: [Stage1] 0.04, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:07:31,564 - Freezing Ratio: [Stage0] 0.05, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:07:31,593 - Freezing Ratio: [Stage3] 0.07, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:08:20,318 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:08:20,295 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:08:20,303 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:08:20,328 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:09:00,941 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:09:00,970 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:09:00,940 - Freezing Ratio: [Stage2] 0.78, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:09:00,941 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:09:41,432 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:09:41,432 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:09:41,432 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:09:41,461 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:10:22,012 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:10:22,012 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:10:22,015 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 08:10:22,017 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:10:22,042 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:10:26,015 - Avg. fwd time: 26.1056 / Avg. bwd time: 67.4480 / Avg. batch time: 893.3004 (ms) / GPU bubble ratio: 16.22%
[rank2]:2025-12-24 08:10:26,044 - Avg. fwd time: 15.8694 / Avg. bwd time: 22.4216 / Avg. batch time: 938.3287 (ms) / GPU bubble ratio: 67.35%
[rank2]:2025-12-24 08:10:26,107 -  step: 750  loss: -4.0000  grad_norm:  0.2013  memory:  9.58GiB(20.16%)  tps: 7,759  tflops: 60.66  mfu: 19.44%
[rank1]:2025-12-24 08:10:26,078 - Avg. fwd time: 20.4821 / Avg. bwd time: 28.7723 / Avg. batch time: 993.7045 (ms) / GPU bubble ratio: 60.35%
[rank1]:2025-12-24 08:10:26,107 -  step: 750  loss: -4.0000  grad_norm:  0.2013  memory: 14.00GiB(29.46%)  tps: 7,759  tflops: 60.66  mfu: 19.44%
[rank0]:2025-12-24 08:10:26,106 - Avg. fwd time: 16.5737 / Avg. bwd time: 23.3587 / Avg. batch time: 1040.4777 (ms) / GPU bubble ratio: 69.30%
[rank0]:2025-12-24 08:10:26,108 -  step: 750  loss: -4.0000  grad_norm:  0.2013  memory: 18.76GiB(39.49%)  tps: 7,759  tflops: 60.66  mfu: 19.44%
[rank3]:2025-12-24 08:10:26,123 -  step: 750  loss:  0.3100  grad_norm:  0.2013  memory: 27.97GiB(58.88%)  tps: 7,759  tflops: 60.66  mfu: 19.44%
[rank1]:2025-12-24 08:11:02,590 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:11:02,590 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:11:02,619 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:11:02,589 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:11:43,212 - Freezing Ratio: [Stage3] 0.76, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:11:43,182 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:11:43,183 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:11:43,183 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:12:23,663 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:12:23,663 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:12:23,664 - Freezing Ratio: [Stage0] 0.86, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:12:23,693 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:13:04,169 - Freezing Ratio: [Stage0] 0.81, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:13:04,198 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:13:04,168 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:13:04,169 - Freezing Ratio: [Stage1] 0.82, Threshold: 1.0000e-02
[rank2]:2025-12-24 08:13:44,870 - Freezing Ratio: [Stage2] 0.81, Threshold: 1.0000e-02
[rank1]:2025-12-24 08:13:44,870 - Freezing Ratio: [Stage1] 0.80, Threshold: 1.0000e-02
[rank0]:2025-12-24 08:13:44,870 - [GC] Peforming periodical GC collection 0.00 seconds
[rank0]:2025-12-24 08:13:44,872 - Freezing Ratio: [Stage0] 0.84, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:13:44,899 - Freezing Ratio: [Stage3] 0.79, Threshold: 1.0000e-02
[rank3]:2025-12-24 08:13:48,915 - Avg. fwd time: 26.1306 / Avg. bwd time: 67.1928 / Avg. batch time: 891.4575 (ms) / GPU bubble ratio: 16.25%
[rank2]:2025-12-24 08:13:48,944 - Avg. fwd time: 15.8795 / Avg. bwd time: 22.1814 / Avg. batch time: 936.2287 (ms) / GPU bubble ratio: 67.48%
[rank1]:2025-12-24 08:13:48,979 - Avg. fwd time: 20.4934 / Avg. bwd time: 28.4564 / Avg. batch time: 991.2806 (ms) / GPU bubble ratio: 60.50%
[rank1]:2025-12-24 08:13:49,008 -  step: 800  loss: -4.0000  grad_norm:  0.2187  memory: 14.00GiB(29.46%)  tps: 8,075  tflops: 63.13  mfu: 20.23%
[rank1]:2025-12-24 08:13:49,008 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  0.2187  tps: 8,213  tflops: 64.20  mfu: 18.77%
[rank1]:2025-12-24 08:13:49,008 - Saving the checkpoint (or staging if async is enabled).
[rank1]:2025-12-24 08:13:49,009 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank0]:2025-12-24 08:13:49,006 - Avg. fwd time: 16.5828 / Avg. bwd time: 22.9917 / Avg. batch time: 1037.6778 (ms) / GPU bubble ratio: 69.49%
[rank0]:2025-12-24 08:13:49,008 -  step: 800  loss: -4.0000  grad_norm:  0.2187  memory: 18.76GiB(39.49%)  tps: 8,075  tflops: 63.13  mfu: 20.23%
[rank0]:2025-12-24 08:13:49,008 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  0.2187  tps: 8,212  tflops: 64.20  mfu: 18.76%
[rank0]:2025-12-24 08:13:49,009 - Saving the checkpoint (or staging if async is enabled).
[rank0]:2025-12-24 08:13:49,009 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank3]:2025-12-24 08:13:49,023 -  step: 800  loss:  0.2968  grad_norm:  0.2187  memory: 27.97GiB(58.88%)  tps: 8,075  tflops: 63.13  mfu: 20.23%
[rank3]:2025-12-24 08:13:49,024 - â„¹ï¸ final step: 800  loss:  0.2968  grad_norm:  0.2187  tps: 8,217  tflops: 64.24  mfu: 18.90%
[rank3]:2025-12-24 08:13:49,024 - Saving the checkpoint (or staging if async is enabled).
[rank3]:2025-12-24 08:13:49,025 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank2]:2025-12-24 08:13:49,008 -  step: 800  loss: -4.0000  grad_norm:  0.2187  memory:  9.58GiB(20.16%)  tps: 8,075  tflops: 63.13  mfu: 20.23%
[rank2]:2025-12-24 08:13:49,008 - â„¹ï¸ final step: 800  loss: -4.0000  grad_norm:  0.2187  tps: 8,212  tflops: 64.20  mfu: 18.77%
[rank2]:2025-12-24 08:13:49,008 - Saving the checkpoint (or staging if async is enabled).
[rank2]:2025-12-24 08:13:49,009 - Saving a model only checkpoint in torch.float16 at last step, step 800.
[rank1]:2025-12-24 08:13:51,213 - âœ… Frozen Ratio History of Rank 1 (Stage 1) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank1/251224_0813_stage1_final800.svg
[rank0]:2025-12-24 08:13:51,151 - [GC] GC collection invoked by checkpointer. 0.00 seconds
[rank0]:2025-12-24 08:13:51,215 - âœ… Frozen Ratio History of Rank 0 (Stage 0) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank0/251224_0813_stage0_final800.svg
[rank2]:2025-12-24 08:13:51,214 - âœ… Frozen Ratio History of Rank 2 (Stage 2) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank2/251224_0813_stage2_final800.svg
[rank3]:2025-12-24 08:13:51,310 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0813_final800_rank3.svg
[rank3]:			> Batch Time: 1000.53 ms, GPU Bubble Ratio: 71.85%, 64.64%, 72.42%, 27.88%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-16-16ms      | [S0,MB1,F]  16-17-33ms     | [S0,MB2,F]  33-17-51ms     | [S0,MB3,F]  51-17-68ms     | [S0,MB0,B]  219-18-237ms   | [S0,MB4,F]  237-16-253ms   | [S0,MB1,B]  327-18-345ms   | [S0,MB5,F]  345-16-361ms   | [S0,MB2,B]  437-18-456ms   | [S0,MB6,F]  455-16-471ms   | [S0,MB3,B]  548-18-566ms   | [S0,MB7,F]  566-16-582ms   | [S0,MB4,B]  658-18-677ms   | [S0,MB5,B]  765-18-784ms   | [S0,MB6,B]  874-18-893ms   | [S0,MB7,B]  982-18-1000ms 
[rank3]:			  [Rank 1]	[S1,MB0,F]  16-20-36ms     | [S1,MB1,F]  43-20-63ms     | [S1,MB2,F]  69-20-90ms     | [S1,MB0,B]  185-23-208ms   | [S1,MB3,F]  215-20-236ms   | [S1,MB1,B]  293-23-316ms   | [S1,MB4,F]  324-20-344ms   | [S1,MB2,B]  403-23-426ms   | [S1,MB5,F]  434-20-454ms   | [S1,MB3,B]  513-23-537ms   | [S1,MB6,F]  544-20-565ms   | [S1,MB4,B]  624-23-647ms   | [S1,MB7,F]  655-20-675ms   | [S1,MB5,B]  735-23-758ms   | [S1,MB6,B]  844-23-867ms   | [S1,MB7,B]  951-23-975ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  36-15-52ms     | [S2,MB1,F]  63-15-79ms     | [S2,MB0,B]  158-18-177ms   | [S2,MB2,F]  181-15-197ms   | [S2,MB1,B]  267-18-285ms   | [S2,MB3,F]  290-15-305ms   | [S2,MB2,B]  377-18-395ms   | [S2,MB4,F]  400-15-416ms   | [S2,MB3,B]  487-18-505ms   | [S2,MB5,F]  510-15-526ms   | [S2,MB4,B]  597-18-616ms   | [S2,MB6,F]  620-16-636ms   | [S2,MB5,B]  708-18-727ms   | [S2,MB7,F]  731-15-747ms   | [S2,MB6,B]  819-18-838ms   | [S2,MB7,B]  926-18-945ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  52-23-76ms     | [S3,MB0,B]  88-60-148ms    | [S3,MB1,F]  155-25-180ms   | [S3,MB1,B]  193-63-257ms   | [S3,MB2,F]  263-26-290ms   | [S3,MB2,B]  302-64-367ms   | [S3,MB3,F]  373-26-400ms   | [S3,MB3,B]  412-64-477ms   | [S3,MB4,F]  484-26-511ms   | [S3,MB4,B]  523-64-588ms   | [S3,MB5,F]  594-26-621ms   | [S3,MB5,B]  634-64-699ms   | [S3,MB6,F]  705-26-732ms   | [S3,MB6,B]  745-64-809ms   | [S3,MB7,F]  816-26-843ms   | [S3,MB7,B]  855-64-920ms  
[rank2]:2025-12-24 08:13:51,371 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_params_histogram/251224_0813_rank2_stage2.svg
[rank2]:	> Counts Sum: 1925, Total Sum: 2700 (71.30%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 17.33, 21.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 34.66, 10.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 34.66, 10.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 42.66, 5.33]
[rank2]:2025-12-24 08:13:51,371 - Destroying the purge thread.
[rank1]:2025-12-24 08:13:51,358 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_params_histogram/251224_0813_rank1_stage1.svg
[rank1]:	> Counts Sum: 2406, Total Sum: 3375 (71.29%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 61.33, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 6.66, 50.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 28.0, 46.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 28.0, 0.0]
[rank1]:2025-12-24 08:13:51,359 - Destroying the purge thread.
[rank0]:2025-12-24 08:13:51,371 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_params_histogram/251224_0813_rank0_stage0.svg
[rank0]:	> Counts Sum: 1963, Total Sum: 2775 (70.74%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 40.0, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 0.0, 0.0, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 29.33, 34.66, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 38.66, 0.0]
[rank0]:2025-12-24 08:13:51,371 - Sleeping 2 seconds for other ranks to complete
[rank3]:2025-12-24 08:13:51,455 - âœ… Pipeline schedule is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/pipeline_schedule/251224_0813_thry_final800_rank3.svg
[rank3]:			> Batch Time: 654.30 ms, GPU Bubble Ratio: 27.27%, 27.27%, 27.27%, 27.27%
[rank3]:			  [Rank 0]	[S0,MB0,F]  0-19-19ms      | [S0,MB1,F]  19-19-39ms     | [S0,MB2,F]  39-19-59ms     | [S0,MB3,F]  59-19-79ms     | [S0,MB0,B]  198-39-237ms   | [S0,MB4,F]  237-19-257ms   | [S0,MB1,B]  257-39-297ms   | [S0,MB5,F]  297-19-317ms   | [S0,MB2,B]  317-39-356ms   | [S0,MB6,F]  356-19-376ms   | [S0,MB3,B]  376-39-416ms   | [S0,MB7,F]  416-19-436ms   | [S0,MB4,B]  436-39-475ms   | [S0,MB5,B]  495-39-535ms   | [S0,MB6,B]  555-39-594ms   | [S0,MB7,B]  614-39-654ms  
[rank3]:			  [Rank 1]	[S1,MB0,F]  19-19-39ms     | [S1,MB1,F]  39-19-59ms     | [S1,MB2,F]  59-19-79ms     | [S1,MB0,B]  158-39-198ms   | [S1,MB3,F]  198-19-218ms   | [S1,MB1,B]  218-39-257ms   | [S1,MB4,F]  257-19-277ms   | [S1,MB2,B]  277-39-317ms   | [S1,MB5,F]  317-19-337ms   | [S1,MB3,B]  337-39-376ms   | [S1,MB6,F]  376-19-396ms   | [S1,MB4,B]  396-39-436ms   | [S1,MB7,F]  436-19-456ms   | [S1,MB5,B]  456-39-495ms   | [S1,MB6,B]  515-39-555ms   | [S1,MB7,B]  574-39-614ms  
[rank3]:			  [Rank 2]	[S2,MB0,F]  39-19-59ms     | [S2,MB1,F]  59-19-79ms     | [S2,MB0,B]  118-39-158ms   | [S2,MB2,F]  158-19-178ms   | [S2,MB1,B]  178-39-218ms   | [S2,MB3,F]  218-19-237ms   | [S2,MB2,B]  237-39-277ms   | [S2,MB4,F]  277-19-297ms   | [S2,MB3,B]  297-39-337ms   | [S2,MB5,F]  337-19-356ms   | [S2,MB4,B]  356-39-396ms   | [S2,MB6,F]  396-19-416ms   | [S2,MB5,B]  416-39-456ms   | [S2,MB7,F]  456-19-475ms   | [S2,MB6,B]  475-39-515ms   | [S2,MB7,B]  535-39-574ms  
[rank3]:			  [Rank 3]	[S3,MB0,F]  59-19-79ms     | [S3,MB0,B]  79-39-118ms    | [S3,MB1,F]  118-19-138ms   | [S3,MB1,B]  138-39-178ms   | [S3,MB2,F]  178-19-198ms   | [S3,MB2,B]  198-39-237ms   | [S3,MB3,F]  237-19-257ms   | [S3,MB3,B]  257-39-297ms   | [S3,MB4,F]  297-19-317ms   | [S3,MB4,B]  317-39-356ms   | [S3,MB5,F]  356-19-376ms   | [S3,MB5,B]  376-39-416ms   | [S3,MB6,F]  416-19-436ms   | [S3,MB6,B]  436-39-475ms   | [S3,MB7,F]  475-19-495ms   | [S3,MB7,B]  495-39-535ms  
[rank3]:2025-12-24 08:13:51,503 - âœ… Frozen Ratio History of Rank 3 (Stage 3) is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_ratio_history/rank3/251224_0813_stage3_final800.svg
[rank3]:2025-12-24 08:13:51,640 - âœ… Elementwise Histogram is saved as: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1/frozen_params_histogram/251224_0813_rank3_stage3.svg
[rank3]:	> Counts Sum: 1453, Total Sum: 2175 (66.80%), Ratio(%) per element: [85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 45.33, 5.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 17.33, 1.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 85.33, 32.0, 44.0, 0.0, 0.0]
[rank3]:2025-12-24 08:13:51,641 - Destroying the purge thread.
[rank2]:2025-12-24 08:13:51,651 - Process group destroyed
[rank1]:2025-12-24 08:13:51,710 - Process group destroyed
[rank3]:wandb: updating run metadata
[rank3]:wandb: uploading config.yaml
[rank3]:wandb: 
[rank3]:wandb: Run history:
[rank3]:wandb:      final/avg_end_to_end(s) â–
[rank3]:wandb:               final/avg_loss â–
[rank3]:wandb:             final/avg_mfu(%) â–
[rank3]:wandb:             final/avg_tflops â–
[rank3]:wandb:    final/avg_throughput(tps) â–
[rank3]:wandb:              final/grad_norm â–
[rank3]:wandb:               final/max_loss â–
[rank3]:wandb:                    grad_norm â–ˆâ–‚â–â–‚â–‚â–â–â–â–â–â–‚â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_avg_loss â–ˆâ–ˆâ–‡â–„â–‚â–„â–ƒâ–‚â–â–â–â–â–â–â–â–â–
[rank3]:wandb: loss_metrics/global_max_loss â–ˆâ–ˆâ–‡â–„â–‚â–„â–ƒâ–‚â–â–â–â–â–â–â–â–â–
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: Run summary:
[rank3]:wandb:      final/avg_end_to_end(s) 3.98761
[rank3]:wandb:               final/avg_loss 0.29685
[rank3]:wandb:             final/avg_mfu(%) 18.89506
[rank3]:wandb:             final/avg_tflops 64.24025
[rank3]:wandb:    final/avg_throughput(tps) 8217.45161
[rank3]:wandb:              final/grad_norm 0.21869
[rank3]:wandb:               final/max_loss 0.29685
[rank3]:wandb:                    grad_norm 0.21869
[rank3]:wandb: loss_metrics/global_avg_loss 0.29685
[rank3]:wandb: loss_metrics/global_max_loss 0.29685
[rank3]:wandb:                          +14 ...
[rank3]:wandb: 
[rank3]:wandb: ðŸš€ View run 1224_1F1B_apf_42_dm1 at: https://wandb.ai/orangingq/torchtitan/runs/igb7defx
[rank3]:wandb: â­ï¸ View project at: https://wandb.ai/orangingq/torchtitan
[rank3]:wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
[rank3]:wandb: Find logs at: /data2/shcho/torchtitan/tb/1224_1F1B_apf_42_dm1/20251224-0717/wandb/run-20251224_071718-igb7defx/logs
[rank3]:2025-12-24 08:13:53,173 - Process group destroyed
[rank0]:2025-12-24 08:13:53,371 - Training completed
[rank0]:2025-12-24 08:13:53,372 - Destroying the purge thread.
[rank0]:2025-12-24 08:13:53,744 - Process group destroyed
[rank0]:Stage 0: Modules to keep: {'layers.1', 'layers.3', 'layers.0', 'tok_embeddings', 'layers.2'}
[rank2]:Stage 2: Modules to keep: {'layers.11', 'layers.9', 'layers.12', 'layers.10'}
[rank1]:Stage 1: Modules to keep: {'layers.6', 'layers.7', 'layers.8', 'layers.5', 'layers.4'}
[rank3]:Stage 3: Modules to keep: {'layers.15', 'output', 'norm', 'layers.14', 'layers.13'}
[rank0]:[Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank3]:----- TimelyFreezeâ° Configuration:
[rank3]:	- job:
[rank3]:		- config_file: /home/shcho/torchtitan/logs/dmserver1/1104_llama1b/config_1224.toml
[rank3]:		- dump_folder: /data2/shcho/torchtitan
[rank3]:		- description: "Main Table Experiment, without streaming mode, sample-level with truncation, with bf16 autocast
[rank3]:1107: for timelyapf: clone().cpu() removed to fix freezing issue.!!! yay~~~
[rank3]:1108: steps 1200 (3 epochs) -> 800 (2 epochs) / alpaca dataset
[rank3]:    - learning rate : tried lr=3e-6 (->3e-9), 5e-6(->0), 1e-5(->0). BEST: lr=5e-6
[rank3]:1109: switch to alpaca_gpt4+alpaca_cleaned dataset
[rank3]:1224: everything same as 1109 but debugged requires_grad bug
[rank3]:"
[rank3]:		- use_for_integration_test: False
[rank3]:		- print_args: False
[rank3]:		- basename: 1224_1F1B_apf_42_dm1
[rank3]:	- profiling:
[rank3]:		- enable_profiling: False
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/profile_trace/1224_1F1B_apf_42_dm1
[rank3]:		- profile_freq: 100
[rank3]:		- enable_memory_snapshot: False
[rank3]:		- save_memory_snapshot_folder: /data2/shcho/torchtitan/memory_snapshot/1224_1F1B_apf_42_dm1
[rank3]:	- metrics:
[rank3]:		- log_freq: 50
[rank3]:		- enable_tensorboard: False
[rank3]:		- disable_color_printing: True
[rank3]:		- save_tb_folder: /data2/shcho/torchtitan/tb/1224_1F1B_apf_42_dm1
[rank3]:		- save_for_all_ranks: False
[rank3]:		- enable_wandb: True
[rank3]:		- image_folder: /data2/shcho/torchtitan/images/1224_1F1B_apf_42_dm1
[rank3]:		- pplog_freq: 200
[rank3]:		- draw_freq: 100
[rank3]:		- wandb_name: 1224_1F1B_apf_42_dm1
[rank3]:		- draw_graph: True
[rank3]:	- model:
[rank3]:		- name: llama3
[rank3]:		- flavor: 1B
[rank3]:		- tokenizer_path: ./assets/tokenizer/Llama-3.2-1B
[rank3]:		- converters: []
[rank3]:		- print_after_conversion: False
[rank3]:	- optimizer:
[rank3]:		- name: AdamW
[rank3]:		- lr: 5e-06
[rank3]:		- beta1: 0.9
[rank3]:		- beta2: 0.95
[rank3]:		- eps: 1e-08
[rank3]:		- weight_decay: 0.1
[rank3]:		- implementation: fused
[rank3]:		- early_step_in_backward: False
[rank3]:	- lr_scheduler:
[rank3]:		- warmup_steps: 100
[rank3]:		- decay_ratio: 0.8
[rank3]:		- decay_type: cosine
[rank3]:		- min_lr_factor: 0.01
[rank3]:	- training:
[rank3]:		- dataset: alpaca_gpt4
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- global_batch_size: 128
[rank3]:		- seq_len: 1024
[rank3]:		- max_norm: 1.0
[rank3]:		- steps: 800
[rank3]:		- enable_cpu_offload: False
[rank3]:		- mixed_precision_param: bfloat16
[rank3]:		- mixed_precision_reduce: float32
[rank3]:		- compile: False
[rank3]:		- gc_freq: 50
[rank3]:		- gc_debug: False
[rank3]:		- seed: 42
[rank3]:		- deterministic: False
[rank3]:	- parallelism:
[rank3]:		- data_parallel_replicate_degree: 1
[rank3]:		- enable_compiled_autograd: False
[rank3]:		- data_parallel_shard_degree: -1
[rank3]:		- fsdp_reshard_after_forward: default
[rank3]:		- tensor_parallel_degree: 1
[rank3]:		- disable_loss_parallel: False
[rank3]:		- enable_async_tensor_parallel: False
[rank3]:		- pipeline_parallel_degree: 4
[rank3]:		- pipeline_parallel_split_points: []
[rank3]:		- module_fqns_per_model_part: None
[rank3]:		- pipeline_parallel_first_stage_less_layers: 1
[rank3]:		- pipeline_parallel_last_stage_less_layers: 1
[rank3]:		- pipeline_parallel_layers_per_stage: None
[rank3]:		- pipeline_parallel_schedule: 1F1B
[rank3]:		- pipeline_parallel_schedule_csv: 
[rank3]:		- pipeline_parallel_microbatch_size: 4
[rank3]:		- context_parallel_degree: 1
[rank3]:		- context_parallel_rotate_method: allgather
[rank3]:		- expert_parallel_degree: 1
[rank3]:		- pp: 4
[rank3]:		- stages_per_rank: 1
[rank3]:		- stages_list: [3]
[rank3]:		- microbatches: 8
[rank3]:	- checkpoint:
[rank3]:		- enable_checkpoint: True
[rank3]:		- checkpoint_folder: /data2/shcho/torchtitan/checkpoint/1224_1F1B_apf_42_dm1
[rank3]:		- interval: 1200
[rank3]:		- initial_load_path: /data2/shcho/torchtitan/base_model/Llama-3.2-1B/original_dcp
[rank3]:		- initial_load_model_only: True
[rank3]:		- initial_load_in_hf: False
[rank3]:		- last_save_model_only: True
[rank3]:		- last_save_in_hf: False
[rank3]:		- export_dtype: float16
[rank3]:		- async_mode: async
[rank3]:		- keep_latest_k: 2
[rank3]:		- load_step: -1
[rank3]:		- exclude_from_loading: ['dataloader', 'lr_scheduler', 'optimizer', 'train_state']
[rank3]:		- enable_first_step_checkpoint: False
[rank3]:		- create_seed_checkpoint: False
[rank3]:	- activation_checkpoint:
[rank3]:		- mode: none
[rank3]:		- selective_ac_option: op
[rank3]:		- per_op_sac_force_recompute_mm_shapes_by_fqns: ['moe.router.gate']
[rank3]:	- float8:
[rank3]:		- enable_fsdp_float8_all_gather: False
[rank3]:		- precompute_float8_dynamic_scale_for_fsdp: False
[rank3]:		- recipe_name: None
[rank3]:		- filter_fqns: ['output']
[rank3]:		- emulate: False
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- mx:
[rank3]:		- mxfp8_dim1_cast_kernel_choice: triton
[rank3]:		- recipe_name: mxfp8
[rank3]:		- filter_fqns: ['output']
[rank3]:		- moe_fqns_prototype: []
[rank3]:	- comm:
[rank3]:		- init_timeout_seconds: 300
[rank3]:		- train_timeout_seconds: 300
[rank3]:		- trace_buf_size: 20000
[rank3]:		- save_traces_folder: /data2/shcho/torchtitan/comm_traces/1224_1F1B_apf_42_dm1
[rank3]:		- world_size: 4
[rank3]:		- global_rank: 3
[rank3]:		- local_rank: 3
[rank3]:		- dp: 1
[rank3]:		- pp: 4
[rank3]:		- pp_rank: 3
[rank3]:		- dp_rank: 0
[rank3]:		- master_dp_rank: 0
[rank3]:	- memory_estimation:
[rank3]:		- enabled: False
[rank3]:		- disable_fake_mode: False
[rank3]:	- fault_tolerance:
[rank3]:		- enable: False
[rank3]:		- process_group: gloo
[rank3]:		- process_group_timeout_ms: 10000
[rank3]:		- replica_id: 0
[rank3]:		- group_size: 0
[rank3]:		- min_replica_size: 1
[rank3]:		- semi_sync_method: None
[rank3]:		- sync_steps: 5
[rank3]:		- should_quantize: False
[rank3]:		- fragment_sync_delay: 0
[rank3]:		- fragment_update_alpha: 0.0
[rank3]:	- experimental:
[rank3]:		- custom_import: 
[rank3]:		- custom_args_module: 
[rank3]:	- validation:
[rank3]:		- enabled: False
[rank3]:		- dataset: c4_validation
[rank3]:		- dataset_path: None
[rank3]:		- local_batch_size: 32
[rank3]:		- seq_len: 512
[rank3]:		- freq: 200
[rank3]:		- steps: 100
[rank3]:	- freezing:
[rank3]:		- freeze: True
[rank3]:		- metric_type: apf
[rank3]:		- phase_unit: 50
[rank3]:		- stability_check_freq: 10
[rank3]:		- max_freeze_ratio: 0.8
[rank3]:		- adjustment: False
[rank3]:		- threshold: 0.01
[rank3]:		- percentile: 80
[rank3]:
[rank3]:[Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank2]:[Gloo] Rank 2 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[rank1]:[Gloo] Rank 1 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
