{ 
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Llama3.2-1B",
            "type": "debugpy",
            "request": "launch",
            "env": {
                "CUDA_VISIBLE_DEVICES": "0,1,2,3",
                "CUBLAS_WORKSPACE_CONFIG": ":4096:8",
                // "NCCL_P2P_DISABLE": "1", 
                "PYTORCH_CUDA_ALLOC_CONF": "expandable_segments:True",
                "TORCHFT_LIGHTHOUSE": "http://localhost:29510",
                "PYTHONPATH": "$(workspaceFolder):/workspace/torchtitan:$PYTHONPATH",
                "LOG_RANK": "3"
            },
            "program": "/usr/local/bin/torchrun",
            "cwd": "/workspace/torchtitan",
            "justMyCode": false,
            "args": [
                "--nproc_per_node=4",
                "--nnodes=1",
                "--standalone",
                // "--rdzv_backend=c10d",
                // "--rdzv_endpoint=localhost:0",
                // "--local-ranks-filter=3", 
                "--role=rank",
                "--tee=3",
                "-m",
                "timelyfreeze.train",
                "--job.config_file=./timelyfreeze/train_configs/pp4_llama3_1b_apf.toml",
                "--metrics.basename=llama3.2_1b_timelyapf_debug",
                "--metrics.log_file=hello.log",
                "--freezing.freeze",
                "--freezing.metric_type=fullrand6"
                // "--job.config_file=./torchtitan/models/llama3/train_configs/pp_debug_model.toml",
            ],
            "console": "integratedTerminal"
        },
        {
            "name": "convert2hf",
            "type": "debugpy",
            "request": "launch",
            "env": {
                "CUDA_VISIBLE_DEVICES": "0",
                "CUBLAS_WORKSPACE_CONFIG": ":4096:8",
                // "NCCL_P2P_DISABLE": "1", 
                "PYTORCH_CUDA_ALLOC_CONF": "expandable_segments:True",
                "TORCHFT_LIGHTHOUSE": "http://localhost:29510",
                "PYTHONPATH": "$(workspaceFolder):/workspace/torchtitan:$PYTHONPATH",
                "LOG_RANK": "3",
            },
            "program": "/usr/local/bin/torchrun",
            "cwd": "/workspace/torchtitan",
            "justMyCode": false,
            "args": [
                "--nproc_per_node=1",
                "--nnodes=1",
                "--standalone",
                // "--rdzv_backend=c10d",
                // "--rdzv_endpoint=localhost:0",
                // "--local-ranks-filter=3", 
                "--role=rank",
                "--tee=0",
                "-m",
                "scripts.checkpoint_conversion.convert_to_hf",
                "workspace/torchtitan_data/checkpoint/0825_1f1b_apf_dm4/step-500",
                "workspace/torchtitan_data/checkpoint/0825_1f1b_apf_dm4/hf_step-500",
                "--model_name=llama3",
                "--model_flavor=1B",
            ],
            "console": "integratedTerminal"
        },
        {
            "name": "eval_hf_checkpoint",
            "type": "debugpy",
            "request": "launch",
            "env": { // python3 -m timelyfreeze.eval_hf_checkpoint --model_path=/workspace/torchtitan_data/checkpoint/0825_1f1b_apf_dm4/hf_step-500 
                "CUDA_VISIBLE_DEVICES": "0,1,2,3"
                // "CUBLAS_WORKSPACE_CONFIG": ":4096:8",
                // "NCCL_P2P_DISABLE": "1", 
                // "PYTORCH_CUDA_ALLOC_CONF": "expandable_segments:True",
                // "TORCHFT_LIGHTHOUSE": "http://localhost:29510",
                // "PYTHONPATH": "$(workspaceFolder):/workspace/torchtitan:$PYTHONPATH",
                // "LOG_RANK": "3",
            },
            "program": "/usr/local/bin/python3", 
            "cwd": "/workspace/torchtitan",
            "justMyCode": true,
            "args": [
                // "--nproc_per_node=4",
                // "--nnodes=1",
                // "--standalone",
                // "--role=rank",
                // "--tee=3",
                "-m",
                "timelyfreeze.eval_hf_checkpoint",
                "--model_path=/workspace/torchtitan_data/checkpoint/0825_1f1b_apf_dm4/hf_step-500",
                "--dtype=float16",
                "--output_json=/workspace/torchtitan_data/checkpoint/0825_1f1b_apf_dm4/hf_step-500/eval_results.json",
                "--limit=100",
            ],
            "console": "integratedTerminal"
        }
    ]
}


